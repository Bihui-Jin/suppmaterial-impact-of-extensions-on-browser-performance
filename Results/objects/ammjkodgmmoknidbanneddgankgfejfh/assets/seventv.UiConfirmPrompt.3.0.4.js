import{a as b,ab as d,r as P,t as k}from"./seventv.useUserAgent.3.0.4.js";import{w as R,n as B,H as T,a as S,I as M,_ as H,l as w,f as _,j as C,e as x,k as A,x as F,m as N,F as D,q}from"./seventv.useSettings.3.0.4.js";import{o as E}from"./seventv.index.esm.3.0.4.js";const L=new WeakMap;function V(u,e){let t=L.get(u);t||(t=b({userInput:0,init:!1,sys:!0,live:!1,visible:!0,paused:!1,pauseBuffer:[],scrollClear:()=>{},container:void 0,bounds:void 0}),L.set(u,t));const a=d(t,"container"),o=d(t,"bounds");e&&R(()=>{var s,r;(s=e.scroller.value)!=null&&s.container&&(a.value=e.scroller.value.container),e.bounds.value&&(o.value=e.bounds.value),(r=e.scroller.value)!=null&&r.isActive&&t.userInput++});async function v(s=0){if(!a.value||!(o!=null&&o.value)||t.paused)return;if(t.scrollClear(),t.sys=!0,s===0){a.value.scrollTo({top:a.value.scrollHeight}),o.value=a.value.getBoundingClientRect();return}const r=await new Promise(f=>{B(()=>{if(!a.value)return 0;f(a.value.scrollTop)})}),i=Date.now();let l=!1;function c(){if(!a.value||!(o!=null&&o.value)||t.paused||l)return;const f=Date.now(),h=Math.min(1,(f-i)/s);a.value.scrollTop=h*(a.value.scrollHeight-r)+r,h<1?requestAnimationFrame(c):o.value=a.value.getBoundingClientRect()}t.scrollClear=()=>l=!0,s<1?(a.value.scrollTo({top:a.value.scrollHeight}),o.value=a.value.getBoundingClientRect()):requestAnimationFrame(c)}function p(){t.paused=!0}async function m(){t.paused=!1,t.init=!0,B(()=>{t.init=!1,v()})}async function g(){const{top:s,h:r}=await new Promise(l=>{B(()=>{if(!a.value||!(o!=null&&o.value))return{top:0,h:0};const c=Math.floor(a.value.scrollTop),f=Math.floor(a.value.scrollHeight-o.value.height);l({top:c,h:f})})}),i=t.live=s>=r-1;if(!t.init){if(t.sys){t.sys=!1;return}t.userInput>0&&(t.userInput=0,p()),i&&m()}}function n(s){s.deltaY<0&&t.userInput++}return b({init:d(t,"init"),paused:d(t,"paused"),live:d(t,"live"),pauseBuffer:d(t,"pauseBuffer"),scrollToLive:v,pause:p,unpause:m,onScroll:g,onWheel:n})}const j=T("chat.smooth_scroll_duration"),U=T("chat.line_limit",150);let y;const I=T("chat.message_batch_duration"),$=new WeakMap;function ae(u){let e=$.get(u);e||(e=b({displayed:[],displayedByUser:{},awaited:new Map,buffer:[],moderated:[],chatters:{},chattersByUsername:{},overflowLimit:0,twitchHandlers:new Set,sendMessage:()=>{}}),$.set(u,e),B(()=>{S(()=>t.paused,(n,s)=>{if(n&&!s)return;const r=Math.ceil(t.pauseBuffer.length/32);let i=0;for(;t.pauseBuffer.length;){const l=t.pauseBuffer.splice(0,50);i+=r,M(()=>{e.displayed=e.displayed.concat(l)},i)}M(()=>{t.scrollToLive()},i+r)})}));const t=V(u);function a(n,s){if(t.paused){t.pauseBuffer.push(n),t.pauseBuffer.length>U.value&&t.pauseBuffer.shift();return}if(n.author){n.author.lastMsgId=n.sym;const r=e.chatters[n.author.id];r?(r.username=n.author.username,r.displayName=n.author.displayName,r.color=n.author.color,r.intl=n.author.intl):e.chatters[n.author.id]=n.author,(!e.chatters[n.author.id]||!e.chattersByUsername[n.author.username])&&(e.chatters[n.author.id]=n.author,n.author.username&&(e.chattersByUsername[n.author.username]=n.author)),e.displayedByUser[n.author.username]||(e.displayedByUser[n.author.username]={}),e.displayedByUser[n.author.username][n.id]=n}e.buffer.push(n),e.awaited.has(n.id)&&(e.awaited.get(n.id)(n),e.awaited.delete(n.id)),v(s)}function o(){e.displayed.length=0,e.buffer.length=0,e.chatters={}}function v(n){y||(y=window.setTimeout(()=>{if(t.paused){y=void 0;return}if(t.init==!0&&(t.init=!1),e.buffer.length>0){const r=e.buffer.splice(0,e.buffer.length);e.displayed.push(...r)}B(()=>t.scrollToLive(j.value));const s=U.value*1.25;e.displayed.length>s?y=window.setTimeout(()=>{const r=e.displayed.splice(0,e.displayed.length-U.value);for(const i of r){if(!i.author)continue;const l=e.displayedByUser[i.author.username];l&&delete l[i.id]}y=void 0},(n?5:I.value)/1.5):y=void 0},(n?5:I.value)/2))}function p(n,s){const r=e.displayed.length+t.pauseBuffer.length,i=e.displayed.length,l=[];for(let c=r-1;c>=0;c--){const f=c>=i?t.pauseBuffer[c-i]:e.displayed[c];if(f&&n(f)&&(l.push(f),!s))break}return s?l:l[0]??null}function m(n){const s=e.displayedByUser[n];return s?Object.values(s):[]}async function g(n,s=1e4){return new Promise((r,i)=>{const l=e.displayed.find(h=>h.id===n);if(l)return r(l);const c=e.buffer.find(h=>h.id===n);if(c)return r(c);const{stop:f}=M(()=>{e.awaited.delete(n),i(Error("Timed out waiting for message"))},s);e.awaited.set(n,h=>{r(h),f()})})}return b({displayed:d(e,"displayed"),handlers:e.twitchHandlers,chatters:d(e,"chatters"),chattersByUsername:d(e,"chattersByUsername"),moderated:d(e,"moderated"),sendMessage:d(e,"sendMessage"),find:p,messagesByUser:m,awaitMessage:g,add:a,clear:o})}const O={},z={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"1em",height:"1em",fill:"currentColor"},Y=C("path",{d:"M68.6 57.4L46 34.7 .7 80l22.6 22.6L176.7 256 23.4 409.4 .7 432 46 477.3l22.6-22.6L222 301.3 375.4 454.6 398 477.3 443.3 432l-22.6-22.6L267.3 256 420.6 102.6 443.3 80 398 34.7 375.4 57.4 222 210.7 68.6 57.4z"},null,-1),G=[Y];function J(u,e){return w(),_("svg",z,G)}const K=H(O,[["render",J]]),Q={key:0,class:"seventv-confirm-prompt-heading"},X={class:"seventv-confirm-prompt-body"},Z={key:0},W={class:"seventv-confirm-prompt-choice"},ee=["onClick"],te=x({__name:"UiConfirmPrompt",props:{title:null,message:null,choices:null},emits:["answer","close"],setup(u,{emit:e}){const t=P();function a(o){e("answer",o),e("close")}return E(t,()=>{e("close")}),(o,v)=>(w(),_("main",{ref_key:"promptRef",ref:t,class:"seventv-confirm-prompt"},[u.title?(w(),_("div",Q,[C("p",null,k(u.title),1),A(K,{onClick:v[0]||(v[0]=p=>e("close"))})])):F("",!0),C("div",X,[u.message?(w(),_("p",Z,k(u.message),1)):N(o.$slots,"default",{key:1},void 0,!0)]),C("div",W,[(w(!0),_(D,null,q(u.choices,(p,m)=>(w(),_("button",{key:m,onClick:g=>a(p)},k(p.toUpperCase()),9,ee))),128))])],512))}});const oe=H(te,[["__scopeId","data-v-591ff630"]]);export{K as C,oe as U,V as a,ae as u};
