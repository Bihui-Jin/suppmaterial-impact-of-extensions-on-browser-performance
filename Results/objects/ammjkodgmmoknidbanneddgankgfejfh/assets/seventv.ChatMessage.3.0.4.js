var V=Object.defineProperty;var B=(t,n,_)=>n in t?V(t,n,{enumerable:!0,configurable:!0,writable:!0,value:_}):t[n]=_;var i=(t,n,_)=>(B(t,typeof n!="symbol"?n+"":n,_),_);import{e as P}from"./seventv.useSettings.3.0.4.js";import{m as x}from"./seventv.useUserAgent.3.0.4.js";var C;(t=>{t.MessageDelimiter=new RegExp("( )","g"),t.Link=new RegExp("^(?:https?:\\/\\/(?:www\\.)?)?([a-z0-9-]+\\.)+[a-z0-9@]{2,6}(\\/[^\\s]*)?$","gim"),t.Mention=new RegExp("@([A-Za-z0-9_]{1,24})"),t.SevenTVLink=new RegExp("^https?:\\/\\/(?:www\\.)?7tv.app\\/emotes\\/(?<emoteID>[0-9a-f]{24})","gi")})(C||(C={}));var G;(t=>{t.ROOT="#root div",t.NAV="[data-a-target='top-nav-container']",t.MainLayout="main.twilight-main, #root.sunlight-root > div:nth-of-type(3), #root[data-a-page-loaded-name='PopoutChatPage'] > div, #root[data-a-page-loaded-name='ModerationViewChannelPage'] > div:nth-of-type(1)",t.ChatContainer="section[data-test-selector='chat-room-component-layout']",t.VideoChatContainer="div.video-chat.va-vod-chat",t.ChatScrollableContainer=".chat-scrollable-area__message-container",t.ChatLine=".chat-line__message",t.VideoChatMessage=".vod-message > div:not(.vod-message__header) > div",t.ChatInput=".chat-input__textarea",t.ChatInputButtonsContainer="div[data-test-selector='chat-input-buttons-container']",t.ChatMessageContainer=".chat-line__message-container",t.ChatList=".chat-list--default ",t.ChatUsernameContainer=".chat-line__username-container",t.ChatAuthorDisplayName=".chat-author__display-name",t.ChatMessageBadges=".chat-line__message--badges",t.ChatMessageUsername=".chat-line__usernames",t.ChatMessageTimestamp=".chat-line__timestamp"})(G||(G={}));var F=(t=>(t[t.MESSAGE=0]="MESSAGE",t[t.EXTENSION_MESSAGE=1]="EXTENSION_MESSAGE",t[t.MODERATION=2]="MODERATION",t[t.MODERATION_ACTION=3]="MODERATION_ACTION",t[t.TARGETED_MODERATION_ACTION=4]="TARGETED_MODERATION_ACTION",t[t.AUTO_MOD=5]="AUTO_MOD",t[t.SUBSCRIBER_ONLY_MODE=6]="SUBSCRIBER_ONLY_MODE",t[t.FOLLOWER_ONLY_MODE=7]="FOLLOWER_ONLY_MODE",t[t.SLOW_MODE=8]="SLOW_MODE",t[t.EMOTE_ONLY_MODE=9]="EMOTE_ONLY_MODE",t[t.R9K_MODE=10]="R9K_MODE",t[t.CONNECTED=11]="CONNECTED",t[t.DISCONNECTED=12]="DISCONNECTED",t[t.RECONNECT=13]="RECONNECT",t[t.SUBSCRIPTION=14]="SUBSCRIPTION",t[t.RESUBSCRIPTION=15]="RESUBSCRIPTION",t[t.GIFT_PAID_UPGRADE=16]="GIFT_PAID_UPGRADE",t[t.ANON_GIFT_PAID_UPGRADE=17]="ANON_GIFT_PAID_UPGRADE",t[t.PRIME_PAID_UPGRADE=18]="PRIME_PAID_UPGRADE",t[t.PRIME_COMMUNITY_GIFT_RECEIVED_EVENT=19]="PRIME_COMMUNITY_GIFT_RECEIVED_EVENT",t[t.EXTEND_SUBSCRIPTION=20]="EXTEND_SUBSCRIPTION",t[t.SUB_GIFT=21]="SUB_GIFT",t[t.ANON_SUB_GIFT=22]="ANON_SUB_GIFT",t[t.CLEAR=23]="CLEAR",t[t.ROOM_MODS=24]="ROOM_MODS",t[t.ROOM_STATE=25]="ROOM_STATE",t[t.RAID=26]="RAID",t[t.UNRAID=27]="UNRAID",t[t.NOTICE=28]="NOTICE",t[t.INFO=29]="INFO",t[t.BADGES_UPDATED=30]="BADGES_UPDATED",t[t.PURCHASE=31]="PURCHASE",t[t.BITS_CHARITY=32]="BITS_CHARITY",t[t.CRATE_GIFT=33]="CRATE_GIFT",t[t.REWARD_GIFT=34]="REWARD_GIFT",t[t.SUB_MYSTERY_GIFT=35]="SUB_MYSTERY_GIFT",t[t.ANON_SUB_MYSTERY_GIFT=36]="ANON_SUB_MYSTERY_GIFT",t[t.STANDARD_PAY_FORWARD=37]="STANDARD_PAY_FORWARD",t[t.COMMUNITY_PAY_FORWARD=38]="COMMUNITY_PAY_FORWARD",t[t.FIRST_CHEER_MESSAGE=39]="FIRST_CHEER_MESSAGE",t[t.FIRST_MESSAGE_HIGHLIGHT=40]="FIRST_MESSAGE_HIGHLIGHT",t[t.BITS_BADGE_TIER_MESSAGE=41]="BITS_BADGE_TIER_MESSAGE",t[t.INLINE_PRIVATE_CALLOUT=42]="INLINE_PRIVATE_CALLOUT",t[t.CHANNEL_POINTS_REWARD=43]="CHANNEL_POINTS_REWARD",t[t.COMMUNITY_CHALLENGE_CONTRIBUTION=44]="COMMUNITY_CHALLENGE_CONTRIBUTION",t[t.LIVE_MESSAGE_SEPARATOR=45]="LIVE_MESSAGE_SEPARATOR",t[t.RESTRICTED_LOW_TRUST_USER_MESSAGE=46]="RESTRICTED_LOW_TRUST_USER_MESSAGE",t[t.COMMUNITY_INTRODUCTION=47]="COMMUNITY_INTRODUCTION",t[t.SHOUTOUT=48]="SHOUTOUT",t[t.ANNOUNCEMENT_MESSAGE=49]="ANNOUNCEMENT_MESSAGE",t[t.MIDNIGHT_SQUID=50]="MIDNIGHT_SQUID",t[t.CHARITY_DONATION=51]="CHARITY_DONATION",t[t.MESSAGE_ID_UPDATE=52]="MESSAGE_ID_UPDATE",t[t.PINNED_CHAT=53]="PINNED_CHAT",t[t.VIEWER_MILESTONE=54]="VIEWER_MILESTONE",t[t.SEVENTV_EMOTE_SET_UPDATE=7e3]="SEVENTV_EMOTE_SET_UPDATE",t))(F||{}),H=(t=>(t[t.BAN=0]="BAN",t[t.TIMEOUT=1]="TIMEOUT",t[t.DELETE=2]="DELETE",t))(H||{}),Y=(t=>(t[t.TEXT=0]="TEXT",t[t.MODERATEDTEXT=1]="MODERATEDTEXT",t[t.FLAGGEDSEGMENT=2]="FLAGGEDSEGMENT",t[t.CURRENTUSERHIGHLIGHT=3]="CURRENTUSERHIGHLIGHT",t[t.MENTION=4]="MENTION",t[t.LINK=5]="LINK",t[t.EMOTE=6]="EMOTE",t[t.CLIPLINK=7]="CLIPLINK",t[t.VIDEOLINK=8]="VIDEOLINK",t[t.SEVENTVEMOTE=700]="SEVENTVEMOTE",t[t.SEVENTVLINK=701]="SEVENTVLINK",t))(Y||{});const k=/^https?:\/\//i,b=new Set(["w!","h!","v!"]);class L{constructor(n){this.msg=n}tokenize(n){var h;const _=[],o=this.msg.body.split(" "),O=E=>{var I;return((I=n.localEmoteMap)==null?void 0:I[E])??n.emoteMap[E]};let R=-1,c;const S=(E,I)=>({kind:"VOID",range:[E,I],content:void 0});for(const E of o){const I=R+(E.length+1),A=O(E),l=O(o[o.indexOf(E)+1]),T=O(o[o.indexOf(E)-1]),v=!!n.chatterMap[E.toLowerCase()];if(A)(((h=A.data)==null?void 0:h.flags)??0)&256&&c?(c.content.overlaid[A.name]=A,_.push(S(R+1,I-1))):_.push(c={kind:"EMOTE",range:[R+1,I-1],content:{emote:A,overlaid:{},...A.isTwitchCheer?{cheerAmount:A.isTwitchCheer.amount,cheerColor:A.isTwitchCheer.color}:{}}});else if(l&&b.has(E))_.push(S(R,I-1));else if(T&&E.startsWith("ffz")&&E.length>3)_.push(S(R,I-1));else if(E.match(C.Link)){const D=E.replace(k,"");_.push({kind:"LINK",range:[R+1,I-1],content:{displayText:E,url:"https://"+D}})}else if(E.match(C.Mention)||v){const D=E.indexOf(","),r=D>0?D:E.length,m=(E.charAt(0)==="@"?E.slice(1,r):E).toLowerCase(),w=n.chatterMap[m];_.push({kind:"MENTION",range:[R+1,R+r],content:{displayText:E.slice(0,r),recipient:m,user:w}}),this.msg.mentions.add(m)}R=I,!A&&E&&(c=void 0)}return _.sort((E,I)=>E.range[0]-I.range[0]),this.msg.tokens=_}}let d;const W=new Uint8Array(16);function z(){if(!d&&(d=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!d))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return d(W)}const N=[];for(let t=0;t<256;++t)N.push((t+256).toString(16).slice(1));function K(t,n=0){return(N[t[n+0]]+N[t[n+1]]+N[t[n+2]]+N[t[n+3]]+"-"+N[t[n+4]]+N[t[n+5]]+"-"+N[t[n+6]]+N[t[n+7]]+"-"+N[t[n+8]]+N[t[n+9]]+"-"+N[t[n+10]]+N[t[n+11]]+N[t[n+12]]+N[t[n+13]]+N[t[n+14]]+N[t[n+15]]).toLowerCase()}let f,u,a=0,U=0;function X(t,n,_){let o=n&&_||0;const O=n||new Array(16);t=t||{};let R=t.node||f,c=t.clockseq!==void 0?t.clockseq:u;if(R==null||c==null){const l=t.random||(t.rng||z)();R==null&&(R=f=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),c==null&&(c=u=(l[6]<<8|l[7])&16383)}let S=t.msecs!==void 0?t.msecs:Date.now(),h=t.nsecs!==void 0?t.nsecs:U+1;const E=S-a+(h-U)/1e4;if(E<0&&t.clockseq===void 0&&(c=c+1&16383),(E<0||S>a)&&t.nsecs===void 0&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=S,U=h,u=c,S+=122192928e5;const I=((S&268435455)*1e4+h)%4294967296;O[o++]=I>>>24&255,O[o++]=I>>>16&255,O[o++]=I>>>8&255,O[o++]=I&255;const A=S/4294967296*1e4&268435455;O[o++]=A>>>8&255,O[o++]=A&255,O[o++]=A>>>24&15|16,O[o++]=A>>>16&255,O[o++]=c>>>8|128,O[o++]=c&255;for(let l=0;l<6;++l)O[o+l]=R[l];return n||K(O)}P({});class Z{constructor(n){i(this,"sym",Symbol("seventv-message"));i(this,"id");i(this,"body","");i(this,"author",null);i(this,"channelID","");i(this,"component",null);i(this,"componentProps",null);i(this,"highlight",null);i(this,"flags",new Set);i(this,"mentions",new Set);i(this,"badges",{});i(this,"nonce","");i(this,"deliveryState","IDLE");i(this,"timestamp",0);i(this,"historical",!1);i(this,"moderation",{deleted:!1,banned:!1,banDuration:null,banReason:"",actionType:null,actor:null,timestamp:0});i(this,"richEmbed",{title:"",author_name:"",twitch_metadata:{clip_metadata:{game:"",channel_display_name:"",slug:"",id:"",broadcaster_id:"",curator_id:""}},thumbnail_url:"",request_url:""});i(this,"pinnable",!1);i(this,"deletable",!1);i(this,"slashMe",!1);i(this,"parent",null);i(this,"wrappedNode",null);i(this,"nativeEmotes",{});i(this,"tokens",new Array);i(this,"tokenizer");i(this,"version",0);n?this.id=n:this.id=X(),this.tokenizer=new L(this)}update(){this.version++}get instance(){return this.component??null}get instanceProps(){return this.componentProps??null}getTokenizer(){return this.tokenizer??(this.tokenizer=new L(this))}setAuthor(n){typeof n.username!="string"&&(n.username=""),typeof n.displayName!="string"&&(n.displayName=""),this.author=n}setID(n){this.id=n}setHighlight(n,_){this.highlight={color:n,label:_}}setNonce(n){this.nonce=n}setDeliveryState(n){this.deliveryState=n}setComponent(n,_){return this.component=x(n),this.componentProps=_,this}setTimestamp(n){this.timestamp=n}}export{Z as C,Y as M,F as a,H as b,z as r,K as u};
