import{e as D,l as s,f as i,j as d,_ as b,aO as W,a as ee,n as Ie,C as J,F as E,q,u as w,x as _,B as F,m as Re,X as De,k as R,H as V,K as pe,s as oe,y as j,$ as ae,aM as re,I as _e,w as ie}from"./seventv.useSettings.3.0.4.js";import{u as ye,a as Q,S as Se,E as le}from"./seventv.Emote.3.0.4.js";import{a as te,t as T,r as y,u as o,b as L,n as be,m as Ue,ab as He,l as Ee}from"./seventv.useUserAgent.3.0.4.js";import{u as A}from"./seventv.useChannelContext.3.0.4.js";import{g as ne}from"./seventv.seventv.user.gql.3.0.4.js";import{u as Me,U as Ve}from"./seventv.UiConfirmPrompt.3.0.4.js";import{a as ue}from"./seventv.useFloatContext.3.0.4.js";import{o as Pe}from"./seventv.index.esm.3.0.4.js";import{R as Ne}from"./seventv.ReactHooks.3.0.4.js";import{a as Fe}from"./seventv.useModule.3.0.4.js";import{u as Le}from"./seventv.useChatEmotes.3.0.4.js";import{T as Ae}from"./seventv.TwClose.3.0.4.js";const ce=new WeakMap;function $e(e){let n=ce.get(e);return n||(n=te({isModerator:!1,isVIP:!1,isDarkTheme:1,primaryColorHex:null,useHighContrastColors:!0,showTimestamps:!1,showModerationIcons:!1,hovering:!1,pauseReason:new Set(["SCROLL"]),currentChannel:{},imageFormat:"WEBP",twitchBadgeSets:{},blockedUsers:new Set}),ce.set(e,n)),n}const ze={ref:"tooltip",class:"seventv-tooltip","tooltip-type":"badge"},Oe=D({__name:"BadgeTooltip",props:{alt:null},setup(e){return(n,t)=>(s(),i("div",ze,[d("p",null,T(e.alt),1)],512))}});const Ye=b(Oe,[["__scopeId","data-v-8b477951"]]),je={class:"seventv-chat-badge"},We=["srcset","alt"],Ze=D({__name:"Badge",props:{alt:null,type:null,badge:null},setup(e){const n=e,t=y(""),a={twitch:m=>`${m.image1x} 1x, ${m.image2x} 2x, ${m.image4x} 4x`,app:m=>m.data.host.files.map((v,M)=>`https:${m.data.host.url}/${v.name} ${M+1}x`).join(", ")}[n.type](n.badge),r=y(),{show:l,hide:c}=W(Ye,{alt:n.alt});function u(m){return m.kind==="BADGE"&&n.type==="app"}return u(n.badge)&&(t.value=n.badge.data.backgroundColor??""),(m,v)=>(s(),i("div",je,[d("img",{ref_key:"imgRef",ref:r,srcset:o(a),alt:e.alt,style:L({backgroundColor:t.value}),onMouseenter:v[0]||(v[0]=M=>o(l)(r.value)),onMouseleave:v[1]||(v[1]=M=>o(c)())},null,44,We)]))}});const de=b(Ze,[["__scopeId","data-v-2f02f001"]]),qe={key:0,class:"seventv-chat-user-badge-list"},Ge={key:0},Ke={key:1},Qe=D({__name:"UserTag",props:{user:null,msgId:null,asMention:{type:Boolean},hideBadges:{type:Boolean},badges:null},emits:["nameClick","badgeClick"],setup(e,{emit:n}){const t=e,a=A(),r=$e(a),l=ye(t.user.id),c=y([]),u=y(null),m=y([]);if(t.badges&&r.twitchBadgeSets)for(const[k,x]of Object.entries(t.badges)){const S=k,C=x;for(const g of[r.twitchBadgeSets.channelsBySet,r.twitchBadgeSets.globalsBySet]){if(!g)continue;const h=g.get(S);if(!h)continue;const f=h.get(C);if(f){c.value.push(f);break}}}const v=Date.now(),M=ee([l.paints,l.badges],([k,x])=>{if(t.msgId&&t.user.lastMsgId&&t.msgId!==t.user.lastMsgId&&Date.now()-v>5e3){Ie(()=>M());return}u.value=k&&k.size?k.values().next().value:null,m.value=[...x.values()]},{immediate:!0});return(k,x)=>{const S=J("cosmetic-paint"),C=J("tooltip");return e.user&&e.user.displayName?(s(),i("div",{key:0,class:"seventv-chat-user",style:L({color:e.user.color})},[!e.hideBadges&&(c.value.length||o(l).badges.size)?(s(),i("span",qe,[(s(!0),i(E,null,q(c.value,g=>(s(),w(de,{key:g.id,badge:g,alt:g.title,type:"twitch",onClick:h=>n("badgeClick",h,g)},null,8,["badge","alt","onClick"]))),128)),(s(!0),i(E,null,q(m.value,g=>(s(),w(de,{key:g.id,badge:g,alt:g.data.tooltip,type:"app"},null,8,["badge","alt"]))),128))])):_("",!0),F((s(),i("span",{class:"seventv-chat-user-username",onClick:x[0]||(x[0]=g=>n("nameClick",g))},[F((s(),i("span",null,[e.asMention?(s(),i("span",Ge,"@")):_("",!0),d("span",null,T(e.user.displayName),1),e.user.intl?(s(),i("span",Ke," ("+T(e.user.username)+")",1)):_("",!0)])),[[S,u.value?u.value.id:null]])])),[[C,u.value&&u.value.data?`Paint: ${u.value.data.name}`:""]])],4)):_("",!0)}}});const G=b(Qe,[["__scopeId","data-v-0e932a41"]]);function Xe(e){return e.kind==="LINK"}function me(e){return e.kind==="EMOTE"}function Je(e){return e.kind==="MENTION"}const et=ne`
	mutation Chat_BanUserFromChatRoom($input: BanUserFromChatRoomInput!) {
		banUserFromChatRoom(input: $input) {
			ban {
				bannedUser {
					id
					login
					displayName
				}
				createdAt
				expiresAt
				isPermanent
				moderator {
					id
					login
					displayName
				}
				reason
			}
			error {
				code
				minTimeoutDurationSeconds
				maxTimeoutDurationSeconds
			}
		}
	}
`,tt=ne`
	mutation Chat_UnbanUserFromChatRoom($input: UnbanUserFromChatRoomInput!) {
		unbanUserFromChatRoom(input: $input) {
			ban {
				bannedUser {
					id
					login
					displayName
				}
				createdAt
				expiresAt
				isPermanent
				moderator {
					id
					login
					displayName
				}
			}
			error {
				code
			}
		}
	}
`,nt=ne`
	mutation PinChatMessage($input: PinChatMessageInput!) {
		pinChatMessage(input: $input) {
			pinnedChatMessage {
				id
				pinnedMessage {
					id
				}
			}
			error {
				code
			}
		}
	}
`;function Ce(e,n){const t=Me(e);function a(u,m){const v=Q();return v?v.mutate({mutation:et,variables:{input:{channelID:e.id,bannedUserLogin:n,expiresIn:u,reason:m}}}):null}function r(){const u=Q();return u?u.mutate({mutation:tt,variables:{input:{channelID:e.id,bannedUserLogin:n}}}):null}function l(u,m){const v=Q();return v?v.mutate({mutation:nt,variables:{input:{channelID:e.id,messageID:u,durationSeconds:m,type:"MOD"}}}):null}function c(u){t.sendMessage(`/delete ${u}`)}return{banUserFromChat:a,unbanUserFromChat:r,pinChatMessage:l,deleteChatMessage:c}}const he=new WeakMap;function ke(e){let n=he.get(e);n||(n=te({TWITCH:{onShowViewerCard:()=>{}},YOUTUBE:{},UNKNOWN:{}}),he.set(e,n));function t(r,l,c){n&&(n[r][l]=c)}function a(r,l,c){if(!n||!r||!r.currentTarget||!l)return!1;const u=r.currentTarget.getBoundingClientRect();return n[e.platform].onShowViewerCard(l,0,c,u.bottom),!0}return{update:t,openViewerCard:a}}const st={class:"seventv-chat-message-rich-embed"},ot=["href"],at={class:"seventv-chat-message-rich-embed-layout"},rt={class:"seventv-chat-message-rich-embed-layout-thumbnail"},it=["src"],lt={class:"seventv-chat-message-rich-embed-layout-description"},ut={class:"seventv-chat-message-rich-embed-layout-description-title"},ct={key:0},dt={class:"seventv-chat-message-rich-embed-layout-description-author"},mt=D({__name:"RichEmbed",props:{richEmbed:null},setup(e){return(n,t)=>(s(),i("div",st,[d("a",{href:e.richEmbed.request_url,target:"_blank",class:"seventv-chat-message-rich-embed-link"},[d("div",at,[d("div",rt,[d("img",{src:e.richEmbed.thumbnail_url,alt:"thumbnail"},null,8,it)]),d("div",lt,[d("div",null,[d("p",ut,T(e.richEmbed.title),1)]),e.richEmbed.twitch_metadata.clip_metadata.id?(s(),i("div",ct,[d("p",dt," Clipped by "+T(e.richEmbed.author_name),1)])):_("",!0)])])],8,ot)]))}});const ht=b(mt,[["__scopeId","data-v-3b3c898f"]]),gt={},vt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"1em",height:"1em",fill:"currentColor"},ft=d("path",{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"},null,-1),pt=[ft];function _t(e,n){return s(),i("svg",vt,pt)}const yt=b(gt,[["render",_t]]),bt={},Mt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"1em",height:"1em",fill:"currentColor"},$t=d("path",{d:"M64 0H32V64H64 93.5L82.1 212.1C23.7 240.7 0 293 0 320v32H384V320c0-22.5-23.7-76.5-82.1-106.7L290.5 64H320h32V0H320 64zm96 480v32h64V480 384H160v96z"},null,-1),Ct=[$t];function kt(e,n){return s(),i("svg",Mt,Ct)}const wt=b(bt,[["render",kt]]),Tt={},xt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"1em",height:"1em",fill:"currentColor"},Bt=d("path",{d:"M0 208L192 384h32V288h80c61.9 0 112 50.1 112 112c0 48-32 80-32 80s128-48 128-176c0-97.2-78.8-176-176-176H224V32H192L0 208z"},null,-1),It=[Bt];function Rt(e,n){return s(),i("svg",xt,It)}const Dt=b(Tt,[["render",Rt]]),St={},Ut={fill:"currenColor",width:"1em",height:"1em",version:"1.1",viewBox:"0 0 16 16",x:"0px",y:"0px"},Ht=d("g",null,[d("path",{d:"M5 6H7V8H5V6Z"}),d("path",{d:"M9 6H11V8H9V6Z"}),d("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 14L10 12H13C13.5523 12 14 11.5523 14 11V3C14 2.44772 13.5523 2 13 2H3C2.44772 2 2 2.44772 2 3V11C2 11.5523 2.44772 12 3 12H6L8 14ZM6.82843 10H4V4H12V10H9.17157L8 11.1716L6.82843 10Z"})],-1),Et=[Ht];function Vt(e,n){return s(),i("svg",Ut,Et)}const we=b(St,[["render",Vt]]),Pt={class:"seventv-copied-message-toast-body"},Nt={key:0},Ft=D({__name:"UiCopiedMessageToast",props:{message:null},emits:["close"],setup(e,{emit:n}){const t=y();return Pe(t,()=>{n("close")}),(a,r)=>(s(),i("main",{ref_key:"copiedMessageToastRef",ref:t,class:"seventv-copied-message-toast"},[d("div",Pt,[e.message?(s(),i("p",Nt,T(e.message),1)):Re(a.$slots,"default",{key:1},void 0,!0)])],512))}});const Lt=b(Ft,[["__scopeId","data-v-fbb0ba18"]]),At={},zt={width:"1em",height:"1em",version:"1.1",viewBox:"0 0 20 20",x:"0px",y:"0px"},Ot=d("path",{d:"M8.5 5.5L7 4L2 9L7 14L8.5 12.5L6 10H10C12.2091 10 14 11.7909 14 14V16H16V14C16 10.6863 13.3137 8 10 8H6L8.5 5.5Z"},null,-1),Yt=[Ot];function jt(e,n){return s(),i("svg",zt,Yt)}const Wt=b(At,[["render",jt]]),Zt={class:"seventv-tray-header"},qt={class:"seventv-tray-icon seventv-reply"},Gt={class:"seventv-tray-header-text"},Kt={key:0},Qt={key:1},Xt={class:"seventv-tray-user-message-container"},Jt=D({__name:"ReplyTray",props:{close:{type:Function},id:null,authorID:null,username:null,displayName:null,body:null,deleted:{type:Boolean}},setup(e){const n=e,t=y(null),a=y([]),r=A(),l=Le(r),{find:c}=Me(r);return De(()=>{if(t.value=c(m=>m.id===n.id),!t.value)return;const u=c(m=>!!(m.parent&&m.parent.id===t.value.id),!0);a.value=[...u,t.value]}),(u,m)=>(s(),i(E,null,[d("div",Zt,[d("div",qt,[a.value.length<=1?(s(),w(Wt,{key:0})):(s(),w(we,{key:1}))]),d("div",Gt,[a.value.length<=1&&e.authorID?(s(),i("span",Kt,T(`Replying to @${e.displayName??e.username}:`),1)):(s(),i("span",Qt," Thread "))]),d("div",{class:"seventv-tray-icon seventv-close",onClick:m[0]||(m[0]=v=>e.close())},[R(Ae)])]),d("div",Xt,[(s(!0),i(E,null,q(a.value,v=>{var M;return s(),w(qn,{key:v.id,msg:v,emotes:o(l).active,as:"Reply",class:be(["thread-msg",{"is-root-msg":((M=t.value)==null?void 0:M.id)===v.id}])},null,8,["msg","emotes","class"])}),128))])],64))}});const en=b(Jt,[["__scopeId","data-v-5446d2a3"]]),ge=te(new Set);function ve(e,n){const t=y({current:null}),a={parent:t.value,component:Ue(e),props:n},r=ee(t.value,()=>{t.value.current?ge.add(a):(ge.delete(a),r())});return{$$typeof:Ne,key:null,ref:t.value,type:"seventv-tray-container",props:{}}}function tn(e){const n=e;return!!(n.id&&n.body)&&typeof n.deleted=="boolean"}function nn(e){return{body:en,inputValueOverride:"",sendButtonOverride:"reply",disableBits:!0,disablePaidPinnedChat:!0,disableChat:e.deleted,sendMessageHandler:{type:"reply",additionalMetadata:{reply:{parentMsgId:e.id,parentMessageBody:e.body,...e.authorID?{parentUid:e.authorID,parentUserLogin:e.username,parentDisplayName:e.displayName}:{}}}},type:"reply"}}function sn(e,n){let t=null;switch(e){case"Reply":if(!tn(n))break;t=nn(n)}return t}function on(e,n,t){const a=Fe("chat-input");function r(){var c;!a.value||typeof((c=a.value.instance)==null?void 0:c.setTray)!="function"||a.value.instance.setTray(null)}function l(){var m;if(!a.value||typeof((m=a.value.instance)==null?void 0:m.setTray)!="function")return;const c={...n==null?void 0:n(),close:r};if(!c)return;const u=t??sn(e,c);u&&a.value.instance.setTray({...u,header:u.header?ve(u.header,c):void 0,body:u.body?ve(u.body,c):void 0})}return{open:l,clear:r}}const an={class:"seventv-chat-message-buttons"},rn=D({__name:"UserMessageButtons",props:{msg:null},emits:["pin"],setup(e,{emit:n}){const t=e,a=on("Reply",()=>{var C,g,h,f,P,z,O,N,B,$,H,p;return{id:((C=t.msg.parent)==null?void 0:C.id)??t.msg.id,body:((g=t.msg.parent)==null?void 0:g.body)??t.msg.body,deleted:((h=t.msg.parent)==null?void 0:h.deleted)??t.msg.moderation.deleted,...((f=t.msg.parent)==null?void 0:f.author)??t.msg.author?{authorID:((P=t.msg.parent)==null?void 0:P.uid)??((z=t.msg.author)==null?void 0:z.id),username:((N=(O=t.msg.parent)==null?void 0:O.author)==null?void 0:N.username)??((B=t.msg.author)==null?void 0:B.username),displayName:((H=($=t.msg.parent)==null?void 0:$.author)==null?void 0:H.displayName)??((p=t.msg.author)==null?void 0:p.displayName)}:{}}}),r=V("chat.copy_icon_toggle"),l=y(!1),c=y(),u=ue(c,{enabled:()=>l.value,middleware:[re({padding:8})]});function m(){l.value||(navigator.clipboard.writeText(t.msg.body),l.value=!0,_e(()=>{l.value=!1},1e3))}const v=y(!1),M=y(),k=ue(M,{enabled:()=>v.value,middleware:[re({padding:8})]});function x(){a.open()}function S(C){C==="yes"&&n("pin")}return(C,g)=>{const h=J("tooltip");return s(),i(E,null,[d("div",an,[o(r)&&!e.msg.moderation.deleted?F((s(),i("div",{key:0,ref_key:"copyButtonRef",ref:c,class:"seventv-button",onClick:g[0]||(g[0]=f=>m())},[R(yt)])),[[h,"Copy"]]):_("",!0),e.msg.pinnable&&!e.msg.moderation.deleted?F((s(),i("div",{key:1,ref_key:"pinButtonRef",ref:M,class:"seventv-button",onClick:g[1]||(g[1]=f=>v.value=!0)},[R(wt)])),[[h,"Pin"]]):_("",!0),F((s(),i("div",{class:"seventv-button",onClick:x},[(s(),w(pe(e.msg.parent?we:Dt)))])),[[h,"Reply"]])]),l.value&&o(u)?(s(),w(ae,{key:0,to:o(u)},[R(Lt,{title:"Message Copied",onClose:g[2]||(g[2]=f=>l.value=!1)},{default:oe(()=>[j(" Message from "),e.msg.author?(s(),w(G,{key:0,user:e.msg.author},null,8,["user"])):_("",!0),j(" has been copied ")]),_:1})],8,["to"])):_("",!0),v.value&&o(k)?(s(),w(ae,{key:1,to:o(k)},[R(Ve,{title:"Pin Message?",choices:["yes","no"],onClose:g[3]||(g[3]=f=>v.value=!1),onAnswer:g[4]||(g[4]=f=>S(f))},{default:oe(()=>[j(" Are you sure you want to pin this message by "),e.msg.author?(s(),w(G,{key:0,user:e.msg.author},null,8,["user"])):_("",!0),j("? ")]),_:1})],8,["to"])):_("",!0)],64)}}});const ln=b(rn,[["__scopeId","data-v-a9cb6e1b"]]),un=["href"],cn=D({__name:"Link",props:{token:null,msg:null},setup(e){return(n,t)=>(s(),i("a",{href:e.token.content.url,target:"_blank",class:"link-part"},T(e.token.content.displayText),9,un))}}),dn={key:1},mn=D({__name:"Mention",props:{token:null,msg:null},setup(e){const n=e,t=V("chat.colored_mentions"),a=A(),r=ke(a);function l(c){r.openViewerCard(c,n.token.content.recipient,n.msg.id)}return(c,u)=>(s(),i("span",{class:"mention-token",onClick:l},[o(t)&&e.token.content.user?(s(),i("span",{key:0,style:L({color:e.token.content.user.color})},[R(G,{user:e.token.content.user,"as-mention":e.token.content.displayText.charAt(0)==="@","hide-badges":!0},null,8,["user","as-mention"])],4)):(s(),i("span",dn,T(e.token.content.displayText),1))]))}});const hn=b(mn,[["__scopeId","data-v-06e76157"]]),gn={},vn={width:"1em",height:"1em",version:"1.1",viewBox:"0 0 20 20",x:"0px",y:"0px",fill:"currentColor"},fn=d("g",null,[d("path",{"fill-rule":"evenodd",d:"M2 10a8 8 0 1116 0 8 8 0 01-16 0zm8 6a6 6 0 01-4.904-9.458l8.362 8.362A5.972 5.972 0 0110 16zm4.878-2.505a6 6 0 00-8.372-8.372l8.372 8.372z","clip-rule":"evenodd"})],-1),pn=[fn];function _n(e,n){return s(),i("svg",vn,pn)}const yn=b(gn,[["render",_n]]),bn={},Mn={width:"1em",height:"1em",version:"1.1",viewBox:"0 0 20 20",x:"0px",y:"0px",fill:"currentColor"},$n=d("g",null,[d("path",{d:"M12 2H8v1H3v2h14V3h-5V2zM4 7v9a2 2 0 002 2h8a2 2 0 002-2V7h-2v9H6V7H4z"}),d("path",{d:"M11 7H9v7h2V7z"})],-1),Cn=[$n];function kn(e,n){return s(),i("svg",Mn,Cn)}const wn=b(bn,[["render",kn]]),Tn={},xn={width:"1em",height:"1em",version:"1.1",viewBox:"0 0 20 20",x:"0px",y:"0px",fill:"currentColor"},Bn=d("g",null,[d("path",{d:"M11 9.586V6H9v4.414l2.293 2.293 1.414-1.414L11 9.586z"}),d("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1),In=[Bn];function Rn(e,n){return s(),i("svg",xn,In)}const Dn=b(Tn,[["render",Rn]]),Sn={class:"seventv-chat-mod-buttons"},Un=D({__name:"ModIcons",props:{msg:null},setup(e){var k,x,S,C;const n=e,t=A(),{banUserFromChat:a,deleteChatMessage:r}=Ce(t,((k=n.msg.author)==null?void 0:k.username)??""),l=y(),c=W(`Ban ${((x=n.msg.author)==null?void 0:x.username)??"???"}`),u=y(),m=W(`Timeout ${((S=n.msg.author)==null?void 0:S.username)??"???"}`),v=y(),M=W(`Delete message by ${((C=n.msg.author)==null?void 0:C.username)??"???"}`);return(g,h)=>(s(),i("span",Sn,[e.msg.author&&!e.msg.author.isActor?(s(),i("span",{key:0,ref_key:"banRef",ref:l,onClick:h[0]||(h[0]=f=>o(a)(null)),onMouseenter:h[1]||(h[1]=f=>o(c).show(l.value)),onMouseleave:h[2]||(h[2]=f=>o(c).hide())},[R(yn)],544)):_("",!0),e.msg.author&&!e.msg.author.isActor?(s(),i("span",{key:1,ref_key:"timeoutRef",ref:u,onClick:h[3]||(h[3]=f=>o(a)("10m")),onMouseenter:h[4]||(h[4]=f=>o(m).show(u.value)),onMouseleave:h[5]||(h[5]=f=>o(m).hide())},[R(Dn)],544)):_("",!0),d("span",{ref_key:"deleteRef",ref:v,onClick:h[6]||(h[6]=f=>o(r)(e.msg.id)),onMouseenter:h[7]||(h[7]=f=>o(M).show(v.value)),onMouseleave:h[8]||(h[8]=f=>o(M).hide())},[R(wn)],544)]))}});const Hn=b(Un,[["__scopeId","data-v-071f3a4f"]]);function U(e,n){if(n.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+n.length+" present")}function En(e,n,t){var a;U(1,arguments);var r;return Vn(n)?r=n:t=n,new Intl.DateTimeFormat((a=t)===null||a===void 0?void 0:a.locale,r).format(e)}function Vn(e){return e!==void 0&&!("locale"in e)}function Te(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return t.length>=n?e.apply(null,t.slice(0,n).reverse()):function(){for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return Te(e,n,t.concat(r))}}const Pn=Te(En,3),Nn=["msg-id","state","data-highlight-style"],Fn=["data-highlight-label"],Ln={key:1,class:"seventv-chat-message-timestamp"},An={key:4},zn={class:"seventv-chat-message-body"},On={key:0,class:"text-token"},Yn={key:1},jn={key:0,class:"seventv-chat-message-moderated"},Wn={key:1,class:"seventv-chat-message-moderated"},Zn=D({__name:"UserMessage",props:{msg:null,as:{default:"Chat"},highlight:null,emotes:null,chatters:null,isModerator:{type:Boolean},hideAuthor:{type:Boolean},hideModeration:{type:Boolean},hideDeletionState:{type:Boolean},showButtons:{type:Boolean},forceTimestamp:{type:Boolean}},setup(e){var N;const n=e,t=He(n,"msg"),a=y(),r=A(),l=$e(r),{openViewerCard:c}=ke(r),{pinChatMessage:u}=Ce(r,((N=t.value.author)==null?void 0:N.username)??""),m=V("chat.emote_scale"),v=V("chat.slash_me_style"),M=V("highlights.display_style"),k=V("highlights.opacity"),x=V("chat.timestamp_with_seconds"),S=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language??"en",C=n.msg.author?ye(n.msg.author.id):{emotes:{}},g=y(""),h=n.msg.getTokenizer(),f=y([]);function P(){if(!h)return;const B=h.tokenize({chatterMap:n.chatters??{},emoteMap:n.emotes??{},localEmoteMap:{...C.emotes,...n.msg.nativeEmotes}}),$=[],H=n.msg.body;let p=0;for(const K of B){const xe=K.range[0],Be=K.range[1],se=H.substring(p,xe);se&&$.push(se),$.push(K),p=Be+1}const Y=H.substring(p);Y&&$.push(Y),f.value=$}function z(){var B;(B=u(t.value.id,1200))==null||B.catch($=>Ee.error("failed to pin chat message",$))}ee(()=>[C.emotes,n.msg.nativeEmotes],()=>P(),{immediate:!0}),n.msg.historical&&_e(ie(()=>{P()}),1e4);function O(B){if(me(B))return le;if(Je(B))return hn;if(Xe(B))return cn}return ie(()=>{!t.value||!a.value||(t.value.highlight&&(a.value.style.setProperty("--seventv-highlight-color",t.value.highlight.color),a.value.style.setProperty("--seventv-highlight-dim-color",t.value.highlight.color.concat(Se(k.value/100)))),(l.showTimestamps||t.value.historical||n.forceTimestamp)&&(g.value=Pn({locale:S},{localeMatcher:"lookup",hour:"numeric",minute:"numeric",second:x.value?"numeric":void 0},n.msg.timestamp).replace(/ (A|P)M/,"")))}),(B,$)=>{var H;return s(),i("span",{ref_key:"msgEl",ref:a,class:be(["seventv-user-message",{deleted:!e.hideDeletionState&&(o(t).moderation.banned||o(t).moderation.deleted),"has-mention":e.as=="Chat"&&o(t).mentions.has("#actor"),"has-highlight":e.as=="Chat"&&o(t).highlight}]),"msg-id":o(t).id,state:o(t).deliveryState,style:L({"font-style":o(t).slashMe&&o(v)&1?"italic":"",color:o(t).slashMe&&o(v)&2?(H=o(t).author)==null?void 0:H.color:""}),"data-highlight-style":o(M)},[o(t).highlight?(s(),i("div",{key:0,class:"seventv-chat-message-highlight-label","data-highlight-label":o(t).highlight.label},null,8,Fn)):_("",!0),o(l).showTimestamps||o(t).historical||e.forceTimestamp?(s(),i("span",Ln,T(g.value),1)):_("",!0),o(l).isModerator&&o(l).showModerationIcons?(s(),w(Hn,{key:2,msg:o(t)},null,8,["msg"])):_("",!0),o(t).author&&!e.hideAuthor?(s(),w(G,{key:3,user:o(t).author,badges:o(t).badges,"msg-id":o(t).sym,onNameClick:$[0]||($[0]=p=>o(c)(p,o(t).author.username,o(t).id)),onBadgeClick:$[1]||($[1]=p=>o(c)(p,o(t).author.username,o(t).id))},null,8,["user","badges","msg-id"])):_("",!0),e.hideAuthor?_("",!0):(s(),i("span",An,T(o(t).slashMe?" ":": "),1)),d("span",zn,[(s(!0),i(E,null,q(f.value,(p,Y)=>(s(),i(E,{key:Y},[typeof p=="string"?(s(),i("span",On,T(p),1)):o(me)(p)?(s(),i("span",Yn,[R(le,{class:"emote-token",emote:p.content.emote,format:o(l).imageFormat,overlaid:p.content.overlaid,clickable:!0,scale:Number(o(m))},null,8,["emote","format","overlaid","scale"]),p.content?(s(),i("span",{key:0,style:L({color:p.content.cheerColor})},T(p.content.cheerAmount),5)):_("",!0)])):(s(),w(pe(O(p)),{key:2,token:p,msg:o(t)},null,8,["token","msg"]))],64))),128))]),o(t).richEmbed.request_url?(s(),w(ht,{key:5,"rich-embed":o(t).richEmbed},null,8,["rich-embed"])):_("",!0),!e.hideModeration&&(o(t).moderation.banned||o(t).moderation.deleted)?(s(),i(E,{key:6},[o(t).moderation.banned?(s(),i("span",jn,T(o(t).moderation.banDuration?`Timed out (${o(t).moderation.banDuration}s)`:"Permanently Banned"),1)):(s(),i("span",Wn,"Deleted"))],64)):_("",!0),R(ln,{msg:o(t),onPin:$[2]||($[2]=p=>z())},null,8,["msg"])],14,Nn)}}});const qn=b(Zn,[["__scopeId","data-v-6e3f2436"]]);function Z(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Z=function(t){return typeof t}:Z=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(e)}function I(e){U(1,arguments);var n=Object.prototype.toString.call(e);return e instanceof Date||Z(e)==="object"&&n==="[object Date]"?new Date(e.getTime()):typeof e=="number"||n==="[object Number]"?new Date(e):((typeof e=="string"||n==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function X(e,n){U(2,arguments);var t=I(e),a=I(n),r=t.getTime()-a.getTime();return r<0?-1:r>0?1:r}function gs(e){var n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),e.getTime()-n.getTime()}function Gn(e,n){return U(2,arguments),I(e).getTime()-I(n).getTime()}var fe={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(n){return n<0?Math.ceil(n):Math.floor(n)}},Kn="trunc";function Qn(e){return e?fe[e]:fe[Kn]}function Xn(e,n){U(2,arguments);var t=I(e),a=I(n),r=t.getFullYear()-a.getFullYear(),l=t.getMonth()-a.getMonth();return r*12+l}function Jn(e){U(1,arguments);var n=I(e);return n.setHours(23,59,59,999),n}function es(e){U(1,arguments);var n=I(e),t=n.getMonth();return n.setFullYear(n.getFullYear(),t+1,0),n.setHours(23,59,59,999),n}function ts(e){U(1,arguments);var n=I(e);return Jn(n).getTime()===es(n).getTime()}function vs(e,n){U(2,arguments);var t=I(e),a=I(n),r=X(t,a),l=Math.abs(Xn(t,a)),c;if(l<1)c=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-r*l);var u=X(t,a)===-r;ts(I(e))&&l===1&&X(e,a)===1&&(u=!1),c=r*(l-Number(u))}return c===0?0:c}function fs(e,n,t){U(2,arguments);var a=Gn(e,n)/1e3;return Qn(t==null?void 0:t.roundingMethod)(a)}export{we as T,qn as U,Ce as a,ke as b,G as c,I as d,Gn as e,Qn as f,gs as g,X as h,vs as i,fs as j,Te as k,U as r,ge as t,$e as u};
