var d=Object.defineProperty;var o=(t,e,s)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var i=(t,e,s)=>(o(t,typeof e!="symbol"?e+"":e,s),s);import{u as l}from"./seventv.main.3.0.4.js";import{a as u,w as m,l as f}from"./seventv.useUserAgent.3.0.4.js";import{u as h}from"./seventv.useWorker.3.0.4.js";import{i as p,p as c}from"./seventv.useSettings.3.0.4.js";const r=Symbol("seventv-channel-context"),{sendMessage:C,target:n}=h();class N{constructor(){i(this,"platform","UNKNOWN");i(this,"id","");i(this,"username","");i(this,"displayName","");i(this,"user",null);i(this,"loaded",!1)}setCurrentChannel(e){if(this.id===e.id)return!1;const s=this.id;return this.id=e.id,this.username=e.username,this.displayName=e.displayName,a.set(e.id,this),a.delete(s),this.fetch(),!0}fetch(){const e=s=>{this.id===s.detail.id&&(this.loaded=!0,this.user=s.detail.user??null,f.info("Channel loaded:",this.id),n.removeEventListener("channel_fetched",e))};n.addEventListener("channel_fetched",e),C("STATE",{channel:m({id:this.id,username:this.username,displayName:this.displayName})})}}const a=new Map;function E(t){let e=p(r,null);if(!e){e=(t?a.get(t):null)??u(new N),t&&e.setCurrentChannel({id:t??"",username:"",displayName:""});const s=l();e.platform=s.platform,c(r,e),t&&a.set(t,e)}return e}export{E as u};
