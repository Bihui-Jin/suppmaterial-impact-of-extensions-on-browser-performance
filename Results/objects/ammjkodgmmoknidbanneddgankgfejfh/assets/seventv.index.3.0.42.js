import{r as ee,u as te,C as V}from"./seventv.ChatMessage.3.0.4.js";import{e as P,l as f,f as v,j as g,k as F,x as U,F as C,q as O,y as ne,z as se,A as ae,_ as re,aK as q,U as H,a2 as oe}from"./seventv.useSettings.3.0.4.js";import{u as Q}from"./seventv.useChannelContext.3.0.4.js";import{u as ie}from"./seventv.useChatEmotes.3.0.4.js";import{u as Z}from"./seventv.UiConfirmPrompt.3.0.4.js";import{u as de}from"./seventv.useWorker.3.0.4.js";import{D as ue,E as W}from"./seventv.Emote.3.0.4.js";import{_ as ce}from"./seventv.StarIcon.3.0.4.js";import{c as me,r as y,d as p,g as R,e as J,f as X,h as B,i as le,j as fe,k as ve}from"./seventv.index.3.0.4.js";import{u as he,t as N,ab as ge,r as pe}from"./seventv.useUserAgent.3.0.4.js";const ye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),j={randomUUID:ye};function $(n,e,t){if(j.randomUUID&&!e&&!n)return j.randomUUID();n=n||{};const s=n.random||(n.rng||ee)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let r=0;r<16;++r)e[t+r]=s[r];return e}return te(s)}const A=n=>(se("data-v-476225fd"),n=n(),ae(),n),_e={class:"seventv-emote-set-update-message-container"},De={class:"seventv-logo"},Me={key:0,class:"seventv-author"},Ie={class:"seventv-change-detail"},Ne=A(()=>g("span",null,"switched the active emote set from ",-1)),Te=A(()=>g("span",null," to ",-1)),Ue={key:1},we={key:2},Se={key:3},ke={key:4},Ce={key:5},Ee={key:6},be=A(()=>g("span",null,"changed the name of ",-1)),xe={class:"referenced-emote"},Fe=A(()=>g("span",null,"to ",-1)),Le={class:"referenced-emote"},Ye=P({__name:"EmoteSetUpdateMessage",props:{appUser:null,add:null,remove:null,update:null,wholeSet:null},setup(n){var c,l;const e=n,t=Q(),{chatters:s}=Z(t),r=(c=e.appUser.connections)==null?void 0:c.find(_=>_.platform==="TWITCH"),a=(r?s[r.id]:null)??{id:(r==null?void 0:r.id)??e.appUser.id,displayName:(r==null?void 0:r.display_name)??e.appUser.display_name,username:(r==null?void 0:r.username)??e.appUser.username,color:(l=e.appUser.style)!=null&&l.color?ue(e.appUser.style.color):"inherit"};return(_,I)=>(f(),v("span",_e,[g("span",De,[F(ce,{provider:"7TV"})]),n.appUser?(f(),v("span",Me,[F(me,{user:he(a)},null,8,["user"])])):U("",!0),g("span",Ie,[n.wholeSet&&n.wholeSet.length===2?(f(),v(C,{key:0},[Ne,g("strong",null,N(n.wholeSet[0].name),1),Te,g("strong",null,N(n.wholeSet[1].name),1)],64)):U("",!0),n.add.length>1?(f(),v("span",Ue,"added "+N(n.add.length)+" emotes ",1)):n.add.length?(f(),v("span",we,"added ")):U("",!0),(f(!0),v(C,null,O(n.add,o=>(f(),v("span",{key:o.id,class:"referenced-emote"},[F(W,{emote:o},null,8,["emote"]),ne(" "+N(o.name),1)]))),128)),n.add.length&&n.remove.length?(f(),v("span",Se," and ")):U("",!0),n.remove.length>1?(f(),v("span",ke,"removed "+N(n.remove.length)+" emotes ",1)):n.remove.length?(f(),v("span",Ce,"removed ")):U("",!0),(f(!0),v(C,null,O(n.remove,o=>(f(),v("span",{key:o.id,class:"referenced-emote"},[F(W,{emote:o},null,8,["emote"]),g("span",null,N(o.name),1)]))),128)),(n.add.length||n.remove.length)&&n.update.length?(f(),v("span",Ee," and ")):U("",!0),(f(!0),v(C,null,O(n.update,([o,i])=>(f(),v(C,{key:i.id+o.id},[i.name!==o.name?(f(),v(C,{key:0},[be,g("span",xe,[F(W,{emote:i},null,8,["emote"]),g("span",null,N(o.name),1)]),Fe,g("span",Le,[g("span",null,N(i.name),1)])],64)):U("",!0)],64))),128))])]))}});const z=re(Ye,[["__scopeId","data-v-476225fd"]]),at=P({__name:"ChatData",setup(n){const{target:e}=de(),t=Q(),s=ge(t,"id"),r=Z(t),a=ie(t),c=q(()=>H.channels.where("id").equals(t.id??"").first().then(o=>(o==null?void 0:o.set_ids)??[]),()=>{a.providers["7TV"]={},a.providers.FFZ={},a.providers.BTTV={}},{reactives:[s]});q(()=>H.emoteSets.where("id").anyOf(c.value??[]).or("scope").equals("GLOBAL").sortBy("priority"),o=>{if(!o)return;for(const d of o){const u=d.provider??"UNKNOWN";a.providers[u]||(a.providers[u]={}),a.providers[u][d.id]=d,a.sets[d.id]=d}const i={};for(const d of o.flatMap(u=>u.emotes)){if(!d)return;i[d.name]=d}for(const d in a.emojis){const u=a.emojis[d];!u||!u.unicode||(i[u.unicode]=u)}for(const d in i)a.active[d]=i[d]},{reactives:[c]});function l(o){var x;const{id:i,emotes_added:d,emotes_removed:u,emotes_updated:D,user:E}=o.detail;if(!((x=c.value)!=null&&x.includes(i)))return;const w=a.sets[i];for(const m of d)a.active[m.name]=m,a.sets[i]&&w.emotes.push(m);for(const[m,h]of D){if(!h||!m)continue;const S=a.find(T=>T.id===h.id,!0);if(!S)continue;const k=pe(S);for(const T in h)T!=="data"&&(k.value={...k.value,[T]:h[T]});delete a.active[m.name],a.active[h.name]=k.value}for(let m=0;m<u.length;m++){const h=u[m],S=a.active[h.name];if(!(!S||S.id!==h.id)&&(u[m].data=S.data,delete a.active[h.name],a.sets[i])){const k=w.emotes.findIndex(T=>T.id===h.id);k!==-1&&w.emotes.splice(k,1)}}const b=new V($());b.setComponent(z,{appUser:E,add:d,remove:u,update:D}),r.add(b)}function _(o,i,d,u){var b,x;if(!i||!t.user)return;const D=(b=t.user.connections)==null?void 0:b[o];if(!D||D.emote_set&&D.emote_set.id!==i.id)return;const E=((x=a.sets[i.id])==null?void 0:x.emotes)??[];for(const m of E)delete a.active[m.name];delete a.sets[i.id],D.emote_set=d,H.channels.where("id").equals(t.id??"").modify(m=>{const h=m.set_ids.indexOf(i.id);h!==-1?m.set_ids.splice(h,1,d.id):m.set_ids.push(d.id)});const w=new V($());w.setComponent(z,{appUser:u,add:[],remove:[],update:[],wholeSet:[i,d]}),r.add(w)}function I(o){a.providers.TWITCH||(a.providers.TWITCH={}),a.providers.TWITCH[o.detail.id]=o.detail}return e.addEventListener("emote_set_updated",l),e.addEventListener("user_updated",o=>{const{id:i,actor:d,emote_set:u}=o.detail;!i||!u||_(u.connection_index,u.old_set,u.new_set,d)}),e.addEventListener("twitch_emote_set_data",I),oe(()=>{e.removeEventListener("emote_set_updated",l),e.removeEventListener("twitch_emote_set_data",I)}),(o,i)=>null}});function M(n){if(n===null||n===!0||n===!1)return NaN;var e=Number(n);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function Ae(n,e){y(2,arguments);var t=p(n),s=M(e);return isNaN(s)?new Date(NaN):(s&&t.setDate(t.getDate()+s),t)}function Oe(n,e){y(2,arguments);var t=p(n),s=M(e);if(isNaN(s))return new Date(NaN);if(!s)return t;var r=t.getDate(),a=new Date(t.getTime());a.setMonth(t.getMonth()+s+1,0);var c=a.getDate();return r>=c?a:(t.setFullYear(a.getFullYear(),a.getMonth(),r),t)}function Y(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Y=function(t){return typeof t}:Y=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(n)}function L(n,e){if(y(2,arguments),!e||Y(e)!=="object")return new Date(NaN);var t=e.years?M(e.years):0,s=e.months?M(e.months):0,r=e.weeks?M(e.weeks):0,a=e.days?M(e.days):0,c=e.hours?M(e.hours):0,l=e.minutes?M(e.minutes):0,_=e.seconds?M(e.seconds):0,I=p(n),o=s||t?Oe(I,s+t*12):I,i=a||r?Ae(o,a+r*7):o,d=l+c*60,u=_+d*60,D=u*1e3,E=new Date(i.getTime()+D);return E}function G(n){y(1,arguments);var e=p(n);return e.setHours(0,0,0,0),e}var He=864e5;function We(n,e){y(2,arguments);var t=G(n),s=G(e),r=t.getTime()-R(t),a=s.getTime()-R(s);return Math.round((r-a)/He)}function K(n,e){var t=n.getFullYear()-e.getFullYear()||n.getMonth()-e.getMonth()||n.getDate()-e.getDate()||n.getHours()-e.getHours()||n.getMinutes()-e.getMinutes()||n.getSeconds()-e.getSeconds()||n.getMilliseconds()-e.getMilliseconds();return t<0?-1:t>0?1:t}function Be(n,e){y(2,arguments);var t=p(n),s=p(e),r=K(t,s),a=Math.abs(We(t,s));t.setDate(t.getDate()-r*a);var c=+(K(t,s)===-r),l=r*(a-c);return l===0?0:l}var Ve=6e4,qe=36e5;function Re(n,e,t){y(2,arguments);var s=J(n,e)/qe;return X(t==null?void 0:t.roundingMethod)(s)}function je(n,e,t){y(2,arguments);var s=J(n,e)/Ve;return X(t==null?void 0:t.roundingMethod)(s)}function $e(n,e){y(2,arguments);var t=p(n),s=p(e);return t.getFullYear()-s.getFullYear()}function ze(n,e){y(2,arguments);var t=p(n),s=p(e),r=B(t,s),a=Math.abs($e(t,s));t.setFullYear(1584),s.setFullYear(1584);var c=B(t,s)===-r,l=r*(a-Number(c));return l===0?0:l}function Ge(n){y(1,arguments);var e=p(n.start),t=p(n.end);if(isNaN(e.getTime()))throw new RangeError("Start Date is invalid");if(isNaN(t.getTime()))throw new RangeError("End Date is invalid");var s={};s.years=Math.abs(ze(t,e));var r=B(t,e),a=L(e,{years:r*s.years});s.months=Math.abs(le(t,a));var c=L(a,{months:r*s.months});s.days=Math.abs(Be(t,c));var l=L(c,{days:r*s.days});s.hours=Math.abs(Re(t,l));var _=L(l,{hours:r*s.hours});s.minutes=Math.abs(je(t,_));var I=L(_,{minutes:r*s.minutes});return s.seconds=Math.abs(fe(t,I)),s}const rt=ve(Ge,1);export{at as _,z as a,rt as i,$ as v};
