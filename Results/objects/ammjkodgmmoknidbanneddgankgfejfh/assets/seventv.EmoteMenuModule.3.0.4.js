import{d as J,u as de}from"./seventv.ReactHooks.3.0.4.js";import{a as Z,d as me}from"./seventv.useModule.3.0.4.js";import{i as ve,p as pe,e as K,H as $,a as F,l as u,f as c,j as p,k as x,x as y,z as fe,A as _e,_ as W,w as oe,X as se,o as he,u as A,B as G,F as O,q as L,aL as ge,M as be,aI as Ee,am as ae,D as Ce,C as ke,s as ie,at as Ie,az as ye,a2 as we,as as Q,J as Y,ap as Me,aM as Se,$ as Te,n as xe,ar as U}from"./seventv.useSettings.3.0.4.js";import{m as Oe,r as Ve,s as $e,t as Re,o as Be}from"./seventv.index.esm.3.0.4.js";import{a as N,r as k,u as g,t as re,n as De,l as Ae}from"./seventv.useUserAgent.3.0.4.js";import{u as ue}from"./seventv.useChannelContext.3.0.4.js";import{u as le}from"./seventv.useChatEmotes.3.0.4.js";import{D as Ne,u as Pe,S as Ue}from"./seventv.DropdownIcon.3.0.4.js";import{_ as j,U as Fe,G as Le,a as je}from"./seventv.StarIcon.3.0.4.js";import{u as ce}from"./seventv.useUpdater.3.0.4.js";import{u as He}from"./seventv.main.3.0.4.js";import{E as ze,u as Ge}from"./seventv.Emote.3.0.4.js";import{d as ee}from"./seventv.Transform.3.0.4.js";import{U as Ke}from"./seventv.UiFloating.3.0.4.js";const te=Symbol("seventv-emote-menu-context");function q(){let a=ve(te,null);return a||(a=N({open:!1,filter:"",channelID:""}),pe(te,a)),a}const We=a=>(fe("data-v-b571f495"),a=a(),_e(),a),qe=We(()=>p("span",{class:"tooltip-over"},"Emote Menu",-1)),Je={key:0,class:"seventv-emote-menu-update-flair"},Xe=K({__name:"EmoteMenuButton",props:{onClick:{type:Function}},setup(a){const l=q(),m=ce(),v=k(!1),E=$("ui.emote_menu.button_placement");return F(E,i=>{v.value=i==="below"},{immediate:!0}),(i,I)=>v.value?(u(),c("div",{key:0,class:"seventv-tw-button seventv-emote-menu-button",onClick:I[0]||(I[0]=(...f)=>a.onClick&&a.onClick(...f))},[p("button",null,[x(j,{provider:"7TV",class:"icon"})]),qe,!g(m).isUpToDate&&!g(l).open?(u(),c("div",Je)):y("",!0)])):y("",!0)}});const ne=W(Xe,[["__scopeId","data-v-b571f495"]]),Ze={mounted(a,l){const{value:m}=l;m("mounted",a)},updated(a,l){const{value:m}=l;m("updated",a)},beforeUnmount(a,l){const{value:m}=l;m("unmounted",a)}},Qe=["collapsed"],Ye={class:"seventv-set-header"},et={class:"seventv-set-header-icon"},tt=["src"],nt={key:0,class:"seventv-emote-set"},ot=["disabled","ratio","load-state","set-id","emote-id","zero-width","favorite","onClick","onKeydown"],st=K({__name:"EmoteMenuSet",props:{es:null},emits:["emote-clicked","emotes-updated"],setup(a,{expose:l,emit:m}){const v=a,E=q(),i=k([]),I=k(),f=k(!1),h=$("ui.emote_menu.collapsed_sets"),d=$("ui.emote_menu.favorites"),w=$("ui.emote_menu.usage"),{alt:C}=Oe(),b=k(n());function M(e){if(v.es.id==="USAGE"){const o=w.value.get(e.id)??0;return o-o*2||0}let s=ee(e);return(e.flags||0)!==0&&(s-=.5),s}const R=J((e="")=>{const s=[];for(const o of v.es.emotes)e&&!o.name.toLowerCase().includes(e.toLowerCase())||s.push(o);s.sort((o,T)=>{const z=M(o),X=M(T);return z==X?o.name.localeCompare(T.name):z>X?1:-1}),i.value=s,m("emotes-updated",s)},25);function B(e,s){return e.scope==="PERSONAL"&&s.data&&s.data.state&&!s.data.state.includes("PERSONAL")}function D(e){if(!B(v.es,e)){if(C.value){d.value.has(e.id)?d.value.delete(e.id):d.value.add(e.id),d.value=new Set(d.value);return}m("emote-clicked",e)}}Ve("Escape",()=>{E.open=!1}),F(()=>v.es.emotes,()=>{R(E.filter)}),oe(()=>{R(E.filter)});const _=N({}),V=k(!1),H=v.es.provider!=="EMOJI";let S;function P(){S||(S=new IntersectionObserver(e=>{e.forEach(async s=>{const o=s.target.getAttribute("emote-id");if(s.isIntersecting&&!_[o]){const T=_[o]===-1;_[o]=0,H&&!T&&V.value&&await be(Ee(350)).toBeTruthy()}if(_[o]===0&&!s.isIntersecting){delete _[o];return}if(s.isIntersecting&&_[o]===0){_[o]=1;return}!s.isIntersecting&&_[o]>=0&&(_[o]=_[o]===1?-1:0)}),V.value=!0}),f.value=!0)}function t(e,s){if(S)for(let o=0;o<s.children.length;o++){const T=s.children.item(o);if(!T)continue;const z=T.getAttribute("emote-id");!z||_[z]||(e==="mounted"||e==="updated"?S.observe(T):S.unobserve(T))}}function n(){return h.value.has(v.es.id)}function r(){n()?(h.value.delete(v.es.id),b.value=!1):(h.value.add(v.es.id),b.value=!0),h.value=new Set(h.value)}return se(()=>{P()}),he(()=>{S&&S.disconnect()}),l({containerEl:I}),(e,s)=>i.value.length?(u(),c("div",{key:0,ref_key:"containerEl",ref:I,class:"seventv-emote-set-container",collapsed:b.value},[p("div",Ye,[p("div",et,[a.es.owner&&a.es.owner.avatar_url?(u(),c("img",{key:0,src:a.es.owner.avatar_url},null,8,tt)):(u(),A(j,{key:1,class:"logo",provider:a.es.provider},null,8,["provider"]))]),p("span",null,re(a.es.name),1),p("div",{class:"seventv-set-chevron",onClick:r},[x(Ne)])]),f.value?G((u(),c("div",nt,[(u(!0),c(O,null,L(i.value,o=>(u(),c("div",{key:o.id,class:"seventv-emote-container",disabled:B(a.es,o),ratio:g(ee)(o),"load-state":_[o.id],"set-id":a.es.id,"emote-id":o.id,"zero-width":(o.flags||0)!==0,favorite:g(d).has(o.id)&&a.es.id!=="FAVORITE",tabindex:"0",onClick:T=>D(o),onKeydown:ge(ae(T=>D(o),["prevent"]),["enter"])},[_[o.id]?(u(),A(ze,{key:0,emote:o,unload:!_[o.id]},null,8,["emote","unload"])):y("",!0)],40,ot))),128))])),[[g(Ze),t]]):y("",!0)],8,Qe)):y("",!0)}});const at=W(st,[["__scopeId","data-v-0840c363"]]),it={class:"emote-area-container"},rt={class:"emote-area"},ut={class:"sidebar"},lt={class:"sidebar-icons"},ct=["selected","onClick"],dt={class:"set-sidebar-icon"},mt=["src"],vt={class:"settings-button-container"},pt={key:0,class:"seventv-emote-menu-settings-button-update-flair"},ft=K({__name:"EmoteMenuTab",props:{provider:null,selected:{type:Boolean}},emits:["emote-clicked","provider-visible","toggle-settings","toggle-native-menu"],setup(a,{emit:l}){var P;const m=a,{t:v}=Ce(),E=q(),i=ue(E.channelID),I=le(i),f=ce(),h=k(""),d=I.byProvider(m.provider)??N({}),w=He(),C=Ge(((P=w.identity)==null?void 0:P.id)??""),b=N(new Set),M=k([]),R=$("ui.emote_menu.favorites");function B(){return Array.from(R.value.values()).map(t=>I.find(n=>n.id===t)).filter(t=>!!t)}if(m.provider==="FAVORITE"){const t=d.FAVORITE=N({id:"FAVORITE",name:v("emote_menu.favorite_set"),emotes:B()});F(R,()=>{t.emotes=B()})}function D(t,n){if(!n||!n.length)return;const r=n[0];r.containerEl&&(h.value=t,r.containerEl.scrollIntoView({behavior:"auto"}))}function _(t){return t.scope==="GLOBAL"?1:i.id&&t.owner&&t.owner.id===i.id?-1:(t.flags??0)&4?-2:0}function V(t,n){const r=_(t),e=_(n);return r==e?t.name.localeCompare(n.name):r>e?1:-1}function H(t,n){n?b.add(t):b.delete(t),l("provider-visible",!!b.size)}const S=J(()=>{var n;const t=Object.values(d);if((n=C.emoteSets)!=null&&n.size&&t.push(...Array.from(C.emoteSets.values()).filter(r=>r.provider===m.provider)),m.provider==="TWITCH"){const r=t.reduce((e,s)=>{const o=e[s.name];return o?o.emotes.push(...s.emotes):e[s.name]={set:s,emotes:[...s.emotes]},e},{});t.splice(0,t.length,...Object.values(r).map(e=>({...e.set,emotes:e.emotes})))}t.sort(V),M.value=t},50);return F(()=>[E.filter,d,C.emoteSets],S,{immediate:!0}),(t,n)=>{const r=ke("t");return u(),c("div",it,[x(Fe,{class:"scroll-area"},{default:ie(()=>[a.provider==="TWITCH"?(u(),c("div",{key:0,class:"native-menu-toggle",onClick:n[0]||(n[0]=e=>l("toggle-native-menu"))},[x(j,{provider:"TWITCH"}),G(p("span",null,null,512),[[r,"emote_menu.native"]])])):y("",!0),p("div",rt,[(u(!0),c(O,null,L(M.value,e=>(u(),c("div",{key:e.id},[x(at,{ref_for:!0,ref:"es-"+e.id,es:e,onEmoteClicked:n[1]||(n[1]=s=>l("emote-clicked",s)),onEmotesUpdated:s=>H(e,!!s.length)},null,8,["es","onEmotesUpdated"])]))),128))])]),_:1}),p("div",ut,[p("div",lt,[(u(!0),c(O,null,L(M.value,e=>(u(),c(O,{key:e.id},[e.emotes.length?(u(),c("div",{key:0,class:"set-sidebar-icon-container",selected:h.value==e.id,onClick:s=>D(e.id,t.$refs["es-"+e.id])},[p("div",dt,[e.owner&&e.owner.avatar_url?(u(),c("img",{key:0,src:e.owner.avatar_url},null,8,mt)):(u(),A(j,{key:1,class:"logo",provider:e.provider},null,8,["provider"]))])],8,ct)):y("",!0)],64))),128))]),p("div",vt,[p("div",{class:"settings-button",onClick:n[2]||(n[2]=e=>l("toggle-settings"))},[x(Le,{provider:"7TV"}),g(f).isUpToDate?y("",!0):(u(),c("div",pt))])])])])}}});const _t=W(ft,[["__scopeId","data-v-949ea8bc"]]),ht={class:"seventv-emote-menu"},gt={class:"seventv-emote-menu-header"},bt={class:"seventv-emote-menu-header-providers"},Et=["selected","onClick"],Ct={key:0,class:"emote-search"},kt={class:"search-icon"},It=K({__name:"EmoteMenu",props:{instance:null,buttonEl:null},setup(a){const l=a,m=k(),v=k(),E=k(),i=q();i.channelID=l.instance.component.props.channelID??"";const I=ue(i.channelID),f=Pe(),h=le(I),d=k(),w=$("ui.emote_menu_search"),C=$("ui.emote_menu.usage"),b=k("7TV"),M=N({FAVORITE:!0,"7TV":!0,FFZ:!0,BTTV:!0,TWITCH:!0,EMOJI:!0}),R=Z("chat"),B=$("ui.emote_menu.button_placement"),D=Z("chat-input-controller");se(()=>{D.value.instance&&D.value.instance.addButton("emote-menu",ne,{onClick:()=>i.open=!i.open},1)});const _=$e("Control",{initial:!1});Re("e",t=>{_.value&&(V(),t.preventDefault())});function V(t){const n=l.instance.component;if(t){n.onEmotePickerButtonClick(),i.open=!1;return}i.open?n.props.closeEmotePicker():(n.props.clearMenus(),n.closeBitsCard(),n.closePaidPinnedChatCardForEmotePicker(),n.closeCheerCard()),i.open=!i.open,xe(()=>{d.value&&d.value.focus()})}function H(t){const n=t.split(" ");for(const r of n){const e=h.active[r];e&&C.value.set(e.id,(C.value.get(e.id)??0)+1)}return C.value=new Map(C.value),t}F(R,t=>{t.instance&&t.instance.messageSendMiddleware.set("emote-menu-usage",H)},{immediate:!0});function S(t,n){var r;M[t]=n,!n&&t===b.value&&(b.value=((r=Object.entries(M).find(([,e])=>e))==null?void 0:r[0])??"7TV")}function P(t){const n=l.instance.component.autocompleteInputRef;if(!n)return Ae.warn("ref to input not found, cannot insert emote");let r=n.getValue();w.value?r=r.slice(0,i.filter.length?i.filter.length*-1:1/0):r=r.at(-1)===" "?r:r+" ",n.setValue(r+(t.unicode??t.name)+" "),l.instance.component.chatInputRef.focus()}return Ie(l.instance.component,"onBitsIconClick",function(t){t==null||t(),i.open=!1}),ye(l.instance.component.autocompleteInputRef,"state",{value(t){if(!i.open){i.filter="";return}w.value&&(i.filter=t.value.split(" ").at(-1)??"")}}),Be(E,t=>{f.open||!(t.target instanceof Node)||v.value&&v.value.contains(t.target)||l.buttonEl&&l.buttonEl.contains(t.target)||(i.open=!1)}),oe(()=>{if(!m.value&&l.instance.domNodes.root){const t=l.instance.domNodes.root.querySelector(".seventv-chat-input-textarea");if(!t)return;const n=t.querySelector("[data-test-selector='chat-input']")??t;m.value=n??t,v.value=t}}),we(()=>{Q(l.instance.component.autocompleteInputRef,"state"),Q(l.instance.component,"onBitsIconClick")}),(t,n)=>(u(),c(O,null,[x(Ke,{anchor:m.value,placement:"top-end",middleware:[g(Se)({mainAxis:!0,crossAxis:!0})]},{default:ie(()=>[g(i).open&&g(i).channelID?(u(),c("div",{key:0,ref_key:"containerRef",ref:E,class:"seventv-emote-menu-container"},[p("div",ht,[p("div",gt,[p("div",bt,[(u(!0),c(O,null,L(M,(r,e)=>(u(),c(O,null,[r?(u(),c("div",{key:e,class:"seventv-emote-menu-provider-icon",selected:e===b.value,onClick:s=>b.value=e},[e!=="FAVORITE"?(u(),A(j,{key:0,provider:e},null,8,["provider"])):(u(),A(je,{key:1})),G(p("span",null,re(e),513),[[Y,e===b.value&&e!=="FAVORITE"]])],8,Et)):y("",!0)],64))),256))]),g(w)?y("",!0):(u(),c("div",Ct,[G(p("input",{ref_key:"searchInputRef",ref:d,"onUpdate:modelValue":n[0]||(n[0]=r=>g(i).filter=r),class:"emote-search-input"},null,512),[[Me,g(i).filter]]),p("div",kt,[x(Ue)])]))]),(u(!0),c(O,null,L(M,(r,e)=>G((u(),c("div",{key:e,class:"seventv-emote-menu-body"},[x(_t,{provider:e,selected:e===b.value,onEmoteClicked:P,onProviderVisible:s=>S(e,s),onToggleSettings:n[1]||(n[1]=s=>g(f).toggle()),onToggleNativeMenu:n[2]||(n[2]=s=>V(!0))},null,8,["provider","selected","onProviderVisible"])])),[[Y,e===b.value]])),128))])],512)):y("",!0)]),_:1},8,["anchor","middleware"]),a.buttonEl&&g(B)==="regular"?(u(),A(Te,{key:0,to:a.buttonEl},[x(ne,{onClick:n[3]||(n[3]=r=>V())}),p("div",{class:De(["seventv-emote-menu-button",{"menu-open":g(i).open}]),onClick:n[4]||(n[4]=ae(r=>V(),["stop"]))},[x(j,{provider:"7TV"})],2)],8,["to"])):y("",!0)],64))}});const yt=W(It,[["__scopeId","data-v-918de418"]]),wt=[U("ui.emote_menu_search","TOGGLE",{path:["Appearance","Interface"],label:"Emote Menu: Live Input Search",hint:"Use the chat's regular input box to search in the emote menu instead of the integrated search box",defaultValue:!1}),U("ui.emote_menu.button_placement","DROPDOWN",{path:["Appearance","Interface"],label:"Emote Menu Button Placement",hint:"Control where the 7TV emote menu button is placed. Setting to 'Below Input' will return the native emote menu to its original position.",options:[["Regular","regular"],["Below Input","below"],["Hidden","hidden"]],defaultValue:"regular"}),U("ui.emote_menu.most_used","TOGGLE",{path:["Appearance","Interface"],label:"Emote Menu: Most Used Emotes",hint:"Whether or not to display the emotes you type the most in the emote menu (Temporarily disabled due to performance issues)",disabledIf:()=>!0,defaultValue:!0}),U("ui.emote_menu.favorites","NONE",{path:["",""],label:"",defaultValue:new Set}),U("ui.emote_menu.usage","NONE",{path:["",""],label:"",defaultValue:new Map}),U("ui.emote_menu.collapsed_sets","NONE",{path:["",""],label:"",defaultValue:new Set})],Mt=K({__name:"EmoteMenuModule",setup(a){const{markAsReady:l}=me("emote-menu",{name:"Emote Menu",depends_on:["settings"]}),m=k(),v=N(new WeakMap),E=$("ui.emote_menu.button_placement"),i=de({parentSelector:".chat-room__content",maxDepth:150,predicate:f=>f.onEmotePickerButtonClick},{trackRoot:!0,containerClass:"seventv-chat-input-container",hooks:{render(f,h){return v.set(f,!!f.component.props.channelID),I(Object.values(f.domNodes)),h}}}),I=J(f=>{for(const h of f){const d=h.querySelector("button[data-a-target='emote-picker-button']");if(d){m.value=d;for(let w=0;w<d.childElementCount;w++){const C=d.children[w];C.classList.contains("seventv-emote-menu-button")||(E.value==="regular"?C.classList.add("seventv-emote-menu-overriden"):C.classList.remove("seventv-emote-menu-overriden"))}}}},50);return F(E,f=>{for(const h of Object.values(i.instances).map(d=>d.domNodes))I(Object.values(h))},{immediate:!0}),l(),(f,h)=>(u(!0),c(O,null,L(g(i).instances,d=>(u(),c(O,{key:d.identifier},[v.get(d)?(u(),A(yt,{key:0,instance:d,"button-el":m.value},null,8,["instance","button-el"])):y("",!0)],64))),128))}});const Lt=Object.freeze(Object.defineProperty({__proto__:null,config:wt,default:Mt},Symbol.toStringTag,{value:"Module"}));export{Lt as _};
