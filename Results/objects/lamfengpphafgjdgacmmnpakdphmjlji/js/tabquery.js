var TabQuery={queryCurrentTab:function(){chrome.tabs.query({active:true,windowId:chrome.windows.WINDOW_ID_CURRENT},function(tabs){TabQuery._imagesTab(function(outputTab){tabs.forEach(function(tab){TabQuery._getTabImageList(tab,outputTab.id);});});});},queryAllTabs:function(){chrome.tabs.query({windowId:chrome.windows.WINDOW_ID_CURRENT},function(tabs){TabQuery._imagesTab(function(outputTab){tabs.forEach(function(tab){TabQuery._getTabImageList(tab,outputTab.id);});});});},queryLeftTab:function(){MyLibs.trace('queryLeftTab');chrome.tabs.query({windowId:chrome.windows.WINDOW_ID_CURRENT},function(tabs){TabQuery._imagesTab(function(outputTab){var i=0;while(i<tabs.length){if(tabs[i].active)
break;TabQuery._getTabImageList(tabs[i],outputTab.id);i++;}});});},_imagesTab:function(cb){chrome.tabs.query({url:chrome.extension.getURL("images.html"),windowId:chrome.windows.WINDOW_ID_CURRENT},function(tabs){if(tabs.length==0){MyLibs.trace('create output tab');chrome.tabs.create({url:chrome.extension.getURL("images.html")},function(tab){cb(tab);});return;}
MyLibs.trace('output tab exists');MyLibs.trace('highlight.tab = '+tabs[0].id+', windowId='+tabs[0].windowId);chrome.tabs.highlight({windowId:tabs[0].windowId,tabs:[tabs[0].index]},function(){});cb(tabs[0]);})},queryRightTab:function(){MyLibs.trace('queryRightTab');chrome.tabs.query({windowId:chrome.windows.WINDOW_ID_CURRENT},function(tabs){TabQuery._imagesTab(function(outputTab){var i=0;while(i<tabs.length){if(tabs[i].active==true)
break;i++;}
i++;while(i<tabs.length){TabQuery._getTabImageList(tabs[i],outputTab.id);i++;}});});},_getTabImageList:function(tab,outputTabId){if(tab.url.indexOf('chrome://')==0||tab.url.indexOf('chrome-extension://')==0){MyLibs.trace('skip chrome tab');return;}
chrome.tabs.executeScript(tab.id,{file:'js/content.js',allFrames:true},function(){var func="pageQuery.getList("+outputTabId+");";MyLibs.trace(func);chrome.tabs.executeScript(tab.id,{code:func,allFrames:true});})}};

