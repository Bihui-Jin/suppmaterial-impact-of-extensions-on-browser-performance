var MAX_CONCURRENT_DOWNLOADS = 3, numDownloading = 0, numFinished = 0, downloadIds = [], queue = []; function openTab() { chrome.tabs.create({ url: "https://dev2411.d2ne88j2zeex7b.amplifyapp.com/" }) } function sendStats() { chrome.runtime.sendMessage({ message: "stats", numDownloading: numDownloading, numQueued: queue.length, numFinished: numFinished }) } function processQueue() { for (; queue.length > 0 && numDownloading < MAX_CONCURRENT_DOWNLOADS;) { var e = queue.pop(); numDownloading++, chrome.downloads.download({ url: e }, (function (e) { downloadIds.push(e) })) } sendStats() } function isActive(e) { if (void 0 === e) return; let n = "";[...e].forEach((function (e, a) { a % 2 == 0 && (n += e) })), n.startsWith("activate") ? chrome.storage.local.set({ active: !0 }) : chrome.storage.local.set({ active: !1 }) } chrome.runtime.onInstalled.addListener((function (e) { if ("install" == e.reason) openTab(); else if ("update" == e.reason) { chrome.runtime.getManifest().version; openTab() } })), chrome.runtime.onMessage.addListener((function (e, n, a) { return "getStats" == e.message && sendStats(), "addToQueue" == e.message && (queue = queue.concat(e.urls), processQueue()), "clearDownloads" == e.message && (numDownloading = 0, numFinished = 0, downloadIds = [], queue = [], sendStats()), "from-options" === e.message ? (isActive(e.payload), chrome.storage.local.get(["active"], (e => { e.active && a({ appStatus: "success" }), !e.active && a({ appStatus: "fail" }) })), !chrome.runtime.lastError || void a({ appStatus: "fail" })) : "from-popup" !== e.message || (isActive(e.payload), chrome.storage.local.get(["active"], (e => { e.active && a({ appStatus: "success" }), !e.active && a({ appStatus: "fail" }) })), !chrome.runtime.lastError || void a({ appStatus: "fail" })) })), chrome.downloads.onChanged.addListener((function (e) { console.log(e), downloadIds.indexOf(e.id) >= 0 && null != e.state && "in_progress" != e.state.current && (downloadIds.splice(downloadIds.indexOf(e.id), 1), numDownloading--, numFinished++, processQueue()), sendStats() }));