import { r as r$1 } from '../../chunks/parse_token.util-d707319f.js';
import '../../chunks/index-f253f80e.js';
import { t } from '../../chunks/background.injected-b956e480.js';

var n={exports:{}},s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(s){var o=new Uint8Array(16);n.exports=function(){return s(o),o};}else {var r=new Array(16);n.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r};}for(var i=[],a=0;a<256;++a)i[a]=(a+256).toString(16).substr(1);var l,u,c=function(e,t){var n=t||0,s=i;return [s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]]].join("")},d=n.exports,h=c,m=0,p=0;var f=function(e,t,n){var s=t&&n||0,o=t||[],r=(e=e||{}).node||l,i=void 0!==e.clockseq?e.clockseq:u;if(null==r||null==i){var a=d();null==r&&(r=l=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==i&&(i=u=16383&(a[6]<<8|a[7]));}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:p+1,g=c-m+(f-p)/1e4;if(g<0&&void 0===e.clockseq&&(i=i+1&16383),(g<0||c>m)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");m=c,p=f,u=i;var v=(1e4*(268435455&(c+=122192928e5))+f)%4294967296;o[s++]=v>>>24&255,o[s++]=v>>>16&255,o[s++]=v>>>8&255,o[s++]=255&v;var w=c/4294967296*1e4&268435455;o[s++]=w>>>8&255,o[s++]=255&w,o[s++]=w>>>24&15|16,o[s++]=w>>>16&255,o[s++]=i>>>8|128,o[s++]=255&i;for(var b=0;b<6;++b)o[s+b]=r[b];return t||h(o)},g=n.exports,v=c;var w=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||g)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var r=0;r<16;++r)t[s+r]=o[r];return t||v(o)},b=f,y=w,E=y;E.v1=b,E.v4=y;var I=E;const M=100,S=-1,C={"-32601":"Method not found"};C[M]="Invalid origin",C[S]="Error";class k{constructor({postMessage:e,timeout:t=3e3}={}){this.postMessage=e,this.timeout=t,this.pendingRequests={},this.callbackFunctions={},this.call=this.call.bind(this),this.resolve=this.resolve.bind(this),this.resolveRPCResponse=this.resolveRPCResponse.bind(this);}call(e,t,n={}){const{timeout:s=this.timeout}=n,o=function(){let e=null,t=null;const n=new Promise(((n,s)=>(e=n,t=s,t)));return n.resolve=e,n.reject=t,n}(),r=[];for(const e of Array.from(t||[]))if("function"==typeof e){const t={_browserComms:!0,_browserCommsGunCallback:!0,callbackId:I.v4()};this.callbackFunctions[t.callbackId]=e,r.push(t);}else r.push(e);const i=function({method:e,params:t}){if(null==t)throw new Error("Must provide params");for(const e of Array.from(t))if("function"==typeof e)throw new Error("Functions are not allowed. Use RPCCallback instead.");return {_browserComms:!0,id:I.v4(),method:e,params:t}}({method:e,params:r});this.pendingRequests[i.id]={reject:o.reject,resolve:o.resolve,isAcknowledged:!1};try{this.postMessage(JSON.stringify(i),"*");}catch(e){return o.reject(e),o}return setTimeout((()=>{if(!this.pendingRequests[i.id].isAcknowledged)return o.reject(new Error("Message Timeout"))}),s),o}resolve(e){switch(!1){case!(!0===e?.acknowledge):return this.resolveRPCRequestAcknowledgement(e);case!N(e):return this.resolveRPCResponse(e);case!function(e){return e?.callbackId&&null!=e.params}(e):return this.resolveRPCCallbackResponse(e);default:throw new Error("Unknown response type")}}resolveRPCResponse(e){const t=this.pendingRequests[e.id];if(null==t)throw new Error("Request not found");t.isAcknowledged=!0;const{result:n,error:s}=e;return s?t.reject(s.data||new Error(s.message)):null!=n?t.resolve(n):t.resolve(null),null}resolveRPCRequestAcknowledgement(e){const t=this.pendingRequests[e.id];if(null==t)throw new Error("Request not found");return t.isAcknowledged=!0,null}resolveRPCCallbackResponse(e){const t=this.callbackFunctions[e.callbackId];if(null==t)throw new Error("Callback not found");return t.apply(null,e.params),null}}function O({params:e,callbackId:t}){return {_browserComms:!0,callbackId:t,params:e}}function T({requestId:e,result:t=null,rPCError:n=null}){return {_browserComms:!0,id:e,result:t,error:n}}function x({code:e,data:t=null}){return {_browserComms:!0,code:e,message:C[e],data:t}}function A(e){return e?._browserComms}function N(e){return e?.id&&(void 0!==e.result||void 0!==e.error)}const B=1e4,L="undefined"!=typeof window?window:self;class R{constructor(e={}){const{timeout:t,shouldConnectToServiceWorker:n,handshakeTimeout:s=B,isParentValidFn:o=(()=>!0)}=e;this.handshakeTimeout=s,this.isParentValidFn=o,this.isListening=!1;const r=globalThis?.window?._browserCommsIsInAppBrowser||-1!==navigator.userAgent.indexOf("/InAppBrowser");this.hasParent="undefined"!=typeof window&&window.self!==window.top||r,this.parent=globalThis?.window?.parent,this.client=new k({timeout:t,postMessage:(e,t)=>{if(r){let t=(()=>{try{return JSON.parse(localStorage["portal:queue"])}catch(e){return null}})();return null==t&&(t=[]),t.push(e),localStorage["portal:queue"]=JSON.stringify(t),localStorage["portal:queue"]}return this.parent?.postMessage(e,t)}}),this.ready=n?function(){return new Promise(((e,t)=>{const n=setTimeout(e,5e3);return navigator?.serviceWorker?.ready.catch((function(){return console.log("caught sw error"),null})).then((t=>{const s=t?.active;return s&&(this.sw=new k({timeout:this.timeout,postMessage:(e,t)=>{const n=new MessageChannel;if(n)return n.port1.onmessage=e=>this.onMessage(e,{isServiceWorker:!0}),s.postMessage(e,[n.port2])}})),clearTimeout(n),e()}))}))}():Promise.resolve(!0),this.registeredMethods={ping:()=>Object.keys(this.registeredMethods)},this.parentsRegisteredMethods=[],this.setParent=this.setParent.bind(this),this.setInAppBrowserWindow=this.setInAppBrowserWindow.bind(this),this.replyInAppBrowserWindow=this.replyInAppBrowserWindow.bind(this),this.onMessageInAppBrowserWindow=this.onMessageInAppBrowserWindow.bind(this),this.listen=this.listen.bind(this),this.close=this.close.bind(this),this.call=this.call.bind(this),this.onRequest=this.onRequest.bind(this),this.onMessage=this.onMessage.bind(this),this.on=this.on.bind(this);}setParent(e){this.parent=e,this.hasParent=!0;}setInAppBrowserWindow(e,t){this.iabWindow=e;const n=-1!==navigator.userAgent.indexOf("iPhone")?"loadstop":"loadstart";return this.iabWindow.addEventListener(n,(()=>{this.iabWindow.executeScript({code:"window._browserCommsIsInAppBrowser = true;"}),clearInterval(this.iabInterval),this.iabInterval=setInterval((()=>this.iabWindow.executeScript({code:"localStorage.getItem('portal:queue');"},(e=>{try{return (e=JSON.parse(e?.[0]))&&e.length&&this.iabWindow.executeScript({code:"localStorage.setItem('portal:queue', '[]')"}),e.map((e=>t(e)))}catch(t){return console.log(t,e)}}))),100);})),this.iabWindow.addEventListener("exit",(()=>clearInterval(this.iabInterval)))}replyInAppBrowserWindow(e){const t=e.replace(/'/g,"'");return this.iabWindow.executeScript({code:`if(window._browserCommsOnMessage) window._browserCommsOnMessage('${t}')`})}onMessageInAppBrowserWindow(e){return this.onMessage({data:e,source:{postMessage:e=>this.call("browser.reply",{data:e})}})}listen(){this.isListening=!0,L.addEventListener("message",this.onMessage),"undefined"!=typeof window&&null!==window&&(window._browserCommsOnMessage=e=>this.onMessage({debug:!0,data:(()=>{try{return JSON.parse(e)}catch(t){return console.log("error parsing",e),null}})()})),this.clientValidation=this.client.call("ping",null,{timeout:this.handshakeTimeout}).then((e=>{this.hasParent&&(this.parentsRegisteredMethods=this.parentsRegisteredMethods.concat(e));})).catch((()=>null)),this.swValidation=this.ready.then((()=>this.sw?.call("ping",null,{timeout:this.handshakeTimeout}))).then((e=>{this.parentsRegisteredMethods=this.parentsRegisteredMethods.concat(e);}));}close(){return this.isListening=!0,L.removeEventListener("message",this.onMessage)}async call(e,...t){if(!this.isListening)return new Promise(((e,t)=>t(new Error("Must call listen() before call()"))));const n=(e,t)=>{const n=this.registeredMethods[e];if(!n)throw new Error("Method not found");return n.apply(null,t)};if(await this.ready,this.hasParent){let s=null;await this.clientValidation;if(!(-1!==this.parentsRegisteredMethods.indexOf(e)))return n(e,t);{const o=await this.client.call(e,t);try{if("ping"===e){const s=n(e,t);return (o||[]).concat(s)}return o}catch(o){try{if(s=o,!this.sw)return n(e,t);try{const s=await this.sw.call(e,t);if("ping"===e){const o=n(e,t);return (s||[]).concat(o)}return s}catch{return n(e,t)}}catch(e){throw "Method not found"===e.message&&s?s:e}}}}else {if(!this.sw)return n(e,t);if(await this.swValidation,-1===this.parentsRegisteredMethods.indexOf(e))return n(e,t);try{const s=await this.sw.call(e,t);if("ping"===e){const o=n(e,t);return (s||[]).concat(o)}return s}catch(s){return n(e,t)}}}async onRequest(e,t,n){const s=[];for(const n of Array.from(t.params||[]))n?._browserCommsGunCallback?(t=>{s.push(((...n)=>e(O({params:n,callbackId:t.callbackId}))));})(n):s.push(n);e(function({requestId:e}){return {_browserComms:!0,id:e,acknowledge:!0}}({requestId:t.id}));try{const o=await this.call(t.method,...Array.from(s),{e:n});return e(T({requestId:t.id,result:o}))}catch(n){return e(T({requestId:t.id,rPCError:x({code:S,data:n})}))}}onMessage(e,{isServiceWorker:t}={}){try{const s="string"==typeof e.data?JSON.parse(e.data):e.data;if(!A(s))return;const o=function(t){return "undefined"!=typeof window&&null!==window?e.source?.postMessage(JSON.stringify(t),"*"):e.ports[0].postMessage(JSON.stringify(t))};if(null!=(n=s)?.id&&null!=n.method)return this.onRequest(o,s,e);if(A(s)){let n;if(this.isParentValidFn(e.origin))return n=t?this.sw:this.client,n.resolve(s);if(N(s))return n=t?this.sw:this.client,n.resolve(T({requestId:s.id,rPCError:x({code:M})}));throw new Error("Invalid origin")}throw new Error("Unknown RPCEntity type")}catch(e){}var n;}on(e,t){this.registeredMethods[e]=t;}}async function P(e){return Boolean(await(t=e.fetch("/spore/fetch-is-experimental-enabled").then((e=>null==e?void 0:e.body)),n=1e3,s=!1,Promise.race([t,new Promise((e=>setTimeout((()=>e(s)),n)))])));var t,n,s;}function j(e){return void 0!==e.image}const q=["src","width","height","id","class"];const W=e=>`data-truffle-assoc-mutation-observer-id-${e}`,D=e=>`data-truffle-assoc-mutated-element-id-${e}`;function _(e,{subjectElement:t,mutationObserverId:n,mutatedElementId:s,cleanupMutationsByMutatedElementId:o}={}){let r=document.documentElement;const i=e=>{n&&e.setAttribute(W(n),"1"),s&&e.setAttribute(D(s),"1");};if(e.forEach((e=>{var n,s,a,l,u,c,d,h;switch(e.action){case"appendSubject":t&&(null==r||r.appendChild(t));break;case"resetStyles":r&&r.setAttribute("style","width: 0; height: 0;");break;case"cleanupMutationsByMutatedElementId":e.value&&o&&o(e.value);break;case"useDocument":r=document.documentElement;break;case"getIframeDocument":{const e=r;r=null!==(s=null===(n=null==e?void 0:e.contentDocument)||void 0===n?void 0:n.documentElement)&&void 0!==s?s:null===(l=null===(a=null==e?void 0:e.contentWindow)||void 0===a?void 0:a.document)||void 0===l?void 0:l.documentElement;break}case"insertSubjectBefore":t&&(null===(u=null==r?void 0:r.parentNode)||void 0===u||u.insertBefore(t,r));break;case"insertSubjectAfter":t&&(null===(c=null==r?void 0:r.parentNode)||void 0===c||c.insertBefore(t,null==r?void 0:r.nextSibling));break;case"querySelector":e.value&&(r=null==r?void 0:r.querySelector(e.value));break;case"createImageSubject":{const n=function(e){return void 0!==e.src}(e.value)?e.value:JSON.parse(e.value),s=document.createElement("img");Object.entries(n).forEach((([e,t])=>{var n;n=e,q.includes(n)&&s.setAttribute(e,t);})),i(t=s);break}case"replaceStringsWithImages":(j(e.value)?e.value:JSON.parse(e.value)).forEach((({string:e,image:t})=>{const n=document.createElement("img");if(n.src=U(t.src),t.height&&(n.height=t.height),t.width&&(n.width=t.width),n.title=e,r){J(r,e,n).forEach(i);}}));break;case"createReplacedStringsWithImagesSubject":{const n=j(e.value)?e.value:JSON.parse(e.value);let s=r;if(n.forEach((({string:e,image:t})=>{const n=document.createElement("img");n.src=U(t.src),t.height&&(n.height=t.height),t.width&&(n.width=t.width),n.title=e,s&&(s=function(e,t,n){var s;const o=document.createElement("template");for(const r of e.childNodes)if(r.nodeType===Node.TEXT_NODE){const e=document.createElement("template"),i=null===(s=r.textContent)||void 0===s?void 0:s.replaceAll(t,n.outerHTML);i&&(e.innerHTML=i,o.append(...e.content.childNodes));}else o.appendChild(r);return o}(s,e,n));})),s!==r){const e=document.createElement("span");e.append(...null!==(d=null==s?void 0:s.childNodes)&&void 0!==d?d:[]),i(e),t=e;}else t=null;break}case"replaceWithSubject":t&&(null==r||r.replaceWith(t));break;case"setStyle":{const t="string"==typeof e.value?JSON.parse(e.value):e.value;Object.entries(t).forEach((([e,t])=>{r&&(r.style[e]=t);}));break}case"addStyleSheet":{const t="string"==typeof e.value?JSON.parse(e.value):e.value,n=(null==t?void 0:t.id)?document.getElementById(null==t?void 0:t.id):document.createElement("style");if(!n)return;document.head.appendChild(n),n.innerText=null===(h=e.value)||void 0===h?void 0:h.css,(null==t?void 0:t.id)&&(n.id=null==t?void 0:t.id),(null==t?void 0:t.class)&&(n.className=null==t?void 0:t.class),i(n);break}case"setId":r&&e.value&&(r.id=e.value);break;case"addClassNames":if(!r)break;Array.isArray(e.value)?r.classList.add(...e.value):"string"==typeof e.value&&r.classList.add(e.value);break;case"useSubject":r=t;}})),s){const e=document.querySelector(`[data-truffle-id=${s}]`);null==e||e.setAttribute("data-truffle-has-mutated","1");}return r}function U(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText}function J(e,t,n){const s=[];for(const o of e.childNodes)switch(o.nodeType){case Node.ELEMENT_NODE:s.push(...J(o,t,n));break;case Node.TEXT_NODE:{const e=V(o);e&&(e.innerHTML=e.innerHTML.replace(t,n.outerHTML),s.push(e));break}case Node.DOCUMENT_NODE:s.push(...J(o,t,n));}return s}function V(e){const t=document.createElement("span");if((null==e?void 0:e.textContent)&&(null==e?void 0:e.parentNode)){const n=document.createTextNode(e.textContent);return t.appendChild(n),e.parentNode.replaceChild(t,e),t}}class ${}var H=new class extends ${getPageInfo(){return [{sourceType:"url",sourceId:window.location.href}]}};const G=/[a-zA-Z0-9]+/;var F=new class extends ${getPageInfo(){var e;const t=null===(e=window.location.pathname.match(G))||void 0===e?void 0:e[0];let n=[{sourceType:"url",sourceId:window.location.href}];return t&&(n=n.concat({sourceType:"twitch",sourceId:t})),n}};const z=e=>e.find((e=>{return "youtube"===(t=e.sourceType)||"youtubeLive"===t||"youtubeVideo"===t;var t;}));var Q=new class extends ${getPageInfo(){var e,t;const n=document.querySelector("ytd-page-manager"),s=null===(t=null===(e=null==n?void 0:n.data)||void 0===e?void 0:e.playerResponse)||void 0===t?void 0:t.videoDetails;let o=[{sourceType:"url",sourceId:window.location.href}];return (null==s?void 0:s.channelId)&&(o=o.concat([{sourceType:"youtube",sourceId:s.channelId},{sourceType:(null==s?void 0:s.isLiveContent)?"youtubeLive":"youtubeVideo",sourceId:s.channelId}])),o}};const X={genericSite:H,twitch:F,youtube:Q};var Y;let Z;function K(e){const t=ee(),n=JSON.stringify(t);n!==Z&&(Z=n,e(t));}function ee(){const e=function(e){switch(new URL(e).hostname.replace(/^www\./,"")){case"twitch.tv":return Y.TWITCH;case"youtube.com":return Y.YOUTUBE;default:return Y.GENERIC_SITE}}(window.location.href);return X[e].getPageInfo()}var te;async function ne({sources:e,statuses:t}){const n={sources:e,extensionVersion:"3.2.13",statuses:t};try{const e=await async function(e,t,n,{throwIfErrors:s}={}){const o=await fetch(e,{method:"POST",headers:{Authorization:"Bearer pk_U1x92ZrrdQoflf2JycecdmnilAGRAkmUNBpxPnVPDdeUKcsH","Content-Type":"application/json"},body:JSON.stringify({query:t,variables:n})}),r=await o.json();if(s&&(null==r?void 0:r.errors))throw new Error(`spore graphql error ${r.errors}`);return r.data}("https://zygote.spore.build/graphql","query GetExtensionMappingConnection(\n\t\t\t$sources: [ExtensionMappingSource!],\n\t\t\t$extensionVersion: String,\n\t\t\t$statuses: [String]\n\t\t) {\n\t\textensionMappingConnection(\n\t\t\tsources: $sources,\n\t\t\textensionVersion: $extensionVersion,\n\t\t\tstatuses: $statuses\n\t\t) {\n\t\t\tnodes {\n\t\t\t\tid\n\t\t\t\tslug\n\t\t\t\torgId\n\t\t\t\tsourceType\n\t\t\t\tsourceId\n\t\t\t\tiframeUrl\n\t\t\t\tdomAction\n\t\t\t\tdefaultLayoutConfigSteps { action, value }\n\t\t\t}\n\t\t}\n\t}",n);return e.extensionMappingConnection}catch(e){console.error(e);}}!function(e){e.GENERIC_SITE="genericSite",e.TWITCH="twitch",e.YOUTUBE="youtube";}(Y||(Y={})),function(e){e.PUBLISHED="published",e.EXPERIMENTAL="experimental",e.DISABLED="disabled";}(te||(te={}));let se=[];async function oe(e,t){const n=await P(e)?[te.PUBLISHED,te.EXPERIMENTAL]:[te.PUBLISHED],s=t.map((({sourceType:e,sourceId:t})=>({sourceType:e,sourceId:t}))),o=await ne({sources:s,statuses:n}),r=localStorage.getItem("truffle:devExtensionMappings");let i;try{i=r?JSON.parse(r):[];}catch(e){i=[];}((null==o?void 0:o.nodes)||[]).concat(i).forEach((e=>{!function(e){const t=se.find((t=>e.id===t.extensionMapping.id));if(t)return;const n=document.createElement("iframe");n.src=e.iframeUrl,n.id=function(e){return `truffle-extension-mapping-${e.id}`}(e),n.className="truffle-extension-mapping",n.setAttribute("style","width: 0; height: 0;"),n.dataset.truffleExtensionMappingId=e.id,n.dataset.orgId=e.orgId;const s={extensionMapping:e,element:n};se.push(s),re(s);}(e);}));}function re(e){_(function(e){const t=localStorage.getItem(ae(e.id));let n;try{n=t&&JSON.parse(t);}catch(e){console.error("error parsing json",t);}return n||e.defaultLayoutConfigSteps}(e.extensionMapping),{subjectElement:e.element});}function ie(){se.forEach((e=>{(function(e){var t;return Boolean(null===(t=e.element)||void 0===t?void 0:t.parentNode)})(e)||re(e);}));}function ae(e){return `truffle:extensionMappingLayoutConfigSteps:${e}`}function le(e){return se.find((t=>t.element.contentWindow===e))}function ue(e){return Boolean(e&&e.ownerDocument!==document)}function ce(e,t){const{observer:n,listenElement:s,targetQuerySelector:o,emit:r,normalizeElement:i,observerConfig:a,prepareLayoutConfigSteps:l}=e;if(!s)return;const u=s.querySelectorAll(o);r(Array.from(u||[]).map((e=>i(e)))),l&&u.forEach((e=>{_(l,{subjectElement:e,cleanupMutationsByMutatedElementId:t});})),n.observe(s,a);}const de=new t,he=new class{constructor(t){this.backgroundService=t,this.call=(e,t)=>this.browserComms.call(e,t),this.listen=()=>{this.browserComms.listen(),this.browserComms.on("context.getCredentials",this.contextGetCredentials),this.browserComms.on("context.getInfo",this.contextGetInfo),this.browserComms.on("layout.applyLayoutConfigSteps",this.layoutApplyLayoutConfigSteps),this.browserComms.on("layout.setDefaultLayoutConfigSteps",this.layoutSetDefaultLayoutConfigSteps),this.browserComms.on("layout.listenForElements",this.layoutListenForElements),this.browserComms.on("user.setAccessToken",this.setAccessToken),this.browserComms.on("user.invalidateSporeUser",this.userInvalidateSporeUser),this.browserComms.on("comms.postMessage",this.commsPostMessage),this.browserComms.on("comms.onMessage",this.commsOnMessage),this.browserComms.on("storage.get",this.storageGet),this.browserComms.on("storage.set",this.storageSet);},this.cleanupExtensionMappingInstance=e=>{this.messageCallbacks=this.messageCallbacks.filter((({eventSource:t})=>!(e.element.contentWindow===t))),this.observerObjects=this.observerObjects.filter((({eventSource:t,mutationObserverId:n})=>{const s=e.element.contentWindow===t;return s&&this.cleanupMutationsByMutationObserverId(n),!s}));},this.cleanupMutationsByMutatedElementId=e=>{var t;null===(t=this.mutatedElementIdMap.get(e))||void 0===t||t.forEach((e=>e.remove()));},this.cleanupMutationsByMutationObserverId=e=>{var t;null===(t=this.mutationObserverIdMap.get(e))||void 0===t||t.forEach((e=>e.remove()));},this.contextGetCredentials=async()=>{const e=ee(),t=z(e);if(t){const e=await this.backgroundService.fetch("/auth/token");return {sourceType:t.sourceType,token:e.body}}const n=(e=>e.find((e=>"twitch"===e.sourceType)))(e);if(n){const e=await this.backgroundService.fetch("/auth/get-access-token");return {sourceType:n.sourceType,token:e.body}}},this.contextGetInfo=async()=>{const e=await P(this.backgroundService);return {version:"3.2.13",pageInfo:ee(),isExperimentalEnabled:e}},this.layoutApplyLayoutConfigSteps=({layoutConfigSteps:e,mutatedElementId:t},{e:n})=>{let s,o;if(null==n?void 0:n.source){const e=le(n.source);s=null==e?void 0:e.element,o=this.observerObjects.find((({eventSource:t})=>(null==e?void 0:e.element.contentWindow)===t));}var r;_(e,{subjectElement:s,mutationObserverId:null==o?void 0:o.mutationObserverId,mutatedElementId:t,cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId}),(null==o?void 0:o.shouldCleanupMutatedElements)&&(o.mutationObserverId&&this.mutationObserverIdMap.set(o.mutationObserverId,Array.from(document.querySelectorAll((r=o.mutationObserverId,`[${W(r)}]`)))),t&&this.mutatedElementIdMap.set(t,Array.from(document.querySelectorAll((e=>`[${D(e)}]`)(t)))));},this.layoutSetDefaultLayoutConfigSteps=({layoutConfigSteps:e},{e:t})=>{let n;if((null==t?void 0:t.source)&&(n=le(t.source)),!n)throw new Error("extension mapping not found");localStorage.setItem(ae(n.extensionMapping.id),JSON.stringify(e)),_(e,{subjectElement:n.element,cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId});},this.layoutListenForElements=({listenElementLayoutConfigSteps:e,targetQuerySelector:t,pickStyles:n=[],observerConfig:s={},prepareLayoutConfigSteps:o,shouldCleanupMutatedElements:r=!1},i,{e:a})=>{if("function"!=typeof i)return void console.warn("Emit function not set");let l=Date.now().toString(36)+Math.random().toString(36).substr(2);const u=e=>{const t=e.getAttribute("data-truffle-id"),s=e.getAttribute("data-truffle-has-mutated"),o=Date.now().toString(36)+Math.random().toString(36).substr(2);e.setAttribute("data-truffle-id",o);const r=(null==n?void 0:n.length)?(i=Object.assign({},window.getComputedStyle(e)),a=n,Object.fromEntries(a.filter((e=>e in i)).map((e=>[e,i[e]])))):{};var i,a;return {id:o,existingMutatedElementId:t,hasMutated:s,mutationObserverId:l,data:e.data,innerText:e.innerText,innerHtml:e.innerHTML,styles:r}},c=this.observerObjects.find((({eventSource:e})=>e===a.source));c&&(c.observer.disconnect(),l=c.mutationObserverId);const d=new MutationObserver((e=>{const n=e.filter((e=>{const n=(null==e?void 0:e.addedNodes)&&Array.from(e.addedNodes).filter((e=>{var n;return (null===(n=e)||void 0===n?void 0:n.matches)&&e.matches(t)}));return (null==n?void 0:n.length)>0})).map((e=>Array.from(e.addedNodes))).flat(),s=n.map(u);(null==s?void 0:s.length)&&(i(s),o&&n.forEach((e=>{_(o,{subjectElement:e,cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId});})));})),h=_(e,{cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId}),m=ue(h),p={eventSource:a.source,observer:d,listenElement:h,isIframe:m,listenElementLayoutConfigSteps:e,observerConfig:s,targetQuerySelector:t,emit:i,normalizeElement:u,prepareLayoutConfigSteps:o,mutationObserverId:l,shouldCleanupMutatedElements:r};this.observerObjects.push(p),h&&ce(p,this.cleanupMutationsByMutatedElementId);},this.userInvalidateSporeUser=async({orgId:t})=>{const n=ee();if(z(n)){const n=await this.backgroundService.fetch("/auth/token"),s=r$1(null==n?void 0:n.body);if(!s)return;this.backgroundService.fetch("/spore/invalidate-spore-user-cache",{connectionSourceId:s.sub,sporeOrgId:t}),s.spore||this.backgroundService.fetch("/gateway/set-settings",{hasSporeCollectible:!0});}},this.setAccessToken=async({accessToken:e})=>{e&&this.backgroundService.fetch("/auth/set-access-token",e);},this.commsPostMessage=(...e)=>{this.messageCallbacks.forEach((({callback:t})=>t(...e)));},this.commsOnMessage=(e,{e:t})=>{this.messageCallbacks.push({callback:e,eventSource:t.source});},this.storageGet=({key:e})=>localStorage.getItem(`truffle:${e}`),this.storageSet=({key:e,value:t})=>{localStorage.setItem(`truffle:${e}`,t);},this.attachDetachedMutationObservers=()=>{this.observerObjects.forEach((e=>{const t=function(e){var t,n;if(e.isIframe){const n=null===(t=e.listenElement)||void 0===t?void 0:t.ownerDocument;return Boolean(Boolean(null==n?void 0:n.defaultView)&&(null==n?void 0:n.body.contains(e.listenElement)))}return Boolean(null===(n=e.listenElement)||void 0===n?void 0:n.parentNode)}(e),n=t?e.listenElement:_(e.listenElementLayoutConfigSteps,{cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId});n&&!t&&(e.listenElement=n,e.isIframe=ue(n),ce(e,this.cleanupMutationsByMutatedElementId));}));},this.browserComms=new R,this.observerObjects=[],this.messageCallbacks=[],this.mutatedElementIdMap=new Map,this.mutationObserverIdMap=new Map;}}(de);he.listen(),function({onPageInfoChange:e,onDomChange:t}){const n=()=>{const n=document.querySelector("body");if(!n)return void console.error("body not found");const s=function(e,t=200){let n;return (...s)=>{clearTimeout(n),n=setTimeout((()=>e(...s)),t);}}((()=>{K(e),t();}),100);new MutationObserver(s).observe(n,{childList:!0,subtree:!0});};["interactive","complete"].includes(document.readyState)?n():window.addEventListener("DOMContentLoaded",n),setInterval((()=>{K(e),t();}),3e3),K(e);}({onPageInfoChange:function(e){(function(e,t){se=se.filter((n=>{const{extensionMapping:s,element:o}=n;return !!e.find((({sourceType:e,sourceId:t})=>s.sourceType===e&&s.sourceId===t))||(t.cleanupExtensionMappingInstance(n),null==o||o.remove(),!1)}));})(e,he),oe(de,e);},onDomChange:function(){ie(),he.attachDetachedMutationObservers();}});
