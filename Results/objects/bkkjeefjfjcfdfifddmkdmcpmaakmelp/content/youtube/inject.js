import { r } from '../../chunks/parse_token.util-d707319f.js';
import { e } from '../../chunks/index-f253f80e.js';
import { t as t$1 } from '../../chunks/background.injected-b956e480.js';
import { l, d, c, t as t$2, e as e$4, n, s as s$1, o, u, a, r as r$1, v } from '../../chunks/get_stream_details-6cde6f18.js';
import { e as e$3 } from '../../chunks/mui-theme-82489cf1.js';
import { t, e as e$2 } from '../../chunks/constants-4d4688da.js';
import { s } from '../../chunks/router.interface-3a81c163.js';
import { e as e$1 } from '../../chunks/style-inject.es-305e66b0.js';

const C=e=>void 0!==(null==e?void 0:e.months),I=e=>void 0!==(null==e?void 0:e.slug);function w(e){if(!e)return 0;e=e.toLowerCase();const t=/\((.+)\)/.exec(e);if(!t)return 1;const n=t[1].split(/\s/),o=parseInt(n[0]);return isNaN(o)?0:n[1].startsWith("year")?12*parseInt(n[0]):parseInt(n[0])}function S(e,t){const n=t;for(let t=0;t<n.length;t++)if(n[t][0]>e)return n[t-1][1];return n[n.length-1][1]}function E(e){return {liveChatAuthorBadgeRenderer:{accessibility:{accessibilityData:{label:e.slug}},tooltip:e.slug,customThumbnail:{thumbnails:[{url:e.url,width:18,height:18}],accessibility:{accessibilityData:{label:e.slug}}}}}}function A(e,t,n,o,i){const s=t(e.authorExternalChannelId),r=function(e,t){var n;const o=[];if(e&&t){const i=new Set(null!==(n=null==e?void 0:e.e)&&void 0!==n?n:[]);if(i)for(const e of i){const n=t.get(e);n&&o.push(n);}}return o}(s,n);!function(e,t){var n;(null==t?void 0:t.a)&&(e.authorName={simpleText:(n=t.a,decodeURIComponent(n))});}(e,s),function(e,t){var n,o;e.authorBadges||(e.authorBadges=[]);for(const i of e.authorBadges){const e=i.liveChatAuthorBadgeRenderer;(null===(n=e.icon)||void 0===n?void 0:n.iconType)?e._mtvType=null===(o=e.icon)||void 0===o?void 0:o.iconType.toLowerCase():e.customThumbnail&&(e._mtvType="member"),"moderator"===e._mtvType&&(delete e.icon,e._mtvType="moderator",e.customThumbnail={thumbnails:[{url:t,width:18,height:18}]});}}(e,i),function(e,t,n){if((null==n?void 0:n.b)&&!(n.b<=0))for(const o of e.authorBadges){const e=o.liveChatAuthorBadgeRenderer;if("member"!==e._mtvType)continue;const i=w(e.tooltip);if(0===i)continue;const s=i+n.b,r=`Member (${s} months)`,a=S(s,t);e.customThumbnail=a,delete e.icon,e.tooltip=r,e.accessibility.accessibilityData.label=r;}}(e,o,s),function(e,t){if(e.authorBadges||(e.authorBadges=[]),t)for(const n of t.slice(0,2))e.authorBadges.push(n);}(e,r);}const M=/[\s.,?!]/;function x(e){const t=[];let n=0;for(let o=0;o<e.length-1;o++)M.test(e[o])!==M.test(e[o+1])&&(t.push(e.substring(n,o+1)),n=o+1);return t.push(e.substring(n)),t}function j(e){let t;if(e.provider===e$3.Twitch)t=`https://static-cdn.jtvnw.net/emoticons/v2/${e.id}/static/dark/1.0`;else if(e.provider===e$3.FFZ)t=`https://cdn.frankerfacez.com/emote/${e.id}/1`;else if(e.provider===e$3.BTTV)t=`https://cdn.betterttv.net/emote/${e.id}/1x`;else if(e.provider===e$3.Spore&&(null==e?void 0:e.ext))t=`https://cdn.bio/ugc/collectible/${e.id}.tiny.${e.ext}`;else {if(e.provider!==e$3.Custom)return;t=`https://v2.truffle.vip/emotes/${e.id}`;}return {emojiId:"mogultv-"+e.name+"-"+e.id,image:{thumbnails:[{url:t}],accessibility:{accessibilityData:{label:e.name}}},isCustomEmoji:!0,isSporeEmote:e.provider===e$3.Spore,channelId:e.channelId,searchTerms:[e.name],shortcuts:[":"+e.name+":",e.name]}}function B(e,t){return {emojiPickerCategoryRenderer:{categoryId:"battle-pass-emotes",title:{simpleText:t?`${t} emotes`:"Unlocked Truffle Emotes"},emojiIds:e}}}function O(e){return [...e.values()].map((e=>null==e?void 0:e.emojiId))}function U(e){return e.data.categories}function T(e,t){return {emojiPickerUpsellCategoryRenderer:{categoryId:"locked-truffle-emote-category",title:{simpleText:`Locked ${null!=t?t:"Truffle"} Emotes`},upsell:{runs:[{text:"Unlock emotes through the Truffle Extension"}]},emojiIds:e,emojiToolTip:"Truffle Emote"}}}function k(e){if(e)return function(e,t){return e.filter((e=>{var n;return (null===(n=e.emojiPickerCategoryRenderer)||void 0===n?void 0:n.categoryId)===t})).length}(e,"battle-pass-emotes")}function N(e){if(e)return function(e,t){return e.filter((e=>{var n;return (null===(n=e.emojiPickerUpsellCategoryRenderer)||void 0===n?void 0:n.categoryId)===t})).length}(e,"locked-truffle-emote-category")}function L(e,t){var n;const o=O(t),i=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.categories;if(!i||!(null==o?void 0:o.length))return;const s=i.map((e=>{const t=null==e?void 0:e.emojiPickerUpsellCategoryRenderer;return "battle-pass-emotes"===(null==t?void 0:t.categoryId)&&(t.emojiIds=o),e}));(null==o?void 0:o.length)&&V(e,s);}function R(e,t,n){const o=Q(),i=null==o?void 0:o.emojiManager,s=null==i?void 0:i._upsellEmotesLoaded;if(i){if(t&&!s){i._upsellEmotesLoaded=!0,function(e,t){e.load([...t.values()]);}(o.emojiManager,t);const e=P();if(!e)return;N(U(e))||function(e,t,n){var o;const i=O(t);if(!(null==i?void 0:i.length))return;const s=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.categories;z(s,T(i,n)),V(e,s);}(e,t,n);}!function(e,t){const n=O(t);e.load([...t.values()],Object.assign(Object.assign({},e),{emojis:e.emojis.filter((e=>!(e.isLocked&&!n.includes(e.emojiId))))}));}(o.emojiManager,e);}}function _(e,t,n){if(!(null==e?void 0:e.size))return;const o=P();if(!o)return;k(U(o))?(!function(e,t){var n;const o=O(t),i=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.categories;if(!i)return;let s=!1;const r=i.map((e=>{const t=e.emojiPickerCategoryRenderer;if("battle-pass-emotes"===(null==t?void 0:t.categoryId)){const e=t.emojiIds.filter((e=>void 0!==e)),n=o.filter((t=>!e.includes(t)));(null==n?void 0:n.length)&&(s=!0),t.emojiIds=t.emojiIds.concat(n);}return e}));s&&V(e,r);}(o,e),L(o,t)):(!function(e,t,n){var o;const i=O(t);if(!(null==i?void 0:i.length))return;const s=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.categories;z(s,B(i,n)),V(e,s);}(o,e,n),L(o,t));}function D(e,t){const n=Q();if(null==n?void 0:n.emojiManager){if(n.emojiManager[t])return;n.emojiManager[t]=!0,function(e,t){e.emojiManager.load(Array.from(t.values()).filter((e=>!(null==e?void 0:e.isSporeEmote))));}(n,e);}else console.warn("Cannot YT chat list renderer");}function Q(){return document.querySelector("yt-live-chat-item-list-renderer")}function P(){return document.querySelector("yt-emoji-picker-renderer")}function V(e,t){e.updateCategoriesAndPlaceholder_({categories:[...t]},{});}function z(e,t){null==e||e.unshift(t);}const K=["#ff0000","#009000","#b22222","#ff7f50","#9acd32","#ff4500","#2e8b57","#daa520","#d2691e","#5f9ea0","#1e90ff","#ff69b4","#00ff7f","#a244f9"];class F{constructor(e){this.gatewayService=e;}addAliasesToMessage(e){A(e,(e=>this.gatewayService.isCurrentUser(e)?this.gatewayService.getSporeUserInfo():this.gatewayService.getUserInfo(e)),this.gatewayService.sporeBadgeCache,this.gatewayService.monthBadgeList,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAABg2lDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TiiIVBzuIOGRonSyIijpqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxc3NSdJES/5cUWsR4cNyPd/ced+8AoVFhmhUaAzTdNtPJhJjNrYrdrwgjBGAaMZlZxpwkpeA7vu4R4OtdnGf5n/tz9Kl5iwEBkXiWGaZNvEE8tWkbnPeJI6wkq8TnxKMmXZD4keuKx2+ciy4LPDNiZtLzxBFisdjBSgezkqkRTxJHVU2nfCHrscp5i7NWqbHWPfkLw3l9ZZnrNIeRxCKWIEGEghrKqMBGnFadFAtp2k/4+Idcv0QuhVxlMHIsoAoNsusH/4Pf3VqFiXEvKZwAul4c5yMGdO8CzbrjfB87TvMECD4DV3rbX20AM5+k19ta9Ajo3wYurtuasgdc7gCDT4Zsyq4UpCkUCsD7GX1TDhi4BXrXvN5a+zh9ADLUVeoGODgERoqUve7z7p7O3v490+rvB3pIcqqJKL5aAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5QwEARQDdqq2HwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAGkSURBVDjLpdSxS5tBGMfx7+V9JamLGbSQNNAQdBBJhZKWLPkHxKmQEgd9xUFwCRQKHe1cKHSztCCmLyQlkriULu2kSyBQkCCCg0bQCJrhTSUxoW+8DuLRNPqq8aa7hx8f7nk4TpDXDCQfAC+9rTKCt4KctgcEnZKJ/pcYoRmG+oewz21Wdlb4+PvzvxFLvwlJD5vEx+Lomg5A6ahE/nTt/5hXd0Le+98x9WRKnUtHJSYKkxzLalfW5djSaKILOZCHqvZQDLIwMO8MPdOf4h/wq3Or3epAAuIRP6M/MEYMZyjY1zm6SCBC8XlBId+j3wj7wuiui+lcO6PVszxNu4lH93RiFHBrbsK+MAAnjRNnKBVaxq25u+qRQETt7bZNavfL9a2lQstMj08jhHB8idmtLF8b2atvdBUipaTVbqk2K7UKme0MrytvVEa/DWJumhi7c8QfvKD8p0zR/tV1O0FOk7dBblougE+Pl+6FKGijukGtWesZUZBZT5NcT2KdWT0hl8O2AK9ZT8M6xAZjzO8v3PFLkmVBTpsFuQgi2Nu/Ji3QXv0FPBynaffELJkAAAAASUVORK5CYII=");}}class q{constructor(e){this.gatewayService=e;}addEmotesToMessage(e){return function(e,t){const n=e.authorExternalChannelId,o=[];for(const i of e.message.runs)if("string"==typeof i.text){const{text:e}=i;let s=0,r=0;const a=x(e);let l=!1;for(const i of a){const a=t("ðŸŒ"===i?"Kappa":i,n);a&&(l=!0,s>0&&o.push({text:e.substring(r,s)}),o.push({emoji:a}),r=s+i.length),s+=i.length;}l?o.push({text:e.substring(r,s)}):o.push(i);}else if("ðŸŒ"===i.emoji.emojiId){const e=t("Kappa",n);e&&o.push({emoji:e});}else o.push(i);return e.message.runs=o,e.message}(e,((e,t)=>this.gatewayService.getEmote(e,t)))}}class J extends e.exports.EventEmitter{constructor(e){super(),this.backgroundService=e,this.monthBadgeList=[],this.sporeBadgeCache=new Map,this.emoteCache=new Map,this.upsellSporeEmoteCache=new Map,this.encodedEmoteMap=new Map,this.emoteIndicesMap=new Map,this.sporeUserEmoteCache=new Map,e.getLiveStorageValue("auth.token",r).then((e=>{this.myUserInfo=e;})),l(!1)&&(this.fetchBadges(),this.fetchUserInfo()),setInterval((()=>{l(!1)&&this.fetchBadges();}),t.FIVE_MINUTE_MS),setInterval((()=>{l(!1)&&this.fetchUserInfo();}),t.ONE_MINUTE_MS),setInterval((()=>{l(!1)&&this.fetchCurrentUserSporeInfo();}),t.ONE_SECOND_MS),setInterval((()=>{this.channelUpdatePoll();}),5*t.ONE_SECOND_MS);}async fetchBadges(){const e=await this.backgroundService.fetch("/gateway/badges");if(!s(e))return;const t=e.body.filter(C).sort(((e,t)=>e.months-t.months)),n=e.body.filter(I);this.monthBadgeList=t.map((e=>[e.months,{thumbnails:[{url:e.url,width:16,height:16}]}])),this.sporeBadgeCache.clear();for(const e of n){const t=E(e);t&&this.sporeBadgeCache.set(e.slug,t);}this.emit("monthBadges",this.monthBadgeList),this.emit("sporeBadges",this.sporeBadgeCache);}async fetchMaxSuperChatCents(){const e=await this.backgroundService.fetch("/spore/fetch-max-super-chat-cents",this.sporeOrgId);s(e)&&(this.maxSuperChatCents=null==e?void 0:e.body.value);}channelUpdatePoll(){const e=d();if(e){const t=e.channelId;t&&t!==this.channelId&&this.setChannelId(t);}}async fetchEmotes(){let e,t;if(e=this.channelId?await this.backgroundService.fetch("/gateway/emotes",this.channelId):await this.backgroundService.fetch("/gateway/emotes"),s(e)){try{t=JSON.parse(e.body);}catch(e){t=[];}this.emoteCache.clear(),this.normalizeEmotes(t),this.emit("emotes",this.emoteCache);}}normalizeEmotes(e){this.normalizeUnlockedEmotes(e),this.normalizeLockedEmotes();}normalizeUnlockedEmotes(e){for(const t of e){const e=j(t);e&&(this.emoteCache.set(t.name,e),void 0!==t.bitIndex&&this.encodedEmoteMap.set(t.name,t.bitIndex));}}normalizeLockedEmotes(){for(const e of this.emoteCache.values())if((null==e?void 0:e.isSporeEmote)&&(null==e?void 0:e.channelId)===this.channelId){const t=Object.assign(Object.assign({},e),{isLocked:!0});this.upsellSporeEmoteCache.set(e.searchTerms[0],t);}}async fetchUserInfo(){let e;e=this.channelId?await this.backgroundService.fetch("/gateway/users",this.channelId):await this.backgroundService.fetch("/gateway/users"),s(e)&&(this.infoCache=new Map(JSON.parse(e.body)),this.emit("users",this.infoCache));}async fetchSporeChannel(){var e,t,n;const o=await this.backgroundService.fetch("/spore/fetch-youtube-channel",this.channelId);s(o)&&(this.sporeOrgId=null===(e=o.body.value)||void 0===e?void 0:e.sporeOrgId,this.truffleEmoteCategoryName=null===(n=null===(t=o.body.value)||void 0===t?void 0:t.seasonPass)||void 0===n?void 0:n.name);}async setChannelId(e){this.channelId=e,this.fetchUserInfo(),this.fetchBadges(),await this.fetchSporeChannel(),await this.fetchEmotes(),await this.fetchCurrentUserSporeInfo(!0),await this.fetchMaxSuperChatCents(),this.updateWatchedChannel(e);}async updateWatchedChannel(e){await this.backgroundService.fetch("/youtube/set-watched-channel",e);}async fetchCurrentUserSporeInfo(e=!1){var t,n,o;const i=null===(t=this.myUserInfo.value)||void 0===t?void 0:t.sub;if(i&&this.sporeOrgId)try{const t=await this.backgroundService.fetch("/spore/fetch-spore-user",{connectionSourceId:i,sporeOrgId:this.sporeOrgId,invalidateCache:!!e});if(!s(t))return;if(this.mySporeUserInfo=t.body.value,!t.body.isCached&&(null===(n=null==t?void 0:t.body.value)||void 0===n?void 0:n.emotes)&&(null===(o=null==t?void 0:t.body.value)||void 0===o?void 0:o.serializedEmotes)){for(const e of t.body.value.serializedEmotes){const t=j(e);t&&!this.sporeUserEmoteCache.get(e.name)&&this.sporeUserEmoteCache.set(e.name,t),this.upsellSporeEmoteCache.get(e.name)&&this.upsellSporeEmoteCache.delete(e.name);}this.emit("spore-user-emotes",this.sporeUserEmoteCache,this.upsellSporeEmoteCache,this.truffleEmoteCategoryName);}}catch(e){console.warn("error fetching spore user",e);}}getEmoteCategoryInfo(){return {emotes:this.sporeUserEmoteCache,upsellEmotes:this.upsellSporeEmoteCache,truffleEmoteCategoryName:this.truffleEmoteCategoryName}}getSerializedMetadata(e){const t={a:null==e?void 0:e.name,b:null==e?void 0:e.subbedMonths,c:e.nameColor};return Object.values(t).filter((e=>void 0!==e)).length>0?t:void 0}getSerializedSporeMetadata(e){const t={a:null==e?void 0:e.name,b:null==e?void 0:e.subbedMonths,c:null==e?void 0:e.nameColor,e:e.badges};return Object.values(t).filter((e=>void 0!==e)).length>0?t:void 0}getUserInfo(e){var t,n;if((null===(t=this.mySporeUserInfo)||void 0===t?void 0:t.id)===e&&this.mySporeUserInfo){const e=this.getSerializedMetadata(this.mySporeUserInfo);if(e)return e}return null===(n=this.infoCache)||void 0===n?void 0:n.get(e)}getSporeUserInfo(){var e;if((null===(e=this.myUserInfo)||void 0===e?void 0:e.value)&&this.mySporeUserInfo){const e=this.getSerializedSporeMetadata(this.mySporeUserInfo);if(e)return e}}getSporeBadges(e){var t,n,o;const i=[];if(this.isCurrentUser(e)){const e=new Set(null!==(n=null===(t=this.mySporeUserInfo)||void 0===t?void 0:t.badges)&&void 0!==n?n:[]);for(const t of e){const e=this.sporeBadgeCache.get(t);e&&i.push(e);}}else {const t=this.infoCache.get(e);if(t){const e=new Set(null!==(o=null==t?void 0:t.e)&&void 0!==o?o:[]);for(const t of e){const e=this.sporeBadgeCache.get(t);e&&i.push(e);}}}return i}getEmote(e,t$1){var n,o,i,s,r,a;const l=null===(n=this.emoteCache)||void 0===n?void 0:n.get(e);if(null==l?void 0:l.isSporeEmote)if(this.isCurrentUser(t$1)){const t=null!==(i=null===(o=this.mySporeUserInfo)||void 0===o?void 0:o.emotes)&&void 0!==i?i:[];if((null===(s=this.mySporeUserInfo)||void 0===s?void 0:s.emotes)&&!t.includes(e))return}else {const n=null===(r=this.infoCache.get(t$1))||void 0===r?void 0:r.d;if(n){const t$1=null===(a=this.encodedEmoteMap)||void 0===a?void 0:a.get(e),o=function(e,t$1,n=!0){const o=()=>{const t$1=[];for(let n=0;n<e.length;n++)t$1[e.length-1-n]=e.charCodeAt(n)-t.ASCII_OFFSET;const n=[];for(let e=0;e<t$1.length;e++)if(0!==t$1[e])for(let o=0;o<6;o++)0!=(t$1[e]&1<<o)&&n.push(6*e+o);return n};if(n){const n=t$1.get(e);if(n)return n;const i=o();return t$1.set(e,i),i}return o()}(n,this.emoteIndicesMap,!0);if(void 0!==t$1&&!o.includes(t$1))return}}return l}isCurrentUser(e){var t;return e===(null===(t=this.myUserInfo.value)||void 0===t?void 0:t.sub)}}
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var X,W=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var n={},o=t||{},i=e.split(H),s=o.decode||Z,r=0;r<i.length;r++){var a=i[r],l=a.indexOf("=");if(!(l<0)){var c=a.substr(0,l).trim(),d=a.substr(++l,a.length).trim();'"'==d[0]&&(d=d.slice(1,-1)),null==n[c]&&(n[c]=G(d,s));}}return n},Z=decodeURIComponent,H=/; */;function G(e,t){try{return t(e)}catch(t){return e}}async function $(e,n){await customElements.whenDefined(e);const o=customElements.get(e);if(!o)return void console.warn(`Polymer: ${e} not found`);const i=o.prototype[n.functionName];o.prototype[n.functionName]=function(...e){if(n.enabledLivestreamOnly&&!l())return i.apply(this,e);if(n.type===X.OverrideFunction)try{return n.function.apply(this,e)}catch(e){console.error(JSON.stringify(n)),console.error(e);}if(n.type===X.ModifyArgs)try{const t=n.function.apply(this,e);return i.apply(this,"string"==typeof t?[t]:t)}catch(e){console.error(JSON.stringify(n)),console.error(e);}if(n.type===X.RunBefore)try{n.function.apply(this,e);}catch(e){console.error(e);}let o=i.apply(this,e);if(n.type===X.RunAfter)try{o=n.function.apply(this,[o]);}catch(e){console.error(e);}return o};}!function(e){e[e.ModifyArgs=0]="ModifyArgs",e[e.OverrideFunction=1]="OverrideFunction",e[e.RunBefore=2]="RunBefore",e[e.RunAfter=3]="RunAfter";}(X||(X={}));const Y=(e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:X.OverrideFunction}),ee=(e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:X.ModifyArgs}),te=(e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:X.RunBefore});function ne(e,n,i){$("yt-live-chat-item-list-renderer",te("handleAddChatItemAction_",(function(t){t.item.liveChatTextMessageRenderer&&(n.addAliasesToMessage(t.item.liveChatTextMessageRenderer),e.addEmotesToMessage(t.item.liveChatTextMessageRenderer));}),{EnabledLivestreamOnly:true})),$("yt-live-chat-text-input-field-renderer",((e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:X.RunAfter}))("calculateLiveChatRichMessageInput_",(function(e){var t;if(!(null==e?void 0:e.textSegments))return e;for(const n of e.textSegments)if(null===(t=n.emojiId)||void 0===t?void 0:t.startsWith("mogultv")){const[,e]=n.emojiId.split("-");delete n.emojiId,n.text=e;}return e}),{EnabledLivestreamOnly:true})),$("yt-emoji-picker-renderer",ee("updateCategoriesAndPlaceholder_",(function(e,t){const n=i.getEmoteCategoryInfo(),o=e.categories;if(!N(o)){const e=O(n.upsellEmotes);if(null==e?void 0:e.length){z(o,T(e,n.truffleEmoteCategoryName));}}if(!k(o)){const e=O(n.emotes);if(null==e?void 0:e.length){z(o,B(e,n.truffleEmoteCategoryName));}}return [e,t]}),{EnabledLivestreamOnly:true})),i.on("emotes",(e=>{l()&&(t$2()||D(e,"_mogulTvLoaded"));})),i.on("spore-user-emotes",((e,n,i)=>{l()&&(t$2()||(R(e,n,i),_(e,n,i)));}));}function oe(e){return e?e._mtvType?e._mtvType:e.icon?e.icon.iconType.toLowerCase():e.customThumbnail?"member":"":""}async function ie(e){$("yt-live-chat-author-badge-renderer",Y("computeType_",(e=>oe(e.liveChatAuthorBadgeRenderer)),{EnabledLivestreamOnly:true})),$("yt-live-chat-author-chip",Y("computeAuthorType",(function(t){var n,o,i;const s=this.$["author-name"];if(s){let t;const r=null===(n=this.parentElement)||void 0===n?void 0:n.parentElement,a=null===(o=null==r?void 0:r.data)||void 0===o?void 0:o.authorExternalChannelId;if(a){const n=e.getUserInfo(a);(null==n?void 0:n.c)&&(t=n.c);}t||(t=function(e){const t=function(e){let t=0;if(0===e.length)return 0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(e);return K[(t%K.length+K.length)%K.length]}(null===(i=this.authorName)||void 0===i?void 0:i.simpleText)),s.style.color=t;}return function(e){if(!e)return "";for(const t of e){if(!t.liveChatAuthorBadgeRenderer)continue;const e=oe(t.liveChatAuthorBadgeRenderer);if("verified"!==e)return e}return ""}(t)}),{EnabledLivestreamOnly:true}));}e$1("\n/* Make the masthead transparent unless we are hovering it */\nbody[data-mogul-theater-mode] #masthead-container {\n  opacity: 0.1;\n  transition: opacity .2s ease;\n}\n\nbody[data-mogul-theater-mode] #masthead-container:hover {\n  opacity: 1;\n}\n\n\n@media screen and (min-width: 1014px) {\n  /* Make chat fill screen vertically */\n  body[data-mogul-theater-mode] #chat.ytd-watch-flexy {\n    height: calc(100vh - 56px) !important;\n    width: var(--ytd-watch-flexy-sidebar-width);\n    position: absolute;\n    top: 56px;\n    right: 0;\n  }\n\n  body[data-mogul-theater-mode] #player-theater-container.ytd-watch-flexy {\n    width: calc(100vw - var(--ytd-watch-flexy-sidebar-width) - var(--ytd-watch-flexy-scrollbar-width)) !important;\n    max-width: calc(100vw - var(--ytd-watch-flexy-sidebar-width) - var(--ytd-watch-flexy-scrollbar-width)) !important;\n    height: calc(100vh - 56px) !important;\n    max-height: calc(100vh - 56px) !important;\n  }\n}");let se=!1;const re=new t$1;function ae(){const e=document.querySelector("ytd-live-chat-frame iframe");if(e)if(e.src.includes("LVMoBhjQjlbcwXxO")){const t=e.src.substring(e.src.indexOf("#")+1),n$1=e$4(t),o=n();if(o&&(null==n$1?void 0:n$1.videoId)!==(null==o?void 0:o.videoId)){const t=document.querySelector("ytd-live-chat-frame"),n=s$1(t,o);e.src=n;}}else {const t=d();e.src+=`#LVMoBhjQjlbcwXxO=${encodeURIComponent(JSON.stringify(t))}`;}else if(o()){const e=u();if(e){let t=a(e);const n=r$1();(null==n?void 0:n.channelId)&&t&&((null==t?void 0:t.includes("LVMoBhjQjlbcwXxO"))||(t+=`#LVMoBhjQjlbcwXxO=${encodeURIComponent(JSON.stringify(n))}`,v(e,t)));}}}if(c()){const e=new J(re),t$1=new q(e),o=new F(e);le=re,ne(t$1,o,ce=e),function(e){const t$1=document.querySelector("yt-live-chat-renderer"),n=new MutationObserver((t$1=>{if(null==e?void 0:e.maxSuperChatCents){const n=document.querySelector("yt-live-chat-message-buy-flow-renderer"),o=()=>{var t$1,o;const i=null===(t$1=null==n?void 0:n.data)||void 0===t$1?void 0:t$1.messageTiers,s=null===(o=null==n?void 0:n.data)||void 0===o?void 0:o.currency;if(n&&(null==i?void 0:i.length)&&(null==e?void 0:e.maxSuperChatCents)&&"USD"===s){const t$1=e.maxSuperChatCents*t.MICROS_PER_CENT,o=i.filter((n=>e.maxSuperChatCents&&parseInt(n.minPriceMicros)<=t$1));o[o.length-1]&&(o[o.length-1].maxPriceMicros=`${t$1}`),(null==o?void 0:o.length)&&i.length!==o.length&&n.setupBuyFlowState(o,n.buyButton_);}};if(n&&document.contains(n))for(const e of t$1)if(Array.from(e.addedNodes).includes(n)){o();break}}}));t$1&&n.observe(t$1,{attributes:!1,childList:!0,characterData:!1,subtree:!0});}(ce),$("yt-live-chat-renderer",ee("openPopoutWindow",(function(e){if(!(null==e?void 0:e.includes("LVMoBhjQjlbcwXxO"))){const t=d();return e+`#LVMoBhjQjlbcwXxO=${encodeURIComponent(JSON.stringify(t))}`}return e}),{EnabledLivestreamOnly:!0})),async function(e){const t=await e.getLiveStorageValue("settings.chatBatching");$("yt-timed-continuation",te("dataChanged_",(function(){t.value&&(this.data.timeoutMs/=3*Math.random()+2);}),{EnabledLivestreamOnly:!0})),$("yt-live-chat-renderer",te("preprocessActions_",(function(e){const n=Object.getPrototypeOf(this.smoothedQueue_);for(const e in n)if(e.includes("emitSmoothedMessages")){n[e]=function(){if(this.nextUpdateId_=null,this.messageQueue_.length){let o=1e4;this.estimatedUpdateInterval_&&(o=this.estimatedUpdateInterval_-Date.now()+this.lastUpdateTime_);const i=this.messageQueue_.length<o/80?1:Math.ceil(this.messageQueue_.length/(o/80)),s=this.messageQueue_.splice(0,i);if(this.callback&&this.callback(s[0]),this.messageQueue_.length){let s=1;t.value||(1===i?(s=o/this.messageQueue_.length,s*=Math.random()+.5,s=Math.min(1e3,s),s=Math.max(80,s)):s=80),this.nextUpdateId_=window.setTimeout(n[e].bind(this),s);}}};break}return e}),{EnabledLivestreamOnly:!0}));}(le),ie(ce);const i=setInterval((()=>{const t=d(),o=null==t?void 0:t.channelId;o&&(clearInterval(i),e.setChannelId(o));}),t.ONE_SECOND_MS);se||(se=!0,setInterval((()=>ae()),t.ONE_SECOND_MS));}else !async function(e){async function n(){const n=document.querySelector("ytd-watch-flexy"),o=(null==n?void 0:n.hasAttribute("theater"))||!1,i=(null==n?void 0:n.hasAttribute("fullscreen"))||!1,s=await e.getStorage("settings.theaterMode"),r=l(!1);return o&&!i&&s&&r}let o=await n();setInterval((async()=>{await n()?(document.body.setAttribute("data-mogul-theater-mode",""),o||window.dispatchEvent(new Event("resize")),o=!0):(o=!1,document.body.removeAttribute("data-mogul-theater-mode"));}),250);}(re),async function(e){if(!window.ytcfg)return;const t={key:window.ytcfg.get("INNERTUBE_API_KEY"),authUser:window.ytcfg.get("SESSION_INDEX"),pageId:window.ytcfg.get("DELEGATED_SESSION_ID"),href:window.location.href,context:window.ytcfg.get("INNERTUBE_CONTEXT")};n=await e$2(Object.assign(Object.assign({},t),{cookies:W(document.cookie)})),o=await e.fetch("/auth/@me"),(!n.success||!o.meta.isSuccess||n.data.id!==(null===(i=o.body)||void 0===i?void 0:i.sub)||!(null===(s=o.body)||void 0===s?void 0:s.googleId))&&await e.fetch("/auth/login",t);var n,o,i,s;}(re),se=!0,setInterval((()=>ae()),t.ONE_SECOND_MS);var le,ce;
