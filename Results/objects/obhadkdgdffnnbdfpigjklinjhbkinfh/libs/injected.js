let my_assets_on_trade=function(){let e=[];return g_rgLastFullTradeStatus.me.assets.forEach((function(t){e.push(get_item_from_my_inventory(t.appid,t.assetid))})),e},get_trade_token=function(e){var t=new RegExp("steamcommunity.com/tradeoffer/new/\\?partner=(\\d+)&token=(\\S+)").exec(e);return t?{partner:t[1],token:t[2],steamid:(BigInt(76561197960265730)+BigInt(t[1])).toString()}:null},them_assets_on_trade=function(){let e=[];return g_rgLastFullTradeStatus.them.assets.forEach((function(t){e.push(get_item_from_them_inventory(t.appid,t.assetid))})),e},get_user_inventory=function(e,t){$J.get("https://steamcommunity.com/profiles/"+e+"/inventory/json/730/2/?trading=1",(function(e){let r=[];$J.map(e.rgInventory,(function(t,a){r[t.id]={market_hash_name:e.rgDescriptions[t.classid+"_"+t.instanceid].market_hash_name,id:t.id,classid:t.classid,instanceid:t.instanceid}})),t(r)}))},send_trade_offer=function(e,t){if("undefined"!=typeof g_sessionID&&"undefined"!=typeof g_ulTradePartnerSteamID){var r={sessionid:g_sessionID,serverid:1,partner:g_ulTradePartnerSteamID,tradeoffermessage:"",json_tradeoffer:'{"newversion":true,"version":2,"me":{"assets":[{"appid":730,"contextid":"2","amount":1,"assetid":"'+e.assetid+'"}],"currency":[],"ready":false},"them":{"assets":[],"currency":[],"ready":false}}',captcha:CTradeOfferStateManager.GetCaptchaResponse()};CTradeOfferStateManager.m_rgTradeOfferCreateParams&&(r.trade_offer_create_params=V_ToJSON(CTradeOfferStateManager.m_rgTradeOfferCreateParams)),$J.ajax({url:"https://steamcommunity.com/tradeoffer/new/send",data:r,type:"POST",crossDomain:!0,xhrFields:{withCredentials:!0}}).done((function(e){e&&e.needs_email_confirmation,e&&e.needs_mobile_confirmation,t(e)})).error((function(e){t(e)}))}else t(!1)},show_alert_shadowpay=function(e,t){if(document.getElementsByClassName("shp_alert").length<=0){let r='<div><div id="trade_escrow_header" class="trade_escrow_header shp_alert shadowpay_alert_'+t+'"><div>'+e+"</div></div></div>";$J(".trade_partner_header").parent().append(r)}},detect_page=function(){return location.href.indexOf("tradeoffers")>0||location.href.indexOf("tradeoffers/sent/")>0?"offers":location.href.indexOf("tradeoffer/new")>0?"offer_new":location.href.indexOf("tradeoffer/")>0&&"offer"},send_message_to_ext=function(e,t){chrome.runtime.sendMessage(window.SHID,e,t)},make_offer=function(e){e.forEach((function(e){is_validate_make_offer(e)&&send_trade_offer(e,(function(t){return!1===t?(console.info("process FALSE"),void window.close()):500===t.status?(console.info("cant sent to user"),void window.close()):void send_message_to_ext({type:7,tradeofferid:t.tradeofferid,id:e.id},(function(e){window.close()}))}))}))},confirm_trade=function(e){1==GTradeStateManager.m_eTradeOfferState&&GTradeStateManager.ConfirmTradeOffer().done((()=>{e.forEach((function(e){parseInt(e.tradeofferid)==parseInt(GTradeStateManager.m_nTradeOfferID)&&send_message_to_ext({type:11,tradeofferid:GTradeStateManager.m_nTradeOfferID,id:e.id},(function(){window.close()}))}))})).error((e=>{window.close()}))},confirm_ex_trade=function(e){1==GTradeStateManager.m_eTradeOfferState&&GTradeStateManager.ConfirmTradeOffer().done((()=>{e.forEach((function(e){parseInt(e.tradeofferid)==parseInt(GTradeStateManager.m_nTradeOfferID)&&send_message_to_ext({type:10,tradeofferid:GTradeStateManager.m_nTradeOfferID,id:e.id},(function(){window.close()}))}))})).error((e=>{window.close()}))},reject_trade=function(e){ActOnTradeOffer(e,"cancel","","")},valid_offer=function(e){return null!=e&&-1!==e.indexOf(parseInt(GTradeStateManager.m_nTradeOfferID))},is_validate_trade=function(e){let t=!1;return parseInt(location.hash.split("#")[1]),e.forEach((e=>{e.tradeofferid&&e.from_steamid===g_ulTradePartnerSteamID&&(console.log("user ok"),parseInt(e.tradeofferid)==parseInt(GTradeStateManager.m_nTradeOfferID)&&(t=!0)),e.tradeofferid||e.to_steamid!==g_ulTradePartnerSteamID||(t=!0)})),t},is_validate_ex_trade=function(e){let t=!1;return parseInt(location.hash.split("#")[1]),e.forEach((function(e){parseInt(e.tradeofferid)==parseInt(GTradeStateManager.m_nTradeOfferID)&&(t=!0)})),t},is_validate_make_offer=function(e){let t=!1,r=parseInt(location.hash.split("#")[1]);return console.log("is_validate_make_offer"),console.log("_trade_id = "+r),console.log(e),console.log(e.id),!(parseInt(e.tradeofferid)>0)&&(e.id==r&&(t=!0),t)},get_item_from_my_inventory=function(e,t){return UserYou.rgContexts[e][2].inventory.rgInventory[t]},get_my_inventory=function(e){$J.get("https://steamcommunity.com/profiles/"+g_steamID+"/inventory/json/730/2/?trading=1",(function(t){let r={};$J.map(t.rgInventory,(function(e,a){r[e.id]={market_hash_name:t.rgDescriptions[e.classid+"_"+e.instanceid].market_hash_name,id:e.id,classid:e.classid,instanceid:e.instanceid}})),e(r)}))},get_item_from_them_inventory=function(e,t){return UserThem.rgContexts[e][2].inventory.rgInventory[t]};function _injected(){if("offer"===detect_page()){if(!window.accept_trades&&!window.ex_trades)return!1;window.accept_trades.length>0&&is_validate_trade(window.accept_trades)&&(console.log("valid trade"),confirm_trade(window.accept_trades)),window.ex_trades.length>0&&is_validate_ex_trade(window.ex_trades)&&(console.log("valid ex_trades"),confirm_ex_trade(window.ex_trades))}if("offer_new"===detect_page()){if(!window.send_trades)return!1;make_offer(window.send_trades)}}let is_ready=function(){_injected()};setTimeout(is_ready,2e3);