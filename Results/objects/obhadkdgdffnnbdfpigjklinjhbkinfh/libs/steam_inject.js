var t="#global_actions > a",r="body > div.responsive_page_frame.with_header > div.responsive_page_content > script",detect_page=function(){return location.href.indexOf("tradeoffers/sent")>0?"offers_sent":location.href.indexOf("tradeoffer/new")>0?"offer_new":location.href.indexOf("tradeoffers")>0?"offers":location.href.indexOf("tradeoffer/")>0?"offer":location.href.indexOf("profiles/")>0||location.href.indexOf("id/")>0?"profiles":location.href.indexOf("login")>0&&"login"},get_tradeoffers=function(){var e=document.getElementsByClassName("link_overlay"),t=[];if(e&&e.length)for(var n=0;n<e.length;++n){var o=e[n].getAttribute("onclick");t.push(/(\d+)/.exec(o)[1])}return t},total_offers_send=function(){return $(".tradeoffer .tradeoffer_items_banner").length},get_logged_steamid=function(){var e={},t=document.querySelector(r);if(t){var n=t.innerHTML,o=new RegExp('g_steamID\\s*=\\s*"(\\d+)";').exec(n);o&&2===o.length&&(e.steam_id=o[1])}return e.steam_id},dont_close_message=function(e){var t=document.querySelector("#content_block_div");t||((t=document.createElement("div")).id="content_block_div",t.className="content_block_div",t.style.zIndex="3000",t.innerHTML="<div><span>This tab is used to poll your active trade offers to alert you if we detect a valid ShadowPay P2P trade, please do not close it.</span></div>",document.querySelector("body").appendChild(t)),t.style.display=e?"block":"none"},get_current_user_data=function(){for(var e=document.querySelectorAll("script"),t={},n=0;n<e.length;++n){var o,r=e[n].innerHTML;if(t.partner_steam64||(o=new RegExp("g_ulTradePartnerSteamID\\s*=\\s*'(\\d*)'").exec(r))&&(t.partner_steam64=o[1]),t.session_id||(o=new RegExp('g_sessionID\\s*=\\s*"(\\S+)"').exec(r))&&(t.session_id=o[1]),t.steam64||(o=new RegExp('g_steamID\\s*=\\s*"(\\d+)"').exec(r))&&(t.steam64=o[1]),t.partner_steam64&&t.session_id&&t.steam64)return t}return null},_get_your_items=function(){var e=document.querySelectorAll("#your_slots > .has_item .item"),t=[];if(e=e.constructor===NodeList?e:[e])for(var n=0;n<e.length;++n){var o=e[n].id||"";if(0===o.indexOf("item730"))t.push(e[n].id);else if(0===o.indexOf("anonymous_element"))return null}return t},_get_trade_token=function(){var e=window.location.href;trade_id_rx=new RegExp("steamcommunity.com/tradeoffer/new/\\?partner=(\\d+)&token=(\\S+)&auto_trade=true");var t=trade_id_rx.exec(e);return t?{partner:t[1],token:t[2]}:null};window.onload=function(){if("offers_sent"==detect_page())return!1;if("offer"==detect_page()&&chrome.runtime.sendMessage({type:6},(function(e){var t=document.createElement("script");t.src=chrome.extension.getURL("/libs/injected.js"),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.parentNode.removeChild(t)};var n=JSON.stringify(e.accept_trades),o=JSON.stringify(e.ex_trades),r=document.createElement("script");r.textContent=`window.SHID = '${chrome.runtime.id}'; window.accept_trades = ${n}; window.ex_trades = ${o};`,(document.head||document.documentElement).appendChild(r),r.parentNode.removeChild(r)})),"offer_new"==detect_page()&&chrome.runtime.sendMessage({type:6},(function(e){var t=document.createElement("script");t.src=chrome.extension.getURL("/libs/injected.js"),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.parentNode.removeChild(t)};var n=JSON.stringify(e.send_trades),o=JSON.stringify(e.settings),r=document.createElement("script");r.textContent=`window.SHID = '${chrome.runtime.id}'; window.send_trades = ${n}; window.settings = ${o}`,(document.head||document.documentElement).appendChild(r),r.parentNode.removeChild(r)})),"login"==detect_page()){var e=location.hash.split("#")[1];"shadowpay_login"===e&&($("#remember_login").attr("checked","checked"),$("#mainBody").prepend('<div class="shadow-login-warning">You have to be logged in steam in order to trade on ShadowPay payments system.</div>')),"skinplace_login"===e&&($("#remember_login").attr("checked","checked"),$("#mainBody").prepend('<div class="shadow-login-warning">You have to be logged in steam in order to trade on SkinPlace payments system.</div>'))}"profiles"==detect_page()&&chrome.runtime.sendMessage({type:6,steam_id:get_logged_steamid()},(function(e){"show_alert"===location.hash.split("#")[1]&&($(".responsive_page_content_overlay").addClass("show"),void 0===e.user.name?$("body").append('<div class="shadow-login-warning2"><p>Sign in to Steam with the account you’re using on ShadowPay to trade your items.</p> <a href="javascript:Logout();">LOGOUT</button></a>'):$("body").append('<div class="shadow-login-warning2"><p>Sign in to Steam with the account you’re using on ShadowPay to trade your items. You have logged in Shadowpay as a `'+e.user.name+'`</p> <a href="javascript:Logout();">LOGOUT</button></a>'))}))};