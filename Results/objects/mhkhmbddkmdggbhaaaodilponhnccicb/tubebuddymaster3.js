var TubeBuddyTranscriptions=function(){var e=false;var t;var i;var s;var n=function(){};var r=function(){var e=TBGlobal.host+"/ModuleManager/transcriptions/transcriptions?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/transcriptions.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/transcriptions.html"}TBExtension.Get(e,"CRTBLoadTranscriptionsTranscriptions")};var a=function(){jQuery(document).on("click",".tb-transcriptions-order",function(){var e=$(this);jQuery("#tb-transcriptions").hide();TubeBuddyMenu.HideBackground();TBUtilities.AddAction(null,TBUtilities.ActionTypes.CaptionsService_Order,"captionsservice")});jQuery(document).on("click",".tb-transcriptions-close, .tb-transcriptions-closex",function(){jQuery("#tb-transcriptions").hide();TubeBuddyMenu.HideBackground()})};var o=function(){jQuery(document.body).on("CRTBLoadTranscriptionsTranscriptions",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);d()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTranscriptions] CRTBLoadTranscriptionsTranscriptions"})}})};var d=function(){jQuery("#tb-transcriptions").show();jQuery(".tb-transcriptions-order").attr("href",TBGlobal.host+"/account/TranscriptionOrder?videoid="+t);jQuery("#tb-transcriptions-video-thumbnail").attr("src",s);jQuery("#tb-transcriptions-video-link").text(i);jQuery("#tb-transcriptions-video-link").attr("href","https://www.youtube.com/watch?v="+t)};return{Show:function(n,l,c){if(TBGlobal.IsAuthenticated()){t=n;i=l;s=c;if(!e){o();r();a();e=true}else{d()}}}}}();var TubeBuddyCommentsCannedResponse=function(){var t=false;var s=null;var n=null;var r=null;var a=false;var o="";var d="";var l="";var c=false;var u=function(){var e=TBGlobal.host+"/ModuleManager/CommentsCannedResponse/CommentsCannedResponse?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/commentscannedresponse.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/commentscannedresponse.html"}TBExtension.Get(e,"CRTBLoadCommentsCannedResponseTemplate")};var p=function(){jQuery(document).on("click","#page",function(){TBUtilities.Log("CommentsCannedResponse #page click");b()});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponseEmpty",function(){var t=window.open(TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId(),"_blank");t.focus();e.stopPropagation()});jQuery(document).on("click",".show-more, .tb-comment-filter-show-more-wrap",function(){if(r){clearTimeout(r)}r=setTimeout(y,50)});jQuery(document).on("click",".tb-commentsCannedResponse-chart",function(){var e=jQuery(this).closest(".comment-item");var t=jQuery(e).find("a:first").attr("href");var i=t.lastIndexOf("/");var s=t.substring(i+1);var n=e.find(".user-name:first").text();var r=e.find(".user-photo:first").attr("src");TubeBuddyChannelytics.ShowForChannel(s,n,r)});jQuery(document).on("click",".tb-commentsCannedResponse-heart-it",function(e){var t={action:o,session_token:l};TBExtension.Post("https://www.youtube.com/comment_service_ajax?action_perform_comment_action=1",jQuery.param(t),"CRTBCannedResponseHeartComment",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});jQuery(".tb-commentsCannedResponse-heart-processing").show();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").hide();e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-heart-ed",function(e){var t={action:d,session_token:l};TBExtension.Post("https://www.youtube.com/comment_service_ajax?action_perform_comment_action=1",jQuery.param(t),"CRTBCannedResponseUnHeartComment",null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"});jQuery(".tb-commentsCannedResponse-heart-processing").show();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").hide();e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-refresh-cannedResponses",function(e){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeOut();var t=TBGlobal.host+TBGlobal.apiUrls.campaignGetByYouTubeChannelId+"?id="+TBGlobal.CurrentChannelId();TBExtension.Get(t,"CRTBCannedResponseGetCannedResponses");e.stopPropagation()});jQuery(document).on("click",".tb-commentsCannedResponse-menu-cannedResponse",function(e){TBUtilities.Log("CommentsCannedResponse tb-commentsCannedResponse-menu-cannedResponse click");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.CannedResponses_Use,"cannedresponses");b();var t=jQuery(this).attr("data-id");var i=jQuery(this).closest(".comment-footer-actions");var s=jQuery(i).siblings().find(".yt-commentbox-text");if(s.length==0||s.parent().parent().hasClass("hid")){var r=i.find(".yt-commentbox-show-reply");r.click()}var a=TBUtilities.GetInArray(n,"Id",t);TBUtilities.Log(a);var o=a.Template;var d=jQuery(i).parent().siblings().find(".user-name").text();TBUtilities.ReportProductEvent("Feature Applied",{Tool:TBGlobal.GetToolById("cannedresponses").name,Page:"Public Video Comments"});TBUtilities.Log(d);if(d){o=TBUtilities.ReplaceAll(o,"{N}",d);o=TBUtilities.ReplaceAll(o,"{n}",d)}TBUtilities.Log(o);s=jQuery(i).siblings().find(".yt-commentbox-text");jQuery(s).append(o);var r=jQuery(i).siblings().find(".yt-commentbox-button");r.removeAttr("disabled");e.stopPropagation()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-menu-cannedResponse click"})}});jQuery(document).on("click",".tb-commentsCannedResponse-cannedResponse-menu-icon",function(e){TBUtilities.Log("CommentsCannedResponse tb-commentsCannedResponse-cannedResponse-menu-icon click");if(jQuery("#yt-comments-paginator").length>0)if(jQuery("#yt-comments-paginator").closest("form").length>0)jQuery("#yt-comments-paginator").closest("form").css("padding-bottom","400px");b();var t=jQuery(this).closest(".comment-entry");if(t.is(":last-child")){t.css("height","200px")}var i=jQuery(this).siblings(".tb-commentsCannedResponse-cannedResponse-menu-list");var s=jQuery(this).closest(".tb-commentsCannedResponse-cannedResponse-menu").position().left;TBUtilities.Log(s);jQuery(i).css({left:s+"px"});if(jQuery(i).hasClass("tb-hid")){jQuery(i).removeClass("tb-hid").show();var n=jQuery(this).closest(".comment-item");var r=jQuery(n).attr("data-cid");var a=jQuery(n).attr("data-vid");var o=TBGlobal.host+TBGlobal.apiUrls.topicsGetCommentAudienceSuggestedTopic+"?commentId="+r;TBExtension.Get(o,"CRTBCannedResponseGetCommentAudienceSuggestedTopic",r)}e.stopPropagation()});jQuery(document).on("change",".tb-commentsCannedResponse-topicgenerator-input",function(e){TBUtilities.Log("tb-commentsCannedResponse-topicgenerator-input change");try{var t=jQuery(this).is(":checked");if(a==false&&t==true){TBGlobal.ShowUpgradePage("have more than 5 comment suggestions","videotopicplanner");return}if(t){TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_SaveComment,"videotopicplanner")}var i=jQuery(this).closest(".comment-item");var s=jQuery(i).attr("data-cid");var n=jQuery(i).attr("data-vid");var r=jQuery(i).attr("data-name");var o=jQuery(i).find("a:first").attr("href");var d=o.lastIndexOf("/");var l=o.substring(d+1);var c=jQuery(i).find(".comment-text-content").text();var u=jQuery(i).find(".user-photo").attr("src");var p={VideoId:n,CommentId:s,CommentorChannelId:l,CommentorName:r,Comment:c,CommentorPhoto:u};TBUtilities.Log(p);var y=TBGlobal.host+TBGlobal.apiUrls.topicsToggleCommentAudienceSuggestedTopic;TBExtension.Post(y,JSON.stringify(p),null,null,{contentType:"application/json"})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] tb-commentsCannedResponse-topicgenerator-input change"})}});jQuery(document).on("click",".tb-commentsCannedResponse-topicgenerator-input",function(e){e.stopPropagation()})};var y=function(){TBUtilities.Log("lookForMore");clearTimeout(r);if(jQuery("#yt-comments-paginator:visible").length==0){m()}else if(jQuery("#yt-comments-paginator:visible").length==1&&jQuery("#yt-comments-paginator > .show-more").is(":visible")){m()}else{r=setTimeout(y,50)}};var b=function(){jQuery(".tb-commentsCannedResponse-cannedResponse-menu-list").addClass("tb-hid").hide()};var m=function(){var e=jQuery("#tb-commentsCannedResponse-channelInfoTemplate").html();var t=jQuery("#tb-commentsCannedResponse-subscriberCountTemplate").html();var s=jQuery("#tb-commentsCannedResponse-facebookTemplate").html();var n=jQuery("#tb-commentsCannedResponse-twitterTemplate").html();var r=jQuery("#tb-commentsCannedResponse-instagramTemplate").html();jQuery(".comment-entry").each(function(a,o){jQuery(this).find(".comment-item").each(function(a,o){if(jQuery(this).closest(".comment-item").hasClass("channel-owner")==false){var d=jQuery(this);if(TBGlobal.Profile().SettingsShowCommentSubscriberCount==true){if(d.find(".tb-commentsCannedResponse-channelInfo").length==0){var l=jQuery(this).find("a:first").attr("href");var c="https://www.youtube.com"+l;var u=jQuery(this).find("a:first");TubeBuddyYouTubeActions.GetChannelInfoFromAboutPage(c,function(a){if(a.success==true){var o="";if(a.subscribersFormatted!=null){o=t.formatTemplate(a.subscribersFormatted)}var l="";var c="";var u="";for(i=0;i<a.socialProfiles.length;i++){var p=a.socialProfiles[i];if(p.url!==undefined&&p.url.indexOf("twitter.com")!==-1){c=n.formatTemplate(p.url)}else if(p.url!==undefined&&p.url.indexOf("facebook.com")!==-1&&p.url.indexOf("youtube.com")===-1){l=s.formatTemplate(p.url)}else if(p.url!==undefined&&p.url.indexOf("instagram.com")!==-1){u=r.formatTemplate(p.url)}}var y=e.formatTemplate(o,l,c,u);if(d.find(".tb-commentsCannedResponse-channelInfo").length==0){d.find(".time").after(y)}}})}}d.find(".comment-footer-actions:first").each(function(e,t){if(jQuery(this).find(".tb-commentsCannedResponse-cannedResponse-menu").length==0){jQuery(this).append(h())}})}})})};var h=function(){if(s){return s}else{var e="";try{n=TBGlobal.Profile().Campaigns;var t=jQuery("#tb-commentsCannedResponse-menuTemplate").html();var i=v();e=t.formatTemplate(i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] getMenuHtml"})}s=e;return s}};var v=function(){var e=jQuery("#tb-commentsCannedResponse-menuButtonTemplate").html();var t=jQuery("#tb-commentsCannedResponse-menuButtonTemplate-fav").html();var i="";if(n.length>0){if(n.some(e=>e.Order===0)){n.sort((e,t)=>e.Name.localeCompare(t.Name));jQuery.each(n,function(e,s){if(s.IsFavorite==true){i+=t.formatTemplate(s.Id,s.Name)}});jQuery.each(n,function(t,s){if(s.IsFavorite==false){i+=e.formatTemplate(s.Id,s.Name)}})}else{n.sort((e,t)=>{return e.Order-t.Order});jQuery.each(n,function(s,n){if(n.IsFavorite==false){i+=e.formatTemplate(n.Id,n.Name)}else{i+=t.formatTemplate(n.Id,n.Name)}})}}else{i=jQuery("#tb-commentsCannedResponse-menuButtonTemplateEmpty").html()}return i};var f=function(){jQuery(document.body).on("CRTBCannedResponseHeartComment",function(e,t){try{if(t.success){if(t.success){jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").show();jQuery(".tb-commentsCannedResponse-heart-it").hide()}else{TBUtilities.Alert("There was an error!\n\n"+t.response);jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").show()}}}catch(e){}});jQuery(document.body).on("CRTBCannedResponseUnHeartComment",function(e,t){try{if(t.success){jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").show()}else{TBUtilities.Alert("There was an error!\n\n"+t.response);jQuery(".tb-commentsCannedResponse-heart-processing").hide();jQuery(".tb-commentsCannedResponse-heart-ed").show();jQuery(".tb-commentsCannedResponse-heart-it").hide()}}catch(e){}});jQuery(document.body).on("CRTBCannedResponseGetSpecificComment",function(e,t){try{if(t.success){var i=t.response;var s=i.indexOf(t.data.commentId);var n=i.indexOf("creator-heart-big-",s)+"creator-heart-big-".length;var r=i.substring(n,n+1);c=r=="h";jQuery(".tb-commentsCannedResponse-heart-processing").hide();if(!c){jQuery(".tb-commentsCannedResponse-heart-ed").hide();jQuery(".tb-commentsCannedResponse-heart-it").show()}else{jQuery(".tb-commentsCannedResponse-heart-ed").show();jQuery(".tb-commentsCannedResponse-heart-it").hide()}var a=i.indexOf("yt-uix-creator-heart-button",s);s=i.indexOf("data-action-heart=",a)+"data-action-heart=".length+1;var u=i.indexOf('"',s);o=i.substring(s,u);s=i.indexOf("data-action-unheart=",a)+"data-action-unheart=".length+1;u=i.indexOf('"',s);d=i.substring(s,u);l=TBUtilities.GetSessionToken(i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetSpecificComment"})}});jQuery(document.body).on("CRTBCannedResponseGetCommentAudienceSuggestedTopic",function(e,t){try{if(t.success){var i=JSON.parse(t.response);var s=jQuery(".comment-item[data-cid='"+t.data+"']");var n=jQuery(s).find(".tb-commentsCannedResponse-topicgenerator-input");a=i.CanAdd;jQuery(n).removeAttr("disabled");jQuery(n).attr("checked",i.IsSuggestedTopic)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCommentAudienceSuggestedTopic"})}});jQuery(document.body).on("CRTBCannedResponseGetCannedResponses",function(e,t){jQuery(".tb-commentsCannedResponse-refresh-cannedResponses-image").fadeIn();try{if(t.success){n=JSON.parse(t.response);var i=v();jQuery(".tb-commentsCannedResponse-cannedResponses-container").empty();jQuery(".tb-commentsCannedResponse-cannedResponses-container").html(i);s=null}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBCannedResponseGetCannedResponses"})}});jQuery(document.body).on("CRTBLoadCommentsCannedResponseTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response).append(function(){TubeBuddyCommentsCannedResponse.PopulateMenus()})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCommentsCannedResponse] CRTBLoadCommentsCannedResponseTemplate"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!t){f();if(TBGlobal.Profile().SettingsShowCommentCannedResponses){var e=TBUtilities.GetUrlParameter("tab");if(e==null||e=="inbox"){u();p()}}t=true}}},PopulateMenus:function(){m();jQuery(".tb-commentsCannedResponse-manage-cannedResponses").attr("href",TBGlobal.host+"/channel/cannedresponses/"+TBGlobal.CurrentChannelId())}}}();var TubeBuddyTopicGenerator=function(){var e=false;var t;var s;var n=1;var r=function(){jQuery("#tb-topic-generator-container").show();a("ideas");t=null;jQuery("#tb-topic-generator-video-topics-loading").show();jQuery("#tb-topic-generator-video-topics").hide();jQuery("#tb-topic-generator-update-container").hide();var e=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(e,"CRTBTopicGeneratorGetVideoTopics");if(TBExtension.GetType()!="firefox"){jQuery("#tbtopicgeneratorselectededitor").wysiwyg({controls:{subscript:{visible:false},superscript:{visible:false},undo:{visible:false},redo:{visible:false},insertHorizontalRule:{visible:false},createLink:{visible:false},unLink:{visible:false},insertImage:{visible:false},h1:{visible:false},h2:{visible:false},h3:{visible:false},html:{visible:false},removeFormat:{visible:false},insertTable:{visible:false},code:{visible:false}},iFrameClass:"tb-topic-generator-editor",css:"https://www.tubebuddy.com/assets/js/jquery-emoji-picker/tb.css"});jQuery("#tbtopicgeneratorselectededitor").wysiwyg("clear");jQuery(".wysiwyg").css("border","2px solid #ccc")}else{jQuery("#tbtopicgeneratorselectededitor").val("")}};var a=function(e){jQuery("#tb-topic-generator-update-container").hide();jQuery(".tb-topic-generator-tab-ideas").hide();switch(e){case"ideas":{jQuery(".tb-topic-generator-tab-ideas").show();break}case"update":{jQuery("#tb-topic-generator-update-container").show();break}}};var o=function(){var e=TBGlobal.host+"/ModuleManager/TopicGenerator/TopicGenerator?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/topicgenerator.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/topicgenerator.html"}TBExtension.Get(e,"CRTBLoadTopicGeneratorTemplate")};var d=function(e,i){jQuery(".tb-topic-generator-list-content").removeClass("tb-topic-generator-list-content-select");jQuery("#"+e).find(".tb-topic-generator-list-content").addClass("tb-topic-generator-list-content-select");jQuery(".tb-topic-generator-save").show();if(i){jQuery("#tb-topic-generator-video-topics-list").scrollTo("#"+e,500)}var s=TBUtilities.GetInArray(t,"Id",e);var n="";switch(s.SourceType){case 0:{var r=l("v",s.SourceUrl);var a=jQuery("#tb-topic-generator-source-type-relatedVideo").html();n=a.formatTemplate(s.SourceUrl,r);break}case 1:{var a=jQuery("#tb-topic-generator-source-type-comment").html();n=a.formatTemplate("https://youtube.com/watch?v="+s.AudienceSuggestedTopic.VideoId,s.AudienceSuggestedTopic.CommentorName,"https://www.youtube.com/channel/"+s.AudienceSuggestedTopic.CommentorChannelId);break}case 2:{var a=jQuery("#tb-topic-generator-source-type-googletrends").html();n=a.formatTemplate(s.SourceUrl,s.Title);break}case 3:{var a=jQuery("#tb-topic-generator-source-type-custom").html();n=a.formatTemplate("");break}}jQuery(".tb-topic-generator-selected-source-container").empty();jQuery(".tb-topic-generator-selected-source-container").append(DOMPurify.sanitize(n,DOMPurifyConfig));jQuery("#tb-topic-generator-title-update").val(s.Title);jQuery("#tb-topic-generator-isComplete-update").prop("checked",s.IsComplete);if(TBExtension.GetType()=="firefox"){jQuery("#tbtopicgeneratorselectededitor").val(s.Notes)}else{jQuery("#tbtopicgeneratorselectededitor").wysiwyg("setContent",s.Notes)}jQuery(".tb-topic-generator-list-remove").prop("data-id",s.Id)};var l=function(e,t){if(!t)t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),s=i.exec(t);if(!s)return null;if(!s[2])return"";return decodeURIComponent(s[2].replace(/\+/g," "))};var c=function(){if(jQuery("#tb-topic-generator-title-update").val().length==0){TBUtilities.Alert("Please enter a title for your video topic");return}var e=jQuery(".tb-topic-generator-list-content-select").closest("li").attr("id");var i=TBUtilities.GetInArray(t,"Id",e);i.Notes=TBExtension.GetType()=="firefox"?jQuery("#tbtopicgeneratorselectededitor").val():jQuery("#tbtopicgeneratorselectededitor").wysiwyg("getContent");i.Title=jQuery("#tb-topic-generator-title-update").val();i.IsComplete=jQuery("#tb-topic-generator-isComplete-update:checked").length>0;TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("videotopicplanner").name,Action:"Saved Topic Planner",Data:i});var s=TBGlobal.host+TBGlobal.apiUrls.topicsUpdateVideoTopic;TBExtension.Post(s,JSON.stringify(i),"CRTBTopicGeneratorNotesSaved",i.Id,{contentType:"application/json"})};var u=function(e){var t=e;t.IsComplete=!t.IsComplete;var i=TBGlobal.host+TBGlobal.apiUrls.topicsUpdateVideoTopic;TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("videotopicplanner").name,Action:"Marked Complete Topic Planner",Data:t});TBExtension.Post(i,JSON.stringify(t),"CRTBTopicGeneratorNotesSaved",t.Id,{contentType:"application/json"})};var p=function(e){var i=jQuery("#tb-topic-generator-video-topics-list-sortable li");var s=1;i.each(function(e,i){var n=jQuery(i);var r=TBUtilities.GetInArray(t,"Id",n.attr("id"));r.Priority=s;s++});var n=TBGlobal.host+TBGlobal.apiUrls.topicsUpdateVideoTopicsOrder;TBExtension.Post(n,JSON.stringify(t),null,null,{contentType:"application/json"})};var y=function(){jQuery(document).on("click","#tb-topic-generator-launch-keyword-explorer",function(e){jQuery("#tb-topic-generator-container").hide();var t=jQuery(this);TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("videotopicplanner").name,Action:"Keyword Explorer Opened"});TubeBuddyKeywordExplorer.Show(null,t,null)});jQuery(document).on("click",".tb-topic-generator-list-remove",function(e){var i;if(jQuery(this).hasClass("tb-topic-generator-list-item-action")){i=jQuery(this).attr("data-id")}else{i=jQuery(this).prop("data-id")}if(i){TBUtilities.Confirm("Are you sure you want to delete this topic?",function(){var e=TBUtilities.GetInArray(t,"Id",i);jQuery("#tb-topic-generator-video-topics-loading").show();jQuery("#tb-topic-generator-video-topics").hide();var s=TBGlobal.host+TBGlobal.apiUrls.topicsDeleteVideoTopic;TBExtension.Post(s,JSON.stringify(e),"CRTBVideoTopicDelete",null,{contentType:"application/json"})},function(){})}});jQuery(document).on("click",".tb-topic-generator-video-topics-list-filter",function(e){jQuery(".tb-topic-generator-video-topics-list-filter").removeClass("tb-topic-generator-list-filter--selected");jQuery(this).addClass("tb-topic-generator-list-filter--selected");n=jQuery(this).attr("data-filter-type");TBUtilities.Log("tb-topic-generator-video-topics-list-filter change");try{var t=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(t,"CRTBTopicGeneratorGetVideoTopics")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBVideoTopicDelete"})}});jQuery(document).on("click",".tb-topic-generator-list-item-toggle-complete",function(){var e=jQuery(this).closest(".tb-topic-generator-list-item").attr("id");var i=TBUtilities.GetInArray(t,"Id",e);u(i)});jQuery(document).on("click","#tb-topic-generator-cancel-update",function(){a("ideas")});jQuery(document).on("click","#tb-topic-generator-insert",function(){try{var e=jQuery("#tb-topic-generator-title-input").val();if(e.length==0){TBUtilities.Alert("Please enter a title for your video topic");return}var t=jQuery(this).attr("data-url");var i=jQuery(this).attr("data-type");if(!t){t=""}if(!i){i=3}var n=jQuery(this).attr("data-audience-id");var r=null;var a=null;if(typeof n!==typeof undefined&&n!==false){r=TBUtilities.GetInArray(s,"Id",n);a='"'+r.Comment+'"';b(r.CommentId,r.Id)}var o={Title:e,SourceUrl:t,SourceType:i,AudienceSuggestedTopic:r,Notes:a};var d=TBGlobal.host+TBGlobal.apiUrls.topicsAddVideoTopic;TBExtension.Post(d,JSON.stringify(o),"CRTBTopicGeneratorAddVideoTopic",null,{contentType:"application/json"});jQuery("#tb-topic-generator-insert").removeAttr("data-title");jQuery("#tb-topic-generator-insert").removeAttr("data-url");jQuery("#tb-topic-generator-insert").removeAttr("data-type");jQuery("#tb-topic-generator-insert").removeAttr("data-audience-id");TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_Use,"videotopicplanner")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] tb-topic-generator-add [click]"})}});jQuery(document).on("click","#tb-topic-generator-add-topic",function(e){try{var t=jQuery("#tb-topic-generator-title-update").val();var i=null;var s=3;if(t.length==0){TBUtilities.Alert("Please enter a title for your video topic");return}if(TBExtension.GetType()!="firefox"){i=jQuery("#tbtopicgeneratorselectededitor").wysiwyg("getContent")}else{i=jQuery("#tbtopicgeneratorselectededitor").val()}var n={Title:t,Notes:i,SourceType:s,SourceUrl:"",AudienceSuggestedTopic:null};var r=TBGlobal.host+TBGlobal.apiUrls.topicsAddVideoTopic;TBExtension.Post(r,JSON.stringify(n),"CRTBTopicGeneratorAddVideoTopic",null,{contentType:"application/json"});TBUtilities.AddAction(null,TBUtilities.ActionTypes.VideoTopicPlanner_Use,"videotopicplanner");TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("videotopicplanner").name,Action:"Created Topic Planner",Data:n})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] tb-topic-generator-add-topic [click]"})}});jQuery(document).on("click",".tb-topic-generator-save",function(e){c()});jQuery(document).on("click",".tb-topic-generator-list-edit",function(e){jQuery("#tb-topic-generator-add-topic").hide();jQuery("#tb-topic-planner-save-changes").show();jQuery("#tb-topic-planner-delete-button").show();try{var t=jQuery(this).closest(".tb-topic-generator-list-item").attr("id");d(t);a("update")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] tb-topic-generator-list-edit click"})}});jQuery(document).on("click",".tb-topic-generator-addVideoTopic",function(e){jQuery("#tb-topic-planner-save-changes").hide();jQuery("#tb-topic-planner-delete-button").hide();jQuery(".tb-topic-generator-selected-source-container").hide();jQuery("#tb-topic-generator-add-topic").show();jQuery("#tb-topic-generator-isComplete-update").prop("checked",false);if(TBGlobal.CanAccessLevel1Tools()==false&&t.length>=5){TBGlobal.ShowUpgradePage("have more than 5 topics","videotopicplanner");return}m();a("update")});jQuery(document).on("click",".tb-topic-generator-comments-remove",function(e){var t=jQuery(this).attr("data-commentid");TBUtilities.Confirm("Are you sure you want to remove this comment as a suggestion?",function(){b(t)},function(){})});jQuery(document).on("mouseover",".tb-topic-generator-list-item",function(e){var t=jQuery(".tb-topic-generator-sortable-chosen").length>0;if(!t)jQuery(this).addClass("tb-topic-generator-list-item--active")});jQuery(document).on("mouseout",".tb-topic-generator-list-item",function(e){jQuery(this).removeClass("tb-topic-generator-list-item--active")})};var b=function(e,t){var i={CommentId:e,Id:t};TBUtilities.Log(i);jQuery("#tb-topic-generator-comments-loading").show();jQuery("#tb-topic-generator-comments-list").empty();var s=TBGlobal.host+TBGlobal.apiUrls.topicsToggleCommentAudienceSuggestedTopic;TBExtension.Post(s,JSON.stringify(i),"CRTBGetAudienceSuggestedDelete",null,{contentType:"application/json"})};var m=function(){jQuery("#tb-topic-generator-title-update").val("");if(TBExtension.GetType()!="firefox"){jQuery("#tbtopicgeneratorselectededitor").wysiwyg("setContent","")}else{jQuery("#tbtopicgeneratorselectededitor").val("")}};var h=function(){jQuery(document.body).on("CRTBLoadTopicGeneratorTemplate",function(e,t){TBUtilities.Log("CRTBLoadTopicGeneratorTemplate");try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);r()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBLoadTopicGeneratorTemplate"})}});jQuery(document.body).on("CRTBVideoTopicDelete",function(e,t){TBUtilities.Log("CRTBVideoTopicDelete");TBUtilities.Log(t);try{a("ideas");var i=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(i,"CRTBTopicGeneratorGetVideoTopics")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBVideoTopicDelete"})}});jQuery(document.body).on("CRTBGetAudienceSuggestedDelete",function(e,t){TBUtilities.Log("CRTBGetAudienceSuggestedDelete");TBUtilities.Log(t);try{if(t.success){var i=TBGlobal.host+TBGlobal.apiUrls.topicsGetAudienceSuggestedTopics;TBExtension.Get(i,"CRTBGetAudienceSuggestedTopics")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBGetTopRelatedVideos"})}});jQuery(document.body).on("CRTBGetAudienceSuggestedTopics",function(e,t){TBUtilities.Log("CRTBGetAudienceSuggestedTopics");TBUtilities.Log(t);try{if(t.success){jQuery("#tb-topic-generator-comments-list").empty();jQuery("#tb-topic-generator-comments-list-empty").hide();s=jQuery.parseJSON(t.response);if(s.length>0){var n="";for(i=0;i<s.length;i++){var r=jQuery("#tb-topic-generator-comments-template").html();rowTemplate=r.formatTemplate(s[i].Comment,s[i].CommentorChannelId,s[i].VideoId,s[i].CommentorPhoto,s[i].CommentId,s[i].Id);n+=rowTemplate}}else{jQuery("#tb-topic-generator-comments-list-empty").show()}jQuery("#tb-topic-generator-comments-loading").hide();jQuery("#tb-topic-generator-comments-list").append(n)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBGetTopRelatedVideos"})}});jQuery(document.body).on("CRTBGetTopRelatedVideos",function(e,t){TBUtilities.Log("CRTBGetTopRelatedVideos");TBUtilities.Log(t);try{jQuery("#tb-topic-generator-related-loading").hide();if(t.success){var s=jQuery.parseJSON(t.response);if(s.length>0){var n="";for(i=0;i<s.length;i++){var r=jQuery("#tb-topic-generator-related-template").html();rowTemplate=r.formatTemplate(s[i].snippet.title,s[i].url,s[i].snippet.thumbnails.thumbnailMedium,TBUtilities.FormatNumberAbbreviated(s[i].statistics.ViewCount),s[i].snippet.description);n+=rowTemplate}jQuery("#tb-topic-generator-related-list").append(n)}else{jQuery("#tb-topic-generator-related-list-empty").show()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBGetTopRelatedVideos"})}});jQuery(document.body).on("CRTBTopicGeneratorAddVideoTopic",function(e,t){TBUtilities.Log("CRTBTopicGeneratorAddVideoTopic");TBUtilities.Log(t);try{if(t.success){var i=jQuery.parseJSON(t.response);var s=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(s,"CRTBTopicGeneratorGetVideoTopics",i)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBLoadTopicGeneratorTemplate"})}});jQuery(document.body).on("CRTBTopicGeneratorGetVideoTopics",function(e,s){TBUtilities.Log("CRTBTopicGeneratorGetVideoTopics");try{if(s.success){jQuery("#tb-topic-generator-video-topics-list-sortable").empty();jQuery("#tb-topic-generator-video-topics-loading").hide();jQuery("#tb-topic-generator-video-topics").show();t=jQuery.parseJSON(s.response);if(t.length==0){a("ideas");jQuery("#tb-topic-generator-video-topics-list").hide();jQuery("#tb-topic-generator-video-topics-empty").show()}else{var r=jQuery.grep(t,function(e,t){return e.IsComplete}).length;var o=t.length-r;var l=n;jQuery("#tb-topic-generator-video-topics-list-filter-"+l).addClass("tb-topic-generator-list-filter--selected");jQuery("#tb-topic-generator-video-topics-list-sortable").empty();var c="";for(i=0;i<t.length;i++){var u="display: none;";var y=t[i].IsComplete?"Mark Incomplete":"Mark Complete";var b=t[i].IsComplete?"check_box":"check_box_outline_blank";var m=t[i].Title.replace(/<[^>]*>?/gm,"");var h=t[i].Notes.replace(/<[^>]*>?/gm,"");if(l==0||l==1&&!t[i].IsComplete||l==2&&t[i].IsComplete){u=""}var v=jQuery("#tb-topic-generator-topic-template").html();rowTemplate=v.formatTemplate(t[i].Id,m,u,h,t[i].IsComplete,y,b);c+=rowTemplate}jQuery("#tb-topic-generator-video-topics-list-sortable").append(c);var f=document.getElementById("tb-topic-generator-video-topics-list-sortable");var g=Sortable.create(f,{handle:".tb-topic-generator-list-handle",chosenClass:"tb-topic-generator-sortable-chosen",onSort:p,animation:150,filter:".tb-topic-generator-list-edit"});jQuery("#tb-topic-generator-video-topics-empty").hide();jQuery("#tb-topic-generator-video-topics-list").show();if(s.data){a("ideas");d(s.data,true)}else{var T=jQuery(".tb-topic-generator-list-item:visible:first");if(T&&T.length>0){var j=T.attr("id");d(j,true)}else{d(t[0].Id,true)}}}}else{jQuery("#tb-topic-generator-video-topics-empty").show();jQuery("#tb-topic-generator-video-topics-list").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBTopicGeneratorHotTrend"})}});jQuery(document.body).on("CRTBTopicGeneratorNotesSaved",function(e,t){TBUtilities.Log("CRTBTopicGeneratorNotesSaved");TBUtilities.Log(t);try{if(t.success){jQuery("#tb-topic-generator-saved-icon").fadeIn().delay(2e3).fadeOut();var i=TBGlobal.host+TBGlobal.apiUrls.topicsGetVideoTopics;TBExtension.Get(i,"CRTBTopicGeneratorGetVideoTopics",t.data)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTopicGenerator] CRTBTopicGeneratorNotesSaved"})}})};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!e){h();y();o();e=true}else{r()}}}}}();$.fn.filterNode=function(e){return this.find("*").filter(function(){return this.nodeName===e})};jQuery.fn.scrollTo=function(e,t){$(this).animate({scrollTop:$(this).scrollTop()-$(this).offset().top+$(e).offset().top},t==undefined?1e3:t);return this};var TubeBuddyEndScreens=function(){var e=false;var t={method:3,specificVideoIds:[],specificVideos:[],validPlaylistIds:[],playlistId:"",search:"",selectedVideo:{},elements:[],selectedElements:[],videos:[],destinationVideos:[],currentVideo:null,isStopped:false,elementIdsToDelete:[],isDeleteOnly:false,totalDestinationVideos:0,videosWithDeletedEndscreens:[],hasFinished:false,errorCount:0,successCount:0,channelVideoCount:0,fromBulkSelectMenu:false,imageConversions:[],sourceVideoEndscreenData:null};var i={deleteAll:false,deleteUrl:"",deleteText:"",deleteWebsite:false,deleteFundraising:false,deleteMerchandice:false,deleteVideOrPlaylist:false,deleteChannel:false,includePartialMatches:false,includePartialTextMatches:false};var s=function(){var e=chrome.extension.getURL("modules/endscreens.html");TBExtension.Get(e,function(e,i,s){try{if(e){s=TBUtilities.FixLocalHtml(DOMPurify.sanitize(s,DOMPurifyConfig));jQuery("body").append(s);if(t.isDeleteOnly===true){k()}else{w()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndscreensStudio] loadHtml"})}})};var n=function(){try{jQuery("#tb-endscreens-back-bulk").hide();jQuery("#tb-endscreens-fetching").show();if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-back-bulk").show()}jQuery(".tb-endscreens-destination-row").removeClass("tb-endscreens-destination-row--selected");jQuery("#tb-endscreens-error-copy-container").hide();jQuery("#tb-endscreens-error-copy").prop("data-clipboard-text","");var e=new ClipboardJS("#tb-endscreens-error-copy");jQuery("#tb-endscreens-selected-count").text("0");jQuery("#tb-endscreens-total-count").text("0");jQuery("#tb-endscreens-destination-selected-count").text("0");jQuery("#tb-endscreens-destination-total-count").text("0");jQuery("#tb-endscreens-header-image").attr("src",t.selectedVideo.thumbnail);jQuery("#tb-endscreens-featured-thumbnail").attr("src",t.selectedVideo.thumbnail);jQuery("#tb-endscreens-method").hide();jQuery(".tb-endscreens-filter").val("all");jQuery("#tb-endscreens-completed-list2-count").text("0");jQuery("#tb-endscreens-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-endscreens-onlyLoadFirstPage").prop("checked",false);if(t.isDeleteOnly){jQuery("#tb-endscreens-thumbnail").hide();jQuery("#tb-endscreens-title").hide();jQuery("#tb-endscreens-help-link").attr("href",TBGlobal.host+"/tools?tool=bulkdeleteendscreen");jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 1");jQuery(".tb-module-embed-video").hide();jQuery("#tb-endscreens-stop").text("Stop Deleting")}else{jQuery("#tb-endscreens-thumbnail").attr("src",t.selectedVideo.thumbnail);jQuery("#tb-endscreens-title").text(t.selectedVideo.title);jQuery("#tb-endscreens-title").attr("href","https://www.youtube.com/watch?v="+t.selectedVideo.id);jQuery("#tb-endscreens-thumbnail").show();jQuery("#tb-endscreens-title").show();jQuery(".tb-module-embed-video").show();jQuery("#tb-endscreens-help-link").attr("href",TBGlobal.host+"/tools?tool=bulkcopyendscreen");if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 1")}jQuery("#tb-endscreens-stop").text("Stop Copying")}jQuery("#tb-endscreens-status").hide();jQuery("#tb-endscreens-confirm").hide();jQuery("#tb-endscreens-bulk-description-updates-container").hide();jQuery("#tb-endscreens-featured-content-container").hide();jQuery("#tb-endscreens-kickoff").hide();jQuery("#tb-endscreens-summary-container").hide();jQuery("#tb-endscreens-featured-video-status-complete").hide();jQuery("#tb-endscreens-featured-video-status-processing").hide();jQuery("#tb-endscreens-bulk-descriptions-status-complete").hide();jQuery("#tb-endscreens-bulk-descriptions-status-processing").hide();jQuery("#tb-endscreens-success").hide();jQuery("#tb-endscreens-back").hide();jQuery("#tb-endscreens-container").fadeIn();jQuery("#tb-endscreens-methods-container").fadeIn();jQuery("#tb-endscreens-none").hide();jQuery("#tb-endscreens-has").hide();jQuery("#tb-endscreens-stop").hide();jQuery("#tb-endscreens-done-close").hide();jQuery("#tb-endscreens-destination").hide();jQuery("#tb-endscreens-source").show();jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").text("");jQuery("#tb-endscreens-method-full").prop("checked","checked");var i=jQuery("#tb-endscreens-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(e){t.playlistId=e}}).data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();jQuery("#tb-endscreens-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-endscreens-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");i.disable();if(!t.isDeleteOnly){jQuery("#tb-cs-step-2-title").text("Which videos do you want to copy the selected End Screen Element(s) to?");jQuery("#tb-endscreens-what-videos2").text("Which videos do you want to copy the selected End Screen Element(s) to?");jQuery("#tb-endscreens-additional-options-containers").show();jQuery("#tb-endscreens-delete-existing").prop("checked",false);jQuery("#tb-endscreens-skip-existing").prop("checked",false);jQuery("#tb-endscreens-header-image").hide();jQuery("#tb-endscreens-confirm-statement").show();jQuery("#tb-endscreens-confirm-text").text("copying");jQuery("#tb-endscreens-kickoff").text("Start Copying!");jQuery("#tb-endscreens-delete-existing-warning").text("WARNING: You have chosen to automatically delete all existing End Screen Elements from the destination videos before copying new Elements to them.");jQuery("#tb-endscreens-delete-options").hide();jQuery("#tb-endscreens-source").show()}else{jQuery("#tb-endscreens-step-2-title").text("Which videos do you want to Delete End Screen Element(s) from?");jQuery("#tb-endscreens-what-videos2").text("Which videos do you want to Delete End Screen Element(s) from?");jQuery("#tb-endscreens-additional-options-containers").hide();jQuery("#tb-endscreens-delete-existing").prop("checked",true);jQuery("#tb-endscreens-skip-existing").prop("checked",false);jQuery("#tb-endscreens-header-image").hide();jQuery("#tb-endscreens-confirm-statement").hide();jQuery("#tb-endscreens-confirm-text").text("delete");jQuery("#tb-endscreens-kickoff").text("Start Deleting!");jQuery("#tb-endscreens-continue").show();jQuery("#tb-endscreens-delete-options").show();jQuery("#tb-endscreens-source").hide()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] prepareDialog"})}};var r=function(){try{if(!t.isDeleteOnly){TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Loading Video Details");TubeBuddyYouTubeActions.GetVideoEnscreenData(t.selectedVideo.id).then(function(e){TBUtilities.Log(e);TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - GetVideoDetailStudio");t.totalVideoMiliseconds=e.videoDurationMs;t.sourceVideoEndscreenData=e;a(e.endscreen)}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [loadData]"});TBUtilities.Alert("There was an error retrieving endscreens. Please try again.")})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [loadData]"})}};var a=function(e){try{TBUtilities.Log(e);if(e===null||e!==null&&e.elements&&e.elements.length===0){t.elements=[];jQuery("#tb-endscreens-none").show();jQuery("#tb-endscreens-continue").hide();jQuery("#tb-endscreens-done-close").show()}else{t.elements=e.elements;jQuery("#tb-endscreens-has").show();jQuery("#tb-endscreens-continue").show();jQuery("#tb-endscreens-done-close").hide()}jQuery("#tb-endscreens-list").empty();TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - End Screen list Returned");TBGlobal.AddUserDebugInfo(JSON.stringify(e));var i=t.elements.length;jQuery("#tb-endscreens-total-count").text(t.elements.length);for(var s=0;s<i;s++){var n=t.elements[s];var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(e.startMs+n.offsetMs),":"," ");switch(n.type){case"CHANNEL":{var a="";if(n.channelEndscreenElement.isSubscribe){let e=jQuery("#tb-endscreens-elementType-subscribe-template").html();a=e.formatTemplate(n.id,r)}else{let e=jQuery("#tb-endscreens-elementType-channel-template").html();a=e.formatTemplate(n.id,"https://www.youtube.com/channel/"+n.channelEndscreenElement.channelId,n.channelEndscreenElement.metadata,r)}jQuery("#tb-endscreens-list").append(a);break}case"WEBSITE":{let e=jQuery("#tb-endscreens-elementType-website-template").html();let t=e.formatTemplate(n.id,n.websiteEndscreenElement.title,n.websiteEndscreenElement.cta,r,n.websiteEndscreenElement.targetUrl);jQuery("#tb-endscreens-list").append(t);break}case"VIDEO":{switch(n.videoEndscreenElement.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{let e=jQuery("#tb-endscreens-elementType-recent_upload-template").html();let t=e.formatTemplate(n.id,r);jQuery("#tb-endscreens-list").append(t);break}case"VIDEO_TYPE_FIXED":{let e=jQuery("#tb-endscreens-elementType-fixed-template").html();let t=e.formatTemplate(n.id,"https://www.youtube.com/watch?v="+n.videoEndscreenElement.encryptedVideoId,r);jQuery("#tb-endscreens-list").append(t);break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{let e=jQuery("#tb-endscreens-elementType-best_for_viewer-template").html();let t=e.formatTemplate(n.id,r);jQuery("#tb-endscreens-list").append(t);break}}break}case"PLAYLIST":{let e=jQuery("#tb-endscreens-elementType-playlist-template").html();let t=e.formatTemplate(n.id,"https://www.youtube.com/playlist?list="+n.playlistEndscreenElement.playlistId,r);jQuery("#tb-endscreens-list").append(t);break}case"MERCH":{let e=jQuery("#tb-endscreens-elementType-merch-template").html();let t=e.formatTemplate(n.id,r);jQuery("#tb-endscreens-list").append(t);break}}}var o=jQuery("#tb-endscreens-select-all-elements");o.click();jQuery("#tb-endscreens-fetching").hide()}catch(t){TBUtilities.LogError("There was an error retrieving the end screen...");t.resultData=e;TBUtilities.LogError({Exception:t,Location:"[TubeBuddyEndScreens] CRTBLoadCardsForVideo"})}};var o=function(e,t){TBUtilities.Log("copyFromTemplateToElement before");TBUtilities.Log(e);switch(e.type){case"CHANNEL":{if(e.channelEndscreenElement.isSubscribe){}else{var i=jQuery(t).find(".tb-endscreens-elementType-channel-channelurl").val();var s=TBUtilities.ParseChannelIdFromUrl(i);e.channelEndscreenElement.channelId=s;e.channelEndscreenElement.metadata=jQuery(t).find(".tb-endscreens-elementType-channel-custom-message").val()}break}case"WEBSITE":{e.websiteEndscreenElement.title=jQuery(t).find(".tb-endscreens-elementType-website-title").val();e.websiteEndscreenElement.targetUrl=jQuery(t).find(".tb-endscreens-elementType-website-url").val();break}case"VIDEO":{switch(e.videoEndscreenElement.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{break}case"VIDEO_TYPE_FIXED":{var n=jQuery(t).find(".tb-endscreens-elementType-fixed-url").val();var r=TBUtilities.ParseVideoIdFromUrl(n);if(r){e.videoEndscreenElement.encryptedVideoId=r}break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{break}}break}case"PLAYLIST":{var a=jQuery(t).find(".tb-endscreens-elementType-playlist-url").val();var o=TBUtilities.ParsePlaylistIdFromUrl(a);if(o!=null){e.targetUrl=a;e.playlistEndscreenElement.playlistId=o}break}}TBUtilities.Log("copyFromTemplateToElement after");TBUtilities.Log(e)};var d=function(e,i){var s=TBUtilities.GetInArray(t.elements,"id",e);t.selectedElements.push(s);jQuery(i).find(".tb-card-item-inner").addClass("tb-card-item-inner-selected");jQuery("#tb-endscreens-selected-count").text(t.selectedElements.length);jQuery("#tb-endscreens-copy-count").text(t.selectedElements.length);c()};var l=function(e,i){TBUtilities.RemoveFromArray(t.selectedElements,"id",e);jQuery(i).find(".tb-card-item-inner").removeClass("tb-card-item-inner-selected");c()};var c=function(){jQuery("#tb-endscreens-selected-count").text(t.selectedElements.length);jQuery("#tb-endscreens-copy-count").text(t.selectedElements.length);if(t.selectedElements.length==1)jQuery("#tb-endscreens-copy-count-s").hide();else jQuery("#tb-endscreens-copy-count-s").show()};var u=function(e){if(e.totalCount-e.loaded>50){jQuery("#tb-endscreens-loading-count").attr("data-auto-count",e.loaded);var t=e.totalCount;if(jQuery("#tb-endscreens-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-endscreens-onlyLoadFirstPage-number").val())}jQuery("#tb-endscreens-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery("#tb-endscreens-loading-count"))}else{jQuery("#tb-endscreens-rendering").show();jQuery("#tb-endscreens-loading-count-container").hide()}};var p=function(e){try{if(e==null){if(t.method==0)TBUtilities.Alert("No valid Video IDs found");else if(t.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(t.method==2)TBUtilities.Alert("No videos matching your search");else if(t.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-endscreens-back").trigger("click");return}else if(e.length==0){if(t.method==0)TBUtilities.Alert("No valid Video IDs found");else if(t.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(t.method==2)TBUtilities.Alert("No videos matching your search");else if(t.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery("#tb-endscreens-back").trigger("click");return}t.videos=[];e=e.filter((e,t,i)=>i.findIndex(t=>t.id===e.id)===t);jQuery("#tb-endscreens-destination-list").empty();var i=jQuery(".tb-endscreens-destination-row:last")[0].outerHTML;jQuery.each(e,function(e,s){var n=false;if(s.id==t.selectedVideo.id)n=true;if(s.snippet.resourceId!=null)if(s.snippet.resourceId.videoId==t.selectedVideo.id)n=true;if(s.id.videoId!=null){s.id=s.id.videoId}if(!n){if(s.snippet.resourceId!=null)s.id=s.snippet.resourceId.videoId;if(s.snippet!=null&&s.snippet.title=="Deleted video"&&s.snippet.thumbnails==null)return;t.videos.push(s);var r=i;var a=s.snippet.thumbnails.thumbnailMedium?s.snippet.thumbnails.thumbnailMedium:s.snippet.thumbnails.thumbnailDefault;r=r.replace("#VIDEOTITLE#",s.snippet.title);r=TBUtilities.ReplaceAll(r,"#VIDEOID#",s.id);r=r.replace("#VIDEOTHUMBNAIL#",a);if(s.status){r=r.replace("#PRIVACY#",s.status.privacy)}if(t.isDeleteOnly){r=TBUtilities.ReplaceAll(r,"#CUSTOMDISPLAY#","display:none;");jQuery(".tb-bulk-expand").hide()}else{r=TBUtilities.ReplaceAll(r,"#CUSTOMDISPLAY#","");jQuery(".tb-bulk-expand").show()}var o="";jQuery.each(t.selectedElements,function(e,t){var i=null;switch(t.type){case"CHANNEL":{if(t.isSubscribe){var n=jQuery(".tb-endscreens-destination-option-subscribe-row:last")[0].outerHTML;i=i.replace("#data-element-default-id#",t.id)}else{var n=jQuery(".tb-endscreens-destination-option-channel-row:last")[0].outerHTML;i=n.replace("#CHANNELURL#","https://www.youtube.com/channel/"+t.channelEndscreenElement.channelId);i=i.replace("#METADATA#",t.channelEndscreenElement.metadata);i=i.replace("#data-element-default-id#",t.id)}break}case"WEBSITE":{var n=jQuery(".tb-endscreens-destination-option-website-row:last")[0].outerHTML;i=n.replace("#TITLE#",t.websiteEndscreenElement.title);i=i.replace("#URL#",t.websiteEndscreenElement.targetUrl);i=i.replace("#data-element-default-id#",t.id);break}case"VIDEO":{switch(t.videoEndscreenElement.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{var n=jQuery(".tb-endscreens-destination-option-video-mostrecent-row:last")[0].outerHTML;i=n;i=i.replace("#data-element-default-id#",t.id);break}case"VIDEO_TYPE_FIXED":{var n=jQuery(".tb-endscreens-destination-option-video-fixed-row:last")[0].outerHTML;i=n.replace("#VIDEOURL#","https://www.youtube.com/watch?v="+t.videoEndscreenElement.encryptedVideoId);i=i.replace("#data-element-default-id#",t.id);break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{var n=jQuery(".tb-endscreens-destination-option-video-bestforviewer-row")[0].outerHTML;i=n;i=i.replace("#data-element-default-id#",t.id);break}}break}case"PLAYLIST":{var n=jQuery(".tb-endscreens-destination-option-playlist-row:last")[0].outerHTML;i=n.replace("#PLAYLISTURL#","https://www.youtube.com/playlist?list="+t.playlistEndscreenElement.playlistId);i=i.replace("#data-element-default-id#",t.id);break}case"MERCH":{var n=jQuery(".tb-endscreens-destination-option-merchandise-row:last")[0].outerHTML;i=n.replace("#data-element-default-id#",t.id);break}}i=i.replace("#VIDEOID#",s.id);o+=i});o=o.replace("#VIDEOID#",s.id);r=r.replace("#OPTIONS#",o);jQuery("#tb-endscreens-destination-list").append(r)}});jQuery("#tb-endscreens-destination").show();jQuery("#tb-endscreens-method").hide();jQuery("#tb-endscreens-destination-list").show();jQuery("#tb-endscreens-destination-total-count").text(t.videos.length);jQuery("#tb-endscreens-loading-videos").hide();if(t.method==0||t.method==1){jQuery("#tb-endscreens-select-all-checkboxes").trigger("click")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [gotVideoList]"})}};var y=function(){var e=t.specificVideoIds[0];t.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(e,"contentDetails,snippet,id",b)};var b=function(e){if(e!=null)t.specificVideos.push(e);if(t.specificVideoIds.length>0){y()}else{p(t.specificVideos)}};var m=function(){try{t.totalDestinationVideos=t.destinationVideos.length;t.hasFinished=false;t.errorCount=0;t.successCount=0;jQuery("#tb-endscreens-queue-list").empty();jQuery("#tb-endscreens-completed-list").empty();jQuery("#tb-endscreens-queue-list2").empty();jQuery("#tb-endscreens-completed-list2").empty();jQuery("#tb-endscreens-error-list2").empty();jQuery("#tb-endscreens-error-list2").hide();jQuery("#tb-endscreens-error-none-list2").show();jQuery("#tb-endscreens-working").show();jQuery("#tb-endscreens-done").hide();jQuery("#tb-endscreens-stopped").hide();jQuery("#tb-endscreens-error-list2-count").text("");g();h()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [startProcessing]"})}};var h=function(){jQuery("#tb-endscreens-queue-list2").empty();jQuery("#tb-endscreens-queue-complete-list2").hide();var e=0;jQuery.each(t.destinationVideos,function(t,i){var s=jQuery(".tb-endscreens-processing-template2:last")[0].outerHTML;s=s.replace("#THUMBNAILURL#",i.snippet.thumbnails.default.url);s=TBUtilities.ReplaceAll(s,"#VIDEOID#",i.id);s=s.replace("#VIDEOTITLE#",i.snippet.title);s=s.replace("#HREF#","https://studio.youtube.com/video/"+i.id+"/edit");s=s.replace("display: none","display:flex");jQuery("#tb-endscreens-queue-list2").prepend(s);e++;if(e==3)return false});if(e==0){jQuery("#tb-endscreens-queue-complete-list2").show();jQuery("#tb-endscreens-queue-list2").hide()}else{jQuery("#tb-endscreens-queue-list2").show()}};var v=function(e){var i=jQuery(".tb-endscreens-processed-success:last")[0].outerHTML;if(jQuery("#tb-endscreens-skip-existing").is(":checked")&&e.skipped&&e.skipped===true){i=jQuery(".tb-endscreens-skipped-success:last")[0].outerHTML}i=i.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);i=TBUtilities.ReplaceAll(i,"#VIDEOID#",e.id);i=i.replace("#VIDEOTITLE#",e.snippet.title);i=i.replace("#HREF#","https://studio.youtube.com/video/"+e.id+"/edit");i=i.replace("display:none","display:flex");jQuery("#tb-endscreens-completed-list2").prepend(i);jQuery("#tb-endscreens-completed-none-list2").hide();jQuery("#tb-endscreens-completed-list2").show();t.successCount++;jQuery("#tb-endscreens-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(t.successCount))};var f=function(e){try{jQuery("#tb-endscreens-error-copy-container").show();var i=jQuery("#tb-endscreens-error-copy").attr("data-clipboard-text");var s=[];if(i!=""){s=i.split(",");if(s.indexOf(e.id)==-1){s.push(e.id)}}else{s.push(e.id)}jQuery("#tb-endscreens-error-copy").attr("data-clipboard-text",s.join(","))}catch(e){}var n=jQuery(".tb-endscreens-processed-error:last")[0].outerHTML;n=n.replace("#THUMBNAILURL#",e.snippet.thumbnails.default.url);n=TBUtilities.ReplaceAll(n,"#VIDEOID#",e.id);n=n.replace("#VIDEOTITLE#",e.snippet.title);n=n.replace("#ERROR#",e.error);n=n.replace("#HREF#","https://studio.youtube.com/video/"+e.id+"/edit");n=n.replace("display:none","display:block");jQuery("#tb-endscreens-error-list2").prepend(n);jQuery("#tb-endscreens-error-list2").show();jQuery("#tb-endscreens-error-none-list2").hide();t.errorCount++;jQuery("#tb-endscreens-error-list2-count").text(TBUtilities.FormatNumberWithCommas(t.errorCount))};var g=function(){try{TBUtilities.Log("TubeBuddyEndScreens - next video");jQuery("#tb-endscreens-progress-container").html("Start &#707;");if(t.isStopped)return;if(t.destinationVideos.length==0&&!t.hasFinished){t.hasFinished=true;jQuery("#tb-endscreens-status-count").html("<b>"+t.totalDestinationVideos+"</b> of <b>"+t.totalDestinationVideos+"</b> videos complete");jQuery("#tb-endscreens-progress-container").hide();if(t.currentVideo){if(!t.currentVideo.error){v(t.currentVideo)}else{f(t.currentVideo)}}h();jQuery("#tb-endscreens-working").hide();jQuery("#tb-endscreens-done").show();jQuery("#tb-endscreens-stop").hide();jQuery("#tb-endscreens-done-close").show();return}var e=t.destinationVideos[0].id;if(t.currentVideo){if(!t.currentVideo.error)v(t.currentVideo);else f(t.currentVideo)}var s=TBUtilities.RemoveFromArray(t.destinationVideos,"id",e)[0];t.currentVideo=s;jQuery("#tb-endscreens-status-count").html("<b>"+parseInt(t.totalDestinationVideos-t.destinationVideos.length)+"</b> of <b>"+t.totalDestinationVideos+"</b> videos complete");jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+e+'">'+e+"</a> &#707;");h();TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Getting Video Details for: "+s.id);TubeBuddyYouTubeActions.GetVideoEnscreenData(s.id).then(function(e){if(!e){T(e.videoId,"VideoId: "+e.videoId+" - Failed to get video details!");return}try{jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Got Details &#707;");if(e.videoDurationMs<25e3){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Copy Fail &#707;");T(e.videoId,"VideoId: "+e.videoId+" - Video length is less than 25 seconds");return}if(!t.isDeleteOnly){if(jQuery("#tb-endscreens-skip-existing").is(":checked")){if(e.endscreen&&e.endscreen.elements.length>0){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Skipped");t.currentVideo.skipped=true;g();return}}if(jQuery("#tb-endscreens-delete-existing").is(":checked")){if(t.videosWithDeletedEndscreens.indexOf(e.videoId)===-1){jQuery("#tb-endscreens-progress-container").show();jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete  &#707;");t.videosWithDeletedEndscreens.push(e.videoId);e.endscreenStartMs=TBUtilities.AdjustEndScreenTiming(t.sourceVideoEndscreenData,e);TubeBuddyYouTubeActions.DeleteAllEndScreenElementsStudio(e.videoId,e.endscreenStartMs).then(function(){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Success &#707;");if(e.endscreen){e.endscreen.elements=[]}e.endscreenStartMs=null;e.endscreenStartMs=TBUtilities.AdjustEndScreenTiming(t.sourceVideoEndscreenData,e);if(t.isDeleteOnly==false){j(e)}else{g()}}).catch(function(t){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Fail &#707;");T(e.videoId,"VideoId: "+e.videoId+" - Error deleting elements ("+t+")")})}}else{e.endscreenStartMs=TBUtilities.AdjustEndScreenTiming(t.sourceVideoEndscreenData,e);j(e)}}else{jQuery("#tb-endscreens-progress-container").show();jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete  &#707;");t.videosWithDeletedEndscreens.push(e.videoId);if(i.deleteAll==true){TubeBuddyYouTubeActions.DeleteAllEndScreenElementsStudio(e.videoId,e.endscreenStartMs).then(function(){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Success &#707;");g()}).catch(function(t){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Fail &#707;");T(e.videoId,"VideoId: "+e.videoId+" - Error deleting elements ("+t+")")})}else if(i.deleteUrl){TubeBuddyYouTubeActions.DeleteAllEndCardElementsWithUrlStudio(e.videoId,e.endscreenStartMs,i.deleteUrl,i.includePartialMatches).then(function(){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Success &#707;");g()}).catch(function(t){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Delete Fail &#707;");T(e.videoId,"VideoId: "+e.videoId+" - Error deleting elements ("+t+")")})}}}catch(e){var s="";s+=" [Error: "+e.message+"]";jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Failed Details &#707;");T(t.currentVideo.id,s)}}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [processNextVideo]"});jQuery("#tb-endscreens-progress-container").html(DOMPurify.sanitize(jQuery("#tb-endscreens-progress-container").html()+"Error: "+e,DOMPurifyConfig));T(s.id,e)})}catch(e){TBUtilities.LogError({Exception:error,Location:"[TubeBuddyEndScreens] [processNextVideo]"});jQuery("#tb-endscreens-progress-container").html(DOMPurify.sanitize(jQuery("#tb-endscreens-progress-container").html()+"Error: "+error,DOMPurifyConfig));T(s.id,error)}};var T=function(e,i){t.currentVideo.error=i;g()};var j=function(e){try{var i=[];jQuery.each(t.selectedElements,function(s,n){var r=jQuery("div[data-video-id='"+e.videoId+"'][data-element-default-id='"+n.id+"']");var a=jQuery.extend({},n);o(a,r);TBUtilities.AdjustEndScreenElementTiming(a,t.sourceVideoEndscreenData,e);i.push(a)});var s=false;if(e.endscreen&&e.endscreen.elements.length>0){s=true;jQuery.each(e.endscreen.elements,function(e,t){t.existing=true;i.push(t)})}var n=TBUtilities.ValidateEndscreenElements(i);if(n!==""){jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Failed Copy &#707;");T(t.currentVideo.id,n)}else{jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Copy ("+t.selectedElements.length+") &#707;");TubeBuddyYouTubeActions.CopyEndScreenElementsStudio(e.videoId,e.endscreenStartMs,i,s).then(function(){TubeBuddyEndScreens.ProcessNextVideo(true,e)}).catch(function(t){TubeBuddyEndScreens.ProcessNextVideo(false,e,null,t)})}}catch(e){var r="";r+=" [Error: "+e.message+"]";jQuery("#tb-endscreens-progress-container").html(jQuery("#tb-endscreens-progress-container").html()+" Failed Copy &#707;");T(t.currentVideo.id,r)}};var Q=function(e,t,i,s,n){TBUtilities.Log("TubeBuddyEndScreens - start ms ="+e.startMs);TBUtilities.Log("TubeBuddyEndScreens - sourceVideoMiliseconds ="+t);TBUtilities.Log("TubeBuddyEndScreens - destinationVideoMiliseconds ="+i);try{var r=e.endMs-e.startMs;TBUtilities.Log("TubeBuddyEndScreens - duration ="+r);var a=t-e.startMs;if(a>2e4){a=19999}var o=i-a;var d=o+r;if(o<=2e4){o=2e4;d=o+r}TBUtilities.Log("TubeBuddyEndScreens - calculated start time ="+o);if(o<=i){e.startMs=o;e.endMs=d}else{e.startMs=i}if(r<=5e3){e.startMs=o-100}if(e.startMs<s){e.startMs=s}if(e.startMs<n){e.startMs=n}if(e.endMs>=i-50){e.endMs=i-50}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] checkElementStartMs"})}};var B=function(){jQuery(document).on("click change","#tb-endscreens-delete-link-option, #tb-endscreens-delete-all-option",function(){if(jQuery("#tb-endscreens-delete-link-option").is(":checked"))jQuery("#tb-endscreens-delete-partial-matches-container").fadeIn();else jQuery("#tb-endscreens-delete-partial-matches-container").fadeOut();if(jQuery("#tb-endscreens-delete-text-option").is(":checked"))jQuery("#tb-endscreens-delete-partial-matches-container-text").fadeIn();else jQuery("#tb-endscreens-delete-partial-matches-container-text").fadeOut()});jQuery(document).on("click","#tb-endscreens-back-bulk",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-endscreens-container").hide();t.step=1;TubeBuddyMenu.ShowBackgroundSticky();TubeBuddyBulkCopySelect.Show("TubeBuddyEndScreens")});jQuery(document).on("click","#tb-endscreens-error-copy",function(){jQuery(this).find("span").text("Copied");window.setTimeout(function(){jQuery("#tb-endscreens-error-copy-container").find("span").text("Copy video ids")},1500)});jQuery(document).on("click",".tb-cards-default-setting",function(e){e.stopPropagation()});jQuery(document).on("click","#tb-endscreens-stop",function(e){t.isStopped=true;jQuery("#tb-endscreens-stop").hide();jQuery("#tb-endscreens-done-close").show();jQuery("#tb-endscreens-working").hide();jQuery("#tb-endscreens-stopped").show()});jQuery(document).on("click","#playlist-select-type-manual",function(){var e=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").children("input");e.each(function(e,i){t.validPlaylistIds.push(jQuery(i).val())})});jQuery(document).on("keyup",".playlistSelectManualIds",function(){var e=jQuery(this).val();if(t.validPlaylistIds.indexOf(e)==-1){jQuery(".tb-playlist-select-manual-id-invalid").show()}else{jQuery(".tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",function(){jQuery(".tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("click","#tb-endscreens-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-endscreens-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-endscreens-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-input-search",function(e){t.search=jQuery(this).val().trim()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-input-ids",function(e){var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-endscreens-input-ids-status").hide();return}jQuery("#tb-endscreens-input-ids-status").show();t.specificVideoIds=[];if(i.indexOf(",")>-1){t.specificVideoIds=i.split(",")}else{t.specificVideoIds=i.split(" ")}for(var s=0;s<t.specificVideoIds.length;s++){t.specificVideoIds[s]=t.specificVideoIds[s].trim();t.specificVideoIds[s]=t.specificVideoIds[s].replace("https://www.youtube.com/watch?v=","");t.specificVideoIds[s]=t.specificVideoIds[s].replace("https://youtu.be/","");if(t.specificVideoIds[s].length!=11){t.specificVideoIds.splice(s,1);s--}}if(t.specificVideoIds.length==0){jQuery("#tb-endscreens-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-input-ids-status").css("color","red")}else if(t.specificVideoIds.length==1){jQuery("#tb-endscreens-input-ids-status").text("1 video detected");jQuery("#tb-endscreens-input-ids-status").css("color","green");jQuery("#tb-endscreens-method-ids").prop("checked",true);jQuery("#tb-endscreens-method-ids").trigger("click")}else{jQuery("#tb-endscreens-input-ids-status").text(t.specificVideoIds.length+" videos detected");jQuery("#tb-endscreens-input-ids-status").css("color","green");jQuery("#tb-endscreens-method-ids").prop("checked",true);jQuery("#tb-endscreens-method-ids").trigger("click")}});jQuery(document).on("click","#tb-endscreens-method-ids, #tb-endscreens-method-playlist, #tb-endscreens-method-search, #tb-endscreens-method-full",function(e){t.method=parseInt(jQuery(this).attr("data-method"));TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-method-ids, #tb-endscreens-method-playlist, #tb-endscreens-method-search, #tb-endscreens-method-full clicked");TBUtilities.Log("TubeBuddyEndScreens - data-method "+t.method);jQuery(".tb-playlist-select-manual-id-invalid").hide();var i=jQuery("#tb-endscreens-input-playlist").playlistSelect().data("plugin_playlistSelect");switch(t.method){case 0:jQuery("#tb-endscreens-input-ids").removeAttr("disabled","disabled");i.disable();t.playlistId="";jQuery("#tb-endscreens-input-search").attr("disabled","disabled");break;case 1:jQuery("#tb-endscreens-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-input-search").attr("disabled","disabled");t.specificVideoIds.length=0;t.specificVideos.length=0;jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide();i.enable();i.showDropDown();break;case 2:jQuery("#tb-endscreens-input-ids").attr("disabled","disabled");i.disable();jQuery("#tb-endscreens-input-search").removeAttr("disabled","disabled");t.specificVideoIds.length=0;t.specificVideos.length=0;t.playlistId="";jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide();break;case 3:jQuery("#tb-endscreens-input-ids").attr("disabled","disabled");i.disable();jQuery("#tb-endscreens-input-search").attr("disabled","disabled");t.specificVideoIds.length=0;t.specificVideos.length=0;t.playlistId="";jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide();break}});jQuery(document).on("change",".tb-endscreens-filter",function(){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-filter clicked");jQuery(".tb-endscreens-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-endscreens-destination-row[data-privacy="private"]').hide();jQuery('.tb-endscreens-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-endscreens-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-endscreens-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-endscreens-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-endscreens-destination-row[data-privacy="public"]').hide();break}jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-total-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row").filter(":visible").length)});jQuery(document).on("click",".tb-endscreens-destination-row",function(){try{if(!jQuery(this).hasClass("tb-endscreens-destination-row--selected")){if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length>0){jQuery(this).prop("checked",false);if(t.isDeleteOnly)TBGlobal.ShowUpgradePage("delete End Screen Elements in bulk (more than 1 video at a time)","bulkdeleteendscreen");else TBGlobal.ShowUpgradePage("copy End Screen Elements in bulk in bulk (more than 1 video at a time)","bulkcopyendscreen");return}jQuery(this).closest(".tb-endscreens-destination-row").addClass("tb-endscreens-destination-row--selected")}else{jQuery(this).closest(".tb-endscreens-destination-row").removeClass("tb-endscreens-destination-row--selected")}jQuery("#tb-endscreens-copy-destination-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-checkbox-include"})}});jQuery(document).on("click","#tb-endscreens-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()&&t.videos.length>1){if(t.isDeleteOnly)TBGlobal.ShowUpgradePage("delete End Screen Elements in bulk (more than 1 video at a time)","bulkdeleteendscreen");else TBGlobal.ShowUpgradePage("copy End Screen Elements in bulk (more than 1 video at a time)","bulkcopyendscreen");return}jQuery(".tb-endscreens-destination-row").addClass("tb-endscreens-destination-row--selected");jQuery("#tb-endscreens-copy-destination-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show()});jQuery(document).on("click","#tb-endscreens-select-no-checkboxes",function(){jQuery(".tb-endscreens-destination-row").removeClass("tb-endscreens-destination-row--selected");jQuery("#tb-endscreens-copy-destination-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery("#tb-endscreens-destination-selected-count").text(jQuery("#tb-endscreens-destination-list").find(".tb-endscreens-destination-row--selected").filter(":visible").length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show()});jQuery(document).on("click","#tb-endscreens-back",function(){TBUtilities.Log(t);if(t.step==2){if(t.isDeleteOnly)jQuery("#tb-endscreens-delete-options").show();else jQuery("#tb-endscreens-source").show();if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2");jQuery("#tb-endscreens-back-bulk").show()}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 1")}if(t.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 1");jQuery("#tb-endscreens-method").hide();jQuery("#tb-endscreens-back").hide();t.step=1}else if(t.step==3){t.step=2;jQuery("#tb-endscreens-destination").hide();jQuery("#tb-endscreens-method").show();if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2")}if(t.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 2");t.specificVideoIds.length=0;t.specificVideos.length=0;t.playlistId="";jQuery("#tb-endscreens-input-ids").val("");jQuery("#tb-endscreens-input-ids-status").hide()}else if(t.step==4){t.step=3;if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 4")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}if(t.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 3");jQuery("#tb-endscreens-destination").show();jQuery("#tb-endscreens-confirm").hide();jQuery("#tb-endscreens-kickoff").hide();jQuery("#tb-endscreens-continue").show()}});jQuery(document).on("click","#tb-endscreens-expand-all",function(){jQuery(".tb-endscreens-item-customize").html("Customize &#9650;");jQuery(".tb-endscreens-item-options").slideDown()});jQuery(document).on("click","#tb-endscreens-collapse-all",function(){jQuery(".tb-endscreens-item-customize").html("Customize &#9660;");jQuery(".tb-endscreens-item-options").slideUp()});jQuery(document).on("click",".tb-endscreens-item-customize",function(){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-item-customize clicked");try{var e=jQuery(this).attr("data-video-id");if(jQuery(this).parent().parent().find(".tb-endscreens-item-options").css("display")=="none"){jQuery(this).html("Customize &#9650;");jQuery(this).parent().parent().find(".tb-endscreens-item-options").slideDown()}else{jQuery(this).html("Customize &#9660;");jQuery(this).parent().parent().find(".tb-endscreens-item-options").slideUp()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-item-customize"})}});jQuery(document).on("click","#tb-endscreens-select-all-elements",function(e){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-select-all-cards clicked");jQuery(".tb-endscreens-element-item:visible").each(function(){var e=jQuery(this).attr("data-element-default-id");var i=TBUtilities.GetInArray(t.selectedElements,"id",e);if(!i){d(e,this)}})});jQuery(document).on("click","#tb-endscreens-select-none-elements",function(e){TBUtilities.Log("TubeBuddyEndScreens - tb-endscreens-select-none-elements clicked");jQuery(".tb-endscreens-element-item:visible").each(function(){var e=jQuery(this).attr("data-element-default-id");var i=TBUtilities.GetInArray(t.selectedElements,"id",e);if(i){l(e,this)}})});jQuery(document).on("click",".tb-endscreens-destination-row input",function(e){e.stopPropagation()});jQuery(document).on("click","#tb-endscreens-continue, #tb-endscreens-kickoff",function(){try{TBUtilities.Log("TubeBuddyEndscreens - tb-endscreens-continue, #tb-endscreens-kickoff clicked ");if(t.step==1){jQuery("#tb-endscreens-back-bulk").hide();if(t.selectedElements.length===0&&!t.isDeleteOnly){TBUtilities.Alert("You must select at least 1 end screen element to copy.");return}if(t.isDeleteOnly){i.deleteAll=true;i.deleteText="";i.deleteUrl="";if(jQuery("#tb-endscreens-delete-link-option").is(":checked")){i.deleteAll=false;i.deleteUrl=jQuery("#tb-endscreens-delete-url").val().trim();i.includePartialMatches=jQuery("#tb-endscreens-delete-partial-matches").is(":checked");if(!i.deleteUrl){TBUtilities.Alert("You must enter a URL");return}else if(i.deleteUrl.length<=3){TBUtilities.Alert("It does not look like you entered a valid URL");return}}}if(t.isDeleteOnly==false){var e=false;jQuery.each(t.selectedElements,function(t,i){switch(i.type){case"VIDEO":{e=true;break}case"PLAYLIST":{e=true;break}}if(e){return false}});var s=TBUtilities.GetCookie("tbnonprofit");if(e===false&&s===null){TBUtilities.Alert("You must select at least 1 <strong>Video</strong> or <strong>Playlist</strong> end screen element to copy. <br><br> Note: If your channel is part of the YouTube Nonprofit program email support@tubebuddy.com to enable copying only link end screen elements.");return}}jQuery("#tb-endscreens-loading-videos").show();jQuery("#tb-endscreens-destination-list").hide();jQuery("#tb-endscreens-delete-options").hide();jQuery("#tb-endscreens-source").hide();if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 2")}if(t.isDeleteOnly){jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 2")}jQuery("#tb-endscreens-method").show();jQuery("#tb-endscreens-back").show();TBUtilities.Log("TubeEndScreens - Number of elements selected = "+t.selectedElements.length);jQuery.each(t.selectedElements,function(e,t){var i=jQuery("div[data-element-default-id='"+t.id+"']").first();o(t,i)});t.step=2}else if(t.step==2){switch(parseInt(t.method)){case 0:if(t.specificVideoIds.length==0){jQuery("#tb-endscreens-input-ids-status").css("color","red");jQuery("#tb-endscreens-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}if(!TBGlobal.CanAccessLevel2Tools()&&t.specificVideoIds.length>1){if(t.isDeleteOnly)TBGlobal.ShowUpgradePage("delete end screen elements in bulk (more than 1 video at a time)","bulkdeleteendscreen");else TBGlobal.ShowUpgradePage("copy end screen elements in bulk (more than 1 video at a time)","bulkcopyendscreen");return}TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: Video IDs "+JSON.stringify(t.specificVideoIds));y();break;case 1:var n=jQuery("#tb-endscreens-input-playlist").playlistSelect().data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();var r=n.getSelectedPlaylistIds();if(r.length>0){t.playlistId=r.join(",")}if(r.length>=2){TBUtilities.Alert("Please select only one playlist");return}if(t.playlistId==""){n.showValidationWarning();TBUtilities.Alert("Please select a playlist");return}TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: Playlist ["+t.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(t.playlistId,null,p,u);break;case 2:if(t.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: Search ["+t.search+"]");jQuery("#tb-endscreens-destination").show();TBYouTubeApi.GetChannelVideosSearch(t.search,null,p,u);break;case 3:TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Video Selection Method: All");var a=null;if(jQuery("#tb-endscreens-onlyLoadFirstPage").is(":checked")){var d=/^\+?\d+$/.test(jQuery("#tb-endscreens-onlyLoadFirstPage-number").val());if(d==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}a=parseInt(jQuery("#tb-endscreens-onlyLoadFirstPage-number").val());if(a<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,p,u,a,null,t.selectedVideo.id);break}jQuery("#tb-endscreens-method").hide();if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 4")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 3")}if(t.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 3");jQuery("#tb-endscreens-destination").show();jQuery("#tb-endscreens-destination-list").hide();jQuery("#tb-endscreens-loading-videos").show();t.step=3}else if(t.step==3){if(jQuery("#tb-endscreens-delete-existing").is(":checked")){TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Yes, Deleting Existing End Screen Elements");jQuery("#tb-endscreens-delete-existing-warning").show()}else{TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - No, Not Deleting Existing End Screen Elements");jQuery("#tb-endscreens-delete-existing-warning").hide()}if(jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length==0&&t.destinationVideos.length==0){if(t.isDeleteOnly)TBUtilities.Alert("Please select at least 1 video to Delete All End Screen Elements from.");else TBUtilities.Alert("Please select at least 1 video to copy End Screen Elements to.");return}t.destinationVideos=t.videos.filter(e=>jQuery(`div.tb-endscreens-destination-row--selected:visible div.tb-endscreens-item-options[data-video-id="${e.id}"]`)[0]!=undefined);jQuery("#tb-endscreens-queue-list").empty();jQuery("#tb-endscreens-completed-list").empty();jQuery("#tb-endscreens-queue-list2").empty();jQuery("#tb-endscreens-completed-list2").empty();jQuery("#tb-endscreens-error-list2").empty();if(t.isDeleteOnly){if(i.deleteAll)jQuery("#tb-endscreens-delete-existing-warning").html("<b>WARNING:</b> You have chosen to automatically delete all existing end screen elements from <b>"+t.destinationVideos.length+"</b> Video(s)");else{if(i.includePartialMatches)jQuery("#tb-endscreens-delete-existing-warning").html('<b>WARNING:</b> You have chosen to automatically delete all existing end screen elements that contain the URL: "'+i.deleteUrl+'" [INCLUDING PARTIAL MATCHES] from <b>'+t.destinationVideos.length+"</b> Video(s)");else jQuery("#tb-endscreens-delete-existing-warning").html('<b>WARNING:</b> You have chosen to automatically delete all existing end screen elements that contain the URL: "'+i.deleteUrl+'" from <b>'+t.destinationVideos.length+"</b> Video(s)")}}jQuery("#tb-endscreens-copy-destination-count").text(t.destinationVideos.length);jQuery("#tb-endscreens-destination-selected-count").text(t.destinationVideos.length);if(jQuery("#tb-endscreens-copy-destination-count").text()=="1")jQuery("#tb-endscreens-copy-destination-count-s").hide();else jQuery("#tb-endscreens-copy-destination-count-s").show();jQuery("#tb-endscreens-method").hide();jQuery("#tb-endscreens-confirm-checkbox").prop("checked",false);t.step=4;jQuery("#tb-endscreens-destination").hide();if(t.fromBulkSelectMenu==true){jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 5")}else{jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Step 4")}if(t.isDeleteOnly)jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Step 4");jQuery("#tb-endscreens-confirm").show();jQuery("#tb-endscreens-kickoff").show();jQuery("#tb-endscreens-continue").hide();if(t.destinationVideos.length>=2e3){jQuery("#tb-endscreens-2k-warning").show()}else{jQuery("#tb-endscreens-2k-warning").hide()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] #tb-endscreens-continue, #tb-endscreens-kickoff"})}});jQuery(document).on("click",".tb-endscreens-element-item",function(){try{var e=jQuery(this).attr("data-element-default-id");TBUtilities.Log("TubeBuddyEndScreens - element clicked, id = "+e);var i=TBUtilities.GetInArray(t.selectedElements,"id",e);TBUtilities.Log(i);if(i==null){d(e,this)}else{l(e,this)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-element-item"})}});jQuery(document).on("click","#tb-endscreens-close, .tb-endscreens-closex",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-endscreens-container").hide();t.step=1}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreens] [click] tb-endscreens-close"})}});jQuery(document).on("click","#tb-endscreens-kickoff",function(){const e=TBGlobal.GetToolById("bulkcopyendscreen").name;if(!jQuery("#tb-endscreens-confirm-checkbox").is(":checked")){if(t.isDeleteOnly)TBUtilities.Alert("Please check the box confirming that you want to Delete all End Screen Elements");else TBUtilities.Alert("Please check the box confirming that you want to copy the End Screen Elements");return}t.step=4;jQuery("#tb-endscreens-title-block").text("Bulk Copy End Screen - Processing");if(t.isDeleteOnly){TBUtilities.ReportProductEvent("Feature Applied",{Tool:e,Action:`Deleting end screens`});jQuery("#tb-endscreens-title-block").text("Bulk Delete End Screen - Processing")}else{TBUtilities.ReportProductEvent("Feature Applied",{Tool:e,Action:`Copying end screens`})}jQuery("#tb-endscreens-status").show();jQuery("#tb-endscreens-confirm").hide();jQuery("#tb-endscreens-stop").show();jQuery("#tb-endscreens-back").hide();jQuery("#tb-endscreens-kickoff").hide();jQuery("#tb-endscreens-continue").hide();m()})};var w=function(){t.isDeleteOnly=false;t.endscreens=[];t.selectedElements=[];t.videos=[];t.destinationVideos=[];t.currentVideo=null;t.duration=null;t.totalVideoMiliseconds=null;t.isStopped=false;t.videosWithDeletedEndscreens=[];t.step=1;t.specificVideoIds.length=0;t.specificVideos.length=0;t.method=3;t.sourceVideoEndscreenData=null;r();n()};var k=function(){TBGlobal.ClearUserDebugInfo();TBGlobal.AddUserDebugInfo("TubeBuddyEndScreens - Opening Endscreens - Delete Mode");t.isDeleteOnly=true;t.endscreens=[];t.selectedElements=[];t.videos=[];t.destinationVideos=[];t.currentVideo=null;t.duration=null;t.totalVideoMiliseconds=null;t.isStopped=false;t.videosWithDeletedEndscreens=[];t.selectedVideo.id="";t.selectedVideo.title="";t.selectedVideo.thumbnail="";t.step=1;t.specificVideoIds.length=0;t.specificVideos.length=0;t.method=3;t.sourceVideoEndscreenData=null;r();n();jQuery("#tb-endscreens-back").hide()};return{Show:function(i,n,r,a){if(TBGlobal.IsAuthenticated()){t.selectedVideo.id=i;t.selectedVideo.title=n;t.selectedVideo.thumbnail=r;t.fromBulkSelectMenu=a;if(!e){s();B();e=true}else{w()}}},ShowDelete:function(){if(TBGlobal.IsAuthenticated()){t.selectedVideo.id="";t.selectedVideo.title="";t.selectedVideo.thumbnail="";if(!e){t.isDeleteOnly=true;s();B();e=true}else{k()}}},Initialize:function(){},GetEndScreenListCallback:function(e){a(e)},ProcessNextVideo:function(e,i,s,n){if(n)t.currentVideo.error=n;g()},CheckForErrors:function(e,i,s,n){if(n)t.currentVideo.error=n},UpdateElementMs:function(e,t,i,s,n){Q(e,t,i,s,n)}}}();var TubeBuddyEndScreensVideo=function(){var e=false;var t=null;var i=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideo+"?videoid="+TBUtilities.GetUrlParameter("v");TBExtension.Get(e,"CRTBEndScreensLoadVideo",null)};var s=function(e,t){if(jQuery(".creator-editor-content").find(".tb-edit-video-endscreens-container").length==0){jQuery(".creator-editor-content").after(jQuery(".tb-edit-video-endscreens-container:last")[0].outerHTML);if(t)jQuery(".tb-video-endscreens-title-input").val(t);else jQuery(".tb-video-endscreens-title-input").val(jQuery("#creator-editor-title-link").attr("title"));if(e){jQuery(".tb-edit-video-endscreens-template").prop("checked",true);jQuery(".tb-video-endscreens-title-input").prop("disabled",false)}else{jQuery(".tb-edit-video-endscreens-template").prop("checked",false);jQuery(".tb-video-endscreens-title-input").prop("disabled",true)}}jQuery(".annotator-learn-more-container").after(jQuery(".tb-edit-video-endscreens-options-container:first")[0].outerHTML)};var n=function(){var e=TBGlobal.host+"/ModuleManager/EndScreensVideo/EndScreensVideo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/endscreensvideo.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/endscreensvideo.html"}TBExtension.Get(e,"CRTBLoadEndScreensVideoTemplate")};var r=function(){jQuery(document).on("click",".tb-edit-video-endscreens-apply-endscreen-template",function(){TubeBuddyMenu.ShowBackgroundSticky();var e=TBUtilities.GetUrlParameter("v");var t=jQuery("#creator-editor-title-link").attr("title");var i="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";TubeBuddyEndScreenTemplatesStudio.Show(e,t,i)});jQuery(document).on("click",".tb-edit-video-endscreens-clear-endscreens",function(e){e.stopImmediatePropagation();if(TBExtension.GetType()=="firefox"){if(confirm("Are you sure you want to remove all End Screen Elements from this video?"))o()}else{TBUtilities.Confirm("Are you sure you want to remove all Endscreen Elements from this video?",o,null)}});jQuery(document).on("change",".tb-edit-video-endscreens-template",function(){a()});jQuery(document).on("change",".tb-video-endscreens-title-input",function(){a()});jQuery(document).on("keyup",".tb-video-endscreens-title-input",function(e){if(e.keyCode==13){a()}})};var a=function(){try{TBUtilities.Log("TubeBuddyEndScreensVideo - saveTemplateChanges");var e=jQuery(".tb-edit-video-endscreens-template").prop("checked");var t=TBUtilities.GetUrlParameter("v");if(e&&!jQuery(".tb-video-endscreens-title-input").val())jQuery(".tb-video-endscreens-title-input").val(jQuery("#creator-editor-title-link").attr("title"));title=jQuery(".tb-video-endscreens-title-input").val();var i=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleEndScreenTemplate;var s={Id:t,Enabled:e,Title:title};TBUtilities.Log(s);TBExtension.Post(i,JSON.stringify(s),"CRTBLoadEditVideoEndScreenTemplateToggle",null,{contentType:"application/json"});jQuery(".tb-video-endscreens-title-input").prop("disabled",!e);jQuery(".tb-video-endscreens-changes-saved").hide();jQuery(".tb-video-endscreens-changes-saved").show().delay(2e3).fadeOut();if(e)TBUtilities.AddAction(null,TBUtilities.ActionTypes.EndScreenTemplates_Apply,"endscreentemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreensVideo] saveTemplateChanges"})}};var o=function(){jQuery(".tb-edit-video-endscreens-working").show();TBYouTubeApi.GetVideoDetails(t,"contentDetails,snippet,id",function(e){var t=new timelord(e.contentDetails.duration);var i="https://www.youtube.com/account";TBExtension.Get(i,function(i,s,n){try{if(i){var r=TBUtilities.GetSessionToken(n);var a={destVideoMilliseconds:t.ticks(),endscreenStartMs:0};var o={videoId:e.id};TubeBuddyYouTubeActions.DeleteAllEndCardElements(o,a,r,function(e){jQuery(".tb-edit-video-endscreens-working").hide();if(e){TBUtilities.Alert("End Screen elements successfully cleared!\n\nWe need to re-load the page for the changes to take effect. Any unsaved changes on this page will be lost. ",function(){location.reload()})}})}else{TBUtilities.LogFailedWebRequest({Location:"EndScreensVideo.js|removeAllEndScreenElements",Data:s,Response:n})}}catch(e){TBUtilities.LogError({Exception:e,Location:"EndScreensVideo.js|removeAllEndScreenElements"})}})})};var d=function(){jQuery(document.body).on("CRTBLoadEditVideoEndScreenTemplateToggle",function(e,t){try{}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreensVideo] CRTBLoadEditVideoEndScreenTemplateToggle"})}});jQuery(document.body).on("CRTBLoadEndScreensVideoTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);i()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreensVideo] CRTBLoadEndScreensVideoTemplate"})}});jQuery(document.body).on("CRTBEndScreensLoadVideo",function(e,t){try{if(t.success){_video=jQuery.parseJSON(t.response);s(_video.IsEndScreenTemplate,_video.EndScreenTemplateName)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCardsVideo] CRTBEditVideoCardsLoadVideo"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){t=TBUtilities.GetUrlParameter("v");d();n();r();e=true}}}}}();var TubeBuddySchedule=function(){var e=false;var t=null;var i=true;var s=null;var n=function(){jQuery("#vm-view-filter").append(jQuery(".tb-schedule-button:last")[0].outerHTML)};var r=function(){var e=TBGlobal.host+"/ModuleManager/schedule/schedule?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/schedule.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/schedule.html"}TBExtension.Get(e,"CRTBLoadScheduleSchedule")};var a=function(){TubeBuddyMenu.ShowBackgroundSticky();jQuery("#tb-schedule-container").css("width","1100px");jQuery("#tb-schedule-view-toggle").text("View All");jQuery("#tb-schedule-view-toggle").hide();jQuery("#tb-schedule-day-none-scheduled").hide();jQuery("#tb-schedule-view-all").hide();jQuery("#tb-schedule-container").show();jQuery("#tb-schedule-loaded-none-found").hide();jQuery("#tb-schedule-loaded").hide();if(s)s.destroy();jQuery("#tb-schedule-loading").show();jQuery("#tb-schedule-legend").hide();var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetYouTubeVideoScheduledActionsInFuture;TBExtension.Get(e,"CRTBScheduleLoadSchedule")};var o=function(){jQuery(document).on("click",".tb-schedule-buttons, .tb-schedule-button",function(e){a()});jQuery(document).on("click",".tb-schedule-close, .tb-schedule-closex",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-schedule-container").hide();if(s)s.destroy()});jQuery(document).on("click",".tb-schedule-edit-golive",function(e){var t=jQuery(this).attr("data-video-id");var i=jQuery(this).attr("data-title");var s="https://img.youtube.com/vi/"+t+"/mqdefault.jpg";jQuery("#tb-schedule-container").hide();TubeBuddyScheduledPublish.Show(t,i)});jQuery(document).on("click",".tb-schedule-edit-sunset",function(e){var t=jQuery(this).attr("data-video-id");var i=jQuery(this).attr("data-title");var s="https://img.youtube.com/vi/"+t+"/mqdefault.jpg";jQuery("#tb-schedule-container").hide();TubeBuddySunsetVideo.Show(t,i)});jQuery(document).on("click","#tb-schedule-view-toggle",function(){i=i==false?true:false;if(i==false){jQuery("#tb-schedule-monthly-view").hide();jQuery("#tb-schedule-view-toggle").text("View by Month");jQuery("#tb-schedule-container").css("width","680px");jQuery("#tb-schedule-view-all").show()}else{jQuery("#tb-schedule-view-all").hide();jQuery("#tb-schedule-view-toggle").text("View All");jQuery("#tb-schedule-container").css("width","1100px");jQuery("#tb-schedule-monthly-view").show()}});jQuery(document).on("click",".tb-schedule-month",function(){jQuery("#tb-schedule-day-none-scheduled").hide();jQuery(".day").removeClass("selected-day");jQuery("#tb-schedule-events-title-text").text("This Month");jQuery(".tb-schedule-event-item").show();c()})};var d=function(e){var t=Math.floor(e/60);var e=e%60;var i=t>=12?"PM":"AM";t=t%12;t=t?t:12;e=e<10?"0"+e:e;var s=t+":"+e+" "+i;return s};var l=function(e){var t=jQuery(e.element).attr("class").search("calendar-day");var i=jQuery(e.element).attr("class").slice(t,t+23);if(jQuery(e.element).hasClass("past"))return;if(jQuery(e.element).hasClass("last-month")){s.back()}else if(jQuery(e.element).hasClass("next-month")){s.forward()}if(e.events.length==0){jQuery("#tb-schedule-day-none-scheduled").show()}else{jQuery("#tb-schedule-day-none-scheduled").hide()}jQuery(".day").removeClass("selected-day");jQuery("."+i).addClass("selected-day");jQuery(".tb-schedule-event-item").show();jQuery("#tb-schedule-events-title-text").text("for "+e.date.format("ll"));jQuery('.tb-schedule-event-item[data-event-date!="'+e.date.format("MM/DD/YYYY")+'"]').hide();jQuery(".tb-schedule-template span.timeline-icon.golive img").attr("src",TBGlobal.host+"/images/modules/schedule/golive.png").attr("alt","go live icon");jQuery(".tb-schedule-template span.timeline-icon.sunset img").attr("src",TBGlobal.host+"/images/modules/schedule/sunset.png").attr("alt","sunset icon")};var c=function(e){if(jQuery(".tb-schedule-event-item").length==0){jQuery("#tb-schedule-day-none-scheduled").show()}else{jQuery("#tb-schedule-day-none-scheduled").hide()}jQuery(".tb-schedule-template span.timeline-icon.golive img").attr("src",TBGlobal.host+"/images/modules/schedule/golive.png").attr("alt","go live icon");jQuery(".tb-schedule-template span.timeline-icon.sunset img").attr("src",TBGlobal.host+"/images/modules/schedule/sunset.png").attr("alt","sunset icon")};var u=function(){jQuery(document.body).on("CRTBLoadScheduleSchedule",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);n()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySchedule] CRTBLoadScheduleSchedule"})}});jQuery(document.body).on("CRTBScheduleLoadSchedule",async function(e,i){try{if(i.success){t=JSON.parse(i.response);t.forEach(function(e){e.TimeFromMinutes=d(e.LocalTime)});await Promise.all(t.map(async e=>{return await TubeBuddyYouTubeActions.GetVideoDetailStudio(e.Video.Id).then(t=>{if(t.title!==undefined){e.Video.Title=t.title}if(t.title===undefined&&e.Video.Title===undefined){e.Video.Title="Title"}if(t.thumbnailDetails.thumbnails[1].url!==undefined){e.Video.ThumbnailUrl=t.thumbnailDetails.thumbnails[1].url}if(t.thumbnailDetails.thumbnails[1].url===undefined&&e.Video.ThumbnailUrl===undefined){e.Video.ThumbnailUrl="https://img.youtube.com/vi/"+e.Video.Id+"/mqdefault.jpg"}}).catch(e=>TBUtilities.LogError({Exception:e,Location:"[TubeBuddySchedule] CRTBScheduleLoadSchedule"}))}));jQuery(".day").removeClass("selected-day");jQuery("#tb-schedule-day-none-scheduled").hide();if(jQuery("#tb-schedule-monthly-view").children(".clndr").length>0)s.destroy();var n='<div class="tb-schedule-clndr-controls"><div class="clndr-previous-button"><i class="material-icons">keyboard_arrow_left</i></div><div class="tb-schedule-month"><%= month %> <%= year %></div><div class="clndr-next-button"><i class="material-icons">keyboard_arrow_right</i></div></div><div style="display:flex; justify-content: space-between;"><div class="tb-schedule-clndr-grid"><div class="tb-schedule-days-of-the-week"><% _.each(daysOfTheWeek, function (day) { %><div class="tb-schedule-header-day"><%= day %></div><% }); %><div class="tb-schedule-days tb-margin-top5"><% _.each(days, function (day) { %><div class="<%= day.classes %>"><div style="width: 100%;display: flex; flex-wrap: wrap; justify-content: center;"><div class="tb-font-size22 tb-width100-percent" style="display:flex;justify-content:center;"><%= day.day %></div><div style="position:relative; top: 5px; height: 8px; width: 100%; display:flex; justify-content:center;"><div style="height:8px; width:8px; border-radius:50%; background-color:#95b85e; margin:0 1px; display: <%= day.events.map(function(event){ return event.Type; }).indexOf(1) > -1 ? \'flex\': \'none\'%>"></div><div style="height:8px; width:8px; border-radius:50%; background-color:#fa8564; margin:0 1px; display: <%= day.events.map(function(event){ return event.Type; }).indexOf(0) > -1 ? \'flex\': \'none\'%>"></div></div></div></div><% }); %></div></div></div><div class="tb-schedule-event-listing" id="tb-schedule-events-this-month"><div class="tb-schedule-event-listing-title">Events&nbsp;<span id="tb-schedule-events-title-text">This Month</span></div><div id="tb-schedule-event-listing-container"><div style="max-height:386px; overflow-y:auto;"><% _.each(eventsThisMonth, function(event) { %><div class="tb-schedule-event-item" data-event-date="<%= event.LocalDate %>"><div class="tb-schedule-template" style="position: relative;left: 55px;margin-bottom:20px;width: 480px;"><div style="border:4px solid #f1f1f1; margin-bottom:5px;border-radius:5px;"><span style="border-right: 8px solid #f1f1f1; border-bottom: 8px solid transparent;border-top: 8px solid transparent;display: block;height: 0;left: -12px;position: absolute;top: 13px;width: 0;"></span><span class="timeline-icon <%= event.Type == 0 ? \'sunset\' : \'golive\'%>" style="position:absolute; left:-50px; top:5px;"><img src="{PLUGIN_FILE_ROOT}/images/modules/schedule/<%= event.Type == 0 ? \'sunset\' : \'golive\'%>.png" alt="Alternate Text" /></span><div style="width:52px; position: absolute;right: -60px; text-align:left; line-height:16px; font-size:11px;"><span style="font-size:11px; text-transform:uppercase; opacity:.7; color: <%= event.Type == 0 ? \'red\' : \'green\'%>"> <%= event.CurrentPrivacy %> </span><div><i class="material-icons">arrow_drop_down</i></div><span style="font-size:11px; font-weight:500; text-transform:uppercase; color: <%= event.Type == 0 ? \'red\' : \'green\'%>"><%= event.ActionLabel %></span><br /><a class="<%= event.Type == 0 ? \'tb-schedule-edit-sunset\' : \'tb-schedule-edit-golive\' %>" data-video-id="<%= event.Video.Id %>" data-title="<%= event.Video.Title %>" style="font-size:11px; cursor:pointer; position:relative; left:1px;">edit</a></div><table style="border:0; width:470px;"><tr><td style="width:150px; text-align:center; color:#111; background-color:#f1f1f1;vertical-align:top;" rowspan="2"><div style="position:relative; font-size:20px;"><%= event.Day %><br /> <%= event.LocalDateDisplay %> </div><span style="background-color:#f1f1f1; color:#333; border-radius:5px; padding:4px 6px; font-size:16px;"> <%= event.TimeFromMinutes %> </span><div style="background-color:#f1f1f1; color:#999; border-radius:5px; padding:4px 6px; font-size:11px; max-width:145px; overflow:hidden;"><%= event.TimeZoneId %></div></td><td style="width:80px; padding:6px 0px 6px 8px; vertical-align:top;"><img class="tb-calendar-type0" src="<%= event.Video.ThumbnailUrl %>" style="height:50px; margin-right:5px;"></td><td style="width:260px; padding:6px 0px; vertical-align:top; text-align:left; vertical-align:top;"><a href="https://studio.youtube.com/video/<%= event.Video.Id %>/edit" target="_blank"><%= event.Video.Title %></a></td></tr><tr><td colspan="2" style="border-top:dashed 1px #ccc; margin:-10px 5px 0 5px;"><table style="border:0; width:100%; margin:5px 8px 8px 8px;"><tr><td style="width:40%; margin-right:15px; vertical-align:top;"><div style="font-weight:500; font-size:.9em;">Current Playlists</div><%= event.PlaylistHtml %></td><td style="width:142px; margin-right:15px; vertical-align:top; display:<%= event.Type == 0 ? \'none\' : \'block\' %>"><div style="font-weight:500; font-size:.9em;">Add to Playlists</div><%= event.PlaylistHtmlToAddTo %></td><td style="width:142px; margin-right:15px; vertical-align:top; display:<%= event.Type == 0 ? \'block\' : \'none\' %>"><div style="font-weight:500; font-size:.9em;">Remove from Playlists</div><%= event.PlaylistHtmlToRemoveFrom %></td></tr></table></td></tr></table></div></div></div><% }); %></div></div><div id="tb-schedule-day-none-scheduled" class="tb-font-size14 tb-margin10" style="display:none;">You don\'t have any videos scheduled to be published or sunsetted for the timeframe selected.</div></div></div>';try{s=jQuery("#tb-schedule-monthly-view").clndr({events:t,dateParameter:"LocalDate",template:n,forceSixRows:true,startWithMonth:moment(),clickEvents:{click:function(e){l(e)},onMonthChange:function(e){c(e)}},constraints:{startDate:moment()}});jQuery(".tb-schedule-template span.timeline-icon.golive img").attr("src",TBGlobal.host+"/images/modules/schedule/golive.png").attr("alt","go live icon");jQuery(".tb-schedule-template span.timeline-icon.sunset img").attr("src",TBGlobal.host+"/images/modules/schedule/sunset.png").attr("alt","sunset icon")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySchedule] CRTBScheduleLoadSchedule"})}if(t.length==0){jQuery("#tb-schedule-loaded").hide();jQuery("#tb-schedule-loading").hide();jQuery("#tb-schedule-legend").hide();jQuery("#tb-schedule-monthly-view").hide();jQuery("#tb-schedule-view-toggle").hide();jQuery("#tb-schedule-day-none-scheduled").show();jQuery("#tb-schedule-loaded-none-found").show()}else{jQuery("#tb-schedule-loaded-none-found").hide();jQuery("#tb-schedule-loading").hide();jQuery("#tb-schedule-view-toggle").show();jQuery("#tb-schedule-monthly-view").show();c();jQuery("#tb-schedule-legend").show();jQuery("#tb-schedule-loaded").show();jQuery("#tb-schedule-list-container").empty();jQuery.each(t,function(e,t){var i=jQuery(".tb-schedule-template:first")[0].outerHTML;if(t.Type==0){i=TBUtilities.ReplaceAll(i,"#TYPE#","sunset");i=TBUtilities.ReplaceAll(i,"#COLOR#","red");i=TBUtilities.ReplaceAll(i,"#CLASS#","tb-schedule-edit-sunset");i=TBUtilities.ReplaceAll(i,"#ADDDISPLAY#","none");i=TBUtilities.ReplaceAll(i,"#REMOVEDISPLAY#","block")}else{i=TBUtilities.ReplaceAll(i,"#TYPE#","GoLive");i=TBUtilities.ReplaceAll(i,"#COLOR#","green");i=TBUtilities.ReplaceAll(i,"#CLASS#","tb-schedule-edit-golive");i=TBUtilities.ReplaceAll(i,"#ADDDISPLAY#","block");i=TBUtilities.ReplaceAll(i,"#REMOVEDISPLAY#","none")}let s="https://img.youtube.com/vi/"+t.Video.Id+"/mqdefault.jpg";let n=t.Video.ThumbnailUrl?t.Video.ThumbnailUrl:s;let r=t.Video.Title?t.Video.Title:"Title";i=TBUtilities.ReplaceAll(i,"#DATE#",t.LocalDateDisplay);i=TBUtilities.ReplaceAll(i,"#DAY#",t.Day);i=TBUtilities.ReplaceAll(i,"#TIME#",d(t.LocalTime));i=TBUtilities.ReplaceAll(i,"#TIMETYPE#",t.TimeZoneId);i=TBUtilities.ReplaceAll(i,"#VIDEOID#",t.Video.Id);i=TBUtilities.ReplaceAll(i,"#VIDEOTHUMBNAIL#",n);i=TBUtilities.ReplaceAll(i,"#VIDEOTITLE#",r);i=TBUtilities.ReplaceAll(i,"#PRIVACY#",t.ActionLabel);i=TBUtilities.ReplaceAll(i,"#CURPRIVACY#",t.CurrentPrivacy);i=TBUtilities.ReplaceAll(i,"#PLAYLISTS#",t.PlaylistHtml);i=TBUtilities.ReplaceAll(i,"#ADDPLAYLISTS#",t.PlaylistHtmlToAddTo);i=TBUtilities.ReplaceAll(i,"#REMOVEPLAYLISTS#",t.PlaylistHtmlToRemoveFrom);jQuery("#tb-schedule-list-container").append(DOMPurify.sanitize(i,DOMPurifyConfig))})}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddySchedule] CRTBScheduleLoadSchedule"})}})};return{Initialize:function(){if(TBGlobal.IsAuthenticated()){if(!e){u();r();o();e=true}else{n()}}},Show:function(){a()}}}();var TubeBuddyBulkCopySelect=function(){var e=false;var t;var i;var s;var n;var r;var a=function(){var e=TBGlobal.host+"/ModuleManager/BulkCopySelect/BulkCopySelect?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/bulkcopyselect.html")}else if(loadLocalHTML&&TBExtension.GetType()==="safari"){e="modules/bulkcopyselect.html"}TBExtension.Get(e,"CRTBLoadBulkCopySelectTemplate")};var o=function(){jQuery(document).on("keypress",".tb-bulk-copy-select-search-input",function(e){try{if(e.which==13){jQuery(this).blur();jQuery(".tb-bulk-copy-select-search").focus().click()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-search-input"})}});jQuery(document).on("click",".tb-bulk-copy-select-search",function(){try{var e=jQuery(".tb-bulk-copy-select-search-input").val();if(e==""){TBUtilities.Alert("Please enter a search phrase.");return}jQuery(".tb-bulk-copy-select-videos-contianer").hide();jQuery(".tb-bulk-copy-select-videos-search-contianer").show();jQuery(".tb-bulk-copy-select-fetching").show();jQuery(".tb-bulk-copy-select-videos-search").empty();TBYouTubeApi.GetChannelVideosSearch(jQuery(".tb-bulk-copy-select-search-input").val(),null,d,function(){})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-search"})}});jQuery(document).on("click",".tb-bulk-copy-select-row",function(){try{if(jQuery(this).hasClass("tb-card-item-inner-selected")){t=null;s=null;i=null;jQuery(this).removeClass("tb-card-item-inner-selected");jQuery(".tb-module-embed-video").hide()}else{jQuery(".tb-bulk-copy-select-row").removeClass("tb-card-item-inner-selected");jQuery(this).addClass("tb-card-item-inner-selected");t=jQuery(this).attr("data-video-id");i=jQuery(this).attr("data-video-title");s="https://i.ytimg.com/vi/"+t+"/mqdefault.jpg"}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-row"})}});jQuery(document).on("click",".tb-bulk-copy-select-continue",function(){if(t==null){var e=r.toLowerCase()=="tubebuddycards"?"cards":"end screens";TBUtilities.Alert("You must select a video to copy "+e+" from");return}try{switch(r.toLowerCase()){case"tubebuddycards":{TubeBuddyCardsStudio.Show(t,i,s,true);break}case"tubebuddyendscreens":{TubeBuddyEndScreens.Show(t,i,s,true);break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-continue"})}finally{jQuery("#tb-bulk-copy-select-container").hide()}});jQuery(document).on("click",".tb-bulk-copy-select-close",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-bulk-copy-select-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [click] .tb-bulk-copy-select-close"})}});jQuery(document).on("change",".tb-bulk-copy-select-filter",function(){TBUtilities.Log("TubeBuddyBulkCopySelect - tb-bulk-copy-select-filter clicked");l(jQuery(this).val())})};var d=function(e){try{if(e.length>0){var t=jQuery("#tb-bulk-copy-select-video-template").html();jQuery.each(e,function(e,i){var s=t.formatTemplate(i.id,i.snippet.thumbnails.thumbnailMedium,i.url,i.snippet.title,i.status.privacy);jQuery(".tb-bulk-copy-select-videos-search").append(DOMPurify.sanitize(s,DOMPurifyConfig))});l(jQuery(".tb-bulk-copy-select-filter").val())}else{jQuery(".tb-bulk-copy-select-videos-search").append('<span class="tb-margin-left15 tb-margin-top20">No videos found</span>')}jQuery(".tb-bulk-copy-select-fetching").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] [gotVideoList]"})}};var l=function(e){TBUtilities.Log("TubeBuddyBulkCopySelect - filterVideos "+e);jQuery(".tb-bulk-copy-select-row").show();switch(e){case"all":break;case"public":jQuery('.tb-bulk-copy-select-row[data-privacy="private"]').hide();jQuery('.tb-bulk-copy-select-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-bulk-copy-select-row[data-privacy="public"]').hide();jQuery('.tb-bulk-copy-select-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-bulk-copy-select-row[data-privacy="public"]').hide();jQuery('.tb-bulk-copy-select-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-bulk-copy-select-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-bulk-copy-select-row[data-privacy="public"]').hide();break}};var c=function(){try{t=null;s=null;i=null;jQuery(".tb-bulk-copy-select-search-input").val("");jQuery(".tb-bulk-copy-select-videos-contianer").show();jQuery(".tb-bulk-copy-select-videos-search-contianer").hide();jQuery(".tb-bulk-copy-select-fetching").show();jQuery(".tb-bulk-copy-select-videotemplates").empty();jQuery(".tb-bulk-copy-select-videotemplates-contianer").hide();jQuery(".tb-bulk-copy-select-videos").empty();switch(r.toLowerCase()){case"tubebuddycards":{jQuery(".tb-bulk-copy-select-label").text("Cards");jQuery("#tb-bulk-copy-select-title-block").text("Bulk Copy Cards - Step 1");jQuery("#tb-bulk-copy-select-instructions").text("Click on the video you want to copy cards from:");jQuery("#tb-bulk-copy-select-help").attr("href","https://www.tubebuddy.com/tools#bulkcopycards");jQuery(".tb-bulk-copy-select-videotemplates-contianer-name").text("Card Templates");var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoCardTemplates;TBExtension.Get(e,"CRTBLoadBulkCopySelectCardTemplates",{Type:"tubebuddycards"});break}case"tubebuddyendscreens":{jQuery(".tb-bulk-copy-select-label").text("End Screen Elements");jQuery("#tb-bulk-copy-select-title-block").text("Bulk Copy End Screen - Step 1");jQuery("#tb-bulk-copy-select-instructions").text("Click on the video you want to copy end screens from:");jQuery("#tb-bulk-copy-select-help").attr("href","https://www.tubebuddy.com/tools#bulkcopyendscreen");jQuery(".tb-bulk-copy-select-videotemplates-contianer-name").text("End Screen Templates");var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(e,"CRTBLoadBulkCopySelectCardTemplates",{Type:"tubebuddyendscreens"});break}}jQuery(".tb-bulk-copy-select-fetching").show();jQuery("#tb-bulk-copy-select-container").show();var n=TBGlobal.host+TBGlobal.apiUrls.youtubeApiGetRecentVideos;TBExtension.Get(n,"CRTBLoadBulkCopySelectRecent")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] prepareDialog"})}};var u=function(){jQuery(document.body).on("CRTBLoadBulkCopySelectTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);p()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] CRTBLoadBulkCopySelectTemplate"})}});jQuery(document.body).on("CRTBLoadBulkCopySelectRecent",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);var s=jQuery("#tb-bulk-copy-select-video-template").html();jQuery.each(i,function(e,t){var i=s.formatTemplate(t.id,t.snippet.thumbnails.thumbnailMedium,t.url,t.snippet.title,t.status.privacy);jQuery(".tb-bulk-copy-select-videos").append(DOMPurify.sanitize(i,DOMPurifyConfig))});jQuery(".tb-bulk-copy-select-videos-contianer").show();jQuery(".tb-bulk-copy-select-fetching").hide();l(jQuery(".tb-bulk-copy-select-filter").val())}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] CRTBLoadBulkCopySelectRecent"})}});jQuery(document.body).on("CRTBLoadBulkCopySelectCardTemplates",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);if(i.length>0){jQuery(".tb-bulk-copy-select-videos").css("max-height","195px");jQuery(".tb-bulk-copy-select-videotemplates-contianer").show();var s=jQuery("#tb-bulk-copy-select-video-template").html();jQuery.each(i,function(e,i){var n="temp";switch(t.data.Type.toLowerCase()){case"tubebuddycards":{n=i.CardTemplateName;break}case"tubebuddyendscreens":{n=i.EndScreenTemplateName;break}}var r=s.formatTemplate(i.Id,"https://i.ytimg.com/vi/"+i.Id+"/mqdefault.jpg","https://www.youtube.com/watch?v="+i.Id,n);jQuery(".tb-bulk-copy-select-videotemplates").append(DOMPurify.sanitize(r,DOMPurifyConfig))})}else{jQuery(".tb-bulk-copy-select-videos").css("max-height","244px");jQuery(".tb-bulk-copy-select-videotemplates-contianer").hide()}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyBulkCopySelect] CRTBLoadBulkCopySelectCardTemplates"})}})};var p=function(){c()};return{Show:function(t){if(TBGlobal.IsAuthenticated()){TBUtilities.Log("TubeBuddyBulkCopySelect - Opening");r=t;if(!e){u();a();o();e=true}else{p()}}}}}();var TubeBuddyEndScreenTemplatesStudio=function(){var e=false;var t={videoId:"",videoEndscreenData:null};var i=null;var s;var n;var r;var a=null;var o={videoId:"",endscreenElements:[],selectedEndscreenElements:[],videoEndscreenData:null};var d=function(){var e=chrome.extension.getURL("modules/endscreentemplatesstudio.html");TBExtension.Get(e,function(e,t,i){try{if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));if(a){a.append(i)}else{jQuery("body").append(i)}c(s,n,r)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplatesStudio] loadHtml"})}})};var l=function(){jQuery(document).on("click","#tb-endscreen-studio-templates-apply",function(){if(!TBGlobal.CanAccessLevel1Tools()){TBGlobal.ShowUpgradePage("apply End Screen Templates","endscreentemplates");return}jQuery("#tb-endscreen-studio-templates-working").show();jQuery(this).hide();TubeBuddyYouTubeActions.GetVideoEnscreenData(t.videoId).then(function(e){t.videoEndscreenData=e;t.videoEndscreenData.endscreenStartMs=TBUtilities.AdjustEndScreenTiming(o.videoEndscreenData,t.videoEndscreenData);if(jQuery("#tb-endscreen-studio-templates-delete-all").prop("checked")){TubeBuddyYouTubeActions.DeleteAllEndScreenElementsStudio(t.videoId,t.videoEndscreenData.endscreenStartMs).then(function(){if(t.videoEndscreenData.endscreen){t.videoEndscreenData.endscreen.elements=[]}t.videoEndscreenData.endscreenStartMs=null;t.videoEndscreenData.endscreenStartMs=TBUtilities.AdjustEndScreenTiming(o.videoEndscreenData,t.videoEndscreenData);m(o.selectedEndscreenElements,[])}).catch(function(e){v(e)})}else{var i=[];if(t.videoEndscreenData.endscreen&&t.videoEndscreenData.endscreen.elements){i=t.videoEndscreenData.endscreen.elements}m(o.selectedEndscreenElements,i)}}).catch(function(e){v(e)})});jQuery(document).on("click","#tb-endscreen-studio-templates-close, .tb-endscreen-studio-templates-closex, .tb-module-close",function(){TubeBuddyMenu.HideBackground();jQuery("#tb-endscreen-studio-templates-container").hide()});jQuery(document).on("change","#tb-endscreen-studio-templates-select",function(){u()});jQuery(document).on("click","#tb-endscreen-studio-templates-delete-template",function(){TBUtilities.Confirm("Are you sure you want to delete this End Screen Template?",y,null)});jQuery(document).on("click","#tb-endscreen-studio-templates-reload-templates",function(){b()});jQuery(document).on("click","#tb-endscreen-studio-templates-select-all",function(){o.selectedEndscreenElements=[];o.endscreenElements.forEach(function(e){o.selectedEndscreenElements.push(e)});jQuery(".tb-endscreen-studio-template-element-item-inner").addClass("tb-endscreen-studio-template-element-item-inner-selected");jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+o.selectedEndscreenElements.length+"/"+o.endscreenElements.length+")")});jQuery(document).on("click","#tb-endscreen-studio-templates-select-none",function(){o.selectedEndscreenElements=[];jQuery(".tb-endscreen-studio-template-element-item-inner").removeClass("tb-endscreen-studio-template-element-item-inner-selected");jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+o.selectedEndscreenElements.length+"/"+o.endscreenElements.length+")")});jQuery(document).on("click",".tb-endscreen-studio-template-input",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-endscreen-studio-template-element-item",function(){try{var e=jQuery(this).attr("data-element-default-id");TBUtilities.Log("EndScreen element selected with key id =");TBUtilities.Log(e);var t=TBUtilities.GetInArray(o.selectedEndscreenElements,"id",e);TBUtilities.Log(t);TBUtilities.Log("Selected elements before modifying");TBUtilities.Log(o.selectedCards);if(t==null){var i=TBUtilities.GetInArray(o.endscreenElements,"id",e);o.selectedEndscreenElements.push(i);jQuery(this).find(".tb-endscreen-studio-template-element-item-inner").addClass("tb-endscreen-studio-template-element-item-inner-selected");TBUtilities.Log("Selected elements after adding");TBUtilities.Log(o.selectedEndscreenElements)}else{TBUtilities.RemoveFromArray(o.selectedEndscreenElements,"id",e);jQuery(this).find(".tb-endscreen-studio-template-element-item-inner").removeClass("tb-endscreen-studio-template-element-item-inner-selected");TBUtilities.Log("Selected elements after removing");TBUtilities.Log(o.selectedEndscreenElements)}jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+o.selectedEndscreenElements.length+"/"+o.endscreenElements.length+")");if(o.selectedEndscreenElements.length==0)jQuery("#tb-endscreen-studio-templates-apply").hide();else jQuery("#tb-endscreen-studio-templates-apply").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [click] tb-endscreen-studio-templates-cards-item"})}})};var c=function(e,i,s){jQuery("#tb-endscreen-studio-templates-loading-container").show();jQuery("#tb-endscreen-studio-templates-none").hide();jQuery("#tb-endscreen-studio-templates-apply-container").hide();jQuery("#tb-endscreen-studio-templates-apply").hide();t.videoId=e;t.videoEndscreenData=null;jQuery("#tb-endscreen-studio-templates-container").fadeIn();jQuery("#tb-endscreen-studio-templates-how-many").text("");jQuery("#tb-endscreen-studio-templates-thumbnail").attr("src",s);jQuery("#tb-endscreen-studio-templates-title").text(i);jQuery("#tb-endscreen-studio-templates-title").attr("href","https://www.youtube.com/watch?v="+e);jQuery("#tb-endscreen-studio-templates-working").hide();b()};var u=function(){jQuery("#tb-endscreen-studio-templates-list-container").html('<div style="padding:20px;"><span class="tb-spinner"></span> Loading End Screen Elements...</div>');try{var e=TBUtilities.GetInArray(i,"Id",jQuery("#tb-endscreen-studio-templates-select").val());o.videoId=e.Id;jQuery("#tb-endscreen-studio-templates-edit-template").attr("href","https://studio.youtube.com/video/"+o.videoId+"/edit");TubeBuddyYouTubeActions.GetVideoEnscreenData(o.videoId).then(function(e){o.videoEndscreenData=e;p(e.endscreen)}).catch(function(e){TBUtilities.Log(e);TBUtilities.Alert("There was an error retrieving endscreens. Please try again.")})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [api callback] destinationVideoDetailsCallback"})}};var p=function(e){jQuery("#tb-endscreen-studio-templates-list-container").html("");try{if(e===null||e&&e.elements&&e.elements.length==0){var t='<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this Template does not contain any End Screen Elements</div>';jQuery("#tb-endscreen-studio-templates-list-container").html(DOMPurify.sanitize(t,DOMPurifyConfig));jQuery("#tb-endscreen-studio-templates-apply").hide();return}else{o.endscreenElements=e.elements.slice();o.selectedEndscreenElements=e.elements.slice();o.endscreen=e}jQuery("#tb-endscreen-studio-templates-list-container").html("");TBUtilities.Log("TubeBuddyEndScreenTemplates - Elements Returned");TBUtilities.Log(JSON.stringify(e));var i=o.endscreenElements.length;for(var s=0;s<i;s++){var n=o.endscreenElements[s];var r=TBUtilities.ReplaceAll(TBUtilities.MilliSecondsToTime(o.endscreen.startMs+n.offsetMs),":"," ");switch(n.type){case"CHANNEL":{var a="";if(n.channelEndscreenElement.isSubscribe){let e=jQuery("#tb-endscreen-studio-template-elementType-subscribe-template").html();a=e.formatTemplate(n.id,r,n.channelEndscreenElement.title)}else{let e=jQuery("#tb-endscreen-studio-template-elementType-channel-template").html();a=e.formatTemplate(n.id,"https://www.youtube.com/channel/"+n.channelEndscreenElement.channelId,n.channelEndscreenElement.metadata,r)}jQuery("#tb-endscreen-studio-templates-list-container").append(a);break}case"WEBSITE":{let e=jQuery("#tb-endscreen-studio-template-elementType-website-template").html();let t=e.formatTemplate(n.id,n.websiteEndscreenElement.title,n.websiteEndscreenElement.cta,r,n.websiteEndscreenElement.targetUrl);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}case"VIDEO":{switch(n.videoEndscreenElement.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{let e=jQuery("#tb-endscreen-studio-template-elementType-recent_upload-template").html();let t=e.formatTemplate(n.id,r);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}case"VIDEO_TYPE_FIXED":{let e=jQuery("#tb-endscreen-studio-template-elementType-fixed-template").html();let t=e.formatTemplate(n.id,"https://www.youtube.com/watch?v="+n.videoEndscreenElement.encryptedVideoId,r);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{let e=jQuery("#tb-endscreen-studio-template-elementType-best_for_viewer-template").html();let t=e.formatTemplate(n.id,r);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}}break}case"PLAYLIST":{let e=jQuery("#tb-endscreen-studio-template-elementType-playlist-template").html();let t=e.formatTemplate(n.id,"https://www.youtube.com/playlist?list="+n.playlistEndscreenElement.playlistId,r);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}case"MERCH":{let e=jQuery("#tb-endscreen-studio-template-elementType-merch-template").html();let t=e.formatTemplate(n.id,r);jQuery("#tb-endscreen-studio-templates-list-container").append(t);break}}}jQuery("#tb-endscreen-studio-templates-apply").show();jQuery("#tb-endscreen-studio-templates-how-many").text("Selected ("+o.selectedEndscreenElements.length+"/"+o.endscreenElements.length+")")}catch(t){jQuery("#tb-endscreen-studio-templates-list-container").html('<div style="padding:20px; padding-bottom:30px; font-size:16px; font-weight:500; color:coral;"><img src="'+TBGlobal.host+'/images/icons/error.png" style="position:relative; top:2px;" /> Sorry, this template does not contain any end screen elements</div>');jQuery("#tb-endscreen-studio-templates-apply").hide();t.resultData=e;TBUtilities.LogError({Exception:t,Location:"[TubeBuddyEndScreenTemplates] getCardsListCallback"})}};var y=function(){var e=jQuery("#tb-endscreen-studio-templates-select").val();var t=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosToggleEndScreenTemplate;var i={Id:e,Enabled:false,Title:""};TBExtension.Post(t,JSON.stringify(i),function(e,t,i){b()},null,{contentType:"application/json"})};var b=function(){var e=TBGlobal.host+TBGlobal.apiUrls.youTubeVideosGetVideoEndScreenTemplates;TBExtension.Get(e,function(e,t,s){try{jQuery("#tb-endscreen-studio-templates-select").show();jQuery("#tb-endscreen-studio-templates-select").find("option").remove();if(e){i=jQuery.parseJSON(s);if(i.length>0){jQuery("#tb-endscreen-studio-templates-select").empty();jQuery.each(i,function(){jQuery("#tb-endscreen-studio-templates-select").append(jQuery("<option></option>").text(this.EndScreenTemplateName).val(this.Id))});jQuery("#tb-endscreen-studio-templates-loading-container").hide();jQuery("#tb-endscreen-studio-templates-none").hide();jQuery("#tb-endscreen-studio-templates-apply-container").show();u()}else{jQuery("#tb-endscreen-studio-templates-loading-container").hide();jQuery("#tb-endscreen-studio-templates-none").show();jQuery("#tb-endscreen-studio-templates-apply-container").hide();jQuery("#tb-endscreen-studio-templates-apply").hide()}}}catch(e){jQuery("#tb-endscreen-studio-templates-loading-container").hide();jQuery("#tb-endscreen-studio-templates-none").show();jQuery("#tb-endscreen-studio-templates-apply-container").hide();jQuery("#tb-endscreen-studio-templates-apply").hide();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] refreshTemplates"})}},null)};var m=function(e,i){if(t.videoEndscreenData.videoDurationMs<25e3){v("End screens can only be created on videos that are at least 25 seconds long.");return}try{TBUtilities.AddAction({EndScreenElementCount:e.length},TBUtilities.ActionTypes.EndScreenTemplates_Apply,"endscreentemplates")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenTemplates] [applyEndScreenElements]"})}var s=[];jQuery.each(e,function(e,i){var n=jQuery("div[data-element-default-id='"+i.id+"']");var r=jQuery.extend({},i);f(r,n);TBUtilities.AdjustEndScreenElementTiming(r,o.videoEndscreenData,t.videoEndscreenData);s.push(r)});var n=false;jQuery.each(i,function(e,t){n=true;t.existing=true;s.push(t)});var r=TBUtilities.ValidateEndscreenElements(s);if(r!==""){v(r)}else{TubeBuddyYouTubeActions.CopyEndScreenElementsStudio(t.videoId,t.videoEndscreenData.endscreenStartMs,s,n).then(function(){h()}).catch(function(e){v(e)})}};var h=function(){var e=TBUtilities.GetParameterByName("d");if(document.URL.indexOf("endscreen")>0||document.URL.indexOf("editor")>0||document.URL.indexOf("video")>0&&document.URL.indexOf("edit")>0){TBUtilities.Confirm("Success! \n\n In order for your End Screen Elements to show up, we need to re-load the page. Any unsaved changes on this page will be lost. \n\nShould we reload now?",g,function(){jQuery("#tb-endscreen-studio-templates-close, .tb-module-close").trigger("click")})}else if(e&&e==="ud"){TBUtilities.Alert("End Screen Elements successfully applied! \n\n In order for your End Screen Elements to show up, you'll need to complete the upload process and refresh the page.",function(){jQuery("#tb-endscreen-templates-close, .tb-module-close").trigger("click")})}else{TBUtilities.Alert("End Screen Elements successfully applied!",function(){jQuery("#tb-endscreen-studio-templates-close, .tb-module-close").trigger("click")})}};var v=function(e){jQuery("#tb-endscreen-studio-templates-working").hide();jQuery("#tb-endscreen-studio-templates-apply").show();var t="Failed to apply End Screen Elements! ";if(e&&e.length>0){t+=e}TBUtilities.Alert(t,function(){})};var f=function(e,t){TBUtilities.Log("copyFromTemplateToElement before");TBUtilities.Log(e);switch(e.type){case"CHANNEL":{if(e.channelEndscreenElement.isSubscribe){}else{var i=jQuery(t).find(".tb-endscreen-studio-template-elementType-channel-channelurl").val();var s=TBUtilities.ParseChannelIdFromUrl(i);e.channelEndscreenElement.channelId=s;e.channelEndscreenElement.metadata=jQuery(t).find(".tb-endscreen-studio-template-elementType-channel-custom-message").val()}break}case"WEBSITE":{e.websiteEndscreenElement.title=jQuery(t).find(".tb-endscreen-studio-template-elementType-website-title").val();e.websiteEndscreenElement.targetUrl=jQuery(t).find(".tb-endscreen-studio-template-elementType-website-url").val();break}case"VIDEO":{switch(e.videoEndscreenElement.videoType){case"VIDEO_TYPE_RECENT_UPLOAD":{break}case"VIDEO_TYPE_FIXED":{var n=jQuery(t).find(".tb-endscreen-studio-template-elementType-fixed-url").val();var r=TBUtilities.ParseVideoIdFromUrl(n);if(r!=null){e.videoEndscreenElement.encryptedVideoId=r}break}case"VIDEO_TYPE_BEST_FOR_VIEWER":{break}}break}case"PLAYLIST":{var a=jQuery(t).find(".tb-endscreen-studio-template-elementType-playlist-url").val();var o=TBUtilities.ParsePlaylistIdFromUrl(a);if(o!=null){e.playlistEndscreenElement.playlistId=o}break}case"MERCH":{break}}TBUtilities.Log("copyFromTemplateToElement after");TBUtilities.Log(e)};var g=function(){location.reload()};return{Show:function(t,i,o,u){if(TBGlobal.IsAuthenticated()){s=t;n=i;r=o;a=u?u:null;if(!e){d();l();e=true}else if(e&&(u&&jQuery(".tb-endscreen-studio-templates-modal").length===0)){d()}else{c(s,n,r)}}}}}();var TubeBuddyEndScreenUpdate=function(){var e={method:3,specificVideoIds:[],specificVideos:[],playlistId:"",validPlaylistIds:[],search:"",selectedVideo:{},currentVideo:null,isStopped:false,failedVideos:[],step:1,videosWithFoundElements:[],destinationVideos:[],hasFinished:false,errorCount:0,successCount:0,totalDestinationVideos:0,actionElementCount:0,imageConversionDic:{},searchQueue:[]};var t=false;var i=function(){var e=chrome.extension.getURL("modules/endscreensupdate.html");TBExtension.Get(e,function(e,t,i){try{if(e){i=TBUtilities.FixLocalHtml(DOMPurify.sanitize(i,DOMPurifyConfig));jQuery("body").append(i);j()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndscreensStudio] loadHtml"})}})};var s=function(){jQuery(document).on("click","#tb-endscreens-update-error-copy-container",function(){jQuery(this).attr("src","https://www.tubebuddy.com/images/icons/check.png");window.setTimeout(function(){jQuery("#tb-endscreens-update-error-copy").attr("src","https://www.tubebuddy.com/images/icons/copy.png")},1500)});jQuery(document).on("click","#tb-endscreens-update-onlyLoadFirstPage",function(e){if(jQuery(this).is(":checked")){jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").prop("disabled",false)}else{jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").prop("disabled",true)}});jQuery(document).on("change",".tb-endscreens-update-elementtype-select",function(){try{var e=jQuery(".tb-endscreens-update-elementtype-select").val();switch(e){case"video":{jQuery(".tb-endscreens-update-cardtype-video").show();jQuery(".tb-endscreens-update-cardtype-link").hide();jQuery(".tb-endscreens-update-cardtype-playlist").hide();jQuery(".tb-endscreens-update-target-select").val("videoUrl");jQuery(".tb-endscreens-update-cardtype-video-container").show();jQuery(".tb-endscreens-update-cardtype-link-container").hide();jQuery(".tb-endscreens-update-action-option-playlistorvideourl").text("Set Video URL to");break}case"playlist":{jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-playlist").show();jQuery(".tb-endscreens-update-cardtype-link").hide();jQuery(".tb-endscreens-update-target-select").val("playlistUrl");jQuery(".tb-endscreens-update-cardtype-video-container").show();jQuery(".tb-endscreens-update-cardtype-link-container").hide();jQuery(".tb-endscreens-update-action-option-playlistorvideourl").text("Set Playlist URL to");break}case"link":{jQuery(".tb-endscreens-update-cardtype-playlist").hide();jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-link").show();jQuery(".tb-endscreens-update-target-select").val("url");jQuery(".tb-endscreens-update-cardtype-video-container").hide();jQuery(".tb-endscreens-update-cardtype-link-container").show();break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-endscreens-update-imagefile"})}});jQuery(document).on("change","#tb-endscreens-update-imagefile-input",function(){try{var e=jQuery(".tb-endscreens-update-imagefile").val().split(".").pop().toLowerCase();if(jQuery.inArray(e,["gif","png","jpg","jpeg"])===-1){TBUtilities.Alert("Invalid image file type.  Only .gif, .png, and .jpg are allowed");jQuery(".tb-endscreens-update-imagefile").val("");return}jQuery("#tb-endscreens-update-uploaded-file").text(jQuery(".tb-endscreens-update-imagefile").val().split("\\")[2]).show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [change] tb-endscreens-update-imagefile"})}});jQuery(document).on("change",".tb-endscreens-update-filter",function(){jQuery(".tb-endscreens-update-destination-row").show();switch(jQuery(this).val()){case"all":break;case"public":jQuery('.tb-endscreens-update-destination-row[data-privacy="private"]').hide();jQuery('.tb-endscreens-update-destination-row[data-privacy="unlisted"]').hide();break;case"unlisted":jQuery('.tb-endscreens-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-update-destination-row[data-privacy="private"]').hide();break;case"private":jQuery('.tb-endscreens-update-destination-row[data-privacy="public"]').hide();jQuery('.tb-endscreens-update-destination-row[data-privacy="unlisted"]').hide();break;case"publicunlisted":jQuery('.tb-endscreens-update-destination-row[data-privacy="private"]').hide();break;case"privateunlisted":jQuery('.tb-endscreens-update-destination-row[data-privacy="public"]').hide();break}jQuery(".tb-endscreens-update-destination-selected-count").text(jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length)});jQuery(document).on("click",".tb-endscreens-update-destination-row",function(){try{if(!jQuery(this).hasClass("tb-endscreens-destination-row--selected")){jQuery(this).addClass("tb-endscreens-destination-row--selected");if(!TBGlobal.CanAccessLevel2Tools()&&jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length>1){jQuery(this).removeClass("tb-endscreens-destination-row--selected");TBGlobal.ShowUpgradePage("update End Screen Elements in bulk (more than 1 video at a time)","bulkupdateendscreens");return}}else{jQuery(this).removeClass("tb-endscreens-destination-row--selected")}var t=y();e.actionElementCount=t;jQuery(".tb-endscreens-update-destination-selected-count").text(t);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length);jQuery(".tb-endscreens-update-count").text(t);if(jQuery(".tb-endscreens-update-count").text()=="1")jQuery(".tb-endscreens-update-count-s").hide();else jQuery(".tb-endscreens-update-count-s").show()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateCards] [click] tb-endscreens-update-checkbox-include"})}});jQuery(document).on("click",".tb-endscreens-update-select-all-checkboxes",function(){if(!TBGlobal.CanAccessLevel2Tools()){TBGlobal.ShowUpgradePage("update end screen elements in bulk (more than 1 video at a time)","bulkupdateendscreens");return}jQuery(".tb-endscreens-update-destination-row").addClass("tb-endscreens-destination-row--selected");var e=y();jQuery(".tb-endscreens-update-destination-selected-count").text(e);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length);jQuery(".tb-endscreens-update-count").text(e);if(jQuery(".tb-endscreens-update-count").text()=="1")jQuery(".tb-endscreens-update-count-s").hide();else jQuery(".tb-endscreens-update-count-s").show()});jQuery(document).on("click",".tb-endscreens-update-select-no-checkboxes",function(){jQuery(".tb-endscreens-update-destination-row").removeClass("tb-endscreens-destination-row--selected");var e=y();jQuery(".tb-endscreens-update-destination-selected-count").text(e);jQuery(".tb-endscreens-update-destination-total-count").text(jQuery(".tb-endscreens-destination-row").filter(":visible").length);jQuery(".tb-endscreens-update-count").text(e);if(jQuery(".tb-endscreens-update-count").text()=="1")jQuery(".tb-endscreens-update-count-s").hide();else jQuery(".tb-endscreens-update-count-s").show()});jQuery(document).on("click","input[name=tb-endscreens-update-target-option]",function(){jQuery(".tb-endscreens-update-target-input").prop("disabled",true);jQuery(".tb-endscreens-update-target-input").val("");jQuery(this).siblings(".tb-endscreens-update-target-input:first").prop("disabled",false)});jQuery(document).on("click",".tb-endscreens-update-action-option",function(){var e=jQuery(this).is(":checked");if(e){if(jQuery(this).hasClass("tb-endscreens-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-endscreens-update-imagefile:first").prop("disabled",false)}else{jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").prop("disabled",false);jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").val("")}}else{if(jQuery(this).hasClass("tb-endscreens-update-action-image")){jQuery(this).parent().parent().parent().find(".tb-endscreens-update-imagefile:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-endscreens-update-imagefile:first").val("")}else{jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").prop("disabled",true);jQuery(this).parent().parent().parent().find(".tb-endscreens-update-action-input:first").val("")}}});jQuery(document).on("click","#tb-endscreens-update-close, #tb-endscreens-update-cancel, .tb-endscreens-update-closex",function(){try{TubeBuddyMenu.HideBackground();jQuery("#tb-endscreens-update-container").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [click] tb-endscreens-close"})}});jQuery(document).on("click",".tb-endscreens-update-continue",function(){try{switch(e.step){case 1:{if(jQuery(".tb-endscreens-update-target-input-field").val()===""){TBUtilities.Alert("Enter your search criteria");return}var t=jQuery(".tb-endscreens-update-elementtype-select").val();var i=n();switch(t){case"playlist":case"video":{try{if(i.find(".tb-endscreens-update-action-video").is(":checked")===false){TBUtilities.Alert("Please choose at least one update to make");return}var s;var a;if(i.find(".tb-endscreens-update-action-video").is(":checked")){var o=i.find(".tb-endscreens-update-action-video-input").val();a=B(o);if(!a){s=Q(o)}if(!s&&a==false){TBUtilities.Alert("Invalid video id or playlist id to set to.  Make sure you have a valid YouTube URL");return}}var d=jQuery(".tb-endscreens-update-target-input-field").val();var l=B(d);var c;if(!l){c=Q(d)}if(!c&&l==false){TBUtilities.Alert("Invalid video id or playlist id to search for.  Make sure you have a valid YouTube URL");return}if(i.find(".tb-endscreens-update-action-image").is(":checked")&&i.find(".tb-endscreens-update-imagefile").val()===""){TBUtilities.Alert("Select an IMAGE FILE");return}var u=jQuery(".tb-endscreens-update-target-select").val();switch(u){case"playlistUrl":{var p=B(d);if(!p){TBUtilities.Alert("Invalid playlist.  Make sure the playlist you're trying to search for is a valid playlist URL.");return}break}case"videoUrl":{var y=Q(d);if(!y){TBUtilities.Alert("Invalid video.  Make sure the video you're trying to search for is a valid video URL.");return}break}}var m=jQuery(".tb-endscreens-update-action-video-input").val();switch(u){case"playlistUrl":{var p=B(m);if(!p){TBUtilities.Alert("Invalid playlist.  Make sure the playlist you're trying to set is a valid playlist URL.");return}break}case"videoUrl":{var y=Q(m);if(!y){TBUtilities.Alert("Invalid video.  Make sure the video you're trying to set is a valid video URL.");return}break}}r(2)}catch(e){TBUtilities.Alert("Invalid video id or playlist id.  Make sure you have a valid YouTube URL")}break}case"link":{if(i.find(".tb-endscreens-update-action-title").is(":checked")==false&&i.find(".tb-endscreens-update-action-url").is(":checked")==false&&i.find(".tb-endscreens-update-action-image").is(":checked")==false){TBUtilities.Alert("Please choose at least one update to make");return}if(i.find(".tb-endscreens-update-action-title").is(":checked")&&i.find(".tb-endscreens-update-action-title-input").val()==""){TBUtilities.Alert("Enter a TITLE");return}if(i.find(".tb-endscreens-update-action-url").is(":checked")&&i.find(".tb-endscreens-update-action-url-input").val()==""){TBUtilities.Alert("Enter a URL");return}if(i.find(".tb-endscreens-update-action-image").is(":checked")&&i.find(".tb-endscreens-update-imagefile").val()==""){TBUtilities.Alert("Select an image to upload");return}r(2);break}}break}case 2:{switch(parseInt(e.method)){case 0:if(e.specificVideoIds.length==0){jQuery("#tb-endscreens-input-ids-status").css("color","red");jQuery("#tb-endscreens-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-input-ids-status").show();TBUtilities.Alert("You must enter a list of 1 or more valid Video IDs (or change you selection method above)");return}if(!TBGlobal.CanAccessLevel2Tools()&&e.specificVideoIds.length>1){TBGlobal.ShowUpgradePage("update End Screen Elements in bulk (more than 1 video at a time)","bulkupdateendscreens");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Video IDs "+JSON.stringify(e.specificVideoIds));f();break;case 1:var h=jQuery("#tb-endscreens-update-input-playlist").playlistSelect().data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();var v=h.getSelectedPlaylistIds();if(v.length>0){e.playlistId=v.join(",")}if(v.length>=2){TBUtilities.Alert("Please select only one playlist");return}if(e.playlistId===""){h.showValidationWarning();TBUtilities.Alert("You must enter a valid Playlist ID (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Playlist ["+e.playlistId+"]");TBYouTubeApi.GetPlaylistVideos(e.playlistId,null,b,T);break;case 2:if(e.search==""){TBUtilities.Alert("You must enter a Search Term (or change you selection method above)");return}TBGlobal.AddUserDebugInfo("Video Selection Method: Search ["+e.search+"]");jQuery("#tb-endscreens-destination").show();TBYouTubeApi.GetChannelVideosSearch(e.search,null,b,T);break;case 3:TBGlobal.AddUserDebugInfo("Video Selection Method: All");var g=null;if(jQuery("#tb-endscreens-update-onlyLoadFirstPage").is(":checked")){var j=/^\+?\d+$/.test(jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").val());if(j==false){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}g=parseInt(jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").val());if(g<=0){TBUtilities.Alert("Please enter a valid number for the number of videos to load");return}}TBYouTubeApi.GetChannelVideos(TBGlobal.CurrentChannelId(),null,b,T,g,null,e.selectedVideo.id);break}jQuery(".tb-endscreens-update-loading-count").text("0");jQuery(".tb-endscreens-update-loading-count-total").text("?");jQuery(".tb-endscreens-update-loading-text").text("Loading your videos...");jQuery(".tb-endscreens-update-loading-text-search").text("");jQuery(".tb-endscreens-update-loading-videos").show();jQuery(".tb-endscreens-loading-count-container").show();jQuery(".tb-endscreens-update-no-videos").hide();r(3);break}case 3:{if(jQuery(".tb-endscreens-destination-row--selected").filter(":visible").length===0){TBUtilities.Alert("Please select at least 1 video to update end screen elements.");return}e.destinationVideos=[];jQuery(".tb-endscreens-destination-row--selected").filter(":visible").each(function(){var t=jQuery(this).attr("data-video-id");jQuery.each(e.videosWithFoundElements,function(i,s){if(s.id===t){var n=TBUtilities.GetInArray(e.destinationVideos,"id",t);if(!n){e.destinationVideos.push(s)}}})});jQuery("#tb-endscreens-update-queue-list").empty();jQuery("#tb-endscreens-update-completed-list").empty();if(e.destinationVideos.length>=2e3){jQuery("#tb-endscreens-update-2k-warning").show()}else{jQuery("#tb-endscreens-update-2k-warning").hide()}r(4);break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [click] #tb-endscreens-continue, #tb-endscreens-kickoff"})}});jQuery(document).on("click",".tb-endscreens-update-kickoff",function(){if(!jQuery(".tb-endscreens-update-confirm-checkbox").is(":checked")){TBUtilities.Alert("Please check the box confirming that you want to update the end screen elements");return}const t=TBGlobal.GetToolById("bulkupdateendscreens").name;TBUtilities.ReportProductEvent("Feature Applied",{Tool:t,Action:`Updating end screens`});try{TBUtilities.AddAction({VideoCount:e.videosWithFoundElements.length,CardCount:e.actionElementCount,Data:"method = "+e.method},TBUtilities.ActionTypes.BulkUpdateEndScreens_Update,"bulkupdateendscreens")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyUpdateEndScreens] [addAction]"})}jQuery(".tb-endscreens-update-status").show();jQuery(".tb-endscreens-update-confirm").hide();jQuery("#tb-endscreens-update-stop").show();jQuery(".tb-endscreens-update-cancel").hide();jQuery(".tb-endscreens-update-back").hide();jQuery(".tb-endscreens-update-kickoff").hide();jQuery(".tb-endscreens-update-continue").hide();jQuery("#tb-endscreens-update-close").hide();jQuery(".tb-endscreens-update-step-number").text("- Processing");a(function(){d();l()})});jQuery(document).on("click",".tb-endscreens-update-back",function(){if(e.step>1){var t=e.step;e.step=e.step-1;r(e.step,t)}});jQuery(document).on("click","#tb-endscreens-update-method-ids, #tb-endscreens-update-method-playlist, #tb-endscreens-update-method-search, #tb-endscreens-update-method-full",function(t){e.method=parseInt(jQuery(this).attr("data-method"));var i=jQuery("#tb-endscreens-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(t){e.playlistId=t}}).data("plugin_playlistSelect");switch(e.method){case 0:jQuery("#tb-endscreens-update-input-ids").removeAttr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").attr("disabled","disabled");i.disable();break;case 1:jQuery("#tb-endscreens-update-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").removeAttr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").attr("disabled","disabled");i.enable();i.showDropDown();break;case 2:jQuery("#tb-endscreens-update-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").removeAttr("disabled","disabled");i.disable();break;case 3:jQuery("#tb-endscreens-update-input-ids").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-playlist").attr("disabled","disabled");jQuery("#tb-endscreens-update-input-search").attr("disabled","disabled");i.disable();break}});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-update-input-playlist",function(t){e.playlistId="";var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-endscreens-update-input-playlist-status").hide();return}if(i.indexOf("list=")>0){i=i.substring(i.indexOf("list=")+5)}if(i.length!=18&&i.length!=34||i.substring(0,2)!="PL"){jQuery("#tb-endscreens-update-input-playlist-status").text("Invalid Playlist Id");jQuery("#tb-endscreens-update-input-playlist-status").css("color","red")}else{jQuery("#tb-endscreens-update-input-playlist-status").text("Valid Playlist Id");jQuery("#tb-endscreens-update-input-playlist-status").css("color","green");e.playlistId=i}jQuery("#tb-endscreens-update-input-playlist-status").show()});jQuery(document).on("click",".playlistSelectTypeManual",function(){var t=jQuery(this).parents(".playlistSelect").find(".playlistSelectMutliSelectListItem").find("input");t.each(function(t,i){e.validPlaylistIds.push(jQuery(i).val())})});jQuery(document).on("keyup",".playlistSelectManualIds",function(){var t=jQuery(this).val();if(e.validPlaylistIds.indexOf(t)==-1){jQuery("#tb-playlist-select-manual-id-invalid").show()}else{jQuery("#tb-playlist-select-manual-id-invalid").hide()}});jQuery(document).on("click",".playlistSelectTypeList",function(){jQuery("#tb-playlist-select-manual-id-invalid").hide()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-update-input-search",function(t){e.search=jQuery(this).val().trim()});jQuery(document).on("click","#tb-endscreens-update-stop",function(){e.isStopped=true;jQuery("#tb-endscreens-update-stop").hide();jQuery("#tb-endscreens-update-close").show();jQuery("#tb-endscreens-update-working").hide();jQuery("#tb-endscreens-update-stopped").show()});jQuery(document).on("change keypress keyup paste keydown blur","#tb-endscreens-update-input-ids",function(t){var i=jQuery(this).val().trim();i=TBUtilities.ReplaceAll(i,'"',"");if(i.length==0){jQuery("#tb-endscreens-update-input-ids-status").hide();return}jQuery("#tb-endscreens-update-input-ids-status").show();e.specificVideoIds=[];if(i.indexOf(",")>-1){e.specificVideoIds=i.split(",")}else{e.specificVideoIds=i.split(" ")}for(var s=0;s<e.specificVideoIds.length;s++){e.specificVideoIds[s]=e.specificVideoIds[s].trim();e.specificVideoIds[s]=e.specificVideoIds[s].replace("https://www.youtube.com/watch?v=","");e.specificVideoIds[s]=e.specificVideoIds[s].replace("https://youtu.be/","");if(e.specificVideoIds[s].length!=11){e.specificVideoIds.splice(s,1);s--}}if(e.specificVideoIds.length==0){jQuery("#tb-endscreens-update-input-ids-status").text("No videos detected");jQuery("#tb-endscreens-update-input-ids-status").css("color","red")}else if(e.specificVideoIds.length==1){jQuery("#tb-endscreens-update-input-ids-status").text("1 video detected");jQuery("#tb-endscreens-update-input-ids-status").css("color","green");jQuery("#tb-endscreens-update-method-ids").prop("checked",true);jQuery("#tb-endscreens-update-method-ids").trigger("click")}else{jQuery("#tb-endscreens-update-input-ids-status").text(e.specificVideoIds.length+" videos detected");jQuery("#tb-endscreens-update-input-ids-status").css("color","green");jQuery("#tb-endscreens-update-method-ids").prop("checked",true);jQuery("#tb-endscreens-update-method-ids").trigger("click")}})};var n=function(){var e=jQuery(".tb-endscreens-update-elementtype-select").val();var t=null;switch(e){case"playlist":case"video":{t=jQuery(".tb-endscreens-update-cardtype-video-container");break}case"link":{t=jQuery(".tb-endscreens-update-cardtype-link-container");break}}return t};var r=function(t,i){try{jQuery(".tb-endscreens-update-step1").hide();jQuery(".tb-endscreens-update-step2").hide();jQuery(".tb-endscreens-update-step3").hide();jQuery(".tb-endscreens-update-step4").hide();jQuery(".tb-endscreens-update-kickoff").hide();jQuery(".tb-endscreens-update-continue").hide();jQuery(".tb-endscreens-update-back").hide();jQuery("#tb-endscreens-update-stop").hide();jQuery("#tb-endscreens-done-close").hide();jQuery(".tb-endscreens-update-step-number").text("- Step "+t);switch(t){case 1:{jQuery(".tb-endscreens-update-step1").show();jQuery(".tb-endscreens-update-continue").show();e.step=1;break}case 2:{e.specificVideoIds=[];e.specificVideos=[];e.playlistId="";e.search="";jQuery(".tb-endscreens-update-step2").show();jQuery(".tb-endscreens-update-continue").show();jQuery(".tb-endscreens-update-back").show();jQuery("#tb-endscreens-update-input-ids").val("");jQuery("#tb-endscreens-update-input-playlist").val("");jQuery("#tb-endscreens-update-input-search").val("");jQuery("#tb-endscreens-update-input-ids-status").empty();jQuery("#tb-endscreens-update-input-playlist-status").empty();var s=jQuery("#tb-endscreens-update-input-playlist").playlistSelect({tbMaterial:true,singleSelectMode:true,onSelect:function(t){e.playlistId=t}}).data("plugin_playlistSelect");jQuery(".tb-playlist-select-manual-id-invalid").hide();jQuery("#tb-endscreens-input-playlist").find(".tb-material-input").addClass("tb-bulk-input");jQuery("#tb-endscreens-input-playlist").find(".tb-material-radio-label").addClass("tb-bulk-radio-label");e.method&&e.method==1?s.enable():s.disable();e.step=2;break}case 3:{jQuery(".tb-endscreens-update-step3").show();jQuery(".tb-endscreens-update-continue").show();jQuery(".tb-endscreens-update-back").show();if(i&&i==4){TBUtilities.Log("back step 3")}else{jQuery(".tb-endscreens-update-destination-list").empty();jQuery(".tb-endscreens-update-destination-list").hide();jQuery(".tb-endscreens-update-destination-selected-count").text("0");jQuery(".tb-endscreens-update-destination-total-count").text("0");jQuery(".tb-endscreens-update-count").text("0")}e.step=3;break}case 4:{jQuery(".tb-endscreens-update-step4").show();jQuery(".tb-endscreens-update-continue").hide();jQuery(".tb-endscreens-update-kickoff").show();jQuery(".tb-endscreens-update-back").show();jQuery(".tb-endscreens-update-confirm").show();jQuery(".tb-endscreens-update-status").hide();jQuery(".tb-endscreens-update-continue").hide();e.step=4;break}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] showstep "})}};var a=function(t){var i=jQuery(".tb-endscreens-update-elementtype-select").val();var s=n();jQuery.each(e.destinationVideos,function(e,t){var n=v(t.endscreen.elements);jQuery.each(t.endscreen.elements,function(e,t){t.existing=true;var r=n.find(e=>e.id===t.id);if(r){switch(i){case"video":{if(t.type=="VIDEO"&&t.videoEndscreenElement.videoType=="VIDEO_TYPE_FIXED"){var a=Q(s.find(".tb-endscreens-update-action-video-input").val());if(a){t.videoEndscreenElement.encryptedVideoId=a;t.updated=true}}break}case"playlist":{if(t.type==="PLAYLIST"){var o=B(s.find(".tb-endscreens-update-action-video-input").val());if(o){t.playlistEndscreenElement.playlistId=o;t.updated=true}var d=Q(s.find(".tb-endscreens-update-action-video-input").val());if(d){t.playlistEndscreenElement.playlistId=d;t.updated=true}}break}case"link":{if(t.type==="WEBSITE"){if(s.find(".tb-endscreens-update-action-url").is(":checked")&&s.find(".tb-endscreens-update-action-url-input").val()!==""){t.websiteEndscreenElement.targetUrl=s.find(".tb-endscreens-update-action-url-input").val();t.updated=true}if(s.find(".tb-endscreens-update-action-title").is(":checked")&&s.find(".tb-endscreens-update-action-title-input").val()!==""){t.websiteEndscreenElement.title=s.find(".tb-endscreens-update-action-title-input").val();t.updated=true}if(s.find(".tb-endscreens-update-action-image").is(":checked")){t.updated=true}}break}}}})});o(s).then(function(){let i=[];jQuery.each(e.destinationVideos,function(e,t){jQuery.each(t.endscreen.elements,function(e,t){switch(t.type){case"WEBSITE":{if(t.websiteEndscreenElement.customUploadedImage&&t.websiteEndscreenElement.customUploadedImage.url){i.push(t.websiteEndscreenElement.customUploadedImage.url)}break}}})});TBUtilities.ConvertImagesToDataUrls(i).then(function(i){jQuery.each(e.destinationVideos,function(e,t){jQuery.each(t.endscreen.elements,function(e,t){switch(t.type){case"WEBSITE":{if(t.websiteEndscreenElement.customUploadedImage&&t.websiteEndscreenElement.customUploadedImage.url){if(!t.websiteEndscreenElement.updatedImage){let e=i.find(e=>e.url===t.websiteEndscreenElement.customUploadedImage.url);if(e){t.websiteEndscreenElement.imageDataUrl=e.dataUrl;delete t.websiteEndscreenElement["customUploadedImage"];delete t.websiteEndscreenElement["icon"];delete t.websiteEndscreenElement["crossDomainRedirect"];delete t.websiteEndscreenElement["ytAbuseUrlSafe"]}}else{delete t.websiteEndscreenElement["updatedImage"]}}break}}})});t()}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [updateEndScreenProperties]"})})}).catch(function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [updateEndScreenProperties]"})})};var o=function(t){return new Promise(function(i,s){if(t.find(".tb-endscreens-update-action-image").is(":checked")){var n=jQuery(".tb-endscreens-update-imagefile")[0].files[0];var r=new FileReader;r.readAsDataURL(n);r.onload=function(){var t=r.result.split(",")[1];jQuery.each(e.destinationVideos,function(e,i){jQuery.each(i.endscreen.elements,function(e,i){if(i.type==="WEBSITE"&&i.updated&&i.updated===true){i.websiteEndscreenElement.imageDataUrl=t;delete i.websiteEndscreenElement["customUploadedImage"];delete i.websiteEndscreenElement["icon"];delete i.websiteEndscreenElement["crossDomainRedirect"];delete i.websiteEndscreenElement["ytAbuseUrlSafe"]}})});i()};r.onerror=function(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [updateUploadedImages]"});i()}}else{i()}})};var d=function(){TBUtilities.Log("startProcessing");try{e.totalDestinationVideos=e.destinationVideos.length;e.hasFinished=false;e.errorCount=0;e.successCount=0;jQuery("#tb-endscreens-update-update-queue-list").empty();jQuery("#tb-endscreens-update-completed-list").empty();jQuery("#tb-endscreens-update-queue-list2").empty();jQuery("#tb-endscreens-update-completed-list2").empty();jQuery("#tb-endscreens-update-error-list2").empty();jQuery("#tb-endscreens-update-error-list2").hide();jQuery("#tb-endscreens-update-error-none-list2").show();jQuery("#tb-endscreens-update-working").show();jQuery("#tb-endscreens-update-done").hide();jQuery("#tb-endscreens-done-close").hide();jQuery("#tb-endscreens-update-stopped").hide()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [startProcessing]"})}};var l=function(){TBUtilities.Log("processNextVideo");try{jQuery("#tb-endscreens-update-progress-container").html("Start &rarr;");if(e.isStopped)return;if(e.destinationVideos.length==0&&e.hasFinished==false){e.hasFinished=true;var t="<b>"+e.totalDestinationVideos+"</b> of <b>"+e.totalDestinationVideos+"</b> videos complete";jQuery("#tb-endscreens-update-status-count").html(DOMPurify.sanitize(t,DOMPurifyConfig));jQuery("#tb-endscreens-update-progress-container").hide();if(e.currentVideo){if(!e.currentVideo.error)u(e.currentVideo.video);else p(e.currentVideo.video)}c();jQuery("#tb-endscreens-update-working").hide();jQuery("#tb-endscreens-update-done").show();jQuery("#tb-endscreens-done-close").show();jQuery("#tb-endscreens-update-stop").hide();jQuery("#tb-endscreens-update-close").show();return}var i=e.destinationVideos[0].id;if(e.currentVideo){if(!e.currentVideo.error)u(e.currentVideo.video);else p(e.currentVideo.video)}var s=TBUtilities.RemoveFromArray(e.destinationVideos,"id",i);e.currentVideo=s[0];e.imageConversionDic={};var t="<b>"+parseInt(e.totalDestinationVideos-e.destinationVideos.length)+"</b> of <b>"+e.totalDestinationVideos+"</b> videos complete";jQuery("#tb-endscreens-update-status-count").html(DOMPurify.sanitize(t,DOMPurifyConfig));var t=jQuery("#tb-endscreens-update-progress-container").html()+' Id: <a style="font-weight:normal" target="_blank" href="https://www.youtube.com/watch?v='+i+'">'+i+"</a>";jQuery("#tb-endscreens-update-progress-container").html(DOMPurify.sanitize(t,DOMPurifyConfig));c();TBGlobal.AddUserDebugInfo("Updating elements for video: "+e.currentVideo.id);TubeBuddyYouTubeActions.CopyEndScreenElementsStudio(i,e.currentVideo.endscreen.startMs,e.currentVideo.endscreen.elements).then(function(){jQuery("#tb-endscreens-update-progress-container").html(jQuery("#tb-endscreens-update-progress-container").html()+" Update Complete")}).catch(function(t){jQuery("#tb-endscreens-update-progress-container").html(jQuery("#tb-endscreens-update-progress-container").html()+" Error");e.currentVideo.error=t}).finally(function(){l()})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [processNextVideo]"});jQuery("#tb-endscreens-update-progress-container").html(jQuery("#tb-endscreens-update-progress-container").html()+"Error: "+e.message);TBUtilities.Alert('Sorry, there was an error: "'+e.message+'"');jQuery("#tb-endscreens-update-stop").trigger("click");jQuery("#tb-endscreens-update-stop").trigger("click")}};var c=function(){TBUtilities.Log("showNextToBeProcessed");jQuery("#tb-endscreens-update-queue-list2").empty();jQuery("#tb-endscreens-update-queue-complete-list2").hide();var t=0;jQuery.each(e.destinationVideos,function(e,i){var s=i.video.snippet.thumbnails.thumbnailMedium?i.video.snippet.thumbnails.thumbnailMedium:i.video.snippet.thumbnails.default.url;var n=jQuery(".tb-endscreens-update-processing-template2:last")[0].outerHTML;n=n.replace("#THUMBNAILURL#",s);n=TBUtilities.ReplaceAll(n,"#VIDEOID#",i.id);n=n.replace("#VIDEOTITLE#",i.video.snippet.title);n=n.replace("#HREF#","https://www.youtube.com/watch?v="+i.id);n=n.replace("display: none","display:flex");jQuery("#tb-endscreens-update-queue-list2").prepend(DOMPurify.sanitize(n,DOMPurifyConfig));t++;if(t==3)return false});if(t==0){jQuery("#tb-endscreens-update-queue-complete-list2").show();jQuery("#tb-endscreens-update-queue-list2").hide()}else{jQuery("#tb-endscreens-update-queue-list2").show()}};var u=function(t){TBUtilities.Log("addCompletedSuccess");var i=t.snippet.thumbnails.thumbnailMedium?t.snippet.thumbnails.thumbnailMedium:t.snippet.thumbnails.default.url;var s=jQuery(".tb-endscreens-update-processed-success:last")[0].outerHTML;s=s.replace("#THUMBNAILURL#",i);s=TBUtilities.ReplaceAll(s,"#VIDEOID#",t.id);s=s.replace("#VIDEOTITLE#",t.snippet.title);s=s.replace("#HREF#","https://studio.youtube.com/video/"+t.id+"/edit");s=s.replace("display:none","display:flex");jQuery("#tb-endscreens-update-completed-list2").prepend(s);jQuery("#tb-endscreens-update-completed-none-list2").hide();jQuery("#tb-endscreens-update-completed-list2").show();e.successCount++;jQuery("#tb-endscreens-update-completed-list2-count").text(TBUtilities.FormatNumberWithCommas(e.successCount))};var p=function(t){try{jQuery("#tb-endscreens-update-error-copy-container").show();var i=jQuery("#tb-endscreens-update-error-copy").attr("data-clipboard-text");var s=[];if(i!==""){s=i.split(",");if(s.indexOf(t.id)===-1){s.push(t.id)}}else{s.push(t.id)}jQuery("#tb-endscreens-update-error-copy").attr("data-clipboard-text",s.join(","))}catch(e){TBUtilities.Log("addCompletedError",e)}TBUtilities.Log("addCompletedError");var n=t.snippet.thumbnails.thumbnailMedium?t.snippet.thumbnails.thumbnailMedium:t.snippet.thumbnails.default.url;var r=jQuery(".tb-endscreens-update-processed-error:last")[0].outerHTML;r=r.replace("#THUMBNAILURL#",n);r=TBUtilities.ReplaceAll(r,"#VIDEOID#",t.id);r=r.replace("#VIDEOTITLE#",t.snippet.title);r=r.replace("#ERROR#",t.error);r=r.replace("#HREF#","https://studio.youtube.com/video/"+t.id+"/edit");r=r.replace("display:none","display:flex; flex-wrap:wrap;");jQuery("#tb-endscreens-update-error-list2").prepend(DOMPurify.sanitize(r,DOMPurifyConfig));jQuery("#tb-endscreens-update-error-list2").show();jQuery("#tb-endscreens-update-error-none-list2").hide();e.errorCount++;jQuery("#tb-endscreens-update-error-list2-count").text(TBUtilities.FormatNumberWithCommas(e.errorCount))};var y=function(){var t=0;jQuery(".tb-endscreens-destination-row--selected").filter(":visible").each(function(){var i=jQuery(this).attr("data-video-id");jQuery.each(e.videosWithFoundElements,function(e,s){if(s.id==i){t=t+s.searchResults.length}})});return t};var b=function(t){try{if(t==null){if(e.method==0)TBUtilities.Alert("No valid Video IDs found");else if(e.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(e.method==2)TBUtilities.Alert("No videos matching your search");else if(e.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery(".tb-endscreens-update-back").trigger("click");return}else if(t.length==0){if(e.method==0)TBUtilities.Alert("No valid Video IDs found");else if(e.method==1)TBUtilities.Alert("Invalid Playlist Id or no videos found in playlist");else if(e.method==2)TBUtilities.Alert("No videos matching your search");else if(e.method==3)TBUtilities.Alert("No videos found or failed to load. Try again.");jQuery(".tb-endscreens-update-back").trigger("click");return}jQuery(".tb-endscreens-update-destination-list").empty();jQuery(".tb-endscreens-update-destination-list").hide();jQuery(".tb-endscreens-update-no-videos").hide();jQuery(".tb-endscreens-update-loading-videos").show();jQuery(".tb-endscreens-update-loading-text").html("Hang Tight!<br /><br />We are currently looking through the videos you selected to find End Screen Elements that match your search criteria. This generally takes a couple seconds per video meaning it may take up to 30 minutes per 1,000 videos you have.");jQuery(".tb-endscreens-loading-count-container").hide();jQuery("tb-endscreens-update-loading-text-search").text("");e.videosWithFoundElements=[];e.searchQueue=[];jQuery.each(t,function(t,i){if(i.id.videoId!=null){i.id=i.id.videoId}if(i.snippet.resourceId!=null)i.id=i.snippet.resourceId.videoId;if(i.snippet!=null&&i.snippet.title=="Deleted video"&&i.snippet.thumbnails==null)return;e.searchQueue.push(i)});m()}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] [gotVideoList]"})}};var m=function(){if(e.searchQueue.length>0){var t=e.searchQueue.shift();TubeBuddyYouTubeActions.GetEndScreenListStudio(t.id).then(function(i){jQuery(".tb-endscreens-update-loading-text-search").html("Searching End Screen Elements for video https://youtube.com/watch?v="+t.id);if(i.elements&&i.elements.length>0){var s=v(i.elements);if(s.length>0){var n=TBUtilities.GetInArray(e.videosWithFoundElements,"id",t.id);if(!n){e.videosWithFoundElements.push({video:t,endscreen:i,searchResults:s,id:t.id,error:""});var r=jQuery("#tb-endscreens-update-destination-template").html();var a="matches";if(s.length==1){a="match"}var o=r.formatTemplate(t.id,t.snippet.thumbnails.default.url,"https://studio.youtube.com/video/"+t.id+"/edit",t.snippet.title,s.length,a,t.status.privacy);jQuery(".tb-endscreens-update-destination-list").prepend(o)}}}}).catch(function(e){TBUtilities.Log(e)}).finally(function(){if(e.searchQueue.length===0){h()}else{m()}})}else{h()}};var h=function(){jQuery(".tb-endscreens-update-loading-videos").hide();if(e.videosWithFoundElements.length==0){jQuery(".tb-endscreens-update-no-videos").show();jQuery(".tb-endscreens-update-destination-list").hide();jQuery(".tb-endscreens-update-continue").hide()}else{jQuery(".tb-endscreens-update-destination-total-count").text(e.videosWithFoundElements.length);jQuery(".tb-endscreens-update-destination-list").show();jQuery(".tb-endscreens-update-continue").show();if(e.method===0||e.method===1)jQuery(".tb-endscreens-update-select-all-checkboxes").trigger("click")}};var v=function(e){var t=jQuery(".tb-endscreens-update-target-select").val();var i=jQuery(".tb-endscreens-update-target-input-field").val().toUpperCase();var s=jQuery(".tb-endscreens-update-elementtype-select").val();TBUtilities.Log("searchField="+t);TBUtilities.Log("searchValue="+i);TBUtilities.Log("selectedElementType="+s);var n;var r;var a;if(s==="video"||s==="playlist"){a=jQuery(".tb-endscreens-update-target-select").val();n=B(jQuery(".tb-endscreens-update-target-input-field").val());r=Q(jQuery(".tb-endscreens-update-target-input-field").val())}TBUtilities.Log("listIdToSearch="+n);TBUtilities.Log("videoIdToSearch="+r);TBUtilities.Log("searchType="+a);TBUtilities.Log("selectedElementType="+s);var o=new Array;try{jQuery.each(e,function(e,t){TBUtilities.Log(t);switch(s){case"video":{if(t.type=="VIDEO"&&t.videoEndscreenElement.videoType=="VIDEO_TYPE_FIXED"){switch(a){case"videoUrl":{if(t.videoEndscreenElement.encryptedVideoId==r){o.push(t);return true}break}}}break}case"playlist":{if(t.type=="PLAYLIST"){switch(a){case"playlistUrl":{if(t.playlistEndscreenElement.playlistId==n){o.push(t);return true}break}}}break}case"link":{if(t.type=="WEBSITE"){if(t.websiteEndscreenElement.targetUrl&&t.websiteEndscreenElement.targetUrl.toUpperCase()===i){o.push(t);return true}else if(t.websiteEndscreenElement.title&&t.websiteEndscreenElement.title.toUpperCase()===i){o.push(t);return true}}break}}})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] searchElements"})}return o};var f=function(){var t=e.specificVideoIds[0];e.specificVideoIds.splice(0,1);TBYouTubeApi.GetVideoDetails(t,"contentDetails,snippet,id,status",g)};var g=function(t){if(t!=null)e.specificVideos.push(t);if(e.specificVideoIds.length>0){f()}else{b(e.specificVideos)}};var T=function(e){if(e.totalCount-e.loaded>50){jQuery(".tb-endscreens-update-loading-count").attr("data-auto-count",e.loaded);var t=e.totalCount;if(jQuery("#tb-endscreens-update-onlyLoadFirstPage").is(":checked")){t=parseInt(jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").val())}jQuery(".tb-endscreens-update-loading-count-total").text(t);TBUtilities.AutoIncrementCount(jQuery(".tb-endscreens-update-loading-count"))}else{jQuery(".tb-endscreens-update-rendering").show();jQuery(".tb-endscreens-update-loading-count-container").hide()}};var j=function(){try{jQuery("#tb-endscreens-update-error-copy-container").hide();jQuery("#tb-endscreens-update-error-copy").prop("data-clipboard-text","");jQuery("#tb-endscreens-update-uploaded-file").text("").hide();var t=new ClipboardJS("#tb-endscreens-update-error-copy");e.destinationVideos=[];e.videosWithFoundElements=[];e.specificVideos=[];e.currentVideo=null;e.is=false;jQuery('input[type="radio"][value="url"]').prop("checked",true);jQuery(".tb-endscreens-update-target-input").prop("disabled",true);jQuery(".tb-endscreens-update-target-url").prop("disabled",false);jQuery(".tb-endscreens-update-target-input").val("");jQuery(".tb-endscreens-update-action-input").val("");jQuery(".tb-endscreens-update-filter").val("all");jQuery(".tb-endscreens-update-action-input").prop("disabled",true);jQuery(".tb-endscreens-update-imagefile").val("");jQuery(".tb-endscreens-update-imagefile").prop("disabled",true);jQuery(".tb-endscreens-update-action-option").prop("checked","");jQuery(".tb-endscreens-kickoff").hide();jQuery(".tb-endscreens-update-confirm-checkbox").prop("checked","");jQuery(".tb-endscreens-update-no-videos").hide();jQuery(".tb-endscreens-update-loading-videos").show();jQuery(".tb-endscreens-update-loading-count").text("0");jQuery(".tb-endscreens-update-loading-count-total").text("?");jQuery(".tb-endscreens-update-loading-text-search").text("");jQuery(".tb-endscreens-update-loading-text").text("Loading your videos...");jQuery(".tb-endscreens-update-target-input-field").val("");jQuery(".tb-endscreens-update-action-video-input").val("");jQuery("#tb-endscreens-update-onlyLoadFirstPage-number").prop("disabled",true);jQuery("#tb-endscreens-update-onlyLoadFirstPage").prop("checked",false);jQuery(".tb-endscreens-update-elementtype-select").val("link");jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-playlist").hide();jQuery(".tb-endscreens-update-cardtype-link").show();jQuery(".tb-endscreens-update-target-select").val("url");jQuery(".tb-endscreens-update-cardtype-video-container").hide();jQuery(".tb-endscreens-update-cardtype-link-container").show();e.step=1;r(e.step);jQuery(".tb-endscreens-update-cardtype-video").hide();jQuery(".tb-endscreens-update-cardtype-link").show();jQuery("#tb-endscreens-update-container").show();jQuery(".tb-endscreens-update-action-option-playlistorvideourl").text("Set Video URL to")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyEndScreenUpdate] prepareDialog"})}};var Q=function(e){var t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;var i=e.match(t);return i&&i[7].length===11?i[7]:false};var B=function(e){var t=/list=([a-zA-Z0-9\-\_]+)&?/;var i=e.match(t);var s=i?i[1]:false;return s};return{Show:function(){if(TBGlobal.IsAuthenticated()){if(!t){i();s();t=true}else{j()}}}}}();var TubeBuddyTagLists=function(){var e=false;var t=false;var i;var s=true;var n=null;var r=null;var a=false;var o=function(){var e=TBGlobal.host+"/ModuleManager/TagLists/TagLists?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/taglists.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/taglists.html"}TBExtension.Get(e,"CRTBLoadTagListsTemplate")};var d=function(){var e=jQuery(".tb-tag-list-tag-input").val();if(!e){TBUtilities.Alert("Please enter a Tag to add to your list.");return}var t={ListId:jQuery(".tb-tag-lists-select").val(),Tag:e};var i=TBGlobal.host+TBGlobal.apiUrls.taglistsAddTag;TBExtension.Post(i,JSON.stringify(t),"CRTBTagListAddTag",null,{contentType:"application/json"})};var l=function(){var e=jQuery(".tb-tag-lists-select").val();var t=jQuery(".tb-tag-lists-tag-sort").val();var i=TBGlobal.host+TBGlobal.apiUrls.taglistsGetListTags+"?id="+e+"&sort="+t;TBExtension.Get(i,"CRTBTagListGetListTags")};var c=function(){var e=0;var t=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){if(jQuery(this).is(":checked")){e++;var i=jQuery(this).attr("data-tag-value");if(i){t.push(i)}}});jQuery(".tb-tag-lists-selected-count").text(e);if(e>0){jQuery(".tb-tag-lists-remove").attr("disabled",false);jQuery(".tb-tag-lists-insert").attr("disabled",false);jQuery(".tb-tag-lists-tag-selected-container").slideDown()}else{jQuery(".tb-tag-lists-remove").attr("disabled",true);jQuery(".tb-tag-lists-insert").attr("disabled",true);jQuery(".tb-tag-lists-tag-selected-container").hide()}if(jQuery(".tb-tag-list-tag-row-checkbox:visible").length<=1){jQuery(".tb-tag-list-filtering").hide()}else{jQuery(".tb-tag-list-filtering").show()}var i="";var s=t.length;if(t.length>0){jQuery.each(t,function(e,t){if(e==s-1){i+=t}else{i+=t+", "}})}jQuery(".tb-tag-lists-insert").attr("data-clipboard-text",i);return e};var u=function(){var e=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(t,i){if(jQuery(this).is(":checked")){var s=jQuery(this).attr("data-tag-value");if(s){e.push(s)}}});var t="";var s=e.length;if(e.length>0){jQuery.each(e,function(e,i){if(e==s-1){t+=i}else{t+=i+", "}})}if(i){i.destroy()}jQuery(".tb-tag-lists-insert").attr("data-clipboard-text",t);if(!a){i=new ClipboardJS(".tb-tag-lists-insert")}else{i=new ClipboardJS(".tb-tag-lists-insert",{container:jQuery(a)[0]})}};var p=function(){jQuery(document).on("click",".tb-tag-lists-delete-list",function(e){var t="Are you sure you want to delete list "+jQuery(".tb-tag-lists-select option:selected").text()+" ?";TBUtilities.Confirm(t,function(){var e={ListId:jQuery(".tb-tag-lists-select").val()};var t=TBGlobal.host+TBGlobal.apiUrls.taglistsDeleteList;TBExtension.Post(t,JSON.stringify(e),"CRTBTagListDeleteList",null,{contentType:"application/json"})},null)});jQuery(document).on("change",".tb-tag-lists-action-select",function(e){var t=jQuery(".tb-tag-lists-action-select").val();switch(t){case"video":{if(i){i.destroy();jQuery(".tb-tag-lists-insert").removeAttr("data-clipboard-text")}jQuery(".tb-tag-lists-insert").text("Insert");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");break}case"clipboard":{jQuery(".tb-tag-lists-insert").text("Copy");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");u();break}case"remove":{jQuery(".tb-tag-lists-insert").text("Remove");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").addClass("tb-btn-danger");u();break}}});jQuery(document).on("click",".tb-tag-lists-insert",function(e){if(jQuery(this).attr("disabled")=="disabled"){return true}var t=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(e,i){if(jQuery(this).is(":checked")){var s=jQuery(this).attr("data-tag-value");if(s){t.push(s)}}});var i=jQuery(".tb-tag-lists-action-select:visible").val();switch(i){case"video":{if(n){n(t)}else{if(document.URL.indexOf("https://studio.youtube.com")==0){var s=location.pathname;var r=[];if(s){var r=s.substring(1).split("/");if(r[0]=="video"&&r[2]=="edit"){TubeBuddyEditVideoStudio.AddTags(t)}}}jQuery(".tb-tag-lists-insert").html(DOMPurify.sanitize('<img class="tb-move-down3" src="https://www.tubebuddy.com/images/icons/check.png"/>',DOMPurifyConfig));window.setTimeout(function(){jQuery(".tb-tag-lists-insert").html("Add")},1500)}try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.TagLists_Export,"taglists")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] [addAction]"})}TubeBuddyMenu.HideBackground();jQuery("#tb-tag-lists-container:visible").hide();break}case"clipboard":{jQuery(".tb-tag-lists-insert").html(DOMPurify.sanitize('<img class="tb-move-down3" src="https://www.tubebuddy.com/images/icons/check.png"/>',DOMPurifyConfig));window.setTimeout(function(){jQuery(".tb-tag-lists-insert").html("Add")},1500);try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.TagLists_Export,"taglists")}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] [addAction]"})}break}case"remove":{if(jQuery(this).attr("disabled")=="disabled"){return true}var a=c();var o="Are you sure you want to remove "+a+" tag(s)?";TBUtilities.Confirm(o,function(){var e=[];jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){if(jQuery(this).is(":checked"))e.push(jQuery(this).attr("data-tag-id"))});if(e.length>0){var t={ListId:jQuery(".tb-tag-lists-select").val(),TagIds:e};var i=TBGlobal.host+TBGlobal.apiUrls.taglistsRemoveTags;TBExtension.Post(i,JSON.stringify(t),"CRTBTagListRemoveTags",null,{contentType:"application/json"})}},null);return}}jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){jQuery(this).prop("checked",false)});c()});jQuery(document).on("click",".tb-tag-lists-all-tags",function(e){jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){jQuery(this).prop("checked",true)});c()});jQuery(document).on("click",".tb-tag-lists-none-tags",function(e){jQuery(".tb-tag-list-tag-row-checkbox:visible").each(function(){jQuery(this).prop("checked",false)});c()});jQuery(document).on("change",".tb-tag-list-tag-row-checkbox",function(e){var t=jQuery(".tb-tag-lists-action-select:visible").val();switch(t){case"video":{jQuery(".tb-tag-lists-insert").text("Insert");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");break}case"clipboard":{jQuery(".tb-tag-lists-insert").text("Copy");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger");break}case"remove":{jQuery(".tb-tag-lists-insert").text("Remove");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").addClass("tb-btn-danger");break}}c()});jQuery(document).on("change",".tb-tag-lists-tag-sort",function(e){l()});jQuery(document).on("change",".tb-tag-lists-select",function(e){l()});jQuery(document).on("click",".tb-tag-list-tag-insert",function(e){d()});jQuery(document).on("keypress",".tb-tag-list-tag-input",function(e){if(e.which===13){d()}});jQuery(document).on("keypress",".tb-tag-list-name-input",function(e){if(e.which===13){jQuery(".tb-tag-list-empty-insert").click()}});jQuery(document).on("keypress","#tb-tag-list-emptystart-name-input",function(e){if(e.which===13){jQuery(".tb-tag-list-emptystart-insert").click()}});jQuery(document).on("click",".tb-tag-lists-show-add",function(e){if(TBGlobal.CanAccessLevel1Tools()==false&&r.length>=3){TBGlobal.ShowUpgradePage("have more than 3 Tag Lists",TBGlobal.limitation.tagLists);return}var t=TBGlobal.host+TBGlobal.apiUrls.taglistsAddList;if(!a){TBUtilities.Prompt("What would you like to call the new tag list?","List #"+(jQuery(".tb-tag-lists-select:first option").length+1),function(e,i){if(i!=null){var s={Name:i};TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("taglists").name,Action:"New Tag List",Data:s});TBExtension.Post(t,JSON.stringify(s),"CRTBTagListAdd",null,{contentType:"application/json"})}})}else{var i=prompt("What would you like to call the new tag list?","");if(!i||i.length==0){TBUtilities.Alert("Please enter a list name.");return}else{var s={Name:i};TBExtension.Post(t,JSON.stringify(s),"CRTBTagListAdd",null,{contentType:"application/json"})}}});jQuery(document).on("click",".tb-tag-list-emptystart-insert",function(e){jQuery(".tb-tag-lists-show-add-cancel").hide();var t=jQuery(this).siblings("#tb-tag-list-emptystart-name-input").val();if(t.length==0){TBUtilities.Alert("Please enter a name for your Tag List");return}var i={Name:t};var s=TBGlobal.host+TBGlobal.apiUrls.taglistsAddList;TBExtension.Post(s,JSON.stringify(i),"CRTBTagListAdd",null,{contentType:"application/json"});jQuery("#tb-tag-list-emptystart-name-input").text("")});jQuery(document).on("click",".tb-tag-lists-close, .tb-tag-lists-closex",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-tag-lists-container:visible").hide()})};var y=function(){jQuery(document.body).on("CRTBTagListDeleteList",function(e,t){try{if(t.success){m()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListDeleteList"})}});jQuery(document.body).on("CRTBTagListRemoveTags",function(e,t){try{if(t.success){l()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListGetListTags"})}});jQuery(document.body).on("CRTBTagListGetListTags",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);jQuery(".tb-tag-lists-tag-list-tag-container").empty();if(i.length>0){var s=jQuery("#tb-tag-list-tag-row").html();var n="";jQuery.each(i,function(e,t){n+=s.formatTemplate(t.TagValue,t.Id)});jQuery(".tb-tag-lists-tag-list-tag-container").append(DOMPurify.sanitize(n,DOMPurifyConfig));u()}else{var s=jQuery("#tb-tag-list-empty-row").html();jQuery(".tb-tag-lists-tag-list-tag-container").append(DOMPurify.sanitize(s,DOMPurifyConfig))}c()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListGetListTags"})}});jQuery(document.body).on("CRTBLoadTagListsTemplate",function(e,t){try{if(t.success){if(jQuery("#tb-tag-lists-container").length>0){jQuery("#tb-tag-lists-container").remove()}t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(!a){jQuery("body").append(t.response)}else{a.append(t.response)}h()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBLoadTagListsTemplate"})}});jQuery(document.body).on("CRTBTagListsGetLists",function(e,t){try{if(t.success){r=jQuery.parseJSON(t.response);if(r.length==0){jQuery(".tb-tag-lists-has-container").hide();jQuery(".tb-tag-lists-has-none-container").show()}else{jQuery(".tb-tag-lists-select").empty();jQuery.each(r,function(e,t){jQuery(".tb-tag-lists-select").append(jQuery("<option></option>").attr("value",t.Id).text(t.Name))});if(t.data&&t.data.ListId){jQuery(".tb-tag-lists-select").val(t.data.ListId);l()}else{jQuery(".tb-tag-lists-select").val(jQuery(".tb-tag-lists-select option:first").val());l()}jQuery(".tb-tag-lists-has-container").show();jQuery(".tb-tag-lists-has-none-container").hide();jQuery(".tb-tag-lists-select-container").show()}jQuery(".tb-tag-lists-loading-container").hide();jQuery(".tb-tag-lists-loading-done-container").show()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListsGetLists"})}});jQuery(document.body).on("CRTBTagListAdd",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);var s=TBGlobal.host+TBGlobal.apiUrls.taglistsGetLists;TBExtension.Get(s,"CRTBTagListsGetLists",{ListId:i.Id})}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListAdd"})}});jQuery(document.body).on("CRTBTagListAddTag",function(e,t){try{if(t.success){jQuery(".tb-tag-list-tag-input").val("");l()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] CRTBTagListAddTag"})}})};var b=function(){try{jQuery(".tb-tag-lists-loading-done-container").hide();jQuery(".tb-tag-lists-has-container").hide();jQuery("#tb-tag-lists-container").show();jQuery(".tb-tag-lists-remove").prop("disabled",true);var e=TBGlobal.GetYouTubeUI();var n=false;switch(e){case"studio":{var r=location.pathname;var a=[];if(r){var a=r.substring(1).split("/");TBUtilities.Log(a);for(var o=0;o<5-a.length;o++)a.push("");if(a[0]=="video"&&a[2]=="edit"){n=true}else if(jQuery(".ytcp-uploads-dialog#dialog").length>0){n=true}}break}case"material":case"default":{n=document.URL.indexOf("youtube.com/upload")>0||document.URL.indexOf("youtube.com/edit")>0||document.URL.indexOf("youtube.com/my_live_events")>0;break}}if(n===true){jQuery(".tb-tag-lists-insert").attr("disabled",false);jQuery(".tb-tag-lists-insert").attr("title","Insert Tag to Video.");jQuery(".tb-tag-lists-insert").attr("data-tooltip-text","Insert Tag to Video.");t=true;if(s){jQuery(".tb-tag-lists-action-select").val("video");if(i){i.destroy();jQuery(".tb-tag-lists-insert").removeAttr("data-clipboard-text")}jQuery(".tb-tag-lists-insert").text("Insert");jQuery(".tb-tag-lists-insert").addClass("tb-btn-primary");jQuery(".tb-tag-lists-insert").removeClass("tb-btn-danger")}}else{jQuery(".tb-tag-lists-action-select-video").attr("disabled","disabled");jQuery(".tb-tag-lists-action-select").val("clipboard");jQuery(".tb-tag-lists-insert").attr("disabled",true);t=false}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyTagLists] prepareDialog"})}};var m=function(){jQuery(".tb-tag-lists-loading-container").show();jQuery(".tb-tag-lists-container").hide();jQuery(".tb-tag-lists-loading-done-container").hide();var e=TBGlobal.host+TBGlobal.apiUrls.taglistsGetLists;TBExtension.Get(e,"CRTBTagListsGetLists")};var h=function(){b();m()};return{Show:function(t,i,r){if(TBGlobal.IsAuthenticated()){if(t){s=true}if(i){n=i}if(r){a=r}else{a=false}if(!e){y();o();p();e=true}else{o()}}}}}();var TubeBuddyCopyTo=function(){var e=false;var t=null;var i=null;var s;var n;var r;var a;var o;var d=null;var l=function(){var e=TBGlobal.host+"/ModuleManager/CopyTo/CopyTo?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/copyto.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/copyto.html"}TBExtension.Get(e,"CRTBLoadCopyToTemplate")};var c=function(){var e=u();if(t){t.destroy()}var i=" ";if(e.length>0){i=e.join(",")}jQuery('.tb-copyto-action-dropdown-action-option[data-option="clipboard"]').attr("data-clipboard-text",i);if(!d){t=new ClipboardJS('.tb-copyto-action-dropdown-action-option[data-option="clipboard"]')}else{t=new ClipboardJS('.tb-copyto-action-dropdown-action-option[data-option="clipboard"]',{container:jQuery(d)[0]})}jQuery(".tb-copyto-action-dropdown-selected-count").text(e.length)};var u=function(){var e=[];jQuery(".tb-copyto-dropdown-tag:visible").each(function(){if(jQuery(this).is(":checked")){var t=decodeURIComponent(jQuery(this).attr("data-tag-value"));if(t){e.push(t)}}});return e};var p=function(){if(i){i.siblings(".tb-copyto-action-dropdown").remove()}};var y=function(){var e=i.html();var t='&nbsp;&nbsp;<span style="color:green">Copied!<span>&nbsp;&nbsp;';i.html(t);window.setTimeout(function(){i.html(e)},3e3)};var b=function(){jQuery(document).click(function(){p()});jQuery(document).on("click",".tb-copyto-action-dropdown",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-copyto-action-dropdown-all",function(e){jQuery(".tb-copyto-dropdown-tag:visible").each(function(){jQuery(this).prop("checked",true)});c()});jQuery(document).on("click",".tb-copyto-action-dropdown-none",function(e){jQuery(".tb-copyto-dropdown-tag:visible").each(function(){jQuery(this).prop("checked",false)});c()});jQuery(document).on("change",".tb-copyto-dropdown-tag",function(e){c()});jQuery(document).on("click",".tb-copyto-action-dropdown .tb-copyto-action-dropdown-action-option",function(e){e.stopPropagation();var t=jQuery(this).attr("data-option");var i=jQuery(this).attr("data-list-id");var n=jQuery(this).attr("data-list-name");try{TBUtilities.AddAction(null,TBUtilities.ActionTypes.ViewAndCopyVideoTags_Copy,"watchpagestats")}catch(e){TBUtilities.LogError({Exception:e,Location:"[CopyTo] [tb-copyto-action-dropdown]"})}switch(t){case"clipboard":{y();p();TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("viewandcopyvideotags").name,Action:"Copy Tag To Clipboard"});break}case"newlist":{if(TBGlobal.CanAccessLevel1Tools()==false&&s.length>=3){TBGlobal.ShowUpgradePage("have more than 3 Tag Lists",TBGlobal.limitation.tagLists);return}if(!d){TBUtilities.Prompt("What would you like the list name to be?",null,function(e,t){if(t.length==0){TBUtilities.Alert("Please enter a list name.");return}var i=u();var s={Name:t,Tags:i};TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("viewandcopyvideotags").name,Action:"New Tag List",Data:s});var n=TBGlobal.host+TBGlobal.apiUrls.taglistsAddListWithTags;TBExtension.Post(n,JSON.stringify(s),"CRTBCopyToAddListWithTags",null,{contentType:"application/json"});p()},function(e,t){})}else{var r=prompt("What would you like the list name to be?","");if(!r||r.length==0){TBUtilities.Alert("Please enter a list name.");return}else{var a=u();var o={Name:r,Tags:a};var l=TBGlobal.host+TBGlobal.apiUrls.taglistsAddListWithTags;TBExtension.Post(l,JSON.stringify(o),"CRTBCopyToAddListWithTags",null,{contentType:"application/json"})}p()}break}case"list":{var i=jQuery(this).attr("data-list-id");if(i){var a=u();var o={Id:i,Tags:a};var l=TBGlobal.host+TBGlobal.apiUrls.taglistsAddTags;TBExtension.Post(l,JSON.stringify(o),"CRTBCopyToAddTags",null,{contentType:"application/json"})}p();break}}})};var m=function(e,i,s){i=i.filter(function(e){return e===0||e});if(t){t.destroy()}e.siblings(".tb-copyto-action-dropdown").remove();var n=jQuery("#tb-copyto-dropdown-template").html();var r=n.formatTemplate();e.after(r);var d=e.position().top;var l=e.position().left;if(o){l=l-o}if(a){d=d+a.scrollTop()}if(s&&s===true){d=d+35;l=l-280;jQuery(".tb-copyto-action-dropdown").css({position:"absolute",top:d,left:l})}else{if(document.URL.indexOf("youtube.com/edit")>0){d=d-275;l=70}else if(document.URL.indexOf("youtube.com/watch?v")>0){d=d-275;l=l-400}else if(document.URL.indexOf("youtube.com/my_live_events")>0){d=d-270;l=l-10}else if(document.URL.indexOf("youtube.com/results?search_query")>0){d=d-270}jQuery(".tb-copyto-action-dropdown").css({position:"absolute",top:d,left:l})}jQuery(".tb-copyto-action-dropdown").show();var u=jQuery("#tb-copyto-dropdown-tag-template").html();if(i.length>0){jQuery.each(i,function(e,t){if(t!=""){var i=u.formatTemplate(encodeURIComponent(t.trim()),t.trim());jQuery(".tb-copyto-tags-container:visible").append(i)}})}else{jQuery(".tb-copyto-tags-container:visible").append('<span class="tb-margin-left10 tb-font-size11">No Tags</span>')}c();var p=TBGlobal.host+TBGlobal.apiUrls.taglistsGetLists;TBExtension.Get(p,"CRTBCopyToGetLists")};var h=function(){jQuery(document.body).on("CRTBCopyToAddTags",function(e,t){try{if(t.success){y()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBCopyToAddTags"})}finally{p()}});jQuery(document.body).on("CRTBCopyToAddListWithTags",function(e,t){try{if(t.success){y()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBCopyToAddListWithTags"})}finally{p()}});jQuery(document.body).on("CRTBCopyToGetLists",function(e,t){try{if(t.success){jQuery(".tb-copyto-lists-container").empty();s=jQuery.parseJSON(t.response);if(s.length==0){jQuery(".tb-copyto-lists-container").append('<span class="tb-margin-left10 tb-font-size11">You don\'t have any tag lists</span>')}else{var i="";jQuery.each(s,function(e,t){i+='<div class="tb-copyto-action-dropdown-action-option tb-copyto-list-item" data-option="list" data-list-id="'+t.Id+'" data-list-name="'+t.Name+'" ><span title="'+t.Name+'">'+TBUtilities.Truncate(t.Name,25,true)+"</span></div>"});jQuery(".tb-copyto-lists-container").append(i)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBCopyToGetLists"})}});jQuery(document.body).on("CRTBLoadCopyToTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));if(!d){jQuery("body").append(t.response)}else{jQuery(d).append(t.response)}m(i,n,r)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyCopyTo] CRTBLoadCopyToTemplate"})}})};return{ShowMenu:function(t,s,c,u,p,y){if(TBGlobal.IsAuthenticated()){i=t;n=s;r=c;a=u;o=p;if(y){d=y}else{d=null}if(!e){h();l();b();e=true}else{if(jQuery("#tb-copyto-dropdown-template").length==0){l()}else{m(i,n,r)}}}}}}();var TubeBuddyVideolytics=function(){var e=false;var t=null;var s=null;var n=null;var r={};var a=0;var o={};var d={};var l;var c=0;var u=0;var p=4;var y=false;var b="&#10003;";var m='<span style="color:red">&#10007;</span>';var h="-";var v=null;var f=["#dea85d","#dcde5d","#6cc861"];var g=function(e,i){TBUtilities.Log("Videolytics populateContent");if(TBGlobal.CanAccessLevel1Tools()==false){jQuery(".tb-videolytics-savevideo").attr("disabled","disabled")}var n=P();var r=0;var a=setInterval(function(){if(jQuery("#"+n).length){u=0;d={};clearInterval(a);var i=D();var o="#player-ads";if(TBGlobal.IsAuthenticated()&&TBGlobal.Profile().SettingsShowVideolytics==true){var l=TBGlobal.GetYouTubeUI();var c=i.find(".tb-videolytics-container");if(c.length>0){c.remove()}var p=i.find(".tb-videolytics-container-disabled");if(p.length>0){p.remove()}switch(l){case"studio":case"material":{var y=jQuery(".tb-videolytics-container")[0].outerHTML;T(o).then(function(){var n=jQuery(o);n.after(DOMPurify.sanitize(y,DOMPurifyConfig));ye();pe();i.find(".tb-videolytics-container").show();var r=TBUtilities.GetUrlParameter("list");if(r&&l==="default"){i.find(".tb-videolytics-container").css("margin-top","490px")}else{i.find(".tb-videolytics-container").css("margin-top","0px")}B(t,s,"primary",e);i.find(".tb-videolytics-header-carret").attr("style","flex:1; order:3; justify-content:flex-end;")}).catch(function(e){TBUtilities.LogError(`Videolytics - error ${e}`)});break}case"default":{var y=jQuery(".tb-videolytics-container")[0].outerHTML;i.prepend(DOMPurify.sanitize(y,DOMPurifyConfig));break}}if(TBGlobal.IsDarkMode()){jQuery("#tb-videolytics-thumbsdown").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsdownwhite.png"));jQuery("#tb-videolytics-thumbsup").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsupwhite.png"))}else{jQuery("#tb-videolytics-thumbsdown").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsdown.png"));jQuery("#tb-videolytics-thumbsup").attr("src",TBUtilities.FixLocalHtml("{PLUGIN_FILE_ROOT}/images/icons/thumbsup.png"))}}else{switch(TBGlobal.GetYouTubeUI()){case"studio":case"material":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0){var y=jQuery(".tb-videolytics-container-disabled")[0].outerHTML;T(o).then(function(){jQuery(o).after(DOMPurify.sanitize(y,DOMPurifyConfig));i.find(".tb-videolytics-header-carret").attr("style","flex:1; order:3; justify-content:flex-end;")}).catch(function(e){TBUtilities.LogError(`Videolytics - error ${e}`)})}break}case"default":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0){var y=jQuery(".tb-videolytics-container-disabled")[0].outerHTML;i.prepend(DOMPurify.sanitize(y,DOMPurifyConfig))}break}}}setTimeout(function(){j()},2e3)}else if(r<10){r++}else{clearInterval(a);TBUtilities.ReportExtensionDOMIssue("Videolytics","#"+n)}},100)};var T=function(e){return new Promise(function(t,i){var s=0;var n=setInterval(function(){var r=jQuery(e);if(r.length>0){clearInterval(n);t()}else if(s<60){s++}else{clearInterval(n);TBUtilities.ReportExtensionDOMIssue("Videolytics",e);i(`Videolytics - ${element} element not displaying. Reported dom issue`)}},1e3)})};var j=function(){u++;if(u>=p){return}var e=".tb-videolytics-container";var t=TBGlobal.IsAuthenticated();var i=TBGlobal.Profile().SettingsShowVideolytics;if(t&&i==false){e=".tb-videolytics-container-disabled"}var s=D();var n=s.find(e);if(n){var r=n.index();if(r!=-1&&r!=0){s.prepend(n)}}setTimeout(function(){j()},2e3)};var Q=function(e){if(TBExtension.GetType()=="crossrider"){var t=TBGlobal.host+"/assets/js/moment/moment-with-locales.js";TBExtension.Get(t,function(t,i,s){try{if(t){var n="https://cdnjs.cloudflare.com/ajax/libs/highcharts/4.1.9/highcharts.js";TBExtension.Get(n,function(t,i,s){try{if(t){e()}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|addScripts",Data:i,Response:s})}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|addScripts"})}},null,{dataType:"script",cache:true})}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|addScripts",Data:i,Response:s})}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|addScripts"})}},null,{dataType:"script",cache:true})}else{e()}};var B=function(e,t,i,s,n){TBUtilities.Log("Videolytics.js|getPageData");var r=new VideolyticsData;r.videoId=t;r.sessionToken=TBUtilities.GetSessionToken(document.documentElement.innerHTML);r.idToken=E();r.uiVersionNumber=x();r.ui=TBGlobal.GetYouTubeUI();r.serverStats=null;if(TBUtilities.GetUrlParameter("v").toLowerCase()==t.toLowerCase()&&s==false){r.html=document.documentElement.innerHTML;r.language=w(r.html);if(r.serverStats==null){r.commentToken=TBUtilities.GetCommentTokenFromWatchPageHtml(document.documentElement.innerHTML)}ct(r,function(){_e(r,i);k(r,i)});He(r,i)}else{var a="https://www.youtube.com/watch?v="+t;TBExtension.Get(a,function(e,t,s){try{if(e){r.html=s;if(r.serverStats==null){r.commentToken=TBUtilities.GetCommentTokenFromWatchPageHtml(s)}ct(r,function(){_e(r,i);k(r,i)})}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getPageData",Data:t,Response:s});r.html="error"}r.language=w(r.html);He(r,i)}catch(e){r.html="error";TBUtilities.LogError({Exception:e,Location:"Videolytics.js|getPageData"})}},null,{dataType:null})}TubeBuddyYouTubeActions.GetVideoTags(t,function(e){r.tags=e;C(r,i)});if(r.serverStats==null){o[t]=r;M(r,e,i);var a="https://www.youtube.com/channel/"+e+"/about";TBExtension.Get(a,function(e,t,s){try{if(e){r.channelAboutHtml=s}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getPageData",Data:t,Response:s});r.channelAboutHtml="error"}O(r,i)}catch(e){r.channelAboutHtml="error";TBUtilities.LogError({Exception:e,Location:"Videolytics.js|getPageData"})}},null,{dataType:null})}};var w=function(e){TBUtilities.Log("Videolytics getLanguage");var t=null;var i=TBGlobal.GetYouTubeUI();switch(i){case"studio":case"material":{try{var s=e.indexOf("ytplayer.config = ");s=s+17;var n=e.substring(s,e.length);var r=n.indexOf("};")+1;var n=n.substring(0,r);var a=jQuery.parseJSON(n);t=a.args.hl}catch(i){try{var o=e.indexOf('"hl"');var d=e.indexOf('"',o+4);var l=e.indexOf('"',d+1);t=e.substring(d+1,l)}catch(e){}}break}case"default":{break}}TBUtilities.Log(t);return t};var k=function(e,t){TBUtilities.Log("Videolytics getCommentCount");if(e.commentToken==null){e.commentCount=0;e.commentCountFormatted=0;C(e,t);return}var i=TBGlobal.GetYouTubeUI();switch(i){case"studio":case"material":{try{if(e.commentsResponse){if(e.commentsResponse.onResponseReceivedEndpoints&&e.commentsResponse.onResponseReceivedEndpoints["0"]){var s=e.commentsResponse.onResponseReceivedEndpoints["0"].reloadContinuationItemsCommand.continuationItems["0"].commentsHeaderRenderer.countText.runs["0"].text;if(s){var n=parseInt(s.replace(/\,|\./g,""));e.commentCount=n;e.commentCountFormatted=TBUtilities.FormatNumberAbbreviated(n,null,"tb-videolytics-abbrev")}}}else{e.commentCount=0;e.commentCountFormatted=0;return}}catch(t){TBUtilities.Log(t);e.commentCount="error";return}finally{C(e,t)}break}case"default":{var r="https://www.youtube.com/watch_fragments_ajax?v="+e.videoId+"&tr=scroll&distiller=1&ctoken="+e.commentToken+"&frags=comments&spf=load";var a={session_token:e.sessionToken,client_url:"https://www.youtube.com/watch?v="+e.videoId};var o=jQuery.param(a);TBExtension.Post(r,o,function(i,s,n){try{if(i){var r=0;try{var a=jQuery.parseHTML(DOMPurify.sanitize(n.body["watch-discussion"],DOMPurifyConfig));var o=jQuery(a).find(".comment-section-header-renderer").text();var r=o.match(/\d/g);r=r.join("")}catch(e){r=0;TBUtilities.Log(e)}e.commentCount=parseInt(r);e.commentCountFormatted=TBUtilities.FormatNumberAbbreviated(e.commentCount,null,"tb-videolytics-abbrev")}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getCommentCount",Data:s,Response:n});e.commentCount="error"}C(e,t)}catch(t){e.commentCount="error";TBUtilities.LogError({Exception:t,Location:"Videolytics.js|getCommentCount"})}},null,{dataType:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{"X-YouTube-Identity-Token":e.sessionToken}});break}}};var E=function(){var e=TBGlobal.GetYouTubeUI();var t=null;switch(e){case"studio":case"material":{var i='"ID_TOKEN":"';var s=document.documentElement.innerHTML.indexOf(i);var n=document.documentElement.innerHTML.substring(s+i.length,document.documentElement.innerHTML.length);var r=n.indexOf('","');t=n.substring(0,r);break}case"default":{break}}t=TBUtilities.UnicodeToChar(t);return t};var x=function(){var e=TBGlobal.GetYouTubeUI();var t=null;switch(e){case"studio":case"material":{var s=TBUtilities.ParseResponseContextFromHtml(document.documentElement.innerHTML);jQuery.each(s.responseContext.serviceTrackingParams,function(e,s){if(s.service&&s.service=="CSI"){for(i=0;i<s.params.length;i++){if(s.params[i].key=="cver"){t=s.params[i].value}}}});break}case"default":{break}}return t};var C=function(e,t){TBUtilities.Log("Videolytics getPageDataComplete");if(U(e,t)){TBUtilities.Log("Videolytics getPageDataComplete finished page data scrape");ve(e);ge(e,t);H(e,t);te(e,t);if(t=="primary"){var i=TBUtilities.GetCookie("tb-videolytics-saved-videoid-"+TBGlobal.CurrentChannelId());if(i){var s=D();s.find(".tb-videolytics-savevideo").attr("checked","checked");s.find(".tb-videolytics-savevideo").attr("checked","checked");s.find('input:radio[name="tb-videolytics-compareVid"]').filter('[value="3"]').attr("checked",true);s.find("#videolyticsVideoId").val(i);Fe(i)}else{be()}}else{be()}}};var U=function(e,t){TBUtilities.Log("Videolytics isPageDataComplete");var i=false;switch(e.ui){case"studio":case"material":{if(e.html!=null&&e.commentCount!=null&&e.channelViews!=null&&e.tags!=null&&e.channelVideos!=null){i=true}else{var s="not populated";if(e.html!=null&&e.html.length>0){s="populated"}TBUtilities.Log("Videolytics html ="+s);TBUtilities.Log("Videolytics commentCount ="+e.commentCount);TBUtilities.Log("Videolytics channelViews ="+e.channelViews);TBUtilities.Log("Videolytics tags ="+e.tags)}break}case"default":{if(e.html!=null&&e.commentCount!=null&&e.tags!=null&&e.channelVideos!=null&&e.channelViews!=null&&e.subscribers!=null){i=true}break}}TBUtilities.Log(i);return i};var L=function(e,t){var i="https://www.youtube.com/insight_ajax?action_get_statistics_and_data=1&v="+e.videoId;var s={session_token:e.sessionToken};var n=jQuery.param(s);TBExtension.Post(i,n,function(i,s,n){try{if(i){e.statsData=n}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getVideoGraphData",Data:s,Response:n});e.statsData="error"}S(e,t)}catch(t){e.statsData="error";TBUtilities.LogError({Exception:t,Location:"Videolytics.js|getVideoGraphData"})}},null,{contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:null,headers:{"X-Youtube-Identity-Token":e.sessionToken}})};var S=function(e,t){try{if(e.statsData!="error"&&jQuery(e.statsData).find("html_content").text().indexOf("No statistics available yet.")==-1&&jQuery(e.statsData).find("html_content").text().indexOf("Public statistics have been disabled.")==-1){var i=jQuery(e.statsData).find("graph_data").text();i=i.replace("<![CDATA[","").replace("]]>","");e.chartsObj=jQuery.parseJSON(i)}}catch(e){TBUtilities.Log(e)}try{var s=jQuery.parseHTML(DOMPurify.sanitize(jQuery(e.statsData).find("html_content").text(),DOMPurifyConfig));e.watchTimeAvgViewDuration=jQuery(s).find(".menu-metric-value").first().text()}catch(t){e.watchTimeAvgViewDuration="error";TBUtilities.Log(t)}Ve(e);Ae(e);Me(e);I(e,t)};var I=function(e,t){var i=D();if(t=="primary"){if(e.viewHistoricalData!=null&&e.viewHistoricalData!="error"&&e.viewHistoricalData.length>2&&(e.watchTimeAvgViewDuration!=null&&e.watchTimeAvgViewDuration!="error")&&(e.watchTimeAvgPercentWatched!=null&&e.watchTimeAvgPercentWatched!="error")){i.find("#tb-videolytics-watchtimecontainer").show();if(e.viewHistoricalData!=null&&e.viewHistoricalData.length>2&&e.viewHistoricalData!="error"){try{var s="#759DED";if(t=="secondary"){s="#F3C66F"}var r=i.find("[data-name='views-historical']");if(e.viewHistoricalData!=null){var a=r.highcharts();if(a){a.addSeries({name:"secondary",data:e.viewHistoricalData,color:s,type:"spline"},true);a.series[0].update({type:"spline"})}else{var a=r.highcharts({chart:{renderTo:"historicalChart",margin:[0,0,0,0],backgroundColor:"transparent"},title:{text:""},credits:{enabled:false},xAxis:{labels:{enabled:false}},yAxis:{maxPadding:0,minPadding:0,gridLineWidth:0,endOnTick:false,labels:{enabled:false}},legend:{enabled:false},tooltip:{enabled:false},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,s],[1,s]]},lineWidth:1,marker:{enabled:false},shadow:false,states:{hover:{lineWidth:1}},threshold:null},series:{enableMouseTracking:false,lineWidth:1,shadow:false,states:{hover:{lineWidth:1}},color:s,marker:{radius:0,states:{hover:{radius:2}}}}},series:[{type:"area",data:e.viewHistoricalData,name:"primary"}]})}}else{r.html(n)}}catch(e){TBUtilities.Log(e)}if(t!="secondary"){Y(i,"views-historical",e.durationSincePublish,function(t){t.text(e.durationSincePublish)})}}else{i.find(".tb-videolytics-historical-block").hide()}try{var o="view-duration";if(W(i,o,t,e.watchTimeAvgViewDurationInMilliSeconds,e.watchTimeAvgViewDuration)){if(t=="primary"){Y(i,o,e.videoDuration,function(t){t.text(e.videoDuration)})}else{ne(o)}}}catch(e){TBUtilities.Log(e)}try{var o="percent-watched";if(W(i,o,t,e.watchTimeAvgPercentWatched,e.watchTimeAvgPercentWatchedFormatted)){if(t=="primary"){Y(i,o,e.watchTimeAvgPercentWatched,function(t){var i=jQuery("#tb-videolytics-percentwatched-bar-template").html();var s=i.formatTemplate(e.watchTimeAvgPercentWatched,"na","tb-percentwatched-fill");t.append(s);t.parent().show();t.find(".tb-horizontal .tb-progress-fill-percentwatched span").each(function(){var e=jQuery(this).attr("data-percent");jQuery(this).parent().css("width",e+"%")})})}else{ne(o)}}}catch(e){TBUtilities.Log(e)}}}};var R=function(e,t){TBUtilities.Log("Videolytics isBestPracticesComplete");var i=false;if(e.commentHearted!=null&&e.commentPinned!=null&&e.infoCardsExist!=null&&e.endScreenExist!=null&&e.highResThumbnailExist!=null&&e.likedOnFacebook!=null){i=true}else{TBUtilities.Log("Videolytics isBestPracticesComplete commentPinned ="+e.commentPinned);TBUtilities.Log("Videolytics isBestPracticesComplete commentHearted ="+e.commentHearted);TBUtilities.Log("Videolytics isBestPracticesComplete infoCardsExist ="+e.infoCardsExist);TBUtilities.Log("Videolytics isBestPracticesComplete endScreenExist ="+e.endScreenExist);TBUtilities.Log("Videolytics isBestPracticesComplete highResThumbnailExist ="+e.highResThumbnailExist);TBUtilities.Log("Videolytics isBestPracticesComplete likedOnFacebook ="+e.likedOnFacebook)}return i};var V=function(e,t){TBUtilities.Log("Videolytics isSocialComplete");var i=false;if(e.facebookLikeCount!=null&&e.redditResults!=null){i=true}else{TBUtilities.Log("Videolytics isSocialComplete facebookLikeCount ="+e.facebookLikeCount);TBUtilities.Log("Videolytics isSocialComplete redditResults ="+e.redditResults)}return i};var A=function(){var e=D();if(e.find(".tb-videolytics-container-non-english").length==0){var t=jQuery(".tb-videolytics-container-non-english")[0].outerHTML;jQuery("#player-ads").after(DOMPurify.sanitize(t,DOMPurifyConfig));jQuery(".tb-videolytics-container").hide()}};var D=function(){var e=jQuery("#"+P());return e};var P=function(){var e=TBGlobal.GetYouTubeUI();var t="";switch(e){case"studio":case"material":{t="related";break}case"default":{t="watch7-sidebar";break}}return t};var G=function(e,t,i){var s="https://www.youtube.com/channel/"+t+"/about";TBExtension.Get(s,function(t,s,n){try{if(t){e.channelAboutHtml=n}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getChannelAboutPageData",Data:s,Response:n});e.channelAboutHtml="error"}O(e,i)}catch(t){e.channelAboutHtml="error";TBUtilities.LogError({Exception:t,Location:"Videolytics.js|getChannelAboutPageData"})}},null,{dataType:null})};var M=function(e,t,i){var s="UU"+t.substr(2);var n="https://www.youtube.com/playlist?list="+s+"&playnext=1&index=1";TBExtension.Get(n,function(t,s,n){try{if(t){try{var r=TBUtilities.ParseResponseContextFromHtml(n);var a=r.contents.twoColumnWatchNextResults.playlist.playlist.totalVideos;var o=parseInt(a);e.channelVideos=o;e.channelVideosFormatted=TBUtilities.FormatNumberAbbreviated(e.channelVideos)}catch(t){e.channelVideos="error";C(e,i);e.channelVideos="error"}C(e,i)}else{TBUtilities.LogFailedWebRequest({Location:"Videolytics.js|getChannelVideoCount",Data:s,Response:n})}}catch(e){TBUtilities.LogError({Exception:e,Location:"Videolytics.js|getChannelVideoCount"})}},null,{dataType:null})};var O=function(e,t){var i=TBGlobal.GetYouTubeUIFromHtml(e.channelAboutHtml);switch(i){case"studio":case"material":{try{var s=TBUtilities.ParseResponseContextFromHtml(e.channelAboutHtml);var n=null;jQuery.each(s.contents.twoColumnBrowseResultsRenderer.tabs,function(e,t){if(t.tabRenderer&&t.tabRenderer.endpoint.commandMetadata.webCommandMetadata.url.indexOf("about")!=-1){n=t;return true}});var r="";if(n.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText!==undefined){if(n.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.runs!==undefined){r=n.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.runs["0"].text}else if(n.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.simpleText!==undefined){r=n.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText.simpleText}else{viewText="0"}}else if(n.tabRenderer.content.sectionListRenderer.contents["0"].itemSectionRenderer.contents["0"].channelAboutFullMetadataRenderer.viewCountText===undefined){r="0"}var a=r.match(/\d/g);a=a.join("");e.channelViews=a;e.channelViewsFormatted=TBUtilities.FormatNumberAbbreviated(e.channelViews,null,"tb-videolytics-abbrev");var o="";try{o=s.header.c4TabbedHeaderRenderer.subscribeButton.subscribeButtonRenderer.subscriberCountText.simpleText}catch{try{o=s.header.c4TabbedHeaderRenderer.subscriberCountText.runs[0].text;if(o.indexOf(" ")>0){o=o.substring(0,o.indexOf(" "))}}catch{var d=s.header.c4TabbedHeaderRenderer.subscriberCountText.simpleText;var l=d.split(/\s/);o=l[0];if(l.length>2){o+=l[1]}}}if(o===""){e.subscribers="error";e.subscribersFormatted="error"}else{e.subscribersFormatted=o;e.subscribers=0}}catch(t){TBUtilities.Log(t);e.subscribers="error";e.subscribersFormatted="error"}C(e,t);break}case"default":{var c=jQuery.parseHTML(DOMPurify.sanitize(e.channelAboutHtml,DOMPurifyConfig));var u=jQuery(c).find(".about-stat").length;if(u==2){e.subscribers="error";e.subscribersFormatted="error"}jQuery(c).find(".about-stat").each(function(t){try{var i=jQuery(this).html();var s=i.match(/\d/g);s=s.join("");if(u==3){if(t==0){e.subscribers=s;e.subscribersFormatted=TBUtilities.FormatNumberAbbreviated(e.subscribers,null,"tb-videolytics-abbrev")}else if(t==1){e.channelViews=s;e.channelViewsFormatted=TBUtilities.FormatNumberAbbreviated(e.channelViews,null,"tb-videolytics-abbrev")}else if(t==2){var n=i.indexOf(" ");var r=i.substring(n,i.length)}}else if(u==2){if(t==0){e.channelViews=s;e.channelViewsFormatted=TBUtilities.FormatNumberAbbreviated(e.channelViews,null,"tb-videolytics-abbrev")}else if(t==1){var n=i.indexOf(" ");var r=i.substring(n,i.length)}}}catch(e){TBUtilities.Log(e)}});C(e,t);break}}};var F=function(e,t,i){return e.split(t,i).join(t).length};var N=function(){var e=TBGlobal.host+"/ModuleManager/videolytics/videolytics?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/videolytics.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/videolytics.html"}TBExtension.Get(e,"CRTBLoadVideolyticsTemplate")};var H=function(e,t){var i=D();i.find(".tb-videolytics-vid-compare[data-videoid='"+e.videoId+"']").attr("title",e.title);try{var s="views";if(W(i,s,t,e.views,e.viewsFormatted)){if(t!="primary"){ne(s)}}}catch(e){TBUtilities.Log(e)}try{var s="likeratio";var n=i.find("[data-name='likeratio'][data-type='"+t+"']");var r=e.likes;var a=TBUtilities.FormatNumberAbbreviated(r,null,null);n.prop("data-value",r);n.prop("data-formatted",a);n.find(".up").text(e.likesFormatted);if(t!="primary"){ne(s)}}catch(e){TBUtilities.Log(e)}try{var s="comments";if(W(i,s,t,e.commentCount,e.commentCountFormatted)){if(t!="primary"){ne(s)}}}catch(e){TBUtilities.Log(e)}try{var s="creatorsuggested";if(W(i,s,t,e.creatorSuggestedCount,e.creatorSuggestedFormatted)){if(t!="primary"){ne(s)}}if(e.creatorSuggestedCount=="na"){i.find(".tb-creatorsuggested-container").hide()}}catch(e){TBUtilities.Log(e)}try{var s="tagsin";var o=i.find("[data-name='tagsin'][data-type='"+t+"']");if(W(i,s,t,e.tagsIn,e.tagsIn,null,e.tagsInScore)){if(e.tagsIn==1){jQuery(".tb-videolytics-s").hide()}if(t!="primary"){ne(s)}}if(e.tagsIn=="na"){i.find(".tb-tagsin-container").hide()}}catch(e){TBUtilities.Log(e)}try{if(e.tags.length==1&&e.tags[0]==""){e.tags=[]}if(e.tags.length>0){var l=i.find(".tb-videolytics-tags-body[data-type='"+t+"']");l.attr("data-videoid",e.videoId);l.attr("data-type",t);var c=i.find(".tb-videolytics-compare-tags-label[data-type='"+t+"']");c.text("for "+z(e.title,40));i.find(".tb-videolytics-tags-body[data-type='"+t+"']").empty();var u=jQuery("#tb-videolytics-tags-template").html();jQuery.each(e.tags,function(e,s){if(s!=""){var n=u.formatTemplate(s,escape(s.toLowerCase()));i.find(".tb-videolytics-tags-body[data-type='"+t+"']").append(n);i.find(".tb-videolytics-compare-tags[data-type='"+t+"']").show();if(t=="secondary"){var r=i.find(".tb-videolytics-tag[data-tag='"+escape(s.toLowerCase())+"']");if(r&&r.length>1){r.addClass("tb-videolytics-tag-duplicate")}jQuery(".tb-videolytics-compare-tags-label").show()}}});i.find(".tb-videolytics-copy-tags[data-type='"+t+"']").show();X(e.tags,t);if(y==true){i.find(".tb-videolytics-search-ranking[data-type='"+t+"']").hide();J(e.videoId,e.tags,t);i.find(".tb-videolytics-loading-tag-rankings").show();i.find(".tb-videolytics-loading-tag-rankings-legend").hide()}else{i.find(".tb-videolytics-search-ranking[data-type='"+t+"']").show();$rankedTags=i.find("[data-name='rankedTags'][data-type='"+t+"']");$rankedTags.html('<div class="tb-videolytics-search-ranking-text" style="font-size:11px;opacity:0.5; cursor:pointer;">(click to load)</div>');i.find(".tb-videolytics-loading-tag-rankings").hide();var l=i.find(".tb-videolytics-tags-body[data-type='"+t+"']");l.attr("data-videoid",e.videoId);l.attr("data-type",t)}}else{var l=i.find(".tb-videolytics-tags-body[data-type='"+t+"']");l.attr("data-videoid",e.videoId);l.attr("data-type",t);d[e.videoId]=0;$(e.videoId);i.find(".tb-videolytics-copy-tags").hide();i.find(".tb-videolytics-tags-body").append('<span style="opacity:.7;font-size:11px">No Tags</span>');i.find(".tb-videolytics-loading-tag-rankings-legend").hide()}}catch(e){TBUtilities.Log(e)}try{var c=i.find(".tb-videolytics-image-compare-title[data-type='"+t+"']");c.text(z(e.title,29))}catch(e){TBUtilities.Log(e)}var p="";try{var b=moment(new Date);var m=moment.duration(b.diff(e.videoPublishDate));var h=parseInt(m.asDays().toFixed(0));if(h<=2){p='<div style="border-top:dashed 1px #ccc; padding:2px 0; margin:2px 0;"><span style="font-weight:500">NOTE:</span> Because this video is so new, these stats may change drastically over the few days.</div>'}}catch(e){}jQuery("#tt-total-views").attr("data-tbtooltip-vl","Total lifetime number of views that this video has received.");jQuery("#tt-comments").attr("data-tbtooltip-vl","How many Comments this video has received.");jQuery("#tt-like-ratio").attr("data-tbtooltip-vl","How many viewers Liked the video.");jQuery("#tt-creator-suggested").attr("data-tbtooltip-vl","How many of the 'Suggested' videos shown at the end of the video are from the same channel as the video you are watching.");jQuery("#tt-ranked-tags").attr("data-tbtooltip-vl","If you do a search for each of this video's tags, this number shows how many times this video shows up on the first page of search results for the tags.");jQuery("#tt-channel-views").attr("data-tbtooltip-vl","Total number of views for this channel all time.");jQuery("#tt-channel-subscribers").attr("data-tbtooltip-vl","Total number of subscribers for this channel all time. *Subscriber count is formatted according to your selected YouTube language.");jQuery("#tt-channel-videocount").attr("data-tbtooltip-vl","Total number of videos this channel has published.");_()};var _=function(){jQuery('[data-tbtooltip-vl!=""]').qtip({content:{attr:"data-tbtooltip-vl"},style:{classes:"qtip-youtube-tubebuddy",tip:false},position:{at:"bottom left",adjust:{x:-130}}})};var W=function(e,t,i,s,n,r,a){var o=false;var d=e.find("[data-name='"+t+"'][data-type='"+i+"']");if(Z(s,d)){if(a){var l=re(a);var c='<span class="'+l+'">'+n+"</span>";d.html(DOMPurify.sanitize(c,DOMPurifyConfig))}else{d.html(n)}d.prop("data-value",s);if(r){d.prop("data-formatted",r)}else{d.prop("data-formatted",n)}o=true}return o};var Y=function(e,t,i,s){var n=e.find("[data-name='"+t+"'][data-type='subitem']");if(ee(i,n)){try{s(n)}catch(e){TBUtilities.Log(e)}}};var z=function(e,t){return e.length>t?e.substring(0,t-3)+"...":e};var J=async function(e,t,i){var s=o[e];var n=false;try{var a=moment.utc().diff(s.videoPublishDate,"hours");if(a<=72){n=true}}catch(e){TBUtilities.Log(e)}c=0;if(t.length>0){$watchSideBar=D();$watchSideBar.find(".tb-videolytics-loading-tag-rankings").show();if(r[e]==null){r[e]=[]}r[e]=t;if(TBGlobal.Profile().TagRankingInternalApi==true){TubeBuddyYouTubeActions.GetVideoSearchRankTabbed(e,t,q)}else{let i=[];for(tag of t){let t=TubeBuddyYouTubeActions.GetVideoSearchRankPromise(e,tag,1,null,n).then(({videoId:e,searchTerm:t,rank:i})=>{q(e,t,i);return{videoId:e,searchTerm:t,rank:i}}).catch(e=>({videoId:e.videoId,searchTerm:e.searchTerm,rank:-1,extraData:e}));i.push(t)}failedTags=[];await Promise.all(i).then(e=>{failedTags=e.filter(e=>e.rank<0).map(e=>e.searchTerm)});if(failedTags.length>0){TubeBuddyYouTubeActions.GetVideoSearchRankTabbed(e,failedTags,q)}}}};var q=function(e,t,i){try{c++;TBUtilities.Log("gotSearchRank searchTerm = "+t+" rank= "+i);if(d[e]==null){d[e]=0}if(i>0){var s=d[e];d[e]=s+1;TBUtilities.Log("Rank count = "+d[e]);K(e,t,i)}if(c>=r[e].length){TBUtilities.Log("done with search rank check");$(e)}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] gotSearchRank"})}};var $=function(e){jQuery("#tb-videolytics-loading-tag-rankings-legend").show();jQuery("#tb-videolytics-loading-tag-rankings").hide();jQuery("#tb-videolytics-loading-tag-rankings-legend").html('<span style="opacity: .95;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">X</span> = Where this video ranks in YouTube Search Results (<a style="text-decoration:underline;font-weight:500" href="https://tubebuddy.freshdesk.com/support/solutions/articles/5000868154-tag-rankings-new" target="_blank">For You</a>)');var t=D();var i=jQuery(".tb-videolytics-tags-body[data-videoid='"+e+"']");var s=i.attr("data-type");t.find(".tb-videolytics-loading-tag-rankings").hide();t.find(".tb-videolytics-loading-tag-rankings-legend").show();if(TBGlobal.Profile().TagRankingInternalApi==true){t.find(".tb-videolytics-loading-tag-rankings-legend").html('<span style="opacity: .95;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">X</span> = Where this video ranks in YouTube Search Results (<a style="text-decoration:underline;font-weight:500" href="https://tubebuddy.freshdesk.com/support/solutions/articles/5000868154-tag-rankings-new" target="_blank">* For You</a>)')}else{t.find(".tb-videolytics-loading-tag-rankings-legend").html('<span style="opacity: .95;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">X</span> = Where this video ranks in YouTube Search Results (<a style="text-decoration:underline;font-weight:500" href="https://tubebuddy.freshdesk.com/support/solutions/articles/5000868154-tag-rankings-new" target="_blank">* For You</a>)')}var n=t.find("[data-name='rankedTags'][data-type='"+s+"']");n.html(d[e]);n.prop("data-value",d[e]);n.prop("data-formatted",d[e]);if(s=="secondary"){ne("rankedTags");t.find(".tb-rankedTags-compare-loading").hide()}else{try{var r=1;var a=d[e];if(a>8){r=5}else if(a>6){r=4}else if(a<=6&&a>4){r=3}else if(a<=4&&a>=2){r=2}else if(a<2){r=1}var o=t.find("[data-name='rankedTags'][data-type='subitem']");if(ee(r,o)){try{var l=ae(r);o.find("span").text(l)}catch(e){TBUtilities.Log(e)}}}catch(e){TBUtilities.Log(e)}}};var K=function(e,t,i){var s=t.toLowerCase();if(t.indexOf("(")>0){s=t.substring(0,t.indexOf("("))}var n=jQuery(".tb-videolytics-tags-body[data-videoid='"+e+"']");var r=n.find(".tb-videolytics-tag[data-tag='"+escape(s)+"']");if(r&&r.find(".tb-videolytics-tag-rank").length==0){r.append('&nbsp;&nbsp;<span class="tb-videolytics-tag-rank" style="opacity: .75;background-color:green; color:white;line-height: 14px;font-size: 10px;padding: 1px 5px 0px 4px;border-radius: 3px;position: relative;font-weight: 500;">'+i+"</span>&nbsp;")}else{TBUtilities.Log("addSearchRankToTag tag not found found")}};var X=function(e,t){var i=D();i.find(".tb-videolytics-copy-tags[data-type='"+t+"']").attr("data-tags-list",e.join(", "))};var Z=function(e,t){var i=false;if(n==null){n=jQuery("#tb-videolytics-na-template").html()}if(e!=null&&e!="error"&&isNaN(e)==false&&isFinite(e)==true){i=true}else{t.html(n);i=false}return i};var ee=function(e,t){var i=false;if(e!=null&&e!="error"&&(isNaN(e)==false||e.length>0)){t.parent().show();i=true}else{t.parent().hide();i=false}return i};var te=function(e,i){var s=D();var n='<span class="tb-font-size9" style="opacity:0.5">same channel</span>';try{var r="channel-views";if(W(s,r,i,e.channelViews,e.channelViewsFormatted)){if(i!="primary"){if(e.channelId==t){}else{ne(r)}}}}catch(e){TBUtilities.Log(e)}try{var r="subscribers";if(e.subscribersFormatted!="error"&&e.subscribers=="error"){e.subscribers=0}if(W(s,r,i,e.subscribers,e.subscribersFormatted)){if(i!="primary"){if(e.channelId==t){}else{ne(r)}}}}catch(e){TBUtilities.Log(e)}try{var r="videocount";if(W(s,r,i,e.channelVideos,e.channelVideosFormatted)){if(i!="primary"){if(e.channelId==t){}else{ne(r)}}}}catch(e){TBUtilities.Log(e)}};var ie=function(e,t){var i=D();i.find(".tb-videolytics-best-practices-loading").hide();i.find(".tb-videolytics-video-bestpractices").show();try{var s=jQuery(".tb-videolytics-best-practice-pinned-comment");if(e.commentPinned===true){s.html(b)}else if(e.commentPinned===false){s.html(m)}else{s.html(h)}}catch(e){TBUtilities.Log(e)}try{var s=jQuery(".tb-videolytics-best-practice-hearted-comment");if(e.commentHearted===true){s.html(b)}else if(e.commentHearted===false){s.html(m)}else{s.html(h)}}catch(e){TBUtilities.Log(e)}try{var s=jQuery(".tb-videolytics-best-practice-info-cards");if(e.infoCardsExist===true){s.html(b)}else if(e.infoCardsExist===false){s.html(m)}else{s.html(h)}}catch(e){TBUtilities.Log(e)}try{var s=jQuery(".tb-videolytics-best-practice-endscreens");if(e.endScreenExist===true){s.html(b)}else if(e.endScreenExist===false){s.html(m)}else{s.html(h)}}catch(e){TBUtilities.Log(e)}try{var s=jQuery(".tb-videolytics-best-practice-thumbnail");if(e.highResThumbnailExist===true){s.html(b)}else if(e.highResThumbnailExist===false){s.html(m)}else{s.html(h)}}catch(e){TBUtilities.Log(e)}try{var s=jQuery(".tb-videolytics-best-practice-facebook");if(e.likedOnFacebook===true){s.html(b)}else if(e.likedOnFacebook===false){s.html(m)}else{s.html(h)}}catch(e){TBUtilities.Log(e)}try{var s=jQuery(".tb-videolytics-best-practice-captions");s.parent().attr("title","");if(e.captionsExist===true){s.html(b)}else if(e.captionsExist===false){s.html(m)}else{s.html(h);s.parent().attr("title","Captions check failed.  This could be due to an adblocker.")}}catch(e){TBUtilities.Log(e)}try{var s=jQuery(".tb-videolytics-best-practice-chapters");s.parent().attr("title","");if(e.chaptersAdded===true){s.html(b)}else if(e.chaptersAdded===false){s.html(m)}else{s.html(h);s.parent().attr("title","Chapters check failed.")}}catch(e){TBUtilities.Log(e)}};var se=function(e,t){var i=D();i.find(".tb-videolytics-social-loading").hide();i.find(".tb-videolytics-video-social").show();try{var s="facebooklikes";if(W(i,s,t,e.facebookLikeCount,e.facebookLikeCountFormatted)){if(t!="primary"){ne(s)}}}catch(e){TBUtilities.Log(e)}try{var s="redditup";if(W(i,s,t,e.redditUps,e.redditUpsFormatted)){if(t!="primary"){ne(s)}else{i.find(".tb-reddit-search").attr("href",e.redditSearchUrl)}}}catch(e){TBUtilities.Log(e)}try{var n='"https://www.youtube.com/watch?v='+e.videoId+'" OR "https://youtu.be/'+e.videoId+'"';e.twitterUrl="https://twitter.com/search?f=tweets&vertical=default&q="+TBUtilities.GetUrlEncoded(n);i.find(".tb-twitter-search-url").attr("href",e.twitterUrl)}catch(e){TBUtilities.Log(e)}};var ne=function(e){var t=D();var i=parseFloat(t.find("[data-name='"+e+"'][data-type='primary']").prop("data-value"));var s=t.find("[data-name='"+e+"'][data-type='primary']").prop("data-formatted").toString();var n=parseFloat(t.find("[data-name='"+e+"'][data-type='secondary']").prop("data-value"));var r=t.find("[data-name='"+e+"'][data-type='secondary']").prop("data-formatted").toString();s=TBUtilities.ReplaceAll(s,"tb-videolytics-abbrev","");r=TBUtilities.ReplaceAll(r,"tb-videolytics-abbrev","");var a=false;var o=0;if(n>i){o=i/n*100}else if(n<i){a=true;o=n/i*100}else{a=true;o=100}if(o<=1){o=2}t.find(".tb-"+e+"-container").hide();var d="."+e+"-compare-chart-progress";var l=t.find(d);l.parent().show();if(l.find(".tb-progress-fill-primary").length==0){var c=jQuery("#tb-videolytics-bar-template").html();if(a){var u=c.formatTemplate(100,s,"tb-progress-fill-primary",i);l.append(u)}else{var u=c.formatTemplate(o,s,"tb-progress-fill-primary",i);l.append(u)}}if(l.find(".tb-progress-fill-secondary").length==0){if(a){var u=c.formatTemplate(o,r,"tb-progress-fill-secondary",n);l.append(u)}else{var u=c.formatTemplate(100,r,"tb-progress-fill-secondary",n);l.append(u)}}l.find(".tb-horizontal .tb-progress-fill span").each(function(){var e=jQuery(this).attr("data-percent");jQuery(this).parent().css("width",e+"%")})};var re=function(e){var t="na";switch(e){case 1:{t="tb-videolytics-score1";break}case 2:{t="tb-videolytics-score2";break}case 3:{t="tb-videolytics-score3";break}case 4:{t="tb-videolytics-score4";break}case 5:{t="tb-videolytics-score5";break}}return t};var ae=function(e){var t="na";switch(e){case 1:{t="Very Poor";break}case 2:{t="Poor";break}case 3:{t="Fair";break}case 4:{t="Good";break}case 5:{t="Awesome!";break}}return t};var oe=function(e){var t={Enabled:e};TBUtilities.Log(t);var i=TBGlobal.host+TBGlobal.apiUrls.videoLyticsToggle;TBExtension.Post(i,JSON.stringify(t),"",null,{contentType:"application/json"})};var de=function(){var e=D();e.find(".tb-compare-chart").hide();e.find(".tb-primary-container").show();e.find(".tb-videolytics-compare-text-edit").hide();e.find(".tb-videolytics-video-bestpractices-container").show();e.find("#videolyticsVideoId").val("");e.find(".tb-videolyticsClear").hide();TBUtilities.RemoveCookie("tb-videolytics-saved-videoid-"+TBGlobal.CurrentChannelId());e.find('[data-name="rankedTags"][data-type="primary"]').show();try{var t=e.find("[data-name='views-historical']");var i=t.highcharts();var s=i.series.length;for(var n=s-1;n>-1;n--){if(i.series[n].name=="secondary")i.series[n].remove()}i.series[0].update({type:"area"});i.redraw()}catch(e){TBUtilities.Log(e)}e.find(".tb-videolytics-image-compare-container").hide();var r=e.find(".tb-videolytics-compare-tags[data-type='secondary']");r.hide();r.find(".tb-videolytics-tags-body").empty();e.find(".tb-videolytics-copy-tags[data-type='secondary']").hide();e.find(".tb-videolytics-compare-tags-label").show();e.find(".tb-videolytics-tag-duplicate").removeClass("tb-videolytics-tag-duplicate");e.find(".tb-videolytics-bar").remove();e.find(".tb-videolytics-compare-text").show();Re();e.find(".tb-videolytics-seo-studio-score[data-tb-compare]").remove();e.find(".tb-videolytics-category-container-seo").show();if(e.find("#tt-seoscore").attr("data-channel-primary-videoid")){e.find(".tb-videolytics-seo-studio-score").removeClass("tb-hidden")}else{e.find(".tb-videolytics-seo-studio-score").addClass("tb-hidden")}};var le=function(){jQuery(document).on("click",".tb-videolytics-tag",function(){var e=unescape(jQuery(this).attr("data-tag"));TBUtilities.ReportProductEvent("Feature Used",{Tool:TBGlobal.GetToolById("videolytics").name,Action:"Keyword Explorer Opened"});TubeBuddyKeywordExplorer.Show(e)});jQuery(document).on("click",".tb-videolytics-chart",function(){var e=null;var i=null;switch(TBGlobal.GetYouTubeUI()){case"studio":case"material":{var e="";jQuery("#top-row .ytd-video-owner-renderer").each(function(){e=jQuery(this).find("a:first").text();if(e!=""){return false}});i=jQuery("#top-row #avatar").find("img:first").attr("src");break}case"default":{e=jQuery("#watch7-user-header").find("a:first").text;i=jQuery("#watch7-user-header").find("img:first").attr("src");break}}if(t&&e&&i){TubeBuddyChannelytics.ShowForChannel(t,e,i)}});jQuery(document).on("click",".tb-videolytics-compare-text-edit",function(){he()});jQuery(document).on("click",".tb-videolytics-enabled-img",function(){TBGlobal.Profile().SettingsShowVideolytics=true;oe(true);g(false)});jQuery(document).on("click",".tb-videolytics-non-english-load",function(){var e=D();var t=e.find(".tb-videolytics-container-non-english");if(t.length>0){t.remove()}g(false,true)});jQuery(document).on("click",".tb-videolytics-disable-img",function(){var e=jQuery(this);newSrc=e.attr("data-toggle-img");e.attr("data-toggle-img",e.attr("src"));e.attr("src",newSrc);var t=D();var i=t.find(".tb-videolytics-container");if(i.is(":visible")){i.slideUp();oe(false);TBGlobal.Profile().SettingsShowVideolytics=false;t.find(".tb-videolytics-compare-show").hide();i.hide();if(t.find(".tb-videolytics-container-disabled").length==0){switch(TBGlobal.GetYouTubeUI()){case"studio":case"material":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0){var s=jQuery(".tb-videolytics-container-disabled")[0].outerHTML;jQuery("#player-ads").after(DOMPurify.sanitize(s,DOMPurifyConfig))}break}case"default":{if(jQuery(".tb-videolytics-container-disabled:visible").length==0){var s=jQuery(".tb-videolytics-container-disabled")[0].outerHTML;t.prepend(DOMPurify.sanitize(s,DOMPurifyConfig))}break}}}else{if(jQuery(".tb-videolytics-container-disabled:visible").length==0)t.find(".tb-videolytics-container-disabled").show()}}else{t.find(".tb-videolytics-container-disabled").hide();i.slideDown();oe(true);TBGlobal.Profile().SettingsShowVideolytics=true;t.find(".tb-videolytics-compare-show").show()}});jQuery(document).on("click",".tb-videolytics-search",function(){var e="https://www.youtube.com/";var t=window.open(e,"_blank")});jQuery(document).on("click",".tb-videolytics-toggle-row",function(){var e=jQuery(this);newSrc=e.attr("data-toggle-img");e.attr("data-toggle-img",e.attr("src"));e.attr("src",newSrc);var t=D();var i=e.attr("data-category-id");var s=t.find(".tb-videolytics-category-body[data-category-id='"+i+"']");if(s.is(":visible")){s.slideUp();ce(i)}else{s.slideDown();ue(i)}});jQuery(document).on("click",".tb-videolytics-search-ranking",function(){jQuery(this).hide();var e=D();var t=jQuery(this).parent().siblings(".tb-videolytics-tags-body");var i=t.attr("data-videoid");var s=t.attr("data-type");var n=[];t.find(".tb-videolytics-tag").each(function(e){var t=jQuery(this).attr("data-tag");n.push(unescape(t))});J(i,n,s)});jQuery(document).on("click",".tb-videolytics-search-ranking-text",function(){jQuery(this).text("Loading...");var e=D();y=true;var t=e.find(".tb-videolyticsClear:visible").length>0?"secondary":"primary";if(t!="primary"){e.find(".tb-videolytics-search-ranking:first").click();e.find('[data-name="rankedTags"][data-type="primary"]').hide();e.find('[data-name="rankedTags"][data-type="primary"]').after('<span class="tb-rankedTags-compare-loading">Loading...</span>');var i=setInterval(function(){if(e.find('[data-name="rankedTags"][data-type="primary"]').prop("data-formatted")!=null&&!isNaN(parseInt(e.find('[data-name="rankedTags"][data-type="primary"]').text().trim()))){clearInterval(i);e.find(".tb-videolytics-search-ranking:last").click()}},500)}else{e.find(".tb-videolytics-search-ranking:first").click()}});jQuery(document).on("click",".tb-videolytics-copy-tags",function(e){e.stopPropagation();if(TBExtension.GetType()=="crossrider"){window.prompt("Top copy Tags to your clipboard, Press Ctrl+C then Enter",jQuery(this).attr("data-clipboard-text"));e.stopPropagation()}else{var t=jQuery(this).attr("data-tags-list");if(t){var i=t.split(",");TubeBuddyCopyTo.ShowMenu(jQuery(this),i)}}});jQuery(document).on("click",".tb-videolytics-compare-show",function(){he()});jQuery(document).on("click",".tb-videolyticsCancel",function(){he()});jQuery(document).on("click",".tb-videolyticsClear",function(){de();if(jQuery(".tb-videolytics-compare-container").is(":visible")){he()}});jQuery(document).on("click",".tb-videolyticsCompare",function(){TBUtilities.Log("Videolytics .videolyticsCompare click");var e=jQuery("input[name=tb-videolytics-compareVid]:checked").val();if((e==1||e==2)&&TBGlobal.CanAccessLevel1Tools()==false){TBGlobal.ShowUpgradePage("use this option","Pro");return}switch(e){case"0":case"1":case"2":{ye();var i=TBGlobal.host+TBGlobal.apiUrls.videolyticsGetVideoToCompare+"?type="+e+"&channelId="+t;TBExtension.Get(i,"CRTBVideolyticsGetVideoToCompare");break}case"3":{var s=jQuery("#watch7-sidebar");s.find(".tb-videolytics-compareVid-error-container").hide();var n=jQuery("#videolyticsVideoId").val().trim();var r=null;if(n.length==11){r=n}else{var a=/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;var o=n.match(a);if(o&&o[2].length==11){r=o[2]}else{s.find(".tb-videolytics-compareVid-error-container").show();s.find(".tb-videolytics-compareVid-error").text("Invalid video URL")}}if(r!=null){ye();Fe(r)}break}}he()});jQuery(document).on("click",".tb-videolytics-tools-menu-button",function(e){e.stopPropagation();var t=jQuery(this).offset();var i=jQuery(".tb-videolyitcs-tools-menu");i.css({position:"absolute",top:t.top+25+"px",left:t.left-5+"px",zIndex:4e3});i.show()});jQuery(document).bind("click",function(e){var t=jQuery(e.target);if(!t.parents().hasClass("tb-videolyitcs-tools-menu")){jQuery(".tb-videolyitcs-tools-menu").hide()}});jQuery(document).on("click",".tb-videolytics-tools-button",function(){var e=jQuery(this).attr("data-tool");var i=t!=TBGlobal.CurrentChannelId();var n=document.getElementsByTagName("title")[0].innerHTML.replace("- YouTube","");var r="https://img.youtube.com/vi/"+s+"/0.jpg";TubeBuddyMenu.ShowBackgroundSticky();switch(e){case"advanced-embed":TubeBuddyEmbed.ShowForVideo(s,n,r);break;case"search-rank":TubeBuddySearchRanking.Show(s,r,n);break;case"share-tracker":TubeBuddyShareTracker.ShowForVideo(s,n,r);break;case"vid2vid-promotion":TubeBuddyV2VPromote.Show(s,n,r,i);break}jQuery(".tb-videolyitcs-tools-menu").hide()});jQuery(document).on("click","#tb-videolytics-word-cloud-btn",function(e){var t="";var i="";var s=TBGlobal.CurrentChannelId();var n=0;jQuery("div#contents").find("ytd-comment-thread-renderer.ytd-item-section-renderer").each(function(){i=jQuery(this).find("div#header-author a#author-text").attr("href");if(i=="/channel/"+s){return}else{t+=jQuery(this).find("yt-formatted-string#content-text").text()}n=n+1;TBUtilities.Log("Comment #"+n+" - This comment channel's Id is: "+i)});TBGlobal.ShowWordCloud(t)});jQuery(document).on("click",".tb-videolytics-seo-studio-score",function(e){e.stopPropagation();var t=D();var i=jQuery(this).attr("data-tb-compare");var s=jQuery(this).attr("data-score-type");var n;var r;if(i=="primary"){r=jQuery(".tb-videolytics-vid-compare[data-videoid]:first").attr("data-videoid");n=t.find("#tt-seoscore").attr("data-seostudio-kw-primary")}else if(i=="secondary"){r=jQuery(".tb-videolytics-vid-compare[data-videoid]:last").attr("data-videoid");n=t.find("#tt-seoscore").attr("data-seostudio-kw-secondary")}else{r=jQuery("[data-videoid]").attr("data-videoid");n=t.find("#tt-seoscore").attr("data-seostudio-kw-primary")}jQuery(".tb-videolytics-seo-studio-kw-prompt-container").attr("data-video-id",r).attr("data-compare-mode",i).attr("data-score-type",s);jQuery(".tb-videolytics-seo-studio-kw-prompt-container .tb-videolytics-seo-studio-launch").attr("href","https://studio.youtube.com/video/"+r+"/edit");if(n){jQuery(".tb-videolytics-seo-studio-kw-prompt-container .tb-videolytics-seo-studio-kw-current").text(n);jQuery(".tb-videolytics-seo-studio-kw-prompt-container .tb-videolytics-seo-studio-kw").show()}else{jQuery(".tb-videolytics-seo-studio-kw-prompt-container .tb-videolytics-seo-studio-kw-current").text("");jQuery(".tb-videolytics-seo-studio-kw-prompt-container .tb-videolytics-seo-studio-kw").hide()}if(t.find(".tb-videolytics-seo-studio-kw-prompt-container").length==0){var a=jQuery("#tb-videolytics-seo-studio-kw-prompt-template").html();jQuery(this).closest(".tb-videolytics-category-section").append(a);t.find(".tb-videolytics-seo-studio-kw-prompt-container").show()}else{t.find(".tb-videolytics-seo-studio-kw-prompt-container").show()}});jQuery(document).on("click",".tb-videolytics-seo-studio-close-kw-prompt",function(e){e.stopPropagation();var t=jQuery(".tb-videolytics-seo-studio-kw-prompt-container");t.removeAttr("data-video-id data-compare-mode data-score-type");t.find(".tb-videolytics-seo-studio-kw-input").val("");t.hide()});jQuery(document).click(function(){jQuery(".tb-videolytics-seo-studio-close-kw-prompt").click()});jQuery(document).on("click",".tb-videolytics-seo-studio-kw-prompt-container",function(e){e.stopPropagation()});jQuery(document).on("click",".tb-videolytics-seo-studio-launch",function(e){e.stopPropagation();TBExtension.SetDbValue("tb-video-edit-open-"+TBGlobal.CurrentChannelId(),"seostudio");jQuery(".tb-videolytics-seo-studio-close-kw-prompt").click()})};var ce=function(e){e=e.trim();var t=[];var i=TBUtilities.GetCookie("tb-videolytics-category-hide");if(i){t=JSON.parse(i);if(jQuery.inArray(e,t)==-1){t.push(e)}}else{t.push(e)}if(t.length>0){var s=JSON.stringify(t);TBUtilities.CreateCookie("tb-videolytics-category-hide",s,5e3)}};var ue=function(e){e=e.trim();var t=[];var i=TBUtilities.GetCookie("tb-videolytics-category-hide");if(i){t=JSON.parse(i);var s=t.indexOf(e);if(s>-1){t.splice(s,1)}}if(t.length>0){var n=JSON.stringify(t);TBUtilities.CreateCookie("tb-videolytics-category-hide",n,5e3)}else{TBUtilities.RemoveCookie("tb-videolytics-category-hide")}};var pe=function(){var e=TBUtilities.GetCookie("tb-videolytics-category-hide");if(e){var t=[];t=JSON.parse(e);var i=D();jQuery.each(t,function(e,t){var s=i.find(".tb-videolytics-category-body[data-category-id='"+t+"']");s.slideUp();var n=i.find(".tb-videolytics-toggle-row[data-category-id='"+t+"']");var r=n.attr("data-toggle-img");n.attr("data-toggle-img",n.attr("src"));n.attr("src",r)})}};var ye=function(e){var t=D();var i='<div class="tb-spinner"></div>'+'<span class="tb-move-up2" style="margin-left:10px; color: '+(TBGlobal.IsDarkMode()?"white":"black")+' !important; font-size: 130%">Loading...</span>';t.find(".tb-videolytics-container").block({message:i,css:{padding:"30px 20px;",backgroundColor:"transparent",border:"none"},overlayCSS:{backgroundColor:TBGlobal.IsDarkMode()?"rgb(2,2,2)":"rgb(255,255,255)",opacity:.8,cursor:"unavailable"}});t.find(".tb-videolytics-container-loading").show()};var be=function(e){var t=D();t.find(".tb-videolytics-container").unblock();t.find(".tb-videolytics-container-body").show();t.find(".tb-videolytics-container-loading").hide()};var me=function(e){var t=D();t.find(".tb-videolyticsClear").show();t.find(".tb-videolytics-image-compare-primary").prop("src","https://img.youtube.com/vi/"+s+"/mqdefault.jpg");t.find(".tb-videolytics-image-compare-primary").parent().attr("data-videoid",s);t.find(".tb-videolytics-image-compare-secondary").prop("src","https://img.youtube.com/vi/"+e+"/mqdefault.jpg");t.find(".tb-videolytics-image-compare-secondary").parent().attr("data-videoid",e);t.find(".tb-videolytics-image-compare-secondary").prop("data-videoid",e);t.find(".tb-videolytics-image-compare-secondary-link").prop("href","https://www.youtube.com/watch?v="+e);t.find(".tb-videolytics-compare-text").hide();t.find(".tb-videolytics-compare-text-edit").show();t.find(".tb-videolytics-image-compare-container").show()};var he=function(){var e=D();var t=jQuery(".tb-videolytics-compare-show-img"),i=t.attr("data-toggle-img");t.attr("data-toggle-img",t.attr("src"));t.attr("src",i);if(jQuery(".tb-videolytics-compare-container").is(":visible")){jQuery(".tb-videolytics-compare-container").slideUp("fast");if(jQuery(".tb-videolytics-compare-text-edit").is(":visible")==false){e.find(".tb-videolytics-compare-text").show()}}else{jQuery(".tb-videolytics-compare-container").slideDown("fast");e.find(".tb-videolytics-compare-text").hide()}};var ve=function(e){TBUtilities.Log("parseDataFromPage");var i=TBGlobal.GetYouTubeUIFromHtml(e.html);switch(i){case"studio":case"material":{e.responseContext=TBUtilities.ParseResponseContextFromHtml(e.html);e.creatorSuggestedCount=0;var s;try{var n=e.responseContext.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results.filter(e=>e.itemSectionRenderer);if(n&&n.length>0){s=n[0].itemSectionRenderer.contents}else{s=e.responseContext.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results}e.suggestedCount=s.length;e.creatorSuggestedCount=s.filter(e=>e.compactVideoRenderer&&e.compactVideoRenderer.longBylineText.runs[0].navigationEndpoint.browseEndpoint.browseId==t).length}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddy Videolytics] error parsing creator suggested count"})}var r=0;var a=1;if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0].videoPrimaryInfoRenderer){r=0}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1].videoPrimaryInfoRenderer){r=1}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2].videoPrimaryInfoRenderer){r=2}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3].videoPrimaryInfoRenderer){r=3}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[0].videoSecondaryInfoRenderer){a=0}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[1].videoSecondaryInfoRenderer){a=1}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[2].videoSecondaryInfoRenderer){a=2}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3]&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[3].videoSecondaryInfoRenderer){a=3}e.channelId=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.navigationEndpoint.browseEndpoint.browseId;e.title="";if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.title.simpleText){e.title=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.title.simpleText}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.title.runs){e.title=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.title.runs[0].text}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.description&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.description.simpleText){e.description=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.description.simpleText}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.description&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.description.runs&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.description.runs.length>0){var o="";try{jQuery.each(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.description.runs,function(e,t){o+=t.text})}catch(e){TBUtilities.Log(e)}e.description=o}else{e.description=""}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.viewCount){var d=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.viewCount.videoViewCountRenderer.viewCount.simpleText;var l=null;if(d)l=d.match(/\d/g);if(l==null){l=0}else{l=l.join("")}e.views=parseInt(l);e.viewsFormatted=TBUtilities.FormatNumberAbbreviated(e.views,null,"tb-videolytics-abbrev")}else{e.views="na";e.viewsFormatted="na"}if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.dateText&&e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.dateText.simpleText){var c=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.dateText.simpleText;var u=new Date(c);e.videoPublishDate=moment(u)}else{var p=new Date;p.setDate(p.getDate()-3);e.videoPublishDate=moment(p)}var y=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[r].videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons[0].toggleButtonRenderer.accessibility.label;var l=y.match(/\d/g);if(l==null){l=0}else{l=l.join("")}e.likes=parseInt(l);e.likesFormatted=TBUtilities.FormatNumberAbbreviated(e.likes);var b=setInterval(function(){if(jQuery(".ad-showing").length==0){clearInterval(b);var t=jQuery("span.ytp-time-duration").text();var i=t.split(":");var s=0;var n=0;var r=0;if(i.length==3){s=jQuery.trim(i[0]);n=jQuery.trim(i[1]);r=jQuery.trim(i[2])}else if(i.length==2){n=jQuery.trim(i[0]);r=jQuery.trim(i[1])}else if(i.length==1){r=jQuery.trim(i[0])}var a=moment.duration({seconds:r,minutes:n,hours:s});e.adsCompleted=true;e.durationInMilliseconds=a.valueOf()}else{e.adsCompleted=false}},1e3);if(e.subscribers=="error"){try{var m="";if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.subscriberCountText.simpleText!==undefined){m=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.subscriberCountText.simpleText}else if(e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.subscriberCountText.runs[0].text!==undefined){m=e.responseContext.contents.twoColumnWatchNextResults.results.results.contents[a].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.subscriberCountText.runs[0].text!==undefined}else{throw"Subscriber count not found"}var h=m.lastIndexOf(" ");m=m.substring(0,h);e.subscribersFormatted=m}catch(t){e.subscribers="error";e.subscribersFormatted="error"}}break}case"default":{e.$html=jQuery.parseHTML(DOMPurify.sanitize(e.html,DOMPurifyConfig));e.channelId=jQuery(e.$html).find("meta[itemprop=channelId]").attr("content");e.title=jQuery(e.$html).find("#eow-title").text();e.description=jQuery(e.$html).find("#eow-description").text();var d=jQuery(e.$html).find(".watch-view-count").html();var l=d.match(/\d/g);if(l==null){l=0}else{l=l.join("")}e.views=parseInt(l);e.viewsFormatted=TBUtilities.FormatNumberAbbreviated(e.views,null,"tb-videolytics-abbrev");var y=jQuery(e.$html).find("span.like-button-renderer:first").find(".like-button-renderer-like-button:first").find(".yt-uix-button-content:first").text();var l=y.match(/\d/g);if(l==null){l=0}else{l=l.join("")}e.likes=parseInt(l);e.likesFormatted=TBUtilities.FormatNumberAbbreviated(e.likes);var v=jQuery(e.$html).find("meta[itemprop=datePublished]").attr("content");e.videoPublishDate=moment(v);var f=jQuery(e.$html).find("meta[itemprop=duration]").attr("content");var g=moment.duration(f);e.durationInMilliseconds=g.valueOf();var T=jQuery(e.$html).find("#watch-related");e.creatorSuggestedCount="na";e.suggestedCount="na";break}}};var fe=function(e,t,i,s){jQuery("#"+e).tipso({titleContent:t,size:"14px;",background:"#ddd",useTitle:false,color:"#222",tooltipHover:true,speed:200,titleColor:"#fff",titleBackground:"#454545",delay:750,hideDelay:0,content:"<div>"+i+'</div><div style="padding-top:6px; font-size:.9em; border-top:dashed 1px #bbb; margin-top:6px;">Sub Item: '+s+"</div>",position:"bottom",offsetY:10})};var ge=function(e,t){Te(e);je(e);Se(e,t)};var Te=function(e){try{if(e.creatorSuggestedCount!="error"&&e.suggestedCount!="error"&&e.suggestedCount!=0){var t=1;var i=e.creatorSuggestedCount/e.suggestedCount*100;if(i>=65){t=5}else if(i>50){t=4}else if(i<=50&&i>20){t=3}else if(i<=20&&i>10){t=2}else if(i<=10){t=1}e.creatorSuggestedScore=t}}catch(t){TBUtilities.Log(t);e.creatorSuggestedScore="error"}try{e.creatorSuggestedFormatted=e.creatorSuggestedCount+"/20"}catch(t){TBUtilities.Log(t);e.creatorSuggestedCount="error";e.suggestedCount="error"}};var je=function(e){try{var t=e.title.toLowerCase();var i=e.description.toLowerCase();var s=0;var n=0;jQuery.each(e.tags,function(e,r){if(r!=""){if(t.indexOf(r.toLowerCase())!=-1){s++}if(i.indexOf(r.toLowerCase())!=-1){n++}}});e.tagsIn=s+n}catch(t){TBUtilities.Log(t);e.tagsIn="error"}try{if(e.tagsIn!="error"){var r=1;if(e.tagsIn>12){r=5}else if(e.tagsIn>9){r=4}else if(e.tagsIn<=9&&e.tagsIn>4){r=3}else if(e.tagsIn<=4&&e.tagsIn>=2){r=2}else if(e.tagsIn<2){r=1}e.tagsInScore=r}}catch(t){TBUtilities.Log(t);e.tagsInScore="error"}};var Qe=function(e){if(v){v.destroy()}jQuery("#tb-videolytics-seoscore-chart").empty();var t=e>70?f[2]:e>50?f[1]:f[0];v=new JustGage({id:"tb-videolytics-seoscore-chart",min:0,max:100,gaugeWidthScale:.8,value:e,valueFontFamily:"inherit",valueFontColor:t,customSectors:{ranges:[{color:f[0],lo:0,hi:50},{color:f[1],lo:51,hi:70},{color:f[2],lo:71,hi:100}]},donut:true,counter:true,startAnimationTime:1e3,refreshAnimationTime:1e3,label:"",onAnimationEnd:Be})};var Be=function(){var e=jQuery("#tb-videolytics-seoscore-chart text:first");var t=parseInt(e.attr("y"));e.attr("y",t+2)};var we=function(e,t,i,s,n){return new Promise((n,r)=>{var a={targetKeyword:e.normalize("NFKC"),title:t.normalize("NFKC"),description:i&&i.length>0?i.normalize("NFKC"):"",tags:s&&s.length>0?s.normalize("NFKC").split(","):[""]};var o=TBGlobal.host+TBGlobal.apiUrls.seoScoreGetCalculation;TBExtension.Post(o,JSON.stringify(a),(a,o,d)=>{try{if(a){var l=JSON.parse(d);l.scoringMethod="seostudio";l.keyword=e;l.title=t;l.description=i;l.tags=s;l.scoreItems=[...l.metaImprovements,...l.tagImprovements];n(l)}else{TBUtilities.LogError(`Error fetching SEO Score. Res: ${d}`);r("Error fetching SEO Score")}}catch(e){TBUtilities.Log(e);r("Error fetching SEO Score. ex: "+e.toString())}},null,{contentType:"application/json",dataType:"text"})})};var ke=function(e,t,i,s){if(!e.title||!e.description||!e.tagString){return false}else{var n=e.title.replace(/(#\w*)/gm,"").toLowerCase().trim();var r=e.description.toLowerCase().trim();var a=e.tagString.toLowerCase().trim();if(n!=t||r!=i||a!=s){return false}else{return true}}};var Ee=function(e,t,i,s){if(!e||e==undefined)return;return new Promise(function(n,r){var a=window.localStorage.getItem("tb-seostudio-score-"+TBGlobal.CurrentChannelId()+"-"+e);if(a&&a!="undefined"&&ke(JSON.parse(a),t.toLowerCase().trim(),i.toLowerCase().trim(),s.join(",").toLowerCase().trim())){n(JSON.parse(a))}else{var o=TBGlobal.host+TBGlobal.apiUrls.seoScoreGetByVideoId+"?videoId="+e;TBExtension.Get(o,async function(t,i,s){try{if(t){var o=JSON.parse(s);if(o&&o.Id){a=await we(o.Keyword,o.Title,o.Description,o.Tags,e);window.localStorage.setItem("tb-seostudio-score-"+TBGlobal.CurrentChannelId()+"-"+e,JSON.stringify(a));n(a)}else{n()}}else{r("Error retrieving saved optimization")}}catch(e){r("Error retrieving saved optimization");TBUtilities.LogError({Exception:e,Location:"[TubeBuddy Videolytics] check for seo studio score"})}},null,{contentType:"application/json"})}})};var xe=function(e){return e.replace(/[\u0021-\u002f\u003a-\u0040\u005b-\u0060\u007b-\u007e\u00a1-\u00bf\u2022]/gm," ")};var Ce=function(e){var t=xe(e.title.normalize("NFKC")).toLowerCase();var i=xe(e.description.normalize("NFKC")).toLowerCase();var s=[];var n=[];var r=[];var a=0;var o=[];for(var d=0;d<e.tags.length;d++){var l=xe(e.tags[d].normalize("NFKC")).toLowerCase();a+=l.length;if(t.indexOf(l)>-1){n.push(l);if(i.indexOf(l)>-1){r.push(l);s.push(l)}}else if(i.indexOf(l)>-1){r.push(l)}}var c=0;if(s.length>=3){c=20}else if(s.length==2){c=15}else if(s.length==1){c=10}var u=0;if(n.length>=2){u=20}else if(n.length==1){u=10}var p=0;if(r.length>=4){p=20}else if(r.length==3){p=15}else if(r.length==2){p=10}else if(r.length==1){p=5}var y=0;if(a>=300){y=20}else if(a>250){y=15}else if(a>200){y=10}else if(a>150){y=5}var b=t.split(/\s/).filter(e=>e.length>0);var m=Array.from(new Set(b));var h=i.split(/\s/).filter(e=>e.length>0);for(var d=0;d<m.length;d++){if(h.indexOf(m[d])>-1){o.push(m[d])}}var v=0;var f=o.length/m.length;if(f>.75){v=20}else if(f>.5){v=10}else if(f>.25){v=5}var g=[{category:"Tags in Title & Description",points:c,possiblePoints:20},{category:"Tags in Title",points:u,possiblePoints:20},{category:"Tags in Description",points:p,possiblePoints:20},{category:"Total Tag Characters",points:y,possiblePoints:20},{category:"Title Words in Description",points:v,possiblePoints:20}];return{scoreItems:g,overallScore:g.map(e=>e.points).reduce((e,t)=>e+t),scoringMethod:"videolytics"}};var Ue=function(e){var t="";if(e.scoringMethod=="seostudio"){var i=e.scoreItems;t+='<div class="tb-bold tb-font-color-light-gray" style="display:flex;align-items:center;margin-bottom:2px;"><span class="tb-font-color-red" style="display:flex;align-items:center;"><i class="material-icons tb-margin-right-5" style="font-size:13px;">my_location</i>Target Keyword: </span><span style="font-size:12px;margin-left:5px;">'+e.keyword+"</span></div>";i.forEach(e=>{var i=e.isCompleted?"tb-font-color-green":"tb-font-color-red";var s=e.isCompleted?"check":"close";t+='<div style="display:flex; justify-content:space-between;margin-bottom:1px;"><div><i class="material-icons '+i+'" style="font-size:13px;">'+s+'</i></div><div style="width:93%;font-size:12px;">'+e.shortText+"</div></div>"})}else{e.scoreItems.forEach(e=>{t+="<li>"+e.category+": "+e.points+"/"+e.possiblePoints+"</li>"})}return t};var Le=function(e,t,i){var s=D();s.find("#tt-seoscore").attr("data-"+t+"-score-type",e.scoringMethod);s.find('[data-name="seoscore"][data-type="'+t+'"]').prop("data-value",e.overallScore);s.find('[data-name="seoscore"][data-type="'+t+'"]').prop("data-formatted",e.overallScore);s.find('[data-name="seoscore"][data-type="'+t+'"]').attr("data-scoring-method",e.scoringMethod);var n=e.scoringMethod=="seostudio"?"TubeBuddy SEO Studio Score ":"TubeBuddy SEO Score ";if(!i){if(t=="primary"){jQuery("#tt-seoscore").attr("data-tbtooltip-vl",'<ul class="tb-videolytics-seoscore-breakdown"><span class="tb-margin-bottom-2 tb-bold tb-videolytics-tooltip-this-video">'+n+"for this video: </span>"+Ue(e)+"</ul>");jQuery(".tb-seoscore-container.tb-primary-container").attr("data-tbtooltip-vl-seoscore-primary",'<ul class="tb-videolytics-seoscore-breakdown"><span class="tb-margin-bottom-2 tb-bold tb-videolytics-tooltip-this-video">'+n+"for this video:</span>"+Ue(e)+"</ul>");jQuery(".tb-videolytics-seo-studio-score").attr("data-score-type",e.scoringMethod)}else if(t=="secondary"){var r=jQuery("#tt-seoscore").attr("data-tbtooltip-vl");r=r.replace("tb-videolytics-tooltip-this-video","tb-videolytics-tooltip-primary");r+='<br /><ul class="tb-videolytics-seoscore-breakdown tb-margin-top-5"><span class="tb-margin-bottom-2 tb-bold tb-videolytics-tooltip-secondary">'+n+"for compare video: </span>"+Ue(e)+"</ul>";jQuery("#tt-seoscore").attr("data-tbtooltip-vl",r)}}else{var r=s.find("#tt-seoscore").attr("data-tbtooltip-vl");var a=r.substring(0,r.search("<br />"));var o=r.substring(r.search("<br />")+6);if(t=="primary"){var d=jQuery(a);d.find("li").remove();d.append(Ue(e));s.find("#tt-seoscore").attr("data-tbtooltip-vl",d.prop("outerHTML")+"<br />"+o)}else{var l=jQuery(o);l.find("li").remove();l.append(Ue(e));s.find("#tt-seoscore").attr("data-tbtooltip-vl",a+"<br />"+l.prop("outerHTML"))}}_()};var Se=function(e,t){var i=D();var s=null;if(e.channelId==TBGlobal.CurrentChannelId()&&TBGlobal.CanAccessLevel1Tools()){if(t=="primary")i.find("#tt-seoscore").attr("data-channel-primary-videoid",e.videoId);else i.find("#tt-seoscore").attr("data-channel-secondary-videoid",e.videoId);i.find(".tb-videolytics-seo-studio-score").removeClass("tb-hidden");Ee(e.videoId,e.title,e.description,e.tags).then(function(n){if(n){s=n;i.find("#tt-seoscore").attr("data-seostudio-kw-"+t,s.keyword);i.find("#tt-seoscore").attr("data-"+t+"-score-type","seostudio")}else{s=Ce(e);i.find("#tt-seoscore").attr("data-"+t+"-score-type","videolytics")}}).catch(function(n){s=Ce(e);i.find("#tt-seoscore").attr("data-"+t+"-score-type","videolytics");TBUtilities.LogError({Exception:n,Location:"[Videolytics] calculate seo score"})})}else{i.find("#tt-seoscore").removeAttr("data-channel-"+t+"-videoid");i.find("#tt-seoscore").removeAttr("data-channel-"+t+"-videoid");i.find("#tt-seoscore").removeAttr("data-"+t+"-score-type");i.find("#tt-seoscore").removeAttr("data-"+t+"-score-type");i.find(".tb-videolytics-seo-studio-score").addClass("tb-hidden");s=Ce(e)}var n=setInterval(function(){if(s!=null){clearInterval(n);Le(s,t);if(t=="primary"){Qe(s.overallScore)}else{ne("seoscore");Ie(e.title,e.description)}}},500)};var Ie=function(e,t){var i=D();var s=setInterval(function(){if(i.find(".seoscore-compare-chart-progress .tb-horizontal-label:visible").length==2){clearInterval(s);var n=i.find("#tt-seoscore[data-channel-primary-videoid]");if(n.length>0){i.find(".seoscore-compare-chart-progress .tb-horizontal-label:first").after('<a class="tb-videolytics-seo-studio-score tb-margin-left-2 tb-videolytics-text" data-tb-compare="primary"><i class="material-icons">create</i></a>')}else{i.find('.tb-videolytics-seo-studio-score[data-tb-compare="primary"]').remove()}var r=i.find("#tt-seoscore[data-channel-secondary-videoid]");if(r.length>0){var a='<a class="tb-videolytics-seo-studio-score tb-margin-left-2 tb-videolytics-text" data-tb-compare="secondary" data-secondary-video-title="'+e+'" data-secondary-video-description="'+t+'"><i class="material-icons">create</i></a>';i.find(".seoscore-compare-chart-progress .tb-horizontal-label:last").after(DOMPurify.sanitize(a,DOMPurifyConfig))}else{i.find('.tb-videolytics-seo-studio-score[data-tb-compare="secondary"]').remove()}}},500)};var Re=function(){var e=jQuery(".tb-seoscore-container.tb-primary-container").attr("data-tbtooltip-vl-seoscore-primary");jQuery("#tt-seoscore").attr("data-tbtooltip-vl",e);_()};var Ve=function(e){try{e.viewHistoricalData=e.chartsObj.views.daily.data}catch(t){TBUtilities.Log(t);e.viewHistoricalData="error"}try{var t=moment(new Date);var i=moment.duration(t.diff(e.videoPublishDate));var s=i.asDays();s=Math.floor(s).toFixed(0);if(s<1){e.durationSincePublish="Published < a day ago"}else{e.durationSincePublish="Published "+TBUtilities.FormatNumberAbbreviated(s)+" days ago"}}catch(t){TBUtilities.Log(t);e.durationSincePublish="error"}};var Ae=function(e){try{var t=e.watchTimeAvgViewDuration.split(":");if(t==""){e.watchTimeAvgViewDurationInMilliSeconds="error";e.watchTimeAvgPercentWatched="error";e.watchTimeAvgViewDuration="error"}else{var i=0;var s=0;var n=0;if(t.length==3){i=jQuery.trim(t[0]);s=jQuery.trim(t[1]);n=jQuery.trim(t[2])}else if(t.length==2){s=jQuery.trim(t[0]);n=jQuery.trim(t[1])}else if(t.length==1){n=jQuery.trim(t[0])}var r=moment.duration({seconds:n,minutes:s,hours:i});e.watchTimeAvgViewDurationInMilliSeconds=r.valueOf();if(e.durationInMilliseconds){var a=e.watchTimeAvgViewDurationInMilliSeconds/e.durationInMilliseconds*100;e.watchTimeAvgPercentWatched=Math.round(a);if(e.watchTimeAvgPercentWatched>100){e.watchTimeAvgPercentWatched=100}e.watchTimeAvgPercentWatchedFormatted=Pe(e.watchTimeAvgPercentWatched)+'<span class="tb-videolytics-abbrev">%<span>'}}}catch(t){TBUtilities.Log(t);e.watchTimeAvgViewDurationInMilliSeconds="error";e.watchTimeAvgPercentWatched="error";e.watchTimeAvgViewDuration="error"}try{var o=moment.duration(e.durationInMilliseconds);var d="ss";if(parseInt(o.asHours().toFixed(2))>0)d="HH:mm:ss";else if(parseInt(o.asMinutes().toFixed(2))>0)d="mm:ss";else if(parseInt(o.asSeconds().toFixed(2))>0)d="ss";e.videoDuration=moment(o._data).format(d)}catch(t){TBUtilities.Log(t);e.videoDuration="error"}};var De=function(e,t){return e+t};var Pe=function(e){if(e>=100){e=e.toFixed(0)}else if(e>=10&&e<100){e=e.toFixed(1)}else if(e<10){e=e.toFixed(2)}return e};var Ge=function(e){if(e>=100){e=e.toFixed(0)}else if(e>=10&&e<100){e=e.toFixed(1)}else if(e<10){e=e.toFixed(2)}return e};var Me=function(e){try{var t=e.chartsObj["watch-time"].daily.data.reduce(De,0);e.watchDurationTotal=moment.duration({seconds:0,minutes:t,hours:0,days:0,years:0});var i="";var s="";var n="";if(parseInt(e.watchDurationTotal.asYears().toFixed(2))>0){i=e.watchDurationTotal.asYears().toFixed(1);s="Years";n="y"}else if(parseInt(e.watchDurationTotal.asDays().toFixed(2))>0){i=e.watchDurationTotal.asDays().toFixed(1);s="Days";n="d"}else if(parseInt(e.watchDurationTotal.asHours().toFixed(2))>0){i=e.watchDurationTotal.asHours().toFixed(1);s="Hours";n="h"}else if(parseInt(e.watchDurationTotal.asMinutes().toFixed(2))>0){i=e.watchDurationTotal.asMinutes().toFixed(1);s="Minutes";n="m"}else if(parseInt(e.watchDurationTotal.asSeconds().toFixed(2))>0){i=e.watchDurationTotal.asSeconds().toFixed(1);s="Seconds";n="s"}e.timeWatched=e.watchDurationTotal.asMinutes();e.timeWatchedFormatted=i+'<div class="tb-videolytics-category-label">'+s+" Watched</div>";e.timeWatchedFormattedSecondary=i+" "+n}catch(t){TBUtilities.Log(t);e.timeWatched="error";e.timeWatchedFormatted="error"}try{if(e.timeWatched!=null){var r=moment(new Date);var a=moment.duration(r.diff(e.videoPublishDate));var o=a.asDays();var d=e.timeWatched;var l=d/o;var c=moment.duration({seconds:0,minutes:l,hours:0,days:0,years:0});var i="";if(parseInt(c.asYears().toFixed(2))>0)i=c.asYears().toFixed(1)+" Years";else if(parseInt(c.asDays().toFixed(2))>0)i=c.asDays().toFixed(1)+" Days";else if(parseInt(c.asHours().toFixed(2))>0)i=c.asHours().toFixed(1)+" Hours";else if(parseInt(c.asMinutes().toFixed(2))>0)i=c.asMinutes().toFixed(1)+" Minutes";else if(parseInt(c.asSeconds().toFixed(2))>0)i=c.asSeconds().toFixed(1)+" Seconds";e.timeWatchedPerDay=i}}catch(t){TBUtilities.Log(t);e.timeWatchedPerDay="error"}};var Oe=function(e){var t="";var i=jQuery("span[data-ytid='"+e.channelId+"']");if(i.length>0){var s=i.find("img").clone();var n=s.clone();n.attr("height","25px");n.attr("width","25px");n.attr("src",n.attr("data-thumb"));n.removeAttr("onload");t=n.prop("outerHTML")}return t};var Fe=function(e){$watchSideBar=D();if($watchSideBar.find(".tb-videolytics-savevideo").is(":checked")){TBUtilities.CreateCookie("tb-videolytics-saved-videoid-"+TBGlobal.CurrentChannelId(),e,365)}if($watchSideBar.find(".tb-videolytics-image-compare-container").is(":visible")==true){de()}$watchSideBar.find(".tb-videolytics-video-bestpractices-container").hide();var t=TBGlobal.GetYouTubeUI();var i=w(document.documentElement.innerHTML);TubeBuddyYouTubeActions.GetVideoChannelId(e,null,function(t){if(t){me(e);B(t,e,"secondary",true)}else{be()}})};var Ne=function(){jQuery(document.body).on("CRTBVideolyticsGetVideoStats",function(e,t){try{var i=jQuery.parseJSON(t.response);B(t.data.ChannelId,t.data.VideoId,t.data.Type,t.data.ReloadHtml,i)}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBVideolyticsGetVideoStats"})}});jQuery(document.body).on("CRTBVideolyticsGetChannelHovercard",function(e,t){var i=t.data.VideoId;var s=o[i];try{if(t.success){var n="//youtube.com/channel/"+t.data.ChannelId+"/videos";var r=t.response.indexOf(n)-2;var a=t.response.substring(0,r);var d=a.lastIndexOf(",");var l=a.substring(d,a.length);var c=l.match(/\d/g);if(c!=null){c=parseInt(c.join(""))}else{c=0}s.channelVideos=c;s.channelVideosFormatted=TBUtilities.FormatNumberAbbreviated(s.channelVideos)}else{s.channelVideos="error"}}catch(e){s.channelVideos="error";TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBVideolyticsGetChannelHovercard"})}finally{C(s,t.data.Type)}});jQuery(document.body).on("CRTBVideolyticsGetVideoToCompare",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);Fe(i)}else{be();he()}}catch(e){be();he();TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBLoadVideolyticsTemplate"})}});jQuery(document.body).on("CRTBLoadVideolyticsTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);var i=false;if(l&&l==true){i=true}g(i)}else{}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyVideolytics] CRTBLoadVideolyticsTemplate"})}})};var He=function(e,t){Xe(e,t,Ye);et(e,t,Ye)};var _e=function(e,t){ot(e,t,We);at(e,t,We);st(e,t,We);nt(e,t,We);rt(e,t,We);Ke(e,t,We);ze(e,t,We);qe(e,t,We)};var We=function(e,t){if(R(e,t)===true){ie(e,t)}};var Ye=function(e,t){if(V(e,t)===true){se(e,t)}};var ze=function(e,t,i){try{var s=TBUtilities.ParseResponseContextFromHtml(e.html);if(s&&s.engagementPanels){try{var n=s.engagementPanels.filter(e=>e.engagementPanelSectionListRenderer.panelIdentifier==="engagement-panel-transcript"||e.engagementPanelSectionListRenderer.panelIdentifier==="engagement-panel-searchable-transcript");if(n&&n.length>0){e.captionsExist=true}else{e.captionsExist=false}i(e,t)}catch(t){e.captionsExist="error";TBUtilities.Log(t)}}else if(!s.engagementPanels){e.captionsExist=false;i(e,t)}}catch(t){e.captionsExist="error";TBUtilities.Log(t)}};var Je=function(e){var t=e.match(/\d{1,2}(?::[0-5]\d){1,2}/gm);var i=t[0].split(":");if(!i){return NaN}else if(i.length==3){return parseInt(i[0])*60*60+parseInt(i[1])*60+parseInt(i[2])}else if(i.length==2){return parseInt(i[0])*60+parseInt(i[1])}};var qe=function(e,t,i){try{var s=setInterval(function(){if(e&&e.description&&e.adsCompleted==true){clearInterval(s);var n=e.description;var r=n.match(/^\D*(\d{1,2}(?::[0-5]\d){1,2})(?=.*$)/gm);var a=e.durationInMilliseconds/1e3;if(r&&r.length>=3){var o=true;if(Je(r[0])!=0){e.chaptersAdded=false;i(e,t)}else{var d=Je(r[0]);for(var l=1;l<r.length;l++){var c=Je(r[l]);if(c<=d||c>a){o=false}if(l==r.length-1){e.chaptersAdded=o;i(e,t)}else{d=c}}}}else{e.chaptersAdded=false;i(e,t)}}},1e3)}catch(e){TBUtilities.Log(e)}};var $e=function(e){return e.replace(/\\u[\dA-F]{4}/gi,function(e){return String.fromCharCode(parseInt(e.replace(/\\u/g,""),16))})};var Ke=function(e,t,i){try{Xe(e,t,i)}catch(e){TBUtilities.Log(e)}};var Xe=function(e,t,i){if(e.facebookLoading=="true"){clearTimeout(e.socialFacebookTimer);e.socialFacebookTimer=setTimeout(function(){Xe(e,t,i)},1e3)}else if(e.facebookLoading=="done"){clearTimeout(e.socialFacebookTimer);i(e,t)}else{Ze(e,t,i)}};var Ze=function(e,t,i){e.facebookLoading="true";jQuery(document).one("CRTBVideolyticsFacebookApi",function(s,n){e.likedOnFacebook=false;e.facebookLikeCount=0;try{if(n.success==true){var r=TBUtilities.ParseFacebookLikeCountText(n.response);if(r&&r.indexOf("One")>-1){r="1"}var a=r.match(/\d/g);if(a!=null){a=a.join("");var o=parseInt(a);if(o>0){e.likedOnFacebook=true}e.facebookLikeCount=0;try{var d=tt(r);var l=it(d);var c=TBUtilities.FormatNumberAbbreviated(l,null,"tb-videolytics-abbrev");e.facebookLikeCountFormatted=c;e.facebookLikeCount=l}catch(t){e.facebookLikeCountFormatted="error";e.facebookLikeCount="error"}}else{e.facebookLikeCountFormatted=0;e.facebookLikeCount=0}}else{e.facebookLoading="done";e.facebookLikeCountFormatted="error";e.facebookLikeCount="error";e.likedOnFacebook="error";i(e,t)}}catch(t){e.facebookLikeCountFormatted="error";e.facebookLikeCount="error";e.likedOnFacebook="error"}e.facebookLoading="done";i(e,t)});var s="https://www.facebook.com/v2.9/plugins/like.php?action=like&domain=www.youtube.com&href=https://www.youtube.com/watch?v="+e.videoId+"&layout=box_count";TBExtension.Get(s,"CRTBVideolyticsFacebookApi",null)};var et=function(e,t,s){jQuery(document).one("CRTBVideolyticsRedditApi",function(n,r){if(r.success==true){try{var a=jQuery.parseJSON(r.response);if(a.data.children.length>0){var o=0;for(i=0;i<a.data.children.length;i++){o+=a.data.children[i].data.ups}e.redditResults=r;var d=TBUtilities.FormatNumberAbbreviated(o,null,"tb-videolytics-abbrev");e.redditUps=o;e.redditUpsFormatted=d}else{e.redditResults=0;e.redditUps=0;e.redditUpsFormatted=0}}catch(t){e.redditResults="error";e.redditUps="error"}}else{e.redditResults="error";e.redditUps="error"}s(e,t)});e.redditSearchUrl="https://www.reddit.com/search?q="+encodeURI("url:"+e.videoId);var n='url:"'+e.videoId+'"';var r="https://www.reddit.com/search.json?q="+encodeURI(n)+"&restrict_sr=off&sort=relevance&t=all";TBExtension.Get(r,"CRTBVideolyticsRedditApi",null)};var tt=function(e){try{var t=e.indexOf(" ");if(t===-1)return e;else return e.substr(0,t)}catch(e){return""}};var it=function(e){multiplier=e.substr(-1).toLowerCase();if(multiplier=="k"){return parseFloat(e)*1e3}else if(multiplier=="m"){return parseFloat(e)*1e6}else{return e}};var st=function(e,t,i){try{if(e.html){if(e.html.indexOf("cardCollectionRenderer")!==-1){e.infoCardsExist=true}else{e.infoCardsExist=false}}else{e.infoCardsExist="error";i(e,t)}}catch(s){e.infoCardsExist="error";TBUtilities.Log(s);i(e,t)}};var nt=function(e,t,i){try{if(e.html){if(e.html.indexOf("endscreenElementRenderer")!==-1){e.endScreenExist=true}else{e.endScreenExist=false}}else{e.endScreenExist="error";i(e,t)}}catch(s){e.endScreenExist="error";TBUtilities.Log(s);i(e,t)}};var rt=function(e,t,i){try{var s="https://i.ytimg.com/vi/"+e.videoId+"/maxresdefault.jpg";var n=new Image;n.onload=function(){if(n.naturalHeight<720&&n.naturalWidth<1280){e.highResThumbnailExist=false}else{e.highResThumbnailExist=true}i(e,t)};n.onerror=function(){e.highResThumbnailExist="error";i(e,t)};n.src=s}catch(s){e.highResThumbnailExist="error";TBUtilities.Log(s);i(e,t)}};var at=function(e,t,i){try{if(e.commentsResponse==null){ct(e,function(e){lt(e);i(e,t)})}else{lt(e);i(e,t)}}catch(s){TBUtilities.Log(s);i(e,t)}};var ot=function(e,t,i){try{if(e.commentsResponse==null){ct(e,function(e){dt(e);i(e,t)})}else{dt(e);i(e,t)}}catch(s){TBUtilities.Log(s);i(e,t)}};var dt=function(e){try{if(e.commentsResponse!=null){e.commentPinned=false;if(e.commentsResponse.onResponseReceivedEndpoints){var t=e.commentsResponse.onResponseReceivedEndpoints["1"].reloadContinuationItemsCommand.continuationItems;jQuery.each(t,function(t,i){if(i.commentThreadRenderer&&i.commentThreadRenderer.renderingPriority=="RENDERING_PRIORITY_PINNED_COMMENT"){e.commentPinned=true;return false}})}}else{e.commentPinned="error"}}catch(t){e.commentPinned="error"}};var lt=function(e){try{if(e.commentsResponse!=null){e.commentHearted=false;if(e.commentsResponse.onResponseReceivedEndpoints){var t=e.commentsResponse.onResponseReceivedEndpoints["1"].reloadContinuationItemsCommand.continuationItems;jQuery.each(t,function(t,i){try{var s=i.commentThreadRenderer.comment.commentRenderer.actionButtons.commentActionButtonsRenderer.creatorHeart;if(typeof s!="undefined"&&s.creatorHeartRenderer.isHearted===true){e.commentHearted=true;return false}}catch(e){}})}}else{e.commentHearted="error"}}catch(t){e.commentHearted="error"}};var ct=function(e,t){try{var i=TBUtilities.GetCommentTokenFromWatchPageHtml(e.html);if(i){TubeBuddyYouTubeActions.GetCommentsResponse(i,e.videoId).then(i=>{try{e.commentsResponse=i}catch{e.commentsResponse="error"}t(e)}).catch(i=>{e.commentsResponse="error";TBUtilities.LogError({Exception:i,Location:"Videolytics.js|getCommentsResponse"});t(e)})}else{e.commentsResponse="error";t(e)}}catch(i){e.commentsResponse="error";t(e)}};var ut=function(){s=TBUtilities.GetUrlParameter("v");if(!s){return}var i=jQuery("meta[itemprop=isLiveBroadcast]").attr("content");var n=jQuery("meta[itemprop=endDate]").attr("content");if(typeof i!==typeof undefined&&i!==false&&i=="True"&&typeof n===typeof undefined){return}setTimeout(function(){var i=jQuery("ytd-tvfilm-offer-module-renderer.ytd-watch-next-secondary-results-renderer");if(i.length==1){return}y=false;if(!e){TBUtilities.Log("TubeBuddyVideolytics initi scripts");t=jQuery("meta[itemprop=channelId]").attr("content");if(t=="UClgRkhTL3_hImCAmdLfDE4g"||t=="UCuVPpxrm2VAgpH3Ktln4HXg"){return}if(t){Q(function(){e=true;Ne();N();le()})}else{TubeBuddyYouTubeActions.GetVideoChannelId(s,null,function(i){t=i;if(t=="UClgRkhTL3_hImCAmdLfDE4g"||t=="UCuVPpxrm2VAgpH3Ktln4HXg"){return}if(i){Q(function(){e=true;Ne();if(TBExtension.GetType()=="safari"){setTimeout(function(){le();N()},1e3)}else{le();N()}})}else{TBUtilities.Log("TubeBuddyVideolytics no channel id found")}})}}else{if(t=="UClgRkhTL3_hImCAmdLfDE4g"||t=="UCuVPpxrm2VAgpH3Ktln4HXg"){return}TBUtilities.Log("TubeBuddyVideolytics partial load");s=TBUtilities.GetUrlParameter("v");t=null;TubeBuddyYouTubeActions.GetVideoChannelId(s,null,function(e){if(e){t=e;g(true)}})}},2e3)};var pt=function(){var e=setInterval(function(){var t=jQuery("ytd-comments-header-renderer.ytd-item-section-renderer");if(t.length>0){clearInterval(e);jQuery("ytd-comments-header-renderer.ytd-item-section-renderer").find("div#title").append(jQuery(".tb-videolytics-word-cloud-button-container"));jQuery(".tb-videolytics-word-cloud-button-container").show()}},1e3)};return{Initialize:function(e){l=e;pt();TBUtilities.Log("TubeBuddyVideolytics Initialize");if(TBGlobal.IsAuthenticated()){ut()}else{TBUtilities.Log("TubeBuddyVideolytics disabled")}},CleanPage:function(){var e=D();var t=e.find(".tb-videolytics-container");if(t.length>0){t.remove()}var i=e.find(".tb-videolytics-container-disabled");if(i.length>0){i.remove()}}}}();function VideolyticsData(){this.channelId=null;this.videoId=null;this.html=null;this.statsData=null;this.views=null;this.viewsFormatted=null;this.percentChangeOverAverage=null;this.percentChangeOverAverageFormatted=null;this.likes=null;this.likesFormatted=null;this.engagementLikeRatio=null;this.engagementLikeRatioFormatted=null;this.engagementLikeRatioScore=null;this.viewsPerHour=null;this.viewsPerHourFormatted=null;this.durationSincePublish=null;this.viewHistoricalData=null;this.watchTimeAvgViewDuration=null;this.videoDuration=null;this.watchTimeAvgViewDurationInMilliSeconds=null;this.watchTimeAvgPercentWatched=null;this.watchTimeAvgPercentWatchedFormatted=null;this.tags=null;this.commentToken=null;this.sessionToken=null;this.commentCount=null;this.commentCountFormatted=null;this.engagementRatio=null;this.engagementRatioFormatted=null;this.engagementRatioScore=null;this.earnings=null;this.earningsFormatted=null;this.earningsRange=null;this.views48hrs=null;this.views48hrsFormatted=null;this.views48hrsPercentOfTotal=null;this.views48hrsPercentOfTotalFormatted=null;this.timeWatched=null;this.timeWatchedFormatted=null;this.timeWatchedFormattedSecondary=null;this.timeWatchedPerDay=null;this.watchDurationTotal=null;this.subscribersGained=null;this.subscribersGainedFormatted=null;this.creatorSuggestedCount=null;this.creatorSuggestedScore=null;this.creatorSuggestedFormatted=null;this.suggestedCount=null;this.title=null;this.description=null;this.tagsIn=null;this.tagsInScore=null;this.ownerUrl=null;this.channelAboutHtml=null;this.subscribers=null;this.subscribersFormatted=null;this.channelViews=null;this.channelViewsFormatted=null;this.channelVideos=null;this.channelVideosFormatted=null;this.commentsPerView=null;this.subsPerView=null;this.averageViewsPerVideo=null;this.averageViewsPerVideoFormatted=null;this.subscribersPerDay=null;this.subscribersPerDayFormatted=null;this.percentOfChannelViews=null;this.percentOfChannelViewsFormatted=null;this.viewsToSubscriberRatio=null;this.viewsToSubscriberRatioFormatted=null;this.viewsToSubscriberRatioFormula=null;this.engagementsPerDay=null;this.engagementsPerDayFormatted=null;this.totalEngagements=null;this.videosPerWeek=null;this.videosPerWeekFormatted=null;this.$pageHtml=null;this.ui=null;this.chartsObj;this.videoPublishDate=null;this.durationInMilliseconds=null;this.viewsPerDay=null;this.viewsPerDayFormatted=null;this.idToken=null;this.uiVersionNumber=null;this.serverStats=null;this.language=null;this.ytplayerconfig=null;this.commentsResponse=null;this.commentHearted=null;this.infoCardsExist=null;this.endScreenExist=null;this.highResThumbnailExist=null;this.likedOnFacebook=null;this.facebookLoading=null;this.facebookLikeCount=null;this.facebookLikeCountFormatted=null;this.redditResults=null;this.redditUps=null;this.redditUpsFormatted=null;this.redditSearchUrl=null;this.sessionLink=null;this.socialFacebookTimer=null}var TubeBuddyScheduledMetaUpdates=function(){var e=false;var t=null;var i=null;var s=null;var n=null;var r=null;var a=null;var o=null;var d=null;var l=true;var c=function(){var e=TBGlobal.host+"/ModuleManager/ScheduledMetaUpdates/ScheduledMetaUpdates?v="+TBGlobal.versionNumber;if(loadLocalHTML&&(TBExtension.GetType()=="chrome"||TBExtension.GetType()=="firefox")){e=chrome.extension.getURL("modules/scheduledmetaupdates.html")}else if(loadLocalHTML&&TBExtension.GetType()=="safari"){e="modules/scheduledmetaupdates.html"}TBExtension.Get(e,"CRTBLoadScheduledMetaUpdatesTemplate")};var u=function(){jQuery(document).on("click",".tb-scheduled-meta-updates-video-upgrade-link",function(e){TBGlobal.ShowUpgradePage("",TBGlobal.limitation.scheduledvideoupdate)});jQuery(document).on("click",".tb-scheduled-meta-updates-video-close, .tb-scheduled-meta-updates-video-closex",function(e){TubeBuddyMenu.HideBackground();jQuery("#tb-scheduled-meta-updates-video").hide()});jQuery(document).on("click",".tb-tabs-menu-item-container",function(){jQuery(this).parent().find(".tb-tabs-selected-menu-item").removeClass("tb-tabs-selected-menu-item");jQuery(this).parents().find(".tb-tabs-content").addClass("tb-hid");jQuery(this).addClass("tb-tabs-selected-menu-item");jQuery(this).find(".tb-tabs-menu-item-icon").addClass("tb-tabs-selected-menu-icon");jQuery(this).parents().find("#"+jQuery(this).attr("data-tab")).removeClass("tb-hid")});jQuery(document).on("click",".tb-scheduled-meta-updates-video-option-checkbox",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-option-checkbox click");var t=jQuery(this).is(":checked");if(t===true){jQuery(this).parent().parent().parent().parent().siblings().children().children("input,select,textarea").prop("disabled",false)}else{jQuery(this).parent().parent().parent().parent().siblings().children().children("input,textarea").val("");jQuery(this).parent().parent().parent().parent().siblings().children().children("input,select,textarea").prop("disabled",true)}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-removeFromPlaylistOptions",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-removeFromPlaylistOptions click");var t=jQuery(this).is(":checked");if(t===true){jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("checked",true)}else{var i=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.disable()}});jQuery(document).on("click","#tb-scheduled-meta-updates-timepicker",function(e){if(jQuery("#tb-scheduled-meta-updates-time").find(".tp-timepicker_wrap").length>0)if(jQuery("#tb-scheduled-meta-updates-time").find(".tp-timepicker_wrap")[0].outerHTML.indexOf("tb-pickr-midnight")==-1)jQuery("#tb-scheduled-meta-updates-time").find(".tp-timepicker_wrap").append('<div style="clear:both;"></div><div class="tb-pickr-midnight" style="border-top:solid 1px #ccc; padding-top:3px; padding-left:1px; margin:15px 5px 0px 5px;">Set to <a class="tb-pickr-set-to-midnight">Midnight</a></div>')});jQuery(document).on("click",".tb-pickr-set-to-midnight",function(e){jQuery("#tb-scheduled-meta-updates-time").find(".tp-meridian").find("input").val("AM");jQuery("#tb-scheduled-meta-updates-time").find(".tp-time").find("input").val("12");jQuery("#tb-scheduled-meta-updates-time").find(".tp-mins").find("input").val("00")});jQuery(document).on("click","#tb-scheduled-meta-updates-video-removeFromAllPlaylists",function(e){var t=jQuery(this).is(":checked");if(t===true){var i=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.disable()}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-thumbnail-option",function(e){var t=jQuery(this).is(":checked");if(t===false){a=null;n=null;r=null}});jQuery(document).on("change","#tb-scheduled-meta-updates-video-thumbnail-upload",function(e){var t=document.getElementById("tb-scheduled-meta-updates-video-thumbnail-upload").value;var i=t.match(/\.([^\.]+)$/)[1];i=i.toLowerCase();switch(i){case"png":case"bmp":case"gif":case"jpg":{$("#tb-scheduled-meta-updates-video-namefile").text(t)}break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");jQuery("#tb-scheduled-meta-updates-video-namefile").text(t);callback(false)}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-save",function(e){var t=jQuery("#tb-scheduled-meta-updates-video-thumbnail-option").is(":checked");if(t===true){v(function(e){if(e===true){if(b()){y()}}})}else{if(b()){y()}}});jQuery(document).on("click","#tb-scheduled-meta-updates-video-addToPlaylists",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-addToPlaylists click");var t=jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){t.enable();t.showDropDown()}else{t.disable()}});jQuery(document).on("change","#tb-scheduled-meta-updates-video-removeFromPlaylistIds",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-removeFromPlaylistIds click");var t=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");if(jQuery(this).is(":checked")){t.enable()}else{t.disable()}});jQuery(document).on("change","#tb-scheduled-meta-updates-video-revert-option",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-revert-option click");if(jQuery(this).is(":checked")){jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-timepicker-revert").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick("enable")}else{jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-timepicker-revert").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick("disable")}});jQuery(document).on("click","input[name='descCampaignTarget']",function(e){TBUtilities.Log("input[name=descCampaignTarget] click");var t=jQuery(this).attr("value");jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-videoIds").hide();jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").hide();switch(t){case"0":{jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-videoIds").show();break}case"1":{jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").show();var i=jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.enable();i.showDropDown();break}}});jQuery(document).on("click",".tb-scheduled-meta-updates-video-cancel",function(e){TBUtilities.Log("tb-scheduled-meta-updates-video-cancel click");try{TBUtilities.Confirm("Are you sure you want to cancel this Video Update?",function(){const e=TBGlobal.GetToolById("scheduledvideoupdate").name;TBUtilities.ReportProductEvent("Feature Used",{Tool:e,Action:`Cancelling scheduled video update`});var t=TBGlobal.host+TBGlobal.apiUrls.scheduledMetaUpdatesDelete;var i={Id:o};p(d);TBExtension.Post(t,JSON.stringify(i),"CRTBScheduledMetaUpdatesDelete",null,{contentType:"application/json"})},function(){})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] cancel click"})}})};var p=function(e){if(e.ScheduledMetaUpdateTitleUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-title-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-title-change").val(e.TitleUpdate);jQuery("#tb-scheduled-meta-updates-video-title-change").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-title-update-types").val(e.ScheduledMetaUpdateTitleUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-title-update-types").prop("disabled",false)}if(e.ScheduledMetaUpdateDescriptionUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-description-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-description-change").val(e.DescriptionUpdate);jQuery("#tb-scheduled-meta-updates-video-description-change").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-description-update-types").val(e.ScheduledMetaUpdateDescriptionUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-description-update-types").prop("disabled",false)}if(e.ScheduledMetaUpdateTagsUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-tags-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-tags-change").val(e.TagsUpdate);jQuery("#tb-scheduled-meta-updates-video-tags-change").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-tags-update-types").val(e.ScheduledMetaUpdateTagsUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-tags-update-types").prop("disabled",false)}if(e.ScheduledMetaUpdatePrivacyUpdateTypes!=0){jQuery("#tb-scheduled-meta-updates-video-privacy-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-privacy-type").val(e.ScheduledMetaUpdatePrivacyUpdateTypes);jQuery("#tb-scheduled-meta-updates-video-privacy-type").prop("disabled",false)}jQuery("#tb-scheduled-meta-updates-video-datepicker").val(e.ScheduledLocalDate);var t=j(e.ScheduledLocalTime);jQuery("#tb-scheduled-meta-updates-timepicker").val(t);jQuery("#tb-scheduled-meta-updates-video-timezone-select").val(e.TimeZoneId);if(e.PlaylistIdsToAddTo&&e.PlaylistIdsToAddTo!=""){var i=jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.setIds(e.PlaylistIdsToAddTo);jQuery("#tb-scheduled-meta-updates-video-addToPlaylists").prop("checked",true)}if(e.PlaylistIdsToRemoveFrom&&e.PlaylistIdsToRemoveFrom!=""){var i=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");i.setIds(e.PlaylistIdsToAddTo);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistIds").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistIds").prop("disabled",false)}if(e.RemoveFromAllPlaylists===true){jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistIds").prop("disabled",false)}if(e.SendWarningEmail==true){jQuery("#tb-scheduled-meta-updates-video-emailreminder").prop("checked",true)}if(e.SendWarningEmailNow==true){jQuery("#tb-scheduled-meta-updates-video-emailreminder-now").prop("checked",true)}if(e.EndLocalDate!=null&&e.EndLocalTime!=null){jQuery("#tb-scheduled-meta-updates-video-revert-option").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").val(e.EndLocalDate);var t=j(e.EndLocalTime);jQuery("#tb-scheduled-meta-updates-timepicker-revert").val(t);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").prop("disabled",false);jQuery("#tb-scheduled-meta-updates-timepicker-revert").prop("disabled",false)}};var y=function(){try{m();var e=g();var t=f(e,false);TBUtilities.Confirm(t,function(){const t=TBGlobal.GetToolById("scheduledvideoupdate").name;TBUtilities.ReportProductEvent("Feature Used",{Tool:t,Action:`Scheduling video update`});var i='<img src="'+TBGlobal.host+'/images/general/loading1.gif" />'+'<span style="margin-left:10px; font-size: 130%">Scheduling...</span>';jQuery(".tb-scheduled-meta-updates-video-settings-container").block({message:i,css:{padding:"30px 20px;",border:"2px solid #77889"},overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"unavailable"}});var s=TBGlobal.host+TBGlobal.apiUrls.scheduledMetaUpdatesCreate;TBExtension.Post(s,JSON.stringify(e),"CRTBScheduledMetaUpdateCreate",null,{contentType:"application/json"})},function(){h()})}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] save click"});jQuery("#tb-scheduled-meta-updates-video-save").text("Schedule Publish");jQuery("#tb-scheduled-meta-updates-video-save").attr("disabled",false)}};var b=function(){var e=g();if(jQuery(".tb-scheduled-meta-updates-video-main-content-options input[type=checkbox]:checked").length===0){TBUtilities.Alert("You must make a change above before scheduling an update");h();return false}var t=jQuery("#tb-scheduled-meta-updates-video-title-option").is(":checked");if(t===true){if(e.TitleUpdate==""){TBUtilities.Alert("Please enter a title change");h();return false}}var i=jQuery("#tb-scheduled-meta-updates-video-tags-option").is(":checked");if(i===true){if(e.TagsUpdate==""){h();TBUtilities.Alert("Please enter a tags change");return false}}var s=jQuery("#tb-scheduled-meta-updates-video-description-option").is(":checked");if(s===true){if(e.DescriptionUpdate==""){h();TBUtilities.Alert("Please enter a description change");return false}}var n=jQuery("#tb-scheduled-meta-updates-video-addToPlaylists").is(":checked");if(n===true){var r=[];if(e.PlaylistIdsToAddTo!=null&&e.PlaylistIdsToAddTo.length>0){var r=e.PlaylistIdsToAddTo.split(",")}if(r.length==0){h();TBUtilities.Alert("Please select a playlist to add to");return false}}var a=jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").is(":checked");if(a===true){if(e.RemoveFromAllPlaylists==false){var r=[];if(e.PlaylistIdsToRemoveFrom!=null&&e.PlaylistIdsToRemoveFrom.length>0){var r=e.PlaylistIdsToRemoveFrom.split(",")}if(r.length==0){h();TBUtilities.Alert("Please select a playlist to remove");return false}}}var o=jQuery("#tb-scheduled-meta-updates-video-revert-option").is(":checked");if(o===true){var d=jQuery("#tb-scheduled-meta-updates-video-datepicker").val();var l=jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").val();var c=new Date(d);var u=new Date(l);if(c.getTime()>u.getTime()){h();TBUtilities.Alert("Please select a rollback date that is after the start date");return false}}return true};var m=function(){jQuery("#tb-scheduled-meta-updates-video-save").text("Scheduling...");jQuery("#tb-scheduled-meta-updates-video-save").attr("disabled",true)};var h=function(){jQuery(".tb-scheduled-meta-updates-video-settings-container").unblock();jQuery("#tb-scheduled-meta-updates-video-save").text("Schedule Video Update");jQuery("#tb-scheduled-meta-updates-video-save").attr("disabled",false)};var v=function(e){var t=document.getElementById("tb-scheduled-meta-updates-video-thumbnail-upload");var i=t.value;$("#tb-scheduled-meta-updates-video-namefile").text(i);if(!i){TBUtilities.Alert("Please choose a thumbnail file to upload");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");e(false)}var s=i.match(/\.([^\.]+)$/)[1];s=s.toLowerCase();switch(s){case"png":case"bmp":case"gif":case"jpg":break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");$("#tb-scheduled-meta-updates-video-namefile").text(i);e(false)}var o=t.files[0].size;if(o>2e6){TBUtilities.Alert("The maximum image file size is 2MB. Please select a smaller image.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");e(false)}var d=new FileReader;d.readAsDataURL(t.files[0]);d.onloadend=function(t){var i=t.target.result;a=i;var o="";switch(s){case"png":o=i.replace("data:image/png;base64,","");break;case"bmp":o=i.replace("data:image/bmp;base64,","");break;case"gif":o=i.replace("data:image/gif;base64,","");break;case"jpg":o=i.replace("data:image/jpeg;base64,","");break;default:TBUtilities.Alert("Only .JPG, .GIF, .BMP, or .PNG formats are allowed.");jQuery("#tb-scheduled-meta-updates-video-thumbnail-upload").val("");e(false)}n=o;r=s;e(true)}};var f=function(e,t){var i=e.ScheduledLocalDate;var s=j(e.ScheduledLocalTime);var r=e.TimeZoneId;var o=jQuery("#tb-scheduled-meta-updates-video-summary-template").html();var d="";if(e.ScheduledMetaUpdateTitleUpdateTypes!=0||e.ScheduledMetaUpdateDescriptionUpdateTypes!=0||e.ScheduledMetaUpdateTagsUpdateTypes!=0||e.ScheduledMetaUpdatePrivacyUpdateTypes!=0||(n!=null||e.ScheduledMetaUpdateThumbnailUpdateTypes!=0&&e.ThumbnailId!="")){d="<table class='tb-scheduled-meta-updates-video-summary-table'>";d+='<tr><th style="width:100px"></th><th style="width:100px">Update Type</th> <th style="width:300px">Value</th> </tr>';if(e.ScheduledMetaUpdateTitleUpdateTypes!=0){d+="<tr><td><strong>Title</strong></td><td>"+e.ScheduledMetaUpdateTitleUpdateTypesDesc+"</td><td>"+e.TitleUpdate+"</td></tr>"}if(e.ScheduledMetaUpdateDescriptionUpdateTypes!=0){d+="<tr><td><strong>Description</strong></td><td>"+e.ScheduledMetaUpdateDescriptionUpdateTypesDesc+"</td><td>"+e.DescriptionUpdate+"</td></tr>"}if(e.ScheduledMetaUpdateTagsUpdateTypes!=0){d+="<tr><td><strong>Tags</strong></td><td>"+e.ScheduledMetaUpdateTagsUpdateTypesDesc+"</td><td>"+e.TagsUpdate+"</td></tr>"}if(e.ScheduledMetaUpdatePrivacyUpdateTypes!=0){d+="<tr><td><strong>Privacy</strong></td><td> Overwrite </td><td>"+e.ScheduledMetaUpdatePrivacyUpdateTypesDesc+"</td></tr>"}if(n!=null){var l=jQuery("<img>");l.attr("src",a);l.attr("height","25px");d+="<tr><td><strong>Thumbnail</strong></td><td> Overwrite </td><td>"+l[0].outerHTML+"</td></tr>"}if(e.ScheduledMetaUpdateThumbnailUpdateTypes!=0&&e.ThumbnailId!=""){var l=jQuery("<img>");l.attr("src","https://s3-us-west-1.amazonaws.com/tubebuddy/scheduledmetaupdates/"+e.ThumbnailId+".jpg");l.attr("height","25px");d+="<tr><td><strong>Thumbnail</strong></td><td> Overwrite </td><td>"+l[0].outerHTML+"</td></tr>"}d+="</table>"}var c="";if(e.RemoveFromAllPlaylists==true){c="&#149;Video will be removed from <span style='background-color:#ffffcc; padding:3px 4px'><strong>all</strong> playlists</span>"}else if(e.PlaylistIdsToRemoveFrom!=null&&e.PlaylistIdsToRemoveFrom!=""){var u=e.PlaylistIdsToRemoveFrom.split(",");c="&#149;Video will be removed from the following playlists:<br>";jQuery.each(e.PlaylistsToRemoveFrom,function(e,t){c+='&nbsp;&nbsp;<strong style="font-size:13px; padding:4px 3px;"><a target="_blank" href="https://www.youtube.com/playlist?list='+t.Id+'">'+t.Title+"</a></strong><br>"})}var p="";if(e.PlaylistIdsToAddTo!=null&&e.PlaylistIdsToAddTo!=""){var u=e.PlaylistIdsToAddTo.split(",");p="&#149;Video will be added to the following playlists:<br>";jQuery.each(e.PlaylistsToAddTo,function(e,t){p+='&nbsp;&nbsp;<strong style="font-size:13px; padding:4px 3px;"><a target="_blank" href="https://www.youtube.com/playlist?list='+t.Id+'">'+t.Title+"</a></strong><br>"})}var y="";if(e.EndLocalDate!=null&&e.EndLocalTime!=null){var b=e.EndLocalDate;var m=j(e.EndLocalTime);y="<p class='tb-margin-bottom-5'>Changes will be rolled back on:</p> <span style='font-size:16px; color: #4A90E2;' class='tb-font-medium'>"+b+"  at "+m+" "+r+"</span>"}var h="&#149;  We'll send you an email reminder the day before.";if(e.SendWarningEmail==false){h=""}if(t===false&&e.SendWarningEmailNow===true){if(h.length>0){h+="<br>"}h+="&#149;  We'll send you a copy of scheduled changes right now."}var v="Are you sure you want to schedule the following changes?";var f="";if(t==true){f='<img style="position: relative; top: 3px; margin-right:3px" src="https://tubebuddy.com/images/icons/check.png" />';v=""}var g=o.formatTemplate(i,s,r,d,c,p,y,h,v,f);return g};var g=function(){var e=jQuery("#tb-scheduled-meta-updates-video-datepicker").val();var i=T(jQuery("#tb-scheduled-meta-updates-timepicker").val());var s=jQuery("#tb-scheduled-meta-updates-timepicker").val();var a=jQuery("#tb-scheduled-meta-updates-video-timezone-select").val();var o=jQuery("#tb-scheduled-meta-updates-video-privacy-option").is(":checked");var d=0;var l=null;if(o===true){d=jQuery("#tb-scheduled-meta-updates-video-privacy-type").val();l=jQuery("#tb-scheduled-meta-updates-video-privacy-type option:selected").text()}var c=jQuery("#tb-scheduled-meta-updates-video-title-option").is(":checked");var u=0;var p=null;var y=null;if(c===true){y=jQuery("#tb-scheduled-meta-updates-video-title-update-types option:selected").text();u=jQuery("#tb-scheduled-meta-updates-video-title-update-types").val();p=jQuery("#tb-scheduled-meta-updates-video-title-change").val();jQuery("#tb-scheduled-meta-updates-video-title-change").prop("disabled",false)}var b=jQuery("#tb-scheduled-meta-updates-video-tags-option").is(":checked");var m=0;var h=null;var v=null;if(b===true){m=jQuery("#tb-scheduled-meta-updates-video-tags-update-types").val();h=jQuery("#tb-scheduled-meta-updates-video-tags-change").val();v=jQuery("#tb-scheduled-meta-updates-video-tags-update-types option:selected").text()}var f=jQuery("#tb-scheduled-meta-updates-video-description-option").is(":checked");var g=0;var j=null;var Q=null;if(f===true){g=jQuery("#tb-scheduled-meta-updates-video-description-update-types").val();j=jQuery("#tb-scheduled-meta-updates-video-description-change").val();Q=jQuery("#tb-scheduled-meta-updates-video-description-update-types option:selected").text()}var B=jQuery("#tb-scheduled-meta-updates-video-addToPlaylists").is(":checked");var w=null;var k=null;if(B===true){var E=jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");var x=E.getSelectedPlaylistIds();k=E.getSelectedPlaylists();if(x.length>0){w=x.join(",")}}var C=jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").is(":checked");var U=null;var L=false;var S=null;if(C===true){if(jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").is(":checked")){L=true}else{var E=jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true}).data("plugin_playlistSelect");S=E.getSelectedPlaylists();var x=E.getSelectedPlaylistIds();if(x.length>0){U=x.join(",")}}}var I=jQuery("#tb-scheduled-meta-updates-video-emailreminder").is(":checked");var R=jQuery("#tb-scheduled-meta-updates-video-emailreminder-now").is(":checked");var V=null;var A=null;var D=jQuery("#tb-scheduled-meta-updates-video-revert-option").is(":checked");if(D===true){V=jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").val();A=T(jQuery("#tb-scheduled-meta-updates-timepicker-revert").val())}var P={TargetIds:t,ScheduledLocalDate:e,ScheduledLocalTime:i,TimeZoneId:a,ScheduledMetaUpdatePrivacyUpdateTypes:d,ScheduledMetaUpdatePrivacyUpdateTypesDesc:l,ScheduledMetaUpdateTitleUpdateTypes:u,TitleUpdate:p,ScheduledMetaUpdateTitleUpdateTypesDesc:y,ScheduledMetaUpdateDescriptionUpdateTypes:g,DescriptionUpdate:j,ScheduledMetaUpdateDescriptionUpdateTypesDesc:Q,ScheduledMetaUpdateTagsUpdateTypes:m,TagsUpdate:h,ScheduledMetaUpdateTagsUpdateTypesDesc:v,ScheduledMetaUpdateThumbnailUpdateTypes:0,PlaylistIdsToAddTo:w,PlaylistsToAddTo:k,PlaylistIdsToRemoveFrom:U,PlaylistsToRemoveFrom:S,RemoveFromAllPlaylists:L,SendWarningEmail:I,SendWarningEmailNow:R,TimeRecent:s,ScheduledMetaUpdateTargetVideoType:0,EndLocalDate:V,EndLocalTime:A,ThumbnailData:n,ThumbnailExt:r};return P};var T=function(e){var t=e.split(":");if(t.length!=3){throw"invalid time format"}var i=t[0];var s=t[1];if(t[2].trim()=="PM"&&t[0]!=12){i=parseInt(i,10);i=i+12}if(t[2].trim()=="AM"&&t[0]==12)i=0;var n=parseInt(i,10)*60+parseInt(s,10);return n};var j=function(e){var t=Math.floor(e/60);var e=e%60;var i=t>=12?"PM":"AM";t=t%12;t=t?t:12;e=e<10?"0"+e:e;var s=t+":"+e+":"+i;return s};var Q=function(){jQuery(document.body).on("CRTBLoadScheduledMetaUpdatesTemplate",function(e,t){try{if(t.success){t.response=TBUtilities.FixLocalHtml(DOMPurify.sanitize(t.response,DOMPurifyConfig));jQuery("body").append(t.response);w()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBLoadScheduledMetaUpdatesTemplate"})}});jQuery(document.body).on("CRTBScheduledMetaUpdatesGetVideo",function(e,t){try{if(t.success){var i=jQuery.parseJSON(t.response);if(i.ScheduledMetaUpdateViewModel==null){h();jQuery("#tb-scheduled-meta-updates-video-loading").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loaded").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-edit").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-current").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-cancel").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-status-bar").addClass("tb-hid");var s=jQuery("#tb-scheduled-meta-updates-video-datepicker").datepick({minDate:new Date,onSelect:function(e){try{var t=$(this).val();var i=24*60*60*1e3;var s=Math.abs((new Date(t).getTime()-(new Date).getTime())/i);if(s<=1){jQuery("#tb-scheduled-meta-updates-video-emailreminder").attr("checked",false);jQuery("#tb-scheduled-meta-updates-video-emailreminder").attr("disabled",true)}else{jQuery("#tb-scheduled-meta-updates-video-emailreminder").attr("disabled",false)}}catch(e){}}});var s=jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick({minDate:new Date,onSelect:function(e){}});if(!jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-tim")){jQuery("#tb-scheduled-meta-updates-timepicker").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}if(!jQuery("#tb-scheduled-meta-updates-timepicke-revertr").attr("data-timepicki-tim")){jQuery("#tb-scheduled-meta-updates-timepicker-revert").timepicki({start_time:["09","30","AM"],increase_direction:"up"})}if(l===true){var n=jQuery("#tb-scheduled-meta-updates-video-timezone-select");n.empty();jQuery(i.TimeZones).each(function(){n.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});var r=new Date;var a=new Date(r);a.setDate(r.getDate()+2);jQuery("#tb-scheduled-meta-updates-video-datepicker").datepick("setDate",a);var r=new Date;var c=new Date(r);c.setDate(r.getDate()+7);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick("setDate",c);jQuery("#tb-scheduled-meta-updates-video-datepicker-revert").datepick({minDate:new Date});try{var u=TBUtilities.GetTimeZoneOffSetInHours();jQuery.each(i.TimeZones,function(e,t){if(t.DisplayName.indexOf(u)>0){n.val(t.Id)}})}catch(e){}jQuery("#tb-scheduled-meta-updates-video-removeFromPlaylistOptions").prop("checked",false);jQuery("#tb-scheduled-meta-updates-video-removeFromAllPlaylists").prop("checked",false);jQuery("#tb-scheduled-meta-updates-video-input-ids").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-timepicker-revert").val("09 : 30 : AM");jQuery("#tb-scheduled-meta-updates-timepicker-revert").timepicki({start_time:["09","30","AM"]});jQuery("#tb-scheduled-meta-updates-timepicker-revert").attr("data-timepicki-tim","09");jQuery("#tb-scheduled-meta-updates-timepicker-revert").attr("data-timepicki-mini","30");jQuery("#tb-scheduled-meta-updates-timepicker-revert").attr("data-timepicki-meri","AM");jQuery("#tb-scheduled-meta-updates-timepicker").val("09 : 30 : AM");jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-tim","09");jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-mini","30");jQuery("#tb-scheduled-meta-updates-timepicker").attr("data-timepicki-meri","AM")}}else{jQuery("#tb-scheduled-meta-updates-video-loading").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-edit").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-current").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loaded").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-cancel").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-status-bar").removeClass("tb-hid");var n=jQuery("#tb-scheduled-meta-updates-video-timezone-select");n.empty();jQuery(i.TimeZones).each(function(){n.append(jQuery("<option>").attr("value",this.Id).text(this.DisplayName))});o=i.ScheduledMetaUpdateViewModel.Id;d=i.ScheduledMetaUpdateViewModel;var p=f(i.ScheduledMetaUpdateViewModel,true);jQuery("#tb-scheduled-meta-updates-video-current").html(p)}}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBScheduledMetaUpdatesGetVideo"})}});jQuery(document.body).on("CRTBScheduledMetaUpdateCreate",function(e,t){try{jQuery(".tb-scheduled-meta-updates-video-settings-container").unblock();n=null;a=null;r=null;if(t.success){B()}else{if(t.status==426){TBUtilities.Alert("You must select a date and time in the future.")}else{TBUtilities.Alert("There was a problem saving your request.  Please try again...")}h()}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBLoadScheduledMetaUpdatesTemplate"})}});jQuery(document.body).on("CRTBScheduledMetaUpdatesDelete",function(e,t){try{o=null;d=null;l=false;if(t.success){B()}else{TBUtilities.Alert("There was a problem with your request.  Please try again...")}}catch(e){TBUtilities.LogError({Exception:e,Location:"[TubeBuddyScheduledMetaUpdates] CRTBLoadScheduledMetaUpdatesTemplate"})}})};var B=function(){if(TBGlobal.CanAccessLevel2Tools()==true){if(t){var e=TBGlobal.host+TBGlobal.apiUrls.scheduledMetaUpdatesGetByVideo+"?videoId="+t;TBExtension.Get(e,"CRTBScheduledMetaUpdatesGetVideo")}}else{jQuery("#tb-scheduled-meta-updates-video-upgrade").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loading").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-loaded").addClass("tb-hid")}};var w=function(){jQuery("#tb-scheduled-meta-updates-video-container").show();jQuery("#tb-scheduled-meta-updates-video-loading").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-loaded").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-current").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-cancel").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-status-bar").addClass("tb-hid");jQuery(".tb-scheduled-meta-updates-video-upgrade").addClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-edit").removeClass("tb-hid");jQuery("#tb-scheduled-meta-updates-video-save").addClass("tb-hid");h();B();jQuery(".tb-scheduled-meta-updates-video-option-checkbox").prop("checked","");jQuery(".tb-scheduled-meta-updates-video-option-checkbox").siblings("input, textarea").not("input:radio").val("");jQuery(".tb-scheduled-meta-updates-video-option-checkbox").siblings("input, textarea, select").prop("disabled",true);jQuery("#tb-scheduled-meta-updates-video-revert-option").prop("checked","");jQuery("#tb-scheduled-meta-updates-video-emailreminder").prop("checked","");jQuery("#tb-scheduled-meta-updates-video-emailreminder-now").prop("checked","");jQuery(".tb-scheduled-meta-updates-video-tab").removeClass("tb-scheduled-meta-updates-video-tab-selected");jQuery("#tb-scheduled-meta-updates-video-add-playlist-ids").playlistSelect({tbMaterial:true});jQuery("#tb-scheduled-meta-updates-video-remove-playlist-ids").playlistSelect({tbMaterial:true});jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").playlistSelect({tbMaterial:true});jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-videoIds").hide();jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-playlistIds").hide();jQuery("#tb-scheduled-meta-updates-video-descriptioncampaign-allVideos").prop("checked",true);jQuery("#tb-scheduled-meta-updates-video-thumbnail").attr("src",s);jQuery("#tb-scheduled-meta-updates-video-link").text(i);jQuery("#tb-scheduled-meta-updates-video-link").attr("href","https://www.youtube.com/watch?v="+t);n=null;r=null;a=null;o=null;l=true;jQuery('[data-tbtooltip!=""]').qtip({content:{attr:"data-tbtooltip"},style:{classes:"qtip-youtube-tubebuddy"}})};return{Show:function(n,r,a){if(TBGlobal.IsAuthenticated()){t=n;i=r;s=a?a:"https://img.youtube.com/vi/"+t+"/mqdefault.jpg";if(!e){Q();c();u();e=true}else{w()}}}}}();